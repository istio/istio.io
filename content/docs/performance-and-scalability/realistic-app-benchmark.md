---
title: Customer-like Application Benchmark
description: Performance measurement through realistic micro service application tests.
weight: 40
---

## Overview  ##

The Regression Patrol for Istio Performance is an automated suite of tests running a customer-like microservices application (BluePerf, a.k.a, Acmeair) on an IBM Cloud Kubernetes Service (IKS) cluster using the latest available Istio build as the service mesh orchestrator.

Its objective is to detect performance regression in the current build and provide data to possibly identify the reason for the regression.  We selected the maximum throughput provided by the system as the single Key Performance Indicator (KPI) for evaluating whether the performance has regressed compared to previous builds.

Three configurations are tested for each build:

* **Istio Full:** Istio is deployed to the K8s cluster using the manifest file that comes in the build, with the default configuration. Some changes are made to force pods to certain nodes.

* **No Mixer:** the Telemetry and Policy functions of Mixer are disabled in order to isolate their impact on the overall performance.

* **Ingress Only:** the application is re-deployed without sidecars, so basically just the Istio Ingress is being exercised. This provides an approximate baseline where Istio is not used.

The regression patrol perform these main tasks:
1. Checks for new builds in the [Istio Daily Build Repository](https://gcsweb.istio.io/gcs/istio-prerelease/daily-build/ );
2. If a new build is available, downloads it and deploys Istio Control Plane pods to a specific node;
3. Injects the sidecars to the application and deploys it;
4. Drives the workload, which consists in a sequence of 5-minute runs, each one using a growing number of clients making http requests.
5. Collect and publish the results.
6. Repeat the previous steps for each configuration.

In addition to the data collected by the scripts driving the test, monitoring probes in the worker nodes provide real-time metrics displayed on Grafana dashboards. That includes CPU and memory usage, disk activity, network traffic, and other OS metrics on the worker nodes as well as CPU and memory usage at pod and container levels. There are also dashboards for the Prometheus data collected from Istio Control Plane components. The collected metrics are persisted so these dashboards can be reviewed later for further analysis.

## Environment ##

One of the premises of the Regression Patrol is that it verifies the Istio performance against a fixed K8s cluster with limited resources, so any component using more resources than usual (CPU, for instance) will impact the overall performance. It is fundamental to keep the same distribution of pods across the nodes from build to build, otherwise different results will be acquired due the varying distribution and fair comparisons cannot be made.

The diagram below illustrates the regression patrol environment:

{{< image width="100%" ratio="80%"
    link="https://ibmcloud-perf.istio.io/regpatrol/istio_regpatrol_readme_files/image002.png"
    >}}

Regression Patrol runs on an IKS 3-node cluster, where one of them is dedicated to the Istio Control Plane and the other 2 to the application pods. Actually, there is a 4th node in the cluster that is being used for support (for example, the Prometheus pod is running there).

The load is generated by Jmeter on a VM co-located in the same sub-net but outside the cluster. The same VM hosts the web server where the results are published. Likewise, the backend database required by the application (MongoDB) runs on an external VM.

The metrics from the worker monitoring probes and from Jmeter driver are stored on InfluxDB which is queried by the Grafana dashboards. Data from Istio that is collected by Prometheus is also queried by Grafana. In order to persist Prometheus metrics, a Persistent Volume Claim (PVC) is used in the Prometheus pod.

## Benchmark Application - Acmeair/BluePerf ##

The benchmark application used by the regression patrol is the Java version of Acmeair, implemented as microservices. This application runs on WebSphere Liberty and simulates the operations of a fictitious airline.

The microservices that compose Acmeair are:

* **Flight Service** retrieves flight route data. It is called by the Booking service to check miles for the rewards operations (Acmeair customer fidelity program).

* **Customer Service** stores, updates, and retrieves customer data. It is invoked by the Auth service for login and by the Booking service for the rewards operations.

* **Booking Service** stores, updates, and retrieves booking data.

* **Auth Service** generates JWT if the user/password is valid.

* **Main Service** primarily consists of the presentation layer (web pages) that interact with the other services. This allows the user to interact directly with the application via browser, but it is not exercised during the load test.

The diagram below represents the different pods/containers of the application in the Kubernetes/Istio environment:

{{< image width="100%" ratio="80%"
    link="https://ibmcloud-perf.istio.io/regpatrol/istio_regpatrol_readme_files/image004.png"
    >}}

The following table shows the transactions that are driven by the Jmeter script and the approximate distribution of each type of request:

{{< image width="100%" ratio="20%"
    link="https://ibmcloud-perf.istio.io/regpatrol/istio_regpatrol_readme_files/image006.png"
    >}}

The results for each build are published automatically on the [Istio Regression Patrol](https://ibmcloud-perf.istio.io/regpatrol/) site.

For the benchmark application used in the regression patrol: [IBM's BluePerf](https://github.com/blueperf).
