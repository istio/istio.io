---
title: Візуалізація вашої Mesh-мережі
description: Це завдання показує, як візуалізувати ваші сервіси в мережі Istio.
weight: 49
keywords: [telemetry,visualization]
aliases:
 - /uk/docs/tasks/telemetry/kiali/
owner: istio/wg-policies-and-telemetry-maintainers
test: no
---

Це завдання показує, як візуалізувати різні аспекти вашої мережі Istio.

У рамках цього завдання ви встановите надбудову [Kiali](https://www.kiali.io) та скористаєтеся графічним інтерфейсом, що працює в оглядачі, щоб переглядати схеми сервісів мережі та обʼєкти конфігурації Istio.

{{< idea >}}
Це завдання не охоплює всі функції, які надає Kiali. Щоб дізнатися про повний набір підтримуваних функцій, перегляньте [вебсайт Kiali](https://kiali.io/docs/features/).
{{< /idea >}}

У цьому завданні використовується демонстраційний застосунок [Bookinfo](/docs/examples/bookinfo/) як приклад. Це завдання передбачає, що Bookinfo встановлено в просторі імен `bookinfo`.

## Перед початком {#before-you-begin}

Слідуйте документації [встановлення Kiali](/docs/ops/integrations/kiali/#installation), щоб розгорнути Kiali у вашому кластері.

## Генерація схеми {#generating-a-graph}

1. Щоб перевірити, чи працює сервіс у вашому кластері, виконайте наступну команду:

    {{< text bash >}}
    $ kubectl -n istio-system get svc kiali
    {{< /text >}}

1. Щоб визначити URL-адресу Bookinfo, дотримуйтесь інструкцій, щоб визначити [Bookinfo ingress `GATEWAY_URL`](/docs/examples/bookinfo/#determine-the-ingress-ip-and-port).

1. Щоб надсилати трафік у мережу, у вас є три варіанти

    * Відвідайте `http://$GATEWAY_URL/productpage` у вашому вебоглядачі

    * Використовуйте наступну команду кілька разів:

        {{< text bash >}}
        $ curl http://$GATEWAY_URL/productpage
        {{< /text >}}

    * Якщо ви встановили команду `watch` у вашій системі, надсилайте запити безперервно за допомогою:

        {{< text bash >}}
        $ watch -n 1 curl -o /dev/null -s -w %{http_code} $GATEWAY_URL/productpage
        {{< /text >}}

1. Щоб відкрити інтерфейс Kiali, виконайте наступну команду у вашому середовищі Kubernetes:

    {{< text bash >}}
    $ istioctl dashboard kiali
    {{< /text >}}

1. Перегляньте огляд вашої мережі на сторінці **Огляд**, яка зʼявляється одразу після входу. Сторінка **Огляд** показує всі простори імен, що містять сервіси у вашій мережі. Ось скріншот подібної сторінки:

    {{< image width="75%"
        link="./kiali-overview.png"
        caption="Приклад огляду"
        >}}

1. Щоб переглянути графік простору імен, виберіть опцію `Graph` у меню з трьох крапок на картці огляду Bookinfo. Меню з трьох крапок знаходиться у верхньому правому куті картки та виглядає як 3 вертикальні крапки. Натисніть його, щоб побачити доступні опції. Сторінка виглядає приблизно так:

    {{< image width="75%"
        link="./kiali-graph.png"
        caption="Приклад графіка"
        >}}

1. Схема представляє трафік, що проходить через сервісну мережу протягом певного часу. Він генерується за допомогою телеметрії Istio.

1. Щоб переглянути підсумок метрик, виберіть будь-який вузол або ребро на схемі, щоб переглянути його деталі метрик у панелі підсумкових деталей справа.

1. Щоб переглянути вашу сервісну мережу, використовуючи різні типи схем, виберіть тип схеми у меню **Тип схеми**. Є кілька типів схем на вибір: **App**, **Versioned App**, **Workload**, **Service**.

    * Тип схеми **App** обʼєднує всі версії застосунку в один вузол схеми. Наступний приклад показує один вузол **reviews**, що представляє три версії застосунку reviews. Зверніть увагу, що опція показу `Show Service Nodes` вимкнена.

        {{< image width="75%"
            link="./kiali-app.png"
            caption="Приклад схеми застосунку"
            >}}

    * Тип схеми **Versioned App** показує вузол для кожної версії застосунку, але всі версії конкретного застосунку згруповані разом. Наступний приклад показує групу вузлів **reviews**, яка містить три вузли, що представляють три версії застосунку reviews.

        {{< image width="75%"
            link="./kiali-versionedapp.png"
            caption="Приклад схеми версії застосунку"
            >}}

    * Тип схеми **Workload** показує вузол для кожного навантаження у вашій сервісній мережі. Цей тип схеми не вимагає використання міток `app` і `version`, тому, якщо ви вирішите не використовувати ці мітки на ваших компонентах, це може бути вашим типом схеми.

        {{< image width="70%"
            link="./kiali-workload.png"
            caption="Приклад схеми навантаження"
            >}}

    * Тип схеми **Service** показує узагальнення трафіку сервісів у вашій мережі.

        {{< image width="70%"
            link="./kiali-service-graph.png"
            caption="Приклад схеми сервісів"
            >}}

## Огляд конфігурації Istio {#examining-istio-configuration}

1. Опції лівого меню ведуть до списків для **Applications**, **Workloads**, **Services** та
    **Istio Config**.Ось скріншот інформації про **Services** для простору імен Bookinfo:

    {{< image width="80%"
        link="./kiali-services.png"
        caption="Приклад деталей"
        >}}

## Зміщення трафіку {#traffic-shifting}

Ви можете використовувати майстра зміщення трафіку Kiali для визначення конкретного відсотка запитів, які потрібно направити на два або більше навантажень.

1. Перегляньте схему **Versioned app graph** `bookinfo`.

    * Переконайтеся, що ви ввімкнули опцію **Traffic Distribution** для показу **Edge Label**, щоб бачити відсоток трафіку, спрямованого на кожне навантаження.

    * Переконайтеся, що ви ввімкнули опцію показу **Service Nodes**, щоб переглядати вузли сервісів на схемі.

    {{< image width="80%"
        link="./kiali-wiz0-graph-options.png"
        caption="Опції схеми Bookinfo"
        >}}

1. Зосередьтеся на сервісі `ratings` у схемі `bookinfo`, натиснувши на вузол сервісу `ratings` (трикутник). Зверніть увагу, що трафік сервісу `ratings` рівномірно розподіляється між двома навантаженнями `ratings` `v1` і `v2` (50% запитів направляються на кожне навантаження).

    {{< image width="80%"
        link="./kiali-wiz1-graph-ratings-percent.png"
        caption="Схема, що показує відсоток трафіку"
        >}}

1. Натисніть на посилання **ratings**, яке знаходиться в боковій панелі, щоб перейти до перегляду деталей для сервісу `ratings`. Це також можна зробити, виконавши другий клік на вузол сервісу `ratings` і вибравши `Details` у контекстному меню.

1. У меню **Actions** виберіть **Traffic Shifting**, щоб отримати доступ до майстра зміщення трафіку.

    {{< image width="80%"
        link="./kiali-wiz2-ratings-service-action-menu.png"
        caption="Меню дій сервісу"
        >}}

1. Перетягуйте повзунки, щоб вказати відсоток трафіку, який потрібно направити на кожне навантаження. Для `ratings-v1` встановіть 10%; для `ratings-v2` — 90%.

    {{< image width="80%"
        link="./kiali-wiz3-traffic-shifting-wizard.png"
        caption="Майстер зваженої маршрутизації"
        >}}

1. Натисніть кнопку **Preview**, щоб переглянути YAML, який буде згенерований майстром.

    {{< image width="80%"
        link="./kiali-wiz3b-traffic-shifting-wizard-preview.png"
        caption="Попередній перегляд майстра маршрутизації"
        >}}

1. Натисніть кнопку **Create** і підтвердіть, щоб застосувати нові налаштування трафіку.

1. Натисніть **Graph** у лівій навігаційній панелі, щоб повернутися до схеми `bookinfo`. Зверніть увагу, що вузол сервісу `ratings` тепер має іконку `virtual service`.

1. Надішліть запити до `bookinfo`. Наприклад, щоб надіслати один запит на секунду, ви можете виконати цю команду, якщо у вас встановлений `watch`:

    {{< text bash >}}
    $ watch -n 1 curl -o /dev/null -s -w %{http_code} $GATEWAY_URL/productpage
    {{< /text >}}

1. Через кілька хвилин ви помітите, що відсоток трафіку показує новий маршрут трафіку,  підтверджуючи, що ваш новий маршрут трафіку успішно направляє 90% всіх запитів трафіку
    на `ratings-v2`.

    {{< image width="80%"
        link="./kiali-wiz4-traffic-shifting-90-10.png"
        caption="90% трафіку Ratings направлено на ratings-v2"
        >}}

## Перевірка конфігурації Istio {#validating-istio-configuration}

Kiali може перевірити ваші ресурси Istio, щоб забезпечити їх відповідність належним умовам і семантиці. Будь-які проблеми, виявлені в конфігурації ваших ресурсів Istio, можуть бути позначені як помилки або попередження залежно від серйозності неправильного налаштування. Дивіться [сторінку перевірок Kiali](https://kiali.io/docs/features/validations/) для отримання списку всіх перевірок, які виконує Kiali.

{{< idea >}}
Istio пропонує `istioctl analyze`, який надає аналіз у форматі, який можна використовувати в CI-конвеєрі. Обидва підходи можуть бути взаємнодоповнюючими.
{{< /idea >}}

Примусово введіть неправильну конфігурацію імені порту сервісу, щоб побачити, як Kiali повідомляє про помилку перевірки.

1. Змініть імʼя порту сервісу `details` з `http` на `foo`:

    {{< text bash >}}
    $ kubectl patch service details -n bookinfo --type json -p '[{"op":"replace","path":"/spec/ports/0/name", "value":"foo"}]'
    {{< /text >}}

1. Перейдіть до списку **Services**, натиснувши **Services** у лівій навігаційній панелі.

1. Виберіть `bookinfo` з меню **Namespace**, якщо він ще не вибраний.

1. Зверніть увагу на іконку помилки, що показується у стовпці **Configuration** рядка `details`.

    {{< image width="80%"
        link="./kiali-validate1-list.png"
        caption="Список сервісів, що показує неправильну конфігурацію"
        >}}

1. Натисніть на посилання **details** у стовпці **Name**, щоб перейти до перегляду деталей сервісу `details`.

1. Наведіть курсор на іконку помилки, щоб показати підказку, що описує помилку.

    {{< image width="80%"
        link="./kiali-validate2-errormsg.png"
        caption="Деталі сервісу, що описують неправильну конфігурацію"
        >}}

1. Змініть імʼя порту назад на `http`, щоб виправити конфігурацію і повернути `bookinfo` до нормального стану.

    {{< text bash >}}
    $ kubectl patch service details -n bookinfo --type json -p '[{"op":"replace","path":"/spec/ports/0/name", "value":"http"}]'
    {{< /text >}}

    {{< image width="80%"
        link="./kiali-validate3-ok.png"
        caption="Деталі сервісу, що показують правильну конфігурацію"
        >}}

## Перегляд і редагування YAML конфігурації Istio {#viewing-and-editing-istio-configuration-yaml}

Kiali надає редактор YAML для перегляду та редагування ресурсів конфігурації Istio. Редактор YAML також надає повідомлення про перевірку, коли виявляє неправильні конфігурації.

1. Введіть помилку в VirtualService `bookinfo`:

    {{< text bash >}}
    $ kubectl patch vs bookinfo -n bookinfo --type json -p '[{"op":"replace","path":"/spec/gateways/0", "value":"bookinfo-gateway-invalid"}]'
    {{< /text >}}

1. Натисніть `Istio Config` на лівій навігаційній панелі, щоб перейти до списку конфігурацій Istio.

1. Виберіть `bookinfo` з меню **Namespace**, якщо він ще не вибраний.

1. Зверніть увагу на іконку помилки, яка сповіщає вас про проблему з конфігурацією.

    {{< image width="80%"
        link="./kiali-istioconfig0-errormsgs.png"
        caption="Список конфігурацій Istio з некоректною конфігурацією"
        >}}

1. Натисніть на іконку помилки у стовпці **Configuration** рядка `bookinfo`, щоб перейти до перегляду віртуального сервісу `bookinfo`.

1. Вкладка **YAML** попередньо вибрана. Зверніть увагу на кольорові підсвічування та іконки на рядках, які мають повʼязані повідомлення про перевірку.

    {{< image width="80%"
        link="./kiali-istioconfig3-details-yaml1.png"
        caption="Редактор YAML, що показує повідомлення про перевірку"
        >}}

1. Наведіть курсор на червону іконку, щоб переглянути підказку, яка інформує вас про перевірку, що викликала помилку. Для отримання додаткових відомостей про причину помилки та способи її виправлення, перегляньте повідомлення про помилку перевірки на [сторінці перевірок Kiali](https://kiali.io/docs/features/validations/).

    {{< image width="80%"
        link="./kiali-istioconfig3-details-yaml3.png"
        caption="Редактор YAML, що показує підказку помилки"
        >}}

1. Відновіть віртуальний сервіс `bookinfo` до його первісного стану.

    {{< text bash >}}
    $ kubectl patch vs bookinfo -n bookinfo --type json -p '[{"op":"replace","path":"/spec/gateways/0", "value":"bookinfo-gateway"}]'
    {{< /text >}}

## Додаткові функції {#additional-features}

Kiali має багато інших функцій, ніж ті, що були розглянуті в цьому завданні, таких як [інтеграція з Jaeger tracing](https://kiali.io/docs/features/tracing/).

Для отримання більш детальної інформації про ці додаткові функції, дивіться [документацію Kiali](https://kiali.io/docs/features/).

Для глибшого вивчення Kiali рекомендується пройти [Tutorial Kiali](https://kiali.io/docs/tutorials/).

## Очищення {#cleanup}

Якщо ви не плануєте подальші завдання, видаліть демонстраційний застосунок Bookinfo та Kiali з вашого кластера.

1. Щоб видалити застосунок Bookinfo, дотримуйтесь інструкцій [очищення Bookinfo](/docs/examples/bookinfo/#cleanup).

1. Щоб видалити Kiali з середовища Kubernetes:

    {{< text bash >}}
    $ kubectl delete -f {{< github_file >}}/samples/addons/kiali.yaml
    {{< /text >}}
