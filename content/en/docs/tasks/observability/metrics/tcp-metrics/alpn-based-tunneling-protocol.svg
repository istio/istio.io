<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1013" height="756"><desc style="-webkit-tap-highlight-color:transparent">Created with RaphaÃ«l 2.2.0</desc><defs style="-webkit-tap-highlight-color:transparent"><path style="-webkit-tap-highlight-color:transparent" id="raphael-marker-block" stroke-linecap="round" d="M5,0 0,2.5 5,5z"/><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objw24vu" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="gray" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objm73oh" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="#000" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-obj25x9a" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="#000" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-obj56161" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="gray" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objiq7td" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="#000" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objvz0jw" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="#000" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objafm63" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="gray" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker><marker style="-webkit-tap-highlight-color:transparent" id="raphael-marker-endblock55-objeiehw" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use style="-webkit-tap-highlight-color:transparent" fill="gray" stroke="none" stroke-width="1" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"/></marker></defs><rect style="-webkit-tap-highlight-color:transparent" width="480.5" height="28" x="10" y="10" fill="#00f" stroke="red" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="470.5" height="18" x="15" y="15" fill="#00f" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="250.25" y="24" fill="#fff" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">ALPN-based tunneling with a prefix-based protocol</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="77.625" height="38" x="10" y="48" fill="#fff" stroke="red" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="57.625" height="18" x="20" y="58" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="48.813" y="67" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">Client</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="77.625" height="38" x="10" y="698.094" fill="#fff" stroke="red" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="57.625" height="18" x="20" y="708.094" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="48.813" y="717.094" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">Client</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-width="2" d="M48.8125,86L48.8125,698.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="173.625" height="38" x="164.438" y="48" fill="#00f" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="153.625" height="18" x="174.438" y="58" fill="#00f" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="251.25" y="67" fill="#fff" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">ClientEnvoyProxy</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="173.625" height="38" x="164.438" y="698.094" fill="#00f" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="153.625" height="18" x="174.438" y="708.094" fill="#00f" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="251.25" y="717.094" fill="#fff" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">ClientEnvoyProxy</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-width="2" d="M251.25,86L251.25,698.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="173.625" height="38" x="654.938" y="48" fill="#00f" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="153.625" height="18" x="664.938" y="58" fill="#00f" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="741.75" y="67" fill="#fff" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">ServerEnvoyProxy</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="173.625" height="38" x="654.938" y="698.094" fill="#00f" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="153.625" height="18" x="664.938" y="708.094" fill="#00f" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="741.75" y="717.094" fill="#fff" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">ServerEnvoyProxy</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-width="2" d="M741.75,86L741.75,698.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="77.625" height="38" x="905.375" y="48" fill="#fff" stroke="red" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="57.625" height="18" x="915.375" y="58" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="944.188" y="67" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">Server</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="77.625" height="38" x="905.375" y="698.094" fill="#fff" stroke="red" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="57.625" height="18" x="915.375" y="708.094" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="944.188" y="717.094" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">Server</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-width="2" d="M944.1875,86L944.1875,698.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="182.438" height="18" x="58.813" y="102" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="150.031" y="111" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">init tcp connection</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="gray" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objw24vu)" d="M48.8125,124C48.8125,124,215.07220458984375,124,246.24589920043945,124"/><rect style="-webkit-tap-highlight-color:transparent" width="202.031" height="47.219" x="150.234" y="144" fill="none" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="192.031" height="37.219" x="155.234" y="149" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="251.25" y="167.609" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="-4.102">TLS Inspector</tspan><tspan style="-webkit-tap-highlight-color:transparent" x="251.25" dy="19.2">Alpn Override Filter</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="470.5" height="18" x="261.25" y="207.219" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="216.219" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">TLS ClientHello(Alpn:{istio-peer-exchange,istio})</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objm73oh)" d="M251.25,229.21875C251.25,229.21875,685.1647472754121,229.21875,736.7556852449252,229.21875"/><rect style="-webkit-tap-highlight-color:transparent" width="470.5" height="18" x="261.25" y="245.219" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="254.219" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">TLS ServerHello(Alpn:{istio-peer-exchange,istio})</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj25x9a)" d="M741.75,267.21875C741.75,267.21875,307.8352527245879,267.21875,256.2443147550748,267.21875"/><rect style="-webkit-tap-highlight-color:transparent" width="182.438" height="18" x="751.75" y="283.219" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="842.969" y="292.219" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">init tcp connection</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="gray" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj56161)" d="M741.75,305.21875C741.75,305.21875,908.0097045898438,305.21875,939.1833992004395,305.21875"/><rect style="-webkit-tap-highlight-color:transparent" width="326.875" height="28" x="578.313" y="325.219" fill="none" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="316.875" height="18" x="583.313" y="330.219" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="741.75" y="339.219" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">Selects filters based on mTLS TCP</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="173.25" height="47.219" x="164.625" y="373.219" fill="none" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="163.25" height="37.219" x="169.625" y="378.219" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="251.25" y="396.828" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="-4.102">upstream metadata</tspan><tspan style="-webkit-tap-highlight-color:transparent" x="251.25" dy="19.2">exc filter</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="336.063" height="37.219" x="328.469" y="426.828" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="445.438" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="-4.102">send magic bytes + initial header +</tspan><tspan style="-webkit-tap-highlight-color:transparent" x="496.5" dy="19.2"> client node metadata</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-dasharray="none" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objiq7td)" d="M251.25,477.65625C251.25,477.65625,685.1647472754121,477.65625,736.7556852449252,477.65625"/><rect style="-webkit-tap-highlight-color:transparent" width="192.438" height="47.219" x="645.531" y="497.656" fill="none" stroke="#000" stroke-width="2" rx="0" ry="0"/><rect style="-webkit-tap-highlight-color:transparent" width="182.438" height="37.219" x="650.531" y="502.656" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="741.75" y="521.266" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="-4.102">downstream metadata</tspan><tspan style="-webkit-tap-highlight-color:transparent" x="741.75" dy="19.2">exc filter</tspan></text><rect style="-webkit-tap-highlight-color:transparent" width="336.063" height="37.219" x="328.469" y="551.266" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="569.875" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="-4.102">send magic bytes + initial header +</tspan><tspan style="-webkit-tap-highlight-color:transparent" x="496.5" dy="19.2"> server node metadata</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="#000" stroke-dasharray="none" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objvz0jw)" d="M741.75,602.09375C741.75,602.09375,307.8352527245879,602.09375,256.2443147550748,602.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="240.063" height="18" x="376.469" y="618.094" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="627.094" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">application data exchange</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="gray" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objafm63)" d="M48.8125,640.09375C48.8125,640.09375,867.4305757489055,640.09375,939.1795721341246,640.09375"/><rect style="-webkit-tap-highlight-color:transparent" width="240.063" height="18" x="376.469" y="656.094" fill="#fff" stroke="none" rx="0" ry="0"/><text style="-webkit-tap-highlight-color:transparent" x="496.5" y="665.094" fill="#000" stroke="none" font-family="&quot;Andale Mono&quot;, monospace" font-size="16" text-anchor="middle"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">application data exchange</tspan></text><path style="-webkit-tap-highlight-color:transparent" fill="none" stroke="gray" stroke-dasharray="6 2" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objeiehw)" d="M944.1875,678.09375C944.1875,678.09375,125.56942425109446,678.09375,53.820427865875445,678.09375"/></svg>