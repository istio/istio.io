---
title: Plugging in CA certificate and key
overview: This task shows how to plug in existing key and certificate into Istio CA.

order: 40

layout: docs
type: markdown
---
{% include home.html %}

This task shows how to plug in existing key and certificate into Istio CA.

By default, the Istio CA generates a self-signed CA certificate and key and uses them to sign the workload certificates.
The Istio CA can also use the existing certificate and key to sign workload certificates.
This task demonstrates an example to and plug in existing cert and key the Istio CA.

## Before you begin

* Set up Istio on auth-enabled Kubernetes by following the instructions in the
  [quick start]({{home}}/docs/setup/kubernetes/quick-start.html).
  Note that authentication should be enabled at step 4 in the
  [installation steps]({{home}}/docs/setup/kubernetes/quick-start.html#installation-steps).

## Plugging in the existing CA certificate

Suppose we want to have Istio CA use the existing certificate and key `ca-cert.pem`, `ca-key.pem`.
The certificate `ca-cert.pem` is signed by the certificate `root-cert.pem`.
We would like to use `root-cert.pem` as the root certificate for Istio workloads.

When the Istio CA certificate is not the workloads' root certificate,
the workload cannot validate the workload certificates directly from the root certificate.
In this case, the workload needs a `cert-chain.pem` file to specify the chain of trust,
which should include the certificates of all the intermediate CAs between the workloads and the root CA.

The following command downloads the example files:
```bash
wget https://raw.githubusercontent.com/istio/auth/master/samples/plugin_ca_certs/ca-cert.pem
wget https://raw.githubusercontent.com/istio/auth/master/samples/plugin_ca_certs/ca-key.pem
wget https://raw.githubusercontent.com/istio/auth/master/samples/plugin_ca_certs/root-cert.pem
wget https://raw.githubusercontent.com/istio/auth/master/samples/plugin_ca_certs/cert-chain.pem
```


In this example, the `cert-chain.pem` file contains the cert of the intermediate CA, that is, `ca-cert.pem`.

1. Create a secret `cacert` including all the input files - `ca-cert.pem`, `ca-key.pem`, `root-cert.pem` and `cert-chain.pem`:
   ```bash
   kubectl create secret generic cacerts -n istio-system --from-file=ca-cert.pem --from-file=ca-key.pem \
   --from-file=root-cert.pem --from-file=cert-chain.pem
   ```

1. Redeploy Istio CA that accepts the certs and key and mounts the secret as files:
   ```bash
   kubectl apply -f install/kubernetes/pluggable-ca.yaml
   ```
   Note that the file names are specified as arguments in `pluggable-ca.yaml`.

1. Refresh the secret `istio.default`, but manually deleting it
   (also do the same for other secrets named as istio.*):
   ```bash
   kubectl delete secret istio.default
   ```

## Cleanup

* To remove the secret `cacerts`:

  ```bash
  kubectl delete secret cacerts -n istio-system
  ```

* To remove the Istio components:
  ```bash
  kubectl delete -f install/kubernetes/istio-auth.yaml
  ```

* To remove all the secrets generated by Istio:
  ```bash
  kubectl delete secret --all
  ```

## Further reading

* Read the Istio [CA arguments](https://github.com/istio/auth/blob/master/cmd/istio_ca/main.go).
* Read [how the sample certificates and keys are generated](https://github.com/istio/auth/blob/master/samples/plugin_ca_certs).
