<!doctype html><html lang=zh itemscope itemtype=https://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content=#466BB0><meta name=title content="VPN 连接"><meta name=description content="通过直连远程 pods 实现多 Kubernetes 集群安装 Istio 网格。"><meta name=keywords content=microservices,services,mesh,kubernetes,multicluster,federation,vpn><meta property=og:title content="VPN 连接"><meta property=og:type content=website><meta property=og:description content="通过直连远程 pods 实现多 Kubernetes 集群安装 Istio 网格。"><meta property=og:url content=/v1.1/zh/docs/setup/kubernetes/install/multicluster/vpn/><meta property=og:image content=/v1.1/img/istio-whitelogo-bluebackground-framed.svg><meta property=og:image:alt content="Istio Logo"><meta property=og:image:width content=112><meta property=og:image:height content=150><meta property=og:site_name content=Istio><meta name=twitter:card content=summary><meta name=twitter:site content=@IstioMesh><title>Istioldie 1.1 / VPN 连接</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98480406-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-98480406-2');</script><link rel=alternate type=application/rss+xml title="Istio Blog" href=/v1.1/feed.xml><link rel="shortcut icon" href=/v1.1/favicons/favicon.ico><link rel=apple-touch-icon href=/v1.1/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/v1.1/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/v1.1/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/v1.1/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/v1.1/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/v1.1/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/v1.1/favicons/android-96x96.png sizes=96xW96><link rel=icon type=image/png href=/v1.1/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/v1.1/favicons/android-192x192.png sizes=192x192><link rel=manifest href=/v1.1/manifest.json><meta name=apple-mobile-web-app-title content=Istio><meta name=application-name content=Istio><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Work+Sans:400|Chivo:400|Work+Sans:500,300,600,300italic,400italic,500italic,600italic|Chivo:500,300,600,300italic,400italic,500italic,600italic"><link rel=stylesheet href=/v1.1/css/all.css></head><body class="language-unknown archive-site"><script src=/v1.1/js/themes_init.min.js></script><script>const branchName="release-1.1";const docTitle="VPN 连接";const iconFile="\/v1.1/img/icons.svg";const buttonCopy='复制到剪切板';const buttonPrint='打印';const buttonDownload='下载';</script><script src="https://www.google.com/cse/brand?form=search-form" defer></script><script src=/v1.1/js/all.min.js data-manual defer></script><header><nav><a id=brand href=/v1.1/zh/><span class=logo><svg viewBox="0 0 300 300"><circle cx="150" cy="150" r="146" stroke-width="2" /><path d="M65 240H225L125 270z"/><path d="M65 230l60-10V110z"/><path d="M135 220l90 10L135 30z"/></svg></span><span class=name>Istioldie 1.1</span></a><div id=hamburger><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#hamburger"/></svg></div><div id=header-links><span title="了解如何部署、使用和运维 Istio。">文档</span>
<a title="关于使用 Istio 的博客文章。" href=/v1.1/zh/blog/2019/root-transition/>博客</a>
<a title="一堆帮助您部署、配置和使用 Istio 的资源。" href=/v1.1/zh/help/>帮助</a>
<a title=关于Istio的说明。 href=/v1.1/zh/about/>关于</a><div class=menu><button id=gearDropdownButton class=menu-trigger title=选项和设置 aria-label="Options and Settings" aria-controls=gearDropdownContent><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#gear"/></svg></button><div id=gearDropdownContent class=menu-content aria-labelledby=gearDropdownButton role=menu><a tabindex=-1 role=menuitem lang=en id=switch-lang-en>English</a>
<a tabindex=-1 role=menuitem lang=zh id=switch-lang-zh class=active>中文</a><div role=separator></div><a tabindex=-1 role=menuitem class=active id=light-theme-item>亮主题</a>
<a tabindex=-1 role=menuitem id=dark-theme-item>暗主题</a><div role=separator></div><a tabindex=-1 role=menuitem id=syntax-coloring-item>代码高亮</a><div role=separator></div><h6>本站的其它版本</h6><a tabindex=-1 role=menuitem onclick="navigateToUrlOrRoot('https://istio.io/docs\/setup\/kubernetes\/install\/multicluster\/vpn\/');return false;">当前版本</a>
<a tabindex=-1 role=menuitem onclick="navigateToUrlOrRoot('https://preliminary.istio.io/docs\/setup\/kubernetes\/install\/multicluster\/vpn\/');return false;">下个版本</a>
<a tabindex=-1 role=menuitem href=https://archive.istio.io>旧版本</a></div></div><button id=search-show title=搜索istio.io aria-label=Search><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#magnifier"/></svg></button></div><form id=search-form name=cse role=search><input type=hidden name=cx value=013699703217164175118:iwwf17ikgf4>
<input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=en>
<input type=hidden id=search-page-url value=/v1.1/search.html>
<input id=search-textbox class=form-control name=q type=search aria-label=搜索istio.io>
<button id=search-close title="Cancel search" type=reset aria-label="Cancel search"><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#cancel-x"/></svg></button></form></nav></header><main class=primary><div id=sidebar-container class="sidebar-container sidebar-offcanvas"><nav id=sidebar aria-label="Section Navigation"><div class=directory><div class=card><button class="header dynamic" id=card28 title="一些概念，理解它们有助于您更好地了解 Istio 系统的不同部分及其使用的抽象。" aria-controls=card28-body><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#concepts"/></svg>概念</button><div class=body aria-labelledby=card28 role=region id=card28-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card28><li role=none><a role=treeitem title="介绍 Istio 及其要解决的问题、顶层架构和设计目标。" href=/v1.1/zh/docs/concepts/what-is-istio/>Istio 是什么?</a></li><li role=none><a role=treeitem title="介绍 Istio 中关于流量路由与控制的各项功能。" href=/v1.1/zh/docs/concepts/traffic-management/>流量管理</a></li><li role=none><a role=treeitem title="描述 Istio 的授权与鉴权功能。" href=/v1.1/zh/docs/concepts/security/>安全</a></li><li role=none><a role=treeitem title=描述策略实施和遥测机制。 href=/v1.1/zh/docs/concepts/policies-and-telemetry/>策略与遥测</a></li><li role=none><a role=treeitem title="介绍 Istio 组件的性能与可伸缩性。" href=/v1.1/zh/docs/concepts/performance-and-scalability/>性能与可伸缩性</a></li><li role=none><a role=treeitem title=描述如何配置服务网格以包含来自多个集群的服务。 href=/v1.1/zh/docs/concepts/multicluster-deployments/>多集群部署</a></li></ul></div></div><div class=card><button class="header dynamic" id=card41 title="在不同的环境下（例如 Kubernetes、Consul 等）如何部署和升级 Istio。" aria-controls=card41-body><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#setup"/></svg>安装</button><div class="body default" aria-labelledby=card41 role=region id=card41-body><ul role=tree aria-expanded=true aria-labelledby=card41><li role=treeitem aria-label=Kubernetes><button class=show aria-hidden=true></button><a title="关于如何在 Kubernetes 集群中安装 Istio 控制平面和添加虚拟机到 mesh 中的说明。" href=/v1.1/zh/docs/setup/kubernetes/>Kubernetes</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title="关于 Istio 发布包下载过程的说明。" href=/v1.1/zh/docs/setup/kubernetes/download/>下载 Istio 发布包</a></li><li role=treeitem aria-label=准备><button aria-hidden=true></button><a title="为 Istio 做准备。" href=/v1.1/zh/docs/setup/kubernetes/prepare/>准备</a><ul role=group aria-expanded=false><li role=treeitem aria-label=平台搭建><button aria-hidden=true></button><a title="在安装 Istio 前，如何准备各种 Kubernetes 平台。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/>平台搭建</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="为 Istio 设置阿里云 Kubernetes 集群的说明。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/alicloud/>阿里云</a></li><li role=none><a role=treeitem title="对 Azure 集群进行配置以便安装运行 Istio。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/azure/>Azure</a></li><li role=none><a role=treeitem title="使用桌面版 Docker 安装 Istio 的说明。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/docker/>桌面版 Docker</a></li><li role=none><a role=treeitem title="对 Google Kubernetes Engine（GKE）集群进行配置以便安装运行 Istio。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="为 IBM Cloud 集群设置 Istio 的说明。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/ibm/>IBM Cloud</a></li><li role=none><a role=treeitem title="对 Minikube 集群进行配置以便安装运行 Istio。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/minikube/>Minikube</a></li><li role=none><a role=treeitem title="对 OpenShift 集群进行配置以便安装运行 Istio。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/openshift/>OpenShift</a></li><li role=none><a role=treeitem title="为 Istio 对 OKE 集群环境进行配置。" href=/v1.1/zh/docs/setup/kubernetes/prepare/platform-setup/oci/>Oracle Cloud Infrastructure</a></li></ul></li></ul></li><li role=treeitem aria-label=安装方案><button class=show aria-hidden=true></button><a title=选择最适合您需求和平台的方案。 href=/v1.1/zh/docs/setup/kubernetes/install/>安装方案</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title="在 Kubernetes 集群中快速安装 Istio 服务网格的说明。" href=/v1.1/zh/docs/setup/kubernetes/install/kubernetes/>在 Kubernetes 中快速开始</a></li><li role=none><a role=treeitem title="使用内含的 Helm chart 安装 Istio。" href=/v1.1/zh/docs/setup/kubernetes/install/helm/>使用 Helm 进行安装</a></li><li role=treeitem aria-label=多集群安装><button class=show aria-hidden=true></button><a title="配置跨越多个 Kubernetes 集群的 Istio 服务网格。" href=/v1.1/zh/docs/setup/kubernetes/install/multicluster/>多集群安装</a><ul role=group aria-expanded=true class=leaf-section><li role=none><a role=treeitem title="使用 Istio Gateway 跨越多个 Kubernetes 集群安装 Istio 网格以访问远程 pod。" href=/v1.1/zh/docs/setup/kubernetes/install/multicluster/gateways/>Gateway 连接</a></li><li role=none><span role=treeitem class=current title="通过直连远程 pods 实现多 Kubernetes 集群安装 Istio 网格。">VPN 连接</span></li></ul></li><li role=treeitem aria-label=特定平台安装说明><button aria-hidden=true></button><a title="支持的 Kubernetes 平台的额外安装流程。" href=/v1.1/zh/docs/setup/kubernetes/install/platform/>特定平台安装说明</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="如何使用阿里云 Kubernetes 容器服务快速安装 Istio。" href=/v1.1/zh/docs/setup/kubernetes/install/platform/alicloud/>阿里云</a></li><li role=none><a role=treeitem title="在 Google Kubernetes Engine (GKE) 上快速搭建 Istio 服务。" href=/v1.1/zh/docs/setup/kubernetes/install/platform/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="如何使用 IBM 公有云或 IBM 私有云快速安装 Istio。" href=/v1.1/zh/docs/setup/kubernetes/install/platform/ibm/>IBM Cloud</a></li></ul></li></ul></li><li role=treeitem aria-label=升级><button aria-hidden=true></button><a title="升级 Istio 的相关信息。" href=/v1.1/zh/docs/setup/kubernetes/upgrade/>升级</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="在升级到 Istio 1.1 之前，运维人员必须了解的重要更改。" href=/v1.1/zh/docs/setup/kubernetes/upgrade/notice/>1.1 升级通知</a></li><li role=none><a role=treeitem title="演示如何独立升级 Istio 控制平面和数据平面。" href=/v1.1/zh/docs/setup/kubernetes/upgrade/steps/>升级步骤</a></li></ul></li><li role=treeitem aria-label=更多指南><button aria-hidden=true></button><a title=有关其他设置任务的更多信息。 href=/v1.1/zh/docs/setup/kubernetes/additional-setup/>更多指南</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio 内置的安装配置文件介绍。" href=/v1.1/zh/docs/setup/kubernetes/additional-setup/config-profiles/>安装配置</a></li><li role=none><a role=treeitem title="介绍两种将 Istio sidecar 注入应用 Pod 的方法：使用 Sidecar 注入 Webhook 自动完成，或使用 istioctl 客户端工具手工完成。" href=/v1.1/zh/docs/setup/kubernetes/additional-setup/sidecar-injection/>注入 Istio sidecar</a></li><li role=none><a role=treeitem title="这里讲述了 Istio 对 Kubernetes 中 Pod 和服务的要求。" href=/v1.1/zh/docs/setup/kubernetes/additional-setup/requirements/>Istio 对 Pod 和服务的要求</a></li><li role=none><a role=treeitem title="Istio CNI 插件的安装和使用 Istio，该插件让运维人员可以用较低的权限来完成网格服务的部署工作。" href=/v1.1/zh/docs/setup/kubernetes/additional-setup/cni/>Istio CNI 插件的安装和使用 Istio</a></li><li role=none><a role=treeitem title="部署在 Kubernetes 之中的 Istio 服务网格，将虚拟机和物理机集成进入到服务网格的方法。" href=/v1.1/zh/docs/setup/kubernetes/additional-setup/mesh-expansion/>网格扩展</a></li></ul></li></ul></li><li role=treeitem aria-label="Nomad &amp; Consul"><button aria-hidden=true></button><a title="基于 Consul 和 Nomad 安装 Istio 控制平面。" href=/v1.1/zh/docs/setup/consul/>Nomad &amp; Consul</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="通过 Docker Compose 快速安装 Istio service mesh。" href=/v1.1/zh/docs/setup/consul/quick-start/>通过 Docker 快速安装</a></li><li role=none><a role=treeitem title="基于 Consul 和 Nomad 安装 Istio 控制平面。" href=/v1.1/zh/docs/setup/consul/install/>安装</a></li></ul></li></ul></div></div><div class=card><button class="header dynamic" id=card49 title="如何用 Istio 系统实现特定目标的行为。" aria-controls=card49-body><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#tasks"/></svg>任务</button><div class=body aria-labelledby=card49 role=region id=card49-body><ul role=tree aria-expanded=true aria-labelledby=card49><li role=treeitem aria-label=流量管理><button aria-hidden=true></button><a title="演示 Istio 流量路由功能的任务。" href=/v1.1/zh/docs/tasks/traffic-management/>流量管理</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title=此任务将说明如何将请求动态路由到多个版本的微服务。 href=/v1.1/zh/docs/tasks/traffic-management/request-routing/>配置请求路由</a></li><li role=none><a role=treeitem title=此任务说明如何注入延迟并测试应用程序的弹性。 href=/v1.1/zh/docs/tasks/traffic-management/fault-injection/>故障注入</a></li><li role=none><a role=treeitem title=向您展示如何将流量从旧版本迁移到新版本的服务。 href=/v1.1/zh/docs/tasks/traffic-management/traffic-shifting/>流量转移</a></li><li role=none><a role=treeitem title="展示如何将一个 TCP 服务的流量从老版本迁移到新版本。" href=/v1.1/zh/docs/tasks/traffic-management/tcp-traffic-shifting/>TCP 流量转移</a></li><li role=none><a role=treeitem title="本任务用于示范如何使用 Istio 在 Envoy 中设置请求超时。" href=/v1.1/zh/docs/tasks/traffic-management/request-timeouts/>设置请求超时</a></li><li role=none><a role=treeitem title="介绍在服务网格 Istio 中如何配置外部公开服务。" href=/v1.1/zh/docs/tasks/traffic-management/ingress/>控制 Ingress 流量</a></li><li role=treeitem aria-label="加密 Ingress Gateway"><button aria-hidden=true></button><a title="使用多种方法为 Gateway 控制器提供加密支持。" href=/v1.1/zh/docs/tasks/traffic-management/secure-ingress/>加密 Ingress Gateway</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="如何配置 Istio，借助 SDS（Secret 发现服务），使用 TLS 或双向 TLS 将服务开放到网格之外。" href=/v1.1/zh/docs/tasks/traffic-management/secure-ingress/sds/>使用 SDS 为 Gateway 提供 HTTPS 加密支持</a></li></ul></li><li role=none><a role=treeitem title="在 Istio 中配置从网格内访问外部服务的流量路由。" href=/v1.1/zh/docs/tasks/traffic-management/egress/>控制 Egress 流量</a></li><li role=none><a role=treeitem title=用连接、请求以及外部检测来进行熔断配置的过程。 href=/v1.1/zh/docs/tasks/traffic-management/circuit-breaking/>熔断</a></li><li role=none><a role=treeitem title="此任务演示了 Istio 的流量镜像功能。" href=/v1.1/zh/docs/tasks/traffic-management/mirroring/>镜像</a></li></ul></li><li role=treeitem aria-label=安全><button aria-hidden=true></button><a title=演示对服务网格进行安全加固的方法。 href=/v1.1/zh/docs/tasks/security/>安全</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="展示为 HTTP 服务设置基于角色的访问控制方法。" href=/v1.1/zh/docs/tasks/security/authz-http/>HTTP 服务的访问控制</a></li><li role=none><a role=treeitem title="整合 Vault CA 到 Istio 中为双向 TLS 提供 支持。" href=/v1.1/zh/docs/tasks/security/vault-ca/>Istio Vault CA 集成</a></li><li role=none><a role=treeitem title="有关如何在 Istio 中配置基于组的授权和配置列表类型声明的授权的教程。" href=/v1.1/zh/docs/tasks/security/rbac-groups/>基于组和列表类型声明的授权</a></li><li role=none><a role=treeitem title="介绍如何使用 Istio 认证策略设置双向 TLS 和基本的终端用户认证。" href=/v1.1/zh/docs/tasks/security/authn-policy/>基础认证策略</a></li><li role=none><a role=treeitem title="对 Istio 的自动双向 TLS 认证功能进行体验和测试。" href=/v1.1/zh/docs/tasks/security/mutual-tls/>深入了解双向 TLS</a></li><li role=none><a role=treeitem title=展示宽容模式的的鉴权过程。 href=/v1.1/zh/docs/tasks/security/authz-permissive/>鉴权过程中的宽容模式</a></li><li role=none><a role=treeitem title="展示如何为 TCP 服务设置基于角色的访问控制。" href=/v1.1/zh/docs/tasks/security/authz-tcp/>TCP 服务的访问控制</a></li><li role=none><a role=treeitem title=展示如何在服务网格中进行基于角色的访问控制。 href=/v1.1/zh/docs/tasks/security/role-based-access-control/>基于角色的访问控制</a></li><li role=none><a role=treeitem title="运维人员如何使用现有根证书配置 Citadel 进行证书以及密钥的签发。" href=/v1.1/zh/docs/tasks/security/plugin-ca-cert/>插入外部 CA 密钥和证书</a></li><li role=none><a role=treeitem title="如何在 Kubernetes 中启用 Citadel 的健康检查。" href=/v1.1/zh/docs/tasks/security/health-check/>Citadel 的健康检查</a></li><li role=none><a role=treeitem title="展示启用 SDS 来为 Istio 提供身份服务的过程。" href=/v1.1/zh/docs/tasks/security/auth-sds/>通过 SDS 提供身份服务</a></li><li role=none><a role=treeitem title="如何渐进式的为现有 Istio 服务添加双向 TLS 支持。" href=/v1.1/zh/docs/tasks/security/mtls-migration/>双向 TLS 的迁移</a></li><li role=none><a role=treeitem title="展示如何在 HTTPS 服务上启用双向 TLS。" href=/v1.1/zh/docs/tasks/security/https-overlay/>通过 HTTPS 进行双向 TLS</a></li></ul></li><li role=treeitem aria-label=策略><button aria-hidden=true></button><a title=演示策略实施功能。 href=/v1.1/zh/docs/tasks/policy-enforcement/>策略</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="本任务讲解如何启用 Istio 策略检查功能。" href=/v1.1/zh/docs/tasks/policy-enforcement/enabling-policy/>启用策略检查</a></li><li role=none><a role=treeitem title="这一任务展示了如何使用 Istio 动态的对服务通信进行速率限制。" href=/v1.1/zh/docs/tasks/policy-enforcement/rate-limiting/>启用速率限制</a></li><li role=none><a role=treeitem title="展示使用简单的 Denier 适配器或黑白名单对服务进行访问控制的方法。" href=/v1.1/zh/docs/tasks/policy-enforcement/denial-and-list/>Denier 适配器以及黑白名单</a></li><li role=none><a role=treeitem title="显示如何使用策略适配器修改请求 header 和路由。" href=/v1.1/zh/docs/tasks/policy-enforcement/control-headers/>控制 header 和路由</a></li></ul></li><li role=treeitem aria-label=遥测><button aria-hidden=true></button><a title=演示从服务网格收集遥测信息的方法。 href=/v1.1/zh/docs/tasks/telemetry/>遥测</a><ul role=group aria-expanded=false><li role=treeitem aria-label=指标度量><button aria-hidden=true></button><a title="演示 Istio 网格指标度量的配置、收集和处理。" href=/v1.1/zh/docs/tasks/telemetry/metrics/>指标度量</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="这一任务讲述如何配置 Istio，进行指标和日志的收集工作。" href=/v1.1/zh/docs/tasks/telemetry/metrics/collecting-metrics/>收集指标和日志</a></li><li role=none><a role=treeitem title="本任务展示了如何配置 Istio 进行 TCP 服务的指标收集。" href=/v1.1/zh/docs/tasks/telemetry/metrics/tcp-metrics/>获取 TCP 服务指标</a></li><li role=none><a role=treeitem title="此任务说明如何使用 Prometheus 查询 Istio 指标。" href=/v1.1/zh/docs/tasks/telemetry/metrics/querying-metrics/>查询 Prometheus 的指标</a></li><li role=none><a role=treeitem title="这个任务向您展示了如何设置和使用 Istio 仪表盘来监视网格流量。" href=/v1.1/zh/docs/tasks/telemetry/metrics/using-istio-dashboard/>使用 Grafana 可视化指标度量</a></li></ul></li><li role=treeitem aria-label=日志><button aria-hidden=true></button><a title="演示 Istio 网格日志的配置、收集和处理。" href=/v1.1/zh/docs/tasks/telemetry/logs/>日志</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="这一任务讲述如何配置 Istio，进行日志的收集工作。" href=/v1.1/zh/docs/tasks/telemetry/logs/collecting-logs/>收集日志</a></li><li role=none><a role=treeitem title="此任务向您展示如何配置 Envoy 代理将访问日志打印到其标准输出。" href=/v1.1/zh/docs/tasks/telemetry/logs/access-log/>获取 Envoy 访问日志</a></li><li role=none><a role=treeitem title="此任务说明如何配置 Istio 以将日志输出到 Fluentd 守护程序。" href=/v1.1/zh/docs/tasks/telemetry/logs/fluentd/>使用 Fluentd 记录日志</a></li></ul></li><li role=treeitem aria-label=分布式追踪><button aria-hidden=true></button><a title="该任务展示了如何为启用了 Istio 支持的应用进行追踪。" href=/v1.1/zh/docs/tasks/telemetry/distributed-tracing/>分布式追踪</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio 分布式追踪概述。" href=/v1.1/zh/docs/tasks/telemetry/distributed-tracing/overview/>概述</a></li><li role=none><a role=treeitem title="了解如何配置代理以向 Jaeger 发送追踪请求。" href=/v1.1/zh/docs/tasks/telemetry/distributed-tracing/jaeger/>Jaeger</a></li><li role=none><a role=treeitem title="了解如何配置代理以向 Zipkin 发送追踪请求。" href=/v1.1/zh/docs/tasks/telemetry/distributed-tracing/zipkin/>Zipkin</a></li><li role=none><a role=treeitem title="如何配置代理以发送请求至 LightStep [𝑥]PM." href=/v1.1/zh/docs/tasks/telemetry/distributed-tracing/lightstep/>使用 LightStep [𝑥]PM 进行分布式追踪</a></li></ul></li><li role=none><a role=treeitem title="本任务展示了在 Istio 网格中对服务进行可视化的过程。" href=/v1.1/zh/docs/tasks/telemetry/kiali/>网格可视化</a></li><li role=none><a role=treeitem title="本任务展示了为 Istio 遥测插件配置外部访问的过程。" href=/v1.1/zh/docs/tasks/telemetry/gateways/>遥测插件的远程访问</a></li></ul></li></ul></div></div><div class=card><button class="header dynamic" id=card84 title="这里包括多个可供 Istio 使用的可完整工作的示例，你可以用来亲自部署和体验这些示例。" aria-controls=card84-body><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#examples"/></svg>示例</button><div class=body aria-labelledby=card84 role=region id=card84-body><ul role=tree aria-expanded=true aria-labelledby=card84><li role=none><a role=treeitem title="部署一个用于演示多种 Istio 特性的应用，由四个单独的微服务构成。" href=/v1.1/zh/docs/examples/bookinfo/>Bookinfo 应用</a></li><li role=none><a role=treeitem title="如何在 Istio 服务网格中使用多种流量管理功能。" href=/v1.1/zh/docs/examples/intelligent-routing/>智能路由</a></li><li role=none><a role=treeitem title="演示如何使用 Istio Mixer 和 Istio sidecar 获取指标和日志，并在不同的服务间进行追踪。" href=/v1.1/zh/docs/examples/telemetry/>深入遥测</a></li><li role=none><a role=treeitem title="说明如何在谷歌云 Endpoints 服务中手动整合 Istio。" href=/v1.1/zh/docs/examples/endpoints/>在谷歌云 Endpoints 服务中安装 Istio</a></li><li role=none><a role=treeitem title="在单一服务网格中，如何使用 Istio 对 Kubernetes 集群以及虚拟机进行控制。" href=/v1.1/zh/docs/examples/integrating-vms/>虚拟机集成</a></li><li role=treeitem aria-label=边缘流量控制><button aria-hidden=true></button><a title="用于管理 Istio 服务网格的边缘流量（即 Ingress 和 Egress 流量）的各种高级示例。" href=/v1.1/zh/docs/examples/advanced-gateways/>边缘流量控制</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="介绍如何为入口网关配置 SNI 直通。" href=/v1.1/zh/docs/examples/advanced-gateways/ingress-sni-passthrough/>没有 TLS 的 Ingress gateway</a></li><li role=none><a role=treeitem title="描述如何通过专用网关服务将流量定向到外部服务来配置 Istio。" href=/v1.1/zh/docs/examples/advanced-gateways/egress-gateway/>配置 Egress gateway</a></li><li role=none><a role=treeitem title="描述了配置 Egress 网关来发起对外部服务进行 TLS 通信的过程。" href=/v1.1/zh/docs/examples/advanced-gateways/egress-gateway-tls-origination/>Egress 网关的 TLS 发起过程</a></li><li role=none><a role=treeitem title="此任务描述 Istio 如何配置出口流量的 TLS。" href=/v1.1/zh/docs/examples/advanced-gateways/egress-tls-origination/>出口流量的 TLS</a></li><li role=none><a role=treeitem title="介绍如何为公共域中的一组主机启用 Egress 流量，而不是单独配置每个主机。" href=/v1.1/zh/docs/examples/advanced-gateways/wildcard-egress-hosts/>使用通配符主机配置 Egress 流量</a></li><li role=none><a role=treeitem title="如何为 Egress TLS 流量配置 SNI 监控并应用策略。" href=/v1.1/zh/docs/examples/advanced-gateways/egress_sni_monitoring_and_policies/>Egress TLS 流量中的 SNI 监控及策略</a></li><li role=none><a role=treeitem title="描述如何配置 Istio 以允许应用程序使用外部 HTTPS 代理。" href=/v1.1/zh/docs/examples/advanced-gateways/http-proxy/>连接到外部 HTTPS 代理</a></li><li role=none><a role=treeitem title="展示使用 cert-Manager 为 Kubernetes Ingress 获取 Let's Encrypt TLS 证书的过程。" href=/v1.1/zh/docs/examples/advanced-gateways/ingress-certmgr/>使用 cert-manager 加密 Kubernetes Ingress</a></li></ul></li><li role=treeitem aria-label=单一三层网络的多集群网格><button aria-hidden=true></button><a title="您可以尝试各种基于 VPN 的 Istio 多集群示例。" href=/v1.1/zh/docs/examples/multicluster/>单一三层网络的多集群网格</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=在一个使用网关进行连接的多集群网格中配置远程服务。 href=/v1.1/zh/docs/examples/multicluster/gateways/>通过网关进行连接的多集群</a></li><li role=none><a role=treeitem title="基于 GKE 的 Istio 多集群安装。" href=/v1.1/zh/docs/examples/multicluster/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="多 IBM Cloud Private 集群安装 Istio 示例。" href=/v1.1/zh/docs/examples/multicluster/icp/>IBM Cloud Private</a></li><li role=none><a role=treeitem title="IBM Cloud Kubernetes Service 和 IBM Cloud Private 之间的多集群示例。" href=/v1.1/zh/docs/examples/multicluster/iks-icp/>IBM Cloud Kubernetes Service &amp; IBM Cloud Private</a></li><li role=none><a role=treeitem title="利用 Istio 的水平分割 EDS 来创建多集群网格。" href=/v1.1/zh/docs/examples/multicluster/split-horizon-eds/>集群感知的服务路由</a></li></ul></li></ul></div></div><div class=card><button class="header dynamic" id=card114 title="参考部分包含详细的权威参考资料，如命令行选项、配置选项和 API 调用参数。" aria-controls=card114-body><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#reference"/></svg>参考</button><div class=body aria-labelledby=card114 role=region id=card114-body><ul role=tree aria-expanded=true aria-labelledby=card114><li role=treeitem aria-label=配置><button aria-hidden=true></button><a title=关于配置选项的详细信息。 href=/v1.1/zh/docs/reference/config/>配置</a><ul role=group aria-expanded=false><li role=treeitem aria-label=流量管理><button aria-hidden=true></button><a title="描述如何配置 HTTP/TCP 路由功能。" href=/v1.1/zh/docs/reference/config/networking/>流量管理</a><ul role=group aria-expanded=false class=leaf-section></ul></li><li role=none><a role=treeitem title="描述了使用 Helm chart 安装 Istio 时可以使用的选项。" href=/v1.1/zh/docs/reference/config/installation-options/>安装选项</a></li><li role=none><a role=treeitem title="详细描述 release-1.0 和 release-1.1 之间 Helm chart 安装选项的差异。" href=/v1.1/zh/docs/reference/config/installation-options-changes/>安装选项的变更</a></li><li role=treeitem aria-label=授权><button aria-hidden=true></button><a title=关于如何配置Istio授权特性的描述。 href=/v1.1/zh/docs/reference/config/authorization/>授权</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=描述所支持的约束和属性。 href=/v1.1/zh/docs/reference/config/authorization/constraints-and-properties/>约束和属性</a></li><li role=none><a role=treeitem title=配置基于角色的访问控制。 href=/v1.1/zh/docs/reference/config/authorization/istio.rbac.v1alpha1/>RBAC</a></li></ul></li><li role=treeitem aria-label=策略和遥测><button aria-hidden=true></button><a title="描述如何配置 Istio 的策略和遥测功能。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/>策略和遥测</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title=介绍策略和控制中会用到的一些基础属性词汇。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/attribute-vocabulary/>属性词汇</a></li><li role=none><a role=treeitem title="Mixer 的配置表达式语言参考。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/expression-language/>表达式语言</a></li><li role=treeitem aria-label=适配器><button aria-hidden=true></button><a title="Mixer 适配器能够让 Istio 连接各种基础设施后端以完成类似指标和日志这样的功能。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/>适配器</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Apigee 的分布式策略检查以及分析适配器。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/apigee/>Apigee</a></li><li role=none><a role=treeitem title="适用于 circonus.com 的监控解决方案。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/circonus/>Circonus</a></li><li role=none><a role=treeitem title="CloudMonitor 适配器使 Istio 可以向 AliCloud CloudMonitor 提供指标。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/cloudmonitor/>CloudMonitor</a></li><li role=none><a role=treeitem title=始终返回按前提条件拒绝的适配器。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/denier/>Denier</a></li><li role=none><a role=treeitem title="用于将日志发送给 Fluentd 守护进程的适配器。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/fluentd/>Fluentd</a></li><li role=none><a role=treeitem title="将指标发送到 SignalFx 的适配器。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/signalfx/>SignalFx</a></li><li role=none><a role=treeitem title="从 Kubernetes 环境中获取集群信息。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/kubernetesenv/>Kubernetes Env</a></li><li role=none><a role=treeitem title=用于执行黑名单或白名单检测的适配器。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/list/>List</a></li><li role=none><a role=treeitem title=简单内存配额管理系统适配器。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/memquota/>Memory quota</a></li><li role=none><a role=treeitem title="基于 Redis 的配额管理系统。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/redisquota/>Redis Quota</a></li><li role=none><a role=treeitem title="用于向 Google Service Control 发送日志和指标的适配器。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/servicecontrol/>Service Control</a></li><li role=none><a role=treeitem title="该适配器用于向 statsd 后端发送指标数据。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/statsd/>statsd</a></li><li role=none><a role=treeitem title=该适配器可以在本地输出日志和指标。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/adapters/stdio/>Stdio</a></li></ul></li><li role=treeitem aria-label=模板><button aria-hidden=true></button><a title="Mixer 模板用于将数据发送到各个适配器。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/>模板</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="该模板用于表达一个 API Key。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/apikey/>API Key</a></li><li role=none><a role=treeitem title="Analytics 模板用于向 Apigee 发送运行时遥测数据。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/analytics/>Analytics</a></li><li role=none><a role=treeitem title=该模版用于访问控制查询。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/authorization/>Authorization</a></li><li role=none><a role=treeitem title=该模板不包含任何数据，用于测试。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/checknothing/>Check Nothing</a></li><li role=none><a role=treeitem title="用于生成 Kubernetes 的特定属性。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/kubernetes/>Kubernetes</a></li><li role=none><a role=treeitem title=该模板用于执行列表检查操作。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/listentry/>List Entry</a></li><li role=none><a role=treeitem title=该模板用于表达一条运行时日志项。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/logentry/>Log Entry</a></li><li role=none><a role=treeitem title=该模板用于表达一个运行时产生的监控指标数据。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/metric/>Metric</a></li><li role=none><a role=treeitem title=该模板用于表达占用配额的请求。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/quota/>Quota</a></li><li role=none><a role=treeitem title=该模板不包含数据，用于测试。 href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/reportnothing/>Report Nothing</a></li><li role=none><a role=treeitem title="用于 Google Service Control 适配器的模板。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/servicecontrolreport/>Service Control Report</a></li><li role=none><a role=treeitem title="该模板用于表达分布式追踪数据中的一个 Span。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/templates/tracespan/>Trace Span</a></li></ul></li><li role=none><a role=treeitem title="通过 Mixer 从 Istio 导出的默认监控指标。" href=/v1.1/zh/docs/reference/config/policy-and-telemetry/metrics/>默认监控指标</a></li></ul></li><li role=none><a role=treeitem title=流量路由配置。 href=/v1.1/zh/docs/reference/config/istio.networking.v1alpha3/>通信路由</a></li></ul></li><li role=treeitem aria-label=命令><button aria-hidden=true></button><a title="描述 Istio 命令和工具的用法及选项。" href=/v1.1/zh/docs/reference/commands/>命令</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Galley 为 Istio 提供配置管理服务。" href=/v1.1/zh/docs/reference/commands/galley/>galley</a></li><li role=none><a role=treeitem title="自动注入 Istio sidecar 的 Kubernetes webhook。" href=/v1.1/zh/docs/reference/commands/sidecar-injector/>sidecar-injector</a></li><li role=none><a role=treeitem title="Istio 控制界面。" href=/v1.1/zh/docs/reference/commands/istioctl/>istioctl</a></li><li role=none><a role=treeitem title="Istio 证书颁发（CA）。" href=/v1.1/zh/docs/reference/commands/istio_ca/>istio_ca</a></li><li role=none><a role=treeitem title="用于触发直接调用 Mixer API 的实用程序。" href=/v1.1/zh/docs/reference/commands/mixc/>mixc</a></li><li role=none><a role=treeitem title="Mixer 是 Istio 在后端基础设施之上的抽象。" href=/v1.1/zh/docs/reference/commands/mixs/>mixs</a></li><li role=none><a role=treeitem title="节点一级的 Istio 安全代理。" href=/v1.1/zh/docs/reference/commands/node_agent/>node_agent</a></li><li role=none><a role=treeitem title="Istio Pilot。" href=/v1.1/zh/docs/reference/commands/pilot-discovery/>pilot-discovery</a></li></ul></li></ul></div></div></div></nav></div><div class=article-container><button tabindex=-1 id=sidebar-toggler title=折叠导航栏><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#pull"/></svg></button><nav aria-label=Breadcrumb><ol><li><a href=/v1.1/zh/>Istio</a></li><li><a href=/v1.1/zh/docs/ title="了解如何部署、使用和运维 Istio。">文档</a></li><li><a href=/v1.1/zh/docs/setup/ title="在不同的环境下（例如 Kubernetes、Consul 等）如何部署和升级 Istio。">安装</a></li><li><a href=/v1.1/zh/docs/setup/kubernetes/ title="关于如何在 Kubernetes 集群中安装 Istio 控制平面和添加虚拟机到 mesh 中的说明。">Kubernetes</a></li><li><a href=/v1.1/zh/docs/setup/kubernetes/install/ title=选择最适合您需求和平台的方案。>安装方案</a></li><li><a href=/v1.1/zh/docs/setup/kubernetes/install/multicluster/ title="配置跨越多个 Kubernetes 集群的 Istio 服务网格。">多集群安装</a></li><li>VPN 连接</li></ol></nav><article aria-labelledby=title><div class=title-area><div><h1 id=title>VPN 连接</h1><p class=byline><span title="1217 字"><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#clock"/></svg><span>&nbsp;</span>阅读大约需要 6 分钟</span></p></div></div><nav class=toc-inlined aria-label="Table of Contents"><div><hr><ol><li role=none aria-label=先决条件><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6>先决条件</a><li role=none aria-label=部署本地控制平面><a href=#%e9%83%a8%e7%bd%b2%e6%9c%ac%e5%9c%b0%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2>部署本地控制平面</a><li role=none aria-label="安装 Istio 远程组件"><a href=#%e5%ae%89%e8%a3%85-istio-%e8%bf%9c%e7%a8%8b%e7%bb%84%e4%bb%b6>安装 Istio 远程组件</a><ol><li role=none aria-label=设置环境变量><a href=#environment>设置环境变量</a><li role=none aria-label=安装并管理远程集群><a href=#%e5%ae%89%e8%a3%85%e5%b9%b6%e7%ae%a1%e7%90%86%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4>安装并管理远程集群</a><ol><li role=none aria-label="通过 Helm 和 kubectl"><a href=#helm-k>通过 Helm 和 <code>kubectl</code></a><li role=none aria-label="通过 Helm 和 Tiller"><a href=#tiller>通过 Helm 和 Tiller</a></ol></li><li role=none aria-label=设置环境变量><a href=#environment-var>设置环境变量</a><li role=none aria-label="Helm chart 配置参数"><a href=#helm-chart-%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0>Helm chart 配置参数</a></ol></li><li role=none aria-label=为远程集群生成配置文件><a href=#kubeconfig>为远程集群生成配置文件</a><li role=none aria-label=实例化凭据><a href=#credentials>实例化凭据</a><li role=none aria-label=卸载远程集群><a href=#%e5%8d%b8%e8%bd%bd%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4>卸载远程集群</a><ol><li role=none aria-label="通过 kubectl"><a href=#%e9%80%9a%e8%bf%87-kubectl>通过 <code>kubectl</code></a><li role=none aria-label="通过 Tiller"><a href=#%e9%80%9a%e8%bf%87-tiller>通过 Tiller</a></ol></li><li role=none aria-label="手动 sidecar 注入示例"><a href=#manual-sidecar>手动 sidecar 注入示例</a><ol><li role=none aria-label="手动将 sidecars 注入到应用清单中"><a href=#%e6%89%8b%e5%8a%a8%e5%b0%86-sidecars-%e6%b3%a8%e5%85%a5%e5%88%b0%e5%ba%94%e7%94%a8%e6%b8%85%e5%8d%95%e4%b8%ad>手动将 sidecars 注入到应用清单中</a></ol></li><li role=none aria-label=访问来自不同集群的服务><a href=#%e8%ae%bf%e9%97%ae%e6%9d%a5%e8%87%aa%e4%b8%8d%e5%90%8c%e9%9b%86%e7%be%a4%e7%9a%84%e6%9c%8d%e5%8a%a1>访问来自不同集群的服务</a><li role=none aria-label=部署注意事项><a href=#%e9%83%a8%e7%bd%b2%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>部署注意事项</a><ol><li role=none aria-label="更新 DNS 条目"><a href=#%e6%9b%b4%e6%96%b0-dns-%e6%9d%a1%e7%9b%ae>更新 DNS 条目</a><li role=none aria-label=切换负载均衡类型><a href=#%e5%88%87%e6%8d%a2%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e7%b1%bb%e5%9e%8b>切换负载均衡类型</a><li role=none aria-label="通过网关暴露 Istio 服务"><a href=#%e9%80%9a%e8%bf%87%e7%bd%91%e5%85%b3%e6%9a%b4%e9%9c%b2-istio-%e6%9c%8d%e5%8a%a1>通过网关暴露 Istio 服务</a></ol></li><li role=none aria-label=安装><a href=#%e5%ae%89%e8%a3%85>安装</a><ol><li role=none aria-label=控制平面安全><a href=#%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2%e5%ae%89%e5%85%a8>控制平面安全</a><li role=none aria-label="应用 Pod 之间的双向 TLS"><a href=#%e5%ba%94%e7%94%a8-pod-%e4%b9%8b%e9%97%b4%e7%9a%84%e5%8f%8c%e5%90%91-tls>应用 Pod 之间的双向 TLS</a><li role=none aria-label=部署示例><a href=#%e9%83%a8%e7%bd%b2%e7%a4%ba%e4%be%8b>部署示例</a><ol><li role=none aria-label="主集群: 部署控制平面集群"><a href=#%e4%b8%bb%e9%9b%86%e7%be%a4-%e9%83%a8%e7%bd%b2%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2%e9%9b%86%e7%be%a4>主集群: 部署控制平面集群</a><li role=none aria-label="远程集群：部署 Istio 组件"><a href=#%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4-%e9%83%a8%e7%bd%b2-istio-%e7%bb%84%e4%bb%b6>远程集群：部署 Istio 组件</a></ol></li><li role=none aria-label=主集群：实例化凭据><a href=#%e4%b8%bb%e9%9b%86%e7%be%a4-%e5%ae%9e%e4%be%8b%e5%8c%96%e5%87%ad%e6%8d%ae>主集群：实例化凭据</a></ol></li><li role=none aria-label=相关内容><a href=#see-also>相关内容</a></li></ol><hr></div></nav><p>这是一个关于当每个集群中的 pod 可以直连访问其他集群中的 pod 时，可以跨多个集群安装 Istio 网格的说明。</p><p>在此配置中，运行远程配置的多个 Kubernetes 控制平面将连接到<strong>单个</strong> Istio 控制平面。一旦一个或多个远程 Kubernetes 集群连接到 Istio 控制平面，Envoy 就可以与单个控制平面通信并形成跨多个集群的服务网格。</p><figure style=width:80%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:60.01468418364452%><a data-skipendnotes=true href=/v1.1/docs/setup/kubernetes/install/multicluster/vpn/multicluster-with-vpn.svg title="通过 VPN 直连远程 pod 的多 Kubernetes 集群 Istio 网格"><img class=element-to-stretch src=/v1.1/docs/setup/kubernetes/install/multicluster/vpn/multicluster-with-vpn.svg alt="通过 VPN 直连远程 pod 的多 Kubernetes 集群 Istio 网格"></a></div><figcaption>通过 VPN 直连远程 pod 的多 Kubernetes 集群 Istio 网格</figcaption></figure><h2 id=先决条件>先决条件</h2><ul><li><p>两个以上运行 <strong>Kubernetes 1.9 或更高版本</strong>的集群。</p></li><li><p>能够在其中<strong>一个</strong>集群上部署 <a href=/v1.1/zh/docs/setup/kubernetes/install/kubernetes/>Istio 控制平面</a>的能力。</p></li><li><p>RFC1918 网络、VPN或是满足以下可选条件的更高级的网络技术：</p><ul><li><p>单集群 Pod 和服务的 CIDR 范围在多集群环境中必须唯一，最好不要重叠。</p></li><li><p>每个集群中的所有 Pod CIDR 必须的相互可达的。</p></li><li><p>所有 Kubernetes 控制平面 API 服务必须是相互可达的。</p></li></ul></li><li><p>Helm <strong>2.7.2 或更高版本</strong>。 也可选择使用 Tiller 。</p></li></ul><p>本指南将介绍如何使用 Istio 仓库中提供的清单和 Helm charts 安装一个多集群的 Istio 拓扑。</p><h2 id=部署本地控制平面>部署本地控制平面</h2><p>在<strong>一个</strong> Kubernetes 集群中安装 <a href=/v1.1/zh/docs/setup/kubernetes/install/kubernetes/#安装步骤>Istio 控制平面</a>。</p><h2 id=安装-istio-远程组件>安装 Istio 远程组件</h2><p>你必须将 <code>istio-remote</code> 组件部署到每一个远程 Kubernetes
集群中。 你可以通过以下两种方式之一安装组件：</p><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1 role=tablist class=tabset><div class=tab-strip data-cookie-name=install-istio-remote><button aria-selected=true data-cookie-value=Helm&#43;kubectl aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-0-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-0-tab role=tab><span>Helm&#43;kubectl</span>
</button><button tabindex=-1 data-cookie-value=Helm&#43;Tiller aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-1-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-1-tab role=tab><span>Helm&#43;Tiller</span></button></div><div class=tab-content><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-0-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-0-tab><a href=#helm-k>使用 Helm 和 <code>kubectl</code> 安装并管理远程集群</a></div><div hidden id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-1-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-1-1-tab><a href=#tiller>使用 Helm 和 Tiller 安装并管理远程集群</a></div></div></div><h3 id=environment>设置环境变量</h3><p>等待 Istio 控制平面完成初始化，然后再执行本节中的步骤。</p><p>你必须在 Istio 控制平面上运行这些操作以捕获 Istio 控制平面服务端点，如：Pilot、Policy 端点。</p><p>如果你在每个远程组件上使用 Helm 和 Tiller，你必须将环境变量复制到每个节点，然后再使用 Helm 将远程集群连接到 Istio 控制平面。</p><p>通过以下命令设置环境变量：</p><pre><code class=language-bash data-expandlinks=true>$ export PILOT_POD_IP=$(kubectl -n istio-system get pod -l istio=pilot -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
$ export POLICY_POD_IP=$(kubectl -n istio-system get pod -l istio-mixer-type=policy -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
$ export TELEMETRY_POD_IP=$(kubectl -n istio-system get pod -l istio-mixer-type=telemetry -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
$ export ZIPKIN_POD_IP=$(kubectl -n istio-system get pod -l app=jaeger -o jsonpath=&#39;{range .items[*]}{.status.podIP}{end}&#39;)
</code></pre><p>接着，你必须将远程集群与本地集群连接。</p><p>继续你先前的选项：</p><ul><li><p>通过 <a href=#helm-k><code>kubectl</code> + Helm</a></p></li><li><p>通过 <a href=#tiller>Helm + Tiller</a></p></li></ul><p>通常，需要启动远程 sidecar 注入。如果需要执行手动 sidecar 注入，请参阅<a href=#manual-sidecar>手动 sidecar 注入示例</a>。</p><h3 id=安装并管理远程集群>安装并管理远程集群</h3><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2 role=tablist class=tabset><div class=tab-strip data-cookie-name=install-istio-remote><button aria-selected=true data-cookie-value=Helm&#43;kubectl aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-0-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-0-tab role=tab><span>Helm&#43;kubectl</span>
</button><button tabindex=-1 data-cookie-value=Helm&#43;Tiller aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-1-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-1-tab role=tab><span>Helm&#43;Tiller</span></button></div><div class=tab-content><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-0-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-0-tab><h4 id=helm-k>通过 Helm 和 <code>kubectl</code></h4><ol><li><p>通过以下 <code>helm template</code> 命令在远程集群中指定 Istio 控制平面服务端点：</p><pre><code class=language-bash data-expandlinks=true>$ helm template install/kubernetes/helm/istio --namespace istio-system \
--name istio-remote \
--values install/kubernetes/helm/istio/values-istio-remote.yaml \
--set global.remotePilotAddress=${PILOT_POD_IP} \
--set global.remotePolicyAddress=${POLICY_POD_IP} \
--set global.remoteTelemetryAddress=${TELEMETRY_POD_IP} &gt; $HOME/istio-remote.yaml
</code></pre></li><li><p>通过以下命令给远程 Istio 创建一个 <code>istio-system</code> 命名空间：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl create ns istio-system
</code></pre><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.1/img/icons.svg#callout-tip"/></svg></div><div class=content>所有集群必须有相同的 Istio 组件命名空间。只要命名空间对有所有集群中的 Istio 组件都相同，就可以覆盖住集群上的 <code>istio-system</code> 名称。</div></aside></div></li><li><p>通过以下命令实例化远程集群与 Istio 控制平面的连接：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl apply -f $HOME/istio-remote.yaml
</code></pre></li><li><p>使用以下示例命令标记 <code>default</code> 命名空间。使用相似命令标记所有需要自动 sidecar 注入的远程集群命名空间。</p><pre><code class=language-bash data-expandlinks=true>$ kubectl label namespace default istio-injection=enabled
</code></pre></li></ol><p>对需要设置 sidecar 注入的所有 Kubernetes 命名空间需要重复此操作。</p></div><div hidden id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-1-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-2-1-tab><h4 id=tiller>通过 Helm 和 Tiller</h4><ol><li><p>如果你尚未给 Helm 设置一个 service account ，请使用以下命令安装一个：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl apply -f install/kubernetes/helm/helm-service-account.yaml
</code></pre></li><li><p>通过以下命令初始化 Helm：</p><pre><code class=language-bash data-expandlinks=true>$ helm init --service-account tiller
</code></pre></li><li><p>通过以下命令来为 <code>istio-remote</code> 安装 Helm chart：</p><pre><code class=language-bash data-expandlinks=true>$ helm install install/kubernetes/helm/istio \
--name istio-remote --namespace istio-system \
--values install/kubernetes/helm/istio/values-istio-remote.yaml \
--set global.remotePilotAddress=${PILOT_POD_IP} \
--set global.remotePolicyAddress=${POLICY_POD_IP} \
--set global.remoteTelemetryAddress=${TELEMETRY_POD_IP}
</code></pre></li></ol></div></div></div><h3 id=environment-var>设置环境变量</h3><p>等待 Istio 控制平面完成初始化，然后再执行本节中的步骤。</p><p>您必须在 Istio 控制平面集群上运行这些操作以捕获 Istio 控制平面服务端点，例如 Pilot 和 Policy Pod IP 端点。</p><p>如果在每个遥控器上使用Helm with Tiller，则必须先将环境变量复制到每个节点，然后才能使用Helm将远程集群连接到Istio控制平面。</p><p>使用以下命令设置环境变量：</p><pre><code class=language-bash data-expandlinks=true>$ export PILOT_POD_IP=$(kubectl -n istio-system get pod -l istio=pilot -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
$ export POLICY_POD_IP=$(kubectl -n istio-system get pod -l istio-mixer-type=policy -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
$ export TELEMETRY_POD_IP=$(kubectl -n istio-system get pod -l istio-mixer-type=telemetry -o jsonpath=&#39;{.items[0].status.podIP}&#39;)
</code></pre><p>通常，启用远程集群上的自动 sidecar 注入。要执行手动 sidecar 注入，请参阅<a href=#manual-sidecar>手动 sidecar 示例</a></p><h3 id=helm-chart-配置参数>Helm chart 配置参数</h3><p>你必须配置远程集群的 sidecar 与 Istio 控制平面的交互，包括 <code>istio-remote</code> 的 Helm chart：
<code>pilot</code>, <code>policy</code>, <code>telemetry</code>, <code>statsd</code> 和 追踪服务。</p><p>该 chart 默认启动自动 sidecar 注入。你可以通过 chart 变量来禁用该功能。</p><p>下表显示了已通过的 <code>istio-remote</code> Helm chart 配置变量：</p><table><thead><tr><th>Helm 变量</th><th>可选值</th><th>默认</th><th>用途</th></tr></thead><tbody><tr><td><code>global.remotePilotAddress</code></td><td>一个合法的 IP 地址或主机名</td><td>None</td><td>指定 Istio 控制平面的 pilot Pod IP 地址或远程集群 DNS 可解析的主机名。</td></tr><tr><td><code>global.remotePolicyAddress</code></td><td>一个合法的 IP 地址或主机名</td><td>None</td><td>指定 Istio 控制平面的 policy Pod IP 地址或远程集群 DNS 可解析的主机名。</td></tr><tr><td><code>global.remoteTelemetryAddress</code></td><td>一个合法的 IP 地址或主机名</td><td>None</td><td>指定 Istio 控制平面的 telemetry Pod IP 地址或远程集群 DNS 可解析的主机名。</td></tr><tr><td><code>global.remoteZipkinAddress</code></td><td>一个合法的 IP 地址或主机名</td><td>None</td><td>指定 Istio 控制平面追踪应用的 Pod IP 地址或远程集群 DNS 可解析的主机名。例如：<code>zipkin</code> 或 <code>jaeger</code>。</td></tr><tr><td><code>sidecarInjectorWebhook.enabled</code></td><td>true, false</td><td>true</td><td>指定是否在远程集群中启用了自动 sidecar 注入</td></tr><tr><td><code>global.remotePilotCreateSvcEndpoint</code></td><td>true, false</td><td>false</td><td>如果设置该项，一个无选择器服务和端点将以<code>remotePilotAddress</code> IP的形式被创建给 <code>istio-pilot.&lt;namespace&gt;</code>是远程集群 DNS 可解析的。</td></tr></tbody></table><h2 id=kubeconfig>为远程集群生成配置文件</h2><p>Istio 控制平面需要服务所有集群中的网格来发现服务、端点和 pod 属性。</p><p>以下步骤描述了如何生成一个 <code>kubeconfig</code> 配置文件给 Istio 控制面板以使用远程集群。</p><p><code>istio-remote</code> Helm chart 在远程集群中创建了一个叫 <code>istio-multi</code> 的 Kubernetes service account 用于最小化 RBAC 访问请求。
此过程通过使用先前所述的 <code>istio-multi</code> service account 凭证生成了一个远程集群的 <code>kubeconfig</code> 配置文件。</p><p>每个远程集群上执行此过程以将集群添加到服务网格。此过程需要 <code>cluster-admin</code> 用户访问远程集群的权限。</p><ol><li><p>通过以下命令为 <code>istio-multi</code> service account 设置所需环境变量构建 <code>kubeconfig</code> 文件：</p><pre><code class=language-bash data-expandlinks=true>$ export WORK_DIR=$(pwd)
$ CLUSTER_NAME=$(kubectl config view --minify=true -o jsonpath=&#39;{.clusters[].name}&#39;)
$ export KUBECFG_FILE=${WORK_DIR}/${CLUSTER_NAME}
$ SERVER=$(kubectl config view --minify=true -o jsonpath=&#39;{.clusters[].cluster.server}&#39;)
$ NAMESPACE=istio-system
$ SERVICE_ACCOUNT=istio-multi
$ SECRET_NAME=$(kubectl get sa ${SERVICE_ACCOUNT} -n ${NAMESPACE} -o jsonpath=&#39;{.secrets[].name}&#39;)
$ CA_DATA=$(kubectl get secret ${SECRET_NAME} -n ${NAMESPACE} -o jsonpath=&#34;{.data[&#39;ca\.crt&#39;]}&#34;)
$ TOKEN=$(kubectl get secret ${SECRET_NAME} -n ${NAMESPACE} -o jsonpath=&#34;{.data[&#39;token&#39;]}&#34; | base64 --decode)
</code></pre><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.1/img/icons.svg#callout-tip"/></svg></div><div class=content>许多系统对 <code>base64 --decode</code> 都有 <code>openssl enc -d -base64 -A</code> 这样的替代方案。</div></aside></div></li><li><p>通过以下命令为 <code>istio-multi</code> service account 在工作目录创建一个 <code>kubeconfig</code> 文件：</p><pre><code class=language-bash data-expandlinks=true>$ cat &lt;&lt;EOF &gt; ${KUBECFG_FILE}
apiVersion: v1
clusters:
   - cluster:
       certificate-authority-data: ${CA_DATA}
       server: ${SERVER}
     name: ${CLUSTER_NAME}
contexts:
   - context:
       cluster: ${CLUSTER_NAME}
       user: ${CLUSTER_NAME}
     name: ${CLUSTER_NAME}
current-context: ${CLUSTER_NAME}
kind: Config
preferences: {}
users:
   - name: ${CLUSTER_NAME}
     user:
       token: ${TOKEN}
EOF
</code></pre></li><li><p><em>(可选)</em> 使用环境变量创建文件以创建远程集群的密钥：</p><pre><code class=language-bash data-expandlinks=true>$ cat &lt;&lt;EOF &gt; remote_cluster_env_vars
export CLUSTER_NAME=${CLUSTER_NAME}
export KUBECFG_FILE=${KUBECFG_FILE}
export NAMESPACE=${NAMESPACE}
EOF
</code></pre></li></ol><p>此时，你在当前目录创建了远程集群的 <code>kubeconfig</code> 文件。</p><p>文件名为 <code>kubeconfig</code> 的文件与原始集群名称相同。</p><h2 id=credentials>实例化凭据</h2><p>在运行了 Istio 控制平面的机器上执行以下过程。
该过程使用的 <code>WORK_DIR</code>、<code>CLUSTER_NAME</code> 和 <code>NAMESPACE</code> 环境变量都存在于<a href=#kubeconfig>上一节</a>为远程集群创建的配置文件中。
如果你为远程集群的 secret 创建了环境变量文件，请通过以下命令获取该文件：</p><pre><code class=language-bash data-expandlinks=true>$ source remote_cluster_env_vars
</code></pre><p>你可以在不同的命名空间中安装 Istio。该过程需要使用 <code>istio-system</code> 命名空间。</p><div><aside class="callout warning"><div class=type><svg class="large-icon"><use xlink:href="/v1.1/img/icons.svg#callout-warning"/></svg></div><div class=content>不要存储和标记运行了 Istio 控制平面的本地集群的 secret。Istio 始终了解本地集群的 Kubernetes 凭据。</div></aside></div><p>为每个集群创建一个正确的 secret 和 标记：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl create secret generic ${CLUSTER_NAME} --from-file ${KUBECFG_FILE} -n ${NAMESPACE}
$ kubectl label secret ${CLUSTER_NAME} istio/multiCluster=true -n ${NAMESPACE}
</code></pre><div><aside class="callout warning"><div class=type><svg class="large-icon"><use xlink:href="/v1.1/img/icons.svg#callout-warning"/></svg></div><div class=content>Kubernetes secret 数据秘钥必须符合 <code>DNS-1123 subdomain</code> <a href=https://tools.ietf.org/html/rfc1123#page-13>格式</a>。例如，文件名不能有下划线。只需更改文件名以符合格式，即可解决文件名的任何问题。</div></aside></div><h2 id=卸载远程集群>卸载远程集群</h2><p>你必须使用与他们安装相同的方法卸载远程集群。</p><p>通过 <code>kubectl + Helm</code> 或 <code>Tiller + Helm</code> 合理卸载他们。</p><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3 role=tablist class=tabset><div class=tab-strip data-cookie-name=install-istio-remote><button aria-selected=true data-cookie-value=Helm&#43;kubectl aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-0-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-0-tab role=tab><span>kubectl</span>
</button><button tabindex=-1 data-cookie-value=Helm&#43;Tiller aria-controls=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-1-panel id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-1-tab role=tab><span>Tiller</span></button></div><div class=tab-content><div id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-0-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-0-tab><h3 id=通过-kubectl>通过 <code>kubectl</code></h3><p>要卸载集群，你必须移除 <code>istio-remote.yaml</code>文件进行的配置。
通过以下命令卸载：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl delete -f $HOME/istio-remote.yaml
</code></pre></div><div hidden id=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-1-panel role=tabpanel tabindex=0 aria-labelledby=tabset-zh-docs-setup-kubernetes-install-multicluster-vpn-3-1-tab><h3 id=通过-tiller>通过 Tiller</h3><p>要卸载集群，你必须移除 <code>istio-remote.yaml</code> 文件进行的配置。
通过以下命令卸载：</p><pre><code class=language-bash data-expandlinks=true>$ helm delete --purge istio-remote
</code></pre></div></div></div><h2 id=manual-sidecar>手动 sidecar 注入示例</h2><p>以下示例将展示如何使用 <code>helm template</code> 命令生成清单以禁用集群的自动 sidecar 注入。此外，示例将展示如何使用远程集群的 <code>configmaps</code> ，通过 <code>istioctl kube-inject</code> 命令为远程集群生成任何应用的清单。</p><p>对远程集群执行以下过程：</p><p>在开始之前，请按照<a href=#environment>设置环境变量部分</a>设置端点 IP 环境变量</p><ol><li><p>在远程集群使用 <code>helm template</code> 命令指定 Istio
控制平面的 service 端点：</p><pre><code class=language-bash data-expandlinks=true>$ helm template install/kubernetes/helm/istio \
--namespace istio-system --name istio-remote \
--values install/kubernetes/helm/istio/values-istio-remote.yaml \
--set global.remotePilotAddress=${PILOT_POD_IP} \
--set global.remotePolicyAddress=${POLICY_POD_IP} \
--set global.remoteTelemetryAddress=${TELEMETRY_POD_IP} \
--set sidecarInjectorWebhook.enabled=false &gt; $HOME/istio-remote_noautoinj.yaml
</code></pre></li><li><p>为远程 Istio 创建 <code>istio-system</code> 命名空间：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl create ns istio-system
</code></pre></li><li><p>实例化远程集群与 Istio 控制平面的连接：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl apply -f $HOME/istio-remote_noautoinj.yaml
</code></pre></li><li><p>为每个远程集群<a href=#kubeconfig>生成</a> <code>kubeconfig</code> 配置文件。</p></li><li><p>为每个集群<a href=#credentials>实例化凭证</a>。</p></li></ol><h3 id=手动将-sidecars-注入到应用清单中>手动将 sidecars 注入到应用清单中</h3><p>以下示例通过 <code>istioctl</code> 命令将 sidecar 注入到应用清单。</p><p>在终端中运行以下命令，通过 <code>kubeconfig</code> 为远程集群设置上下文。</p><pre><code class=language-bash data-expandlinks=true>$ ORIGINAL_SVC_MANIFEST=mysvc-v1.yaml
$ istioctl kube-inject --injectConfigMapName istio-sidecar-injector --meshConfigMapName istio -f ${ORIGINAL_SVC_MANIFEST} | kubectl apply -f -
</code></pre><h2 id=访问来自不同集群的服务>访问来自不同集群的服务</h2><p>Kubernetes 在集群的基础上解析 DNS。由于 DNS解析与集群相关联，因此无论服务端点的位置如何，你都必须在每个运行客户端的集群中定义服务对象。</p><p>为了确保这种情况，在每个集群中使用 <code>kubectl</code> 复制服务对象。副本确保了 Kubernetes 可以解析任何集群中的服务名称。由于服务对象被定义在命名空间中，你必须自己定义命名空间（如果命名空间不存在）并且将其囊括在所有集群的服务定义中。</p><h2 id=部署注意事项>部署注意事项</h2><p>前面的过程提供了部署多集群环境的简单分步指南。生产环境可能需要其他步骤或更复杂的部署选项。该过程收集 Istio 服务端点的 IP 地址并用他们来调用 Helm。
这个过程在远程集群创建了 Istio 服务。作为在远程集群创建这些服务和端点的一部分，Kubernetes 将 DNS 条目加入到了 <code>kube-dns</code> 配置对象中。
这将允许在远程集群中 <code>kube-dns</code> 配置对象将解析 Istio 服务名给所有 Envoy sidecar。
由于 Kubernetes pods 没有固定的 IP 地址，在控制平面中重启任何 Istio 服务 pod 都会导致它端点的改变。
因此，任何从远程集群到任何端点的连接都会中断。<a href=https://github.com/istio/istio/issues/4822>Istio issue #4822</a>详细记录了该问题。</p><p>要避免或解决此问题，有多个选项可供选择。本节提供了以下选项的高级概述：</p><ul><li>更新 DNS 条目</li><li>切换负载均衡服务类型</li><li>通过网关暴露 Istio 服务</li></ul><h3 id=更新-dns-条目>更新 DNS 条目</h3><p>在发生任何故障或 pod 重启时，在远程集群重启 <code>kube-dns</code> 可以为 Istio 服务正确更新端点的映射关系。
有很多方法可以做到这点。常规做法是在远程节点重新运行 Helm 安装，之后 Istio 服务便会在控制平面上重启。</p><h3 id=切换负载均衡类型>切换负载均衡类型</h3><p>在 Kubernetes 中，你可以以 <code>LoadBalancer</code> 类型声明服务。
更多内容详见 Kubernetes 的<a href=https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types>服务类型</a>。</p><p>pod 重启的一个简单的解决方案是给 Istio 服务使用负载均衡器。</p><p>接着，你可以使用负载均衡器的 IP 地址作为 Istio 服务端点的 IP 地址以配置远程集群。你或许需要这些 Istio 服务的负载均衡器：</p><ul><li><code>istio-pilot</code></li><li><code>istio-telemetry</code></li><li><code>istio-policy</code></li></ul><p>目前，Istio 安装不提供为 Istio 服务指定服务类型的选项。 您可以在 Istio Helm chart 或 Istio 清单中手动指定服务类型。</p><h3 id=通过网关暴露-istio-服务>通过网关暴露 Istio 服务</h3><p>此方法使用了 Istio ingress 网关的功能。远程集群有 <code>istio-pilot</code>、<code>istio-telemetry</code>、 <code>istio-policy</code>、
和 <code>zipkin</code> 服务，它们指向了 Istio ingress 网关的负载均衡 IP 地址。然后，所有的服务均指向相同的 IP 地址。你必须创建目标规则以在主集群的 ingress 网关中获得正确的 Istio 服务。</p><p>以下两种方案可供选择：</p><ul><li><p>重新使用清单或 Helm charts 提供安装的默认 Istio ingress 网关。您只需添加正确的目标规则。</p></li><li><p>专门为集群创建另一个 Istio ingress 网关。</p></li></ul><h2 id=安装>安装</h2><p>Istio 支持在控制平面组件之间以及在 sidecar 注入的应用 pod 之间部署双向 TLS。</p><h3 id=控制平面安全>控制平面安全</h3><p>要启用控制平面安全性，请遵循以下常规步骤：</p><ol><li><p>部署 Istio 控制平面集群：</p><ul><li><p>控制平面安全已启用。</p></li><li><p>该 <code>citadel</code> 证书自签署禁用。</p></li><li><p><code>cacerts</code> 的 secret 通过<a href=/v1.1/zh/docs/tasks/security/plugin-ca-cert/#插入现有密钥和证书>证书颁发机构 (CA) 证书</a>下发在Istio 控制平面命名空间中。</p></li></ul></li><li><p>部署 Istio 远程集群：</p><ul><li><p>控制平面安全已启用。</p></li><li><p>该 <code>citadel</code> 证书自签署禁用。</p></li><li><p><code>cacerts</code> 的 secret 通过<a href=/v1.1/zh/docs/tasks/security/plugin-ca-cert/#插入现有密钥和证书>(CA) 证书</a>下发在Istio 控制平面命名空间中。</p></li></ul><p>主集群的证书颁发机构（CA）或根 CA 也必须为远程集群签署 CA 证书。</p><ul><li><p>Istio pilot 服务主机名必须通过DNS解析。DNS解析是必需的，因为Istio 需要配置 sidecar 以使用 <code>istio-pilot.&lt;namespace&gt;</code> 主题名称格式验证证书主题名称。</p></li><li><p>设置控制平面IP或可解析的主机名。</p></li></ul></li></ol><h3 id=应用-pod-之间的双向-tls>应用 Pod 之间的双向 TLS</h3><p>为了确保应用 Pod 之间的双向 TLS，请按照以下常规步骤操作：</p><ol><li><p>部署Istio控制平面集群：</p><ul><li><p>全局启用了相互TLS。</p></li><li><p>Citadel 证书自签名禁用。</p></li><li><p><code>cacerts</code> 的 secret 通过<a href=/v1.1/zh/docs/tasks/security/plugin-ca-cert/#插入现有密钥和证书>(CA) 证书</a>下发在Istio 控制平面命名空间中。</p></li></ul></li><li><p>部署Istio远程集群：</p><ul><li><p>全局启用了相互TLS。</p></li><li><p>Citadel 证书自签名禁用。</p></li><li><p><code>cacerts</code> 的 secret 通过<a href=/v1.1/zh/docs/tasks/security/plugin-ca-cert/#插入现有密钥和证书>(CA) 证书</a>下发在Istio 控制平面命名空间中。
主集群的 CA 或根 CA 也必须为远程集群签署CA证书。</p></li></ul></li></ol><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.1/img/icons.svg#callout-tip"/></svg></div><div class=content>对于控制平面安全性和应用 pod 安全性步骤，CA 证书步骤是相同的。</div></aside></div><h3 id=部署示例>部署示例</h3><p>此示例为安装 Istio 的过程，同时启用控制平面双向 TLS 和 应用 pod 双向 TLS。该过程
使用无选择器服务和端点设置远程集群。Istio Pilot 使用服务和端点允许远程 sidecar 通过 Istio 的本地 Kubernetes DNS 解析主机名。</p><h4 id=主集群-部署控制平面集群>主集群: 部署控制平面集群</h4><ol><li><p>通过在 <code>istio-system</code> 命名空间中的 Istio 证书示例创建 <code>cacerts</code> secret：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl create ns istio-system
$ kubectl create secret generic cacerts -n istio-system --from-file=samples/certs/ca-cert.pem --from-file=samples/certs/ca-key.pem --from-file=samples/certs/root-cert.pem --from-file=samples/certs/cert-chain.pem
</code></pre></li><li><p>部署 Istio 控制平面，并为控制平面和应用 pod 启用安全：</p><pre><code class=language-bash data-expandlinks=true>$ helm template --namespace=istio-system \
  --values install/kubernetes/helm/istio/values.yaml \
  --set global.mtls.enabled=true \
  --set security.selfSigned=false \
  --set global.controlPlaneSecurityEnabled=true \
  install/kubernetes/helm/istio &gt; ${HOME}/istio-auth.yaml
$ kubectl apply -f ${HOME}/istio-auth.yaml
</code></pre></li></ol><h4 id=远程集群-部署-istio-组件>远程集群：部署 Istio 组件</h4><ol><li><p>通过在 <code>istio-system</code> 命名空间中的Istio 证书示例创建 <code>cacerts</code> secret：</p><pre><code class=language-bash data-expandlinks=true>$ kubectl create ns istio-system
$ kubectl create secret generic cacerts -n istio-system --from-file=samples/certs/ca-cert.pem --from-file=samples/certs/ca-key.pem --from-file=samples/certs/root-cert.pem --from-file=samples/certs/cert-chain.pem
</code></pre></li><li><p>按照<a href=#environment>设置环境变量</a>的说明为 pod 的 IP 地址设置环境变量。</p></li><li><p>通过以下命令为部署远程集群的组件并为控制平面和应用 pod 启用安全，同时启用创建 Istio Pilot 无选择器服务和端点以在远程集群中获取 DNS 条目。</p><pre><code class=language-bash data-expandlinks=true>$ helm template install/kubernetes/helm/istio \
  --name istio-remote \
  --namespace istio-system \
  --values install/kubernetes/helm/istio/values-istio-remote.yaml \
  --set global.mtls.enabled=true \
  --set security.selfSigned=false \
  --set global.controlPlaneSecurityEnabled=true \
  --set global.remotePilotCreateSvcEndpoint=true \
  --set global.remotePilotAddress=${PILOT_POD_IP} \
  --set global.remotePolicyAddress=${POLICY_POD_IP} \
  --set global.remoteTelemetryAddress=${TELEMETRY_POD_IP} &gt; ${HOME}/istio-remote-auth.yaml
$ kubectl apply -f ${HOME}/istio-remote-auth.yaml
</code></pre></li><li><p>要为远程集群生成 <code>kubeconfig</code> 配置文件，请按照<a href=#kubeconfig>Kubernetes 配置部分</a>的步骤操作。</p></li></ol><h3 id=主集群-实例化凭据>主集群：实例化凭据</h3><p>你必须为每个远程集群实例化凭据。请按照<a href=#credentials>实例化凭据工程</a>完成部署。</p><p><strong>恭喜!</strong></p><p>你已经在两个集群中配置了所有 Istio 组件以及在应用 sidecar、控制平面组件和其他应用 sidecar 之间开启了双向TLS。</p><nav id=see-also><h2>相关内容</h2><div class=see-also><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/setup/kubernetes/install/multicluster/gateways/>Gateway 连接</a></p><p class=desc>使用 Istio Gateway 跨越多个 Kubernetes 集群安装 Istio 网格以访问远程 pod。</p></div><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/examples/multicluster/gke/>Google Kubernetes Engine</a></p><p class=desc>基于 GKE 的 Istio 多集群安装。</p></div><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/examples/multicluster/iks-icp/>IBM Cloud Kubernetes Service &amp; IBM Cloud Private</a></p><p class=desc>IBM Cloud Kubernetes Service 和 IBM Cloud Private 之间的多集群示例。</p></div><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/examples/multicluster/icp/>IBM Cloud Private</a></p><p class=desc>多 IBM Cloud Private 集群安装 Istio 示例。</p></div><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/examples/multicluster/gateways/>通过网关进行连接的多集群</a></p><p class=desc>在一个使用网关进行连接的多集群网格中配置远程服务。</p></div><div class=entry><p class=link><a data-skipendnotes=true href=/v1.1/zh/docs/examples/multicluster/split-horizon-eds/>集群感知的服务路由</a></p><p class=desc>利用 Istio 的水平分割 EDS 来创建多集群网格。</p></div></div></nav></article><nav class=pagenav><div class=left><a title="使用 Istio Gateway 跨越多个 Kubernetes 集群安装 Istio 网格以访问远程 pod。" href=/v1.1/zh/docs/setup/kubernetes/install/multicluster/gateways/><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#left-arrow"/></svg>Gateway 连接</a></div><div class=right></div></nav><div id=endnotes-container aria-hidden=true><h2>链接</h2><ol id=endnotes></ol></div></div><div class=toc-container><nav class=toc aria-label="Table of Contents"><div id=toc><ol><li role=none aria-label=先决条件><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6>先决条件</a><li role=none aria-label=部署本地控制平面><a href=#%e9%83%a8%e7%bd%b2%e6%9c%ac%e5%9c%b0%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2>部署本地控制平面</a><li role=none aria-label="安装 Istio 远程组件"><a href=#%e5%ae%89%e8%a3%85-istio-%e8%bf%9c%e7%a8%8b%e7%bb%84%e4%bb%b6>安装 Istio 远程组件</a><ol><li role=none aria-label=设置环境变量><a href=#environment>设置环境变量</a><li role=none aria-label=安装并管理远程集群><a href=#%e5%ae%89%e8%a3%85%e5%b9%b6%e7%ae%a1%e7%90%86%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4>安装并管理远程集群</a><ol><li role=none aria-label="通过 Helm 和 kubectl"><a href=#helm-k>通过 Helm 和 <code>kubectl</code></a><li role=none aria-label="通过 Helm 和 Tiller"><a href=#tiller>通过 Helm 和 Tiller</a></ol></li><li role=none aria-label=设置环境变量><a href=#environment-var>设置环境变量</a><li role=none aria-label="Helm chart 配置参数"><a href=#helm-chart-%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0>Helm chart 配置参数</a></ol></li><li role=none aria-label=为远程集群生成配置文件><a href=#kubeconfig>为远程集群生成配置文件</a><li role=none aria-label=实例化凭据><a href=#credentials>实例化凭据</a><li role=none aria-label=卸载远程集群><a href=#%e5%8d%b8%e8%bd%bd%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4>卸载远程集群</a><ol><li role=none aria-label="通过 kubectl"><a href=#%e9%80%9a%e8%bf%87-kubectl>通过 <code>kubectl</code></a><li role=none aria-label="通过 Tiller"><a href=#%e9%80%9a%e8%bf%87-tiller>通过 Tiller</a></ol></li><li role=none aria-label="手动 sidecar 注入示例"><a href=#manual-sidecar>手动 sidecar 注入示例</a><ol><li role=none aria-label="手动将 sidecars 注入到应用清单中"><a href=#%e6%89%8b%e5%8a%a8%e5%b0%86-sidecars-%e6%b3%a8%e5%85%a5%e5%88%b0%e5%ba%94%e7%94%a8%e6%b8%85%e5%8d%95%e4%b8%ad>手动将 sidecars 注入到应用清单中</a></ol></li><li role=none aria-label=访问来自不同集群的服务><a href=#%e8%ae%bf%e9%97%ae%e6%9d%a5%e8%87%aa%e4%b8%8d%e5%90%8c%e9%9b%86%e7%be%a4%e7%9a%84%e6%9c%8d%e5%8a%a1>访问来自不同集群的服务</a><li role=none aria-label=部署注意事项><a href=#%e9%83%a8%e7%bd%b2%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>部署注意事项</a><ol><li role=none aria-label="更新 DNS 条目"><a href=#%e6%9b%b4%e6%96%b0-dns-%e6%9d%a1%e7%9b%ae>更新 DNS 条目</a><li role=none aria-label=切换负载均衡类型><a href=#%e5%88%87%e6%8d%a2%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e7%b1%bb%e5%9e%8b>切换负载均衡类型</a><li role=none aria-label="通过网关暴露 Istio 服务"><a href=#%e9%80%9a%e8%bf%87%e7%bd%91%e5%85%b3%e6%9a%b4%e9%9c%b2-istio-%e6%9c%8d%e5%8a%a1>通过网关暴露 Istio 服务</a></ol></li><li role=none aria-label=安装><a href=#%e5%ae%89%e8%a3%85>安装</a><ol><li role=none aria-label=控制平面安全><a href=#%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2%e5%ae%89%e5%85%a8>控制平面安全</a><li role=none aria-label="应用 Pod 之间的双向 TLS"><a href=#%e5%ba%94%e7%94%a8-pod-%e4%b9%8b%e9%97%b4%e7%9a%84%e5%8f%8c%e5%90%91-tls>应用 Pod 之间的双向 TLS</a><li role=none aria-label=部署示例><a href=#%e9%83%a8%e7%bd%b2%e7%a4%ba%e4%be%8b>部署示例</a><ol><li role=none aria-label="主集群: 部署控制平面集群"><a href=#%e4%b8%bb%e9%9b%86%e7%be%a4-%e9%83%a8%e7%bd%b2%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2%e9%9b%86%e7%be%a4>主集群: 部署控制平面集群</a><li role=none aria-label="远程集群：部署 Istio 组件"><a href=#%e8%bf%9c%e7%a8%8b%e9%9b%86%e7%be%a4-%e9%83%a8%e7%bd%b2-istio-%e7%bb%84%e4%bb%b6>远程集群：部署 Istio 组件</a></ol></li><li role=none aria-label=主集群：实例化凭据><a href=#%e4%b8%bb%e9%9b%86%e7%be%a4-%e5%ae%9e%e4%be%8b%e5%8c%96%e5%87%ad%e6%8d%ae>主集群：实例化凭据</a></ol></li><li role=none aria-label=相关内容><a href=#see-also>相关内容</a></li></ol></div></nav></div></main><footer><div class=user-links><a class=channel title="Go download Istio 1.1.9 now" href=https://github.com/istio/istio/releases/tag/1.1.9 aria-label="Download Istio"><span>download</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#download"/></svg>
</a><a class=channel title="加入 Istio discussion board 参与讨论获取帮助" href=https://discuss.istio.io aria-label="Istio discussion board"><span>discuss</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#discourse"/></svg></a>
<a class=channel title="Stack Overflow 中列举了针对实际问题以及部署、配置和使用 Istio 的各项回答" href=https://stackoverflow.com/questions/tagged/istio aria-label="Stack Overflow"><span>stack overflow</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#stackoverflow"/></svg></a>
<a class=channel title="关注我们的 Twitter 来获取最新信息" href=https://twitter.com/IstioMesh aria-label=Twitter><span>twitter</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#twitter"/></svg></a><div class=tag>对于用户</div></div><div class=info><p class=copyright>中文内容由 ServiceMesher 社区维护，部分文档可能稍微滞后于英文版本，同步工作持续进行中<br>Istio 归档
1.1.9<br>&copy; 2019 Istio Authors, <a href=https://policies.google.com/privacy>隐私政策</a><br>归档于 2019年6月18日</p></div><div class=dev-links><a class=channel title="Istio 的代码在 GitHub 上开发" href=https://github.com/istio/community aria-label=GitHub><span>github</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#github"/></svg></a>
<a class=channel title="在 Slack 上与 Istio 社区交互讨论开发问题（仅限邀请）" href=https://istio.slack.com aria-label=slack><span>slack</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#slack"/></svg></a>
<a class=channel title="如果您想深入了解 Istio 的技术细节，请查看我们日益完善的设计文档" href=https://groups.google.com/forum/#!forum/istio-team-drive-access aria-label="team drive"><span>drive</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#drive"/></svg></a>
<a class=channel title="如果您想为 Istio 项目做出贡献，请考虑加入我们的工作组" href=https://github.com/istio/community/blob/master/WORKING-GROUPS.md aria-label="working groups"><span>working groups</span><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#working-groups"/></svg></a><div class=tag>对于开发者</div></div></footer><div id=scroll-to-top-container aria-hidden=true><button id=scroll-to-top title=回到顶部><svg class="icon"><use xlink:href="/v1.1/img/icons.svg#top"/></svg></button></div></body></html>