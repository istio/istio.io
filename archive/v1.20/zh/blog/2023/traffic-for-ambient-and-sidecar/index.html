<!doctype html><html lang=zh itemscope itemtype=https://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#466BB0"><meta name=title content="深挖 Ambient 与 Sidecar 并存的网络流量路径"><meta name=description content="深挖 Ambient 与 Sidecar 并存的流量路径。"><meta name=author content="张怀龙 (Intel), John Howard (Google), 曾宇星 (Alibaba), Peter Jausovec (Solo.io); Translated by Wilson Wu (DaoCloud)"><meta name=keywords content="microservices,services,mesh,traffic,ambient,sidecar,coexistence"><meta property="og:title" content="深挖 Ambient 与 Sidecar 并存的网络流量路径"><meta property="og:type" content="website"><meta property="og:description" content="深挖 Ambient 与 Sidecar 并存的流量路径。"><meta property="og:url" content="/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/"><meta property="og:image" content="https://raw.githubusercontent.com/istio/istio.io/master/static/img/istio-social.png"><meta property="og:image:alt" content="The Istio sailboat logo"><meta property="og:image:width" content="4096"><meta property="og:image:height" content="2048"><meta property="og:site_name" content="Istio"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@IstioMesh"><title>Istioldie 1.20 / 深挖 Ambient 与 Sidecar 并存的网络流量路径</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98480406-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-98480406-2")</script><link rel=alternate type=application/rss+xml title="Istio Blog" href=/v1.20/blog/feed.xml><link rel=alternate type=application/rss+xml title="Istio News" href=/v1.20/news/feed.xml><link rel=alternate type=application/rss+xml title="Istio Blog and News" href=/v1.20/feed.xml><link rel="shortcut icon" href=/v1.20/favicons/favicon.ico><link rel=apple-touch-icon href=/v1.20/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/v1.20/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/v1.20/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/v1.20/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/v1.20/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/v1.20/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/v1.20/favicons/android-96x96.png sizes=96xW96><link rel=icon type=image/png href=/v1.20/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/v1.20/favicons/android-192x192.png sizes=192x192><link rel=icon type=image/svg+xml href=/v1.20/favicons/favicon.svg><link rel=icon type=image/png href=/v1.20/favicons/favicon.png><link rel=mask-icon href=/v1.20/favicons/safari-pinned-tab.svg color=#466BB0><link rel=manifest href=/v1.20/manifest.json><meta name=apple-mobile-web-app-title content="Istio"><meta name=application-name content="Istio"><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#466BB0"><meta name=theme-color content="#466BB0"><link rel=stylesheet href=/v1.20/css/all.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap"><script src=/v1.20/js/themes_init.min.js></script></head><body class="language-unknown archive-site"><script>const branchName="release-1.20",docTitle="深挖 Ambient 与 Sidecar 并存的网络流量路径",iconFile="/v1.20//img/icons.svg",buttonCopy="复制到剪切板",buttonPrint="打印",buttonDownload="下载"</script><script src="https://www.google.com/cse/brand?form=search-form" defer></script><script src=/v1.20/js/all.min.js data-manual defer></script><header class=main-navigation><nav class="main-navigation-wrapper container-l"><div class=main-navigation-header><a id=brand href=/v1.20/zh/ aria-label=logotype><span class=logo><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371A7.869 7.869.0 01114 30.56a9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></span>
</a><button id=hamburger class=main-navigation-toggle aria-label="Open navigation">
<svg class="icon menu-hamburger"><use xlink:href="/v1.20/img/icons.svg#menu-hamburger"/></svg>
</button>
<button id=menu-close class=main-navigation-toggle aria-label="Close navigation"><svg class="icon menu-close"><use xlink:href="/v1.20/img/icons.svg#menu-close"/></svg></button></div><div id=header-links class=main-navigation-links-wrapper><ul class=main-navigation-links><li class=main-navigation-links-item><a class="main-navigation-links-link has-dropdown"><span>关于</span><svg class="icon dropdown-arrow"><use xlink:href="/v1.20/img/icons.svg#dropdown-arrow"/></svg></a><ul class=main-navigation-links-dropdown><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/service-mesh class=main-navigation-links-link>服务网格</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/solutions class=main-navigation-links-link>解决方案</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/case-studies class=main-navigation-links-link>案例学习</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/ecosystem class=main-navigation-links-link>生态系统</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/deployment class=main-navigation-links-link>部署</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/faq class=main-navigation-links-link>FAQ</a></li></ul></li><li class=main-navigation-links-item><a href=/v1.20/zh/blog/ class=main-navigation-links-link><span>博客</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/news/ class=main-navigation-links-link><span>新闻</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/get-involved/ class=main-navigation-links-link><span>加入我们</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/docs/ class=main-navigation-links-link><span>文档</span></a></li></ul><div class=main-navigation-footer><button id=search-show class=search-show title='搜索 istio.io' aria-label=搜索><svg class="icon magnifier"><use xlink:href="/v1.20/img/icons.svg#magnifier"/></svg></button>
<a href=/v1.20/zh/docs/setup/getting-started class="btn btn--primary" id=try-istio>试用 Istio</a></div></div><form id=search-form class=search name=cse role=search><input type=hidden name=cx value=002184991200833970123:iwwf17ikgf4>
<input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=zh>
<input type=hidden id=search-page-url value=/zh/search>
<input id=search-textbox class="search-textbox form-control" name=q type=search aria-label='搜索 istio.io' placeholder=搜索>
<button id=search-close title=取消搜索 type=reset aria-label=取消搜索><svg class="icon menu-close"><use xlink:href="/v1.20/img/icons.svg#menu-close"/></svg></button></form></nav></header><div class=banner-container></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=header-content><h1>深挖 Ambient 与 Sidecar 并存的网络流量路径</h1><p>深挖 Ambient 与 Sidecar 并存的流量路径。</p></div><p class=post-author>Sep 18, 2023 <span>| </span>By 张怀龙 - Intel, John Howard - Google, 曾宇星 - Alibaba, Peter Jausovec - Solo.io; Translated by Wilson Wu - DaoCloud</p><div><p>Istio 有两种部署模式：Ambient 模式和 Sidecar 模式。
前者还在持续开发中，后者是经典的网格方案。因此，Ambient 模式和 Sidecar
模式并存应该是一种正常的部署形式，这也是这篇博客可能对 Istio 用户有所帮助的原因。</p><h2 id=background>背景</h2><p>在现代微服务架构中，服务之间的通信和管理至关重要。为了应对这一挑战，
Istio 作为一种服务网格技术应运而生。它利用 Sidecar 提供流量控制、安全性和卓越的可观察功能。
为了进一步提高 Istio 的适应性和灵活性，Istio 社区开始探索一种新的模式 —— Ambient 模式。
在这种模式下，Istio 不再依赖显式的 Sidecar 注入，而是通过 ztunnel 和 waypoint
代理实现服务之间的通信和网格管理。Ambient 还带来了一系列改进，例如更低的资源消耗、更简单的部署以及更灵活的配置选项。
启用 Ambient 模式后，我们不再需要重新启动 Pod，这使得 Istio 在各种场景中能够更好地发挥作用。</p><p>在本文的<a href=/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/#reference-resources>参考资源</a>一节列出了几篇在社区和技术论坛中介绍和分析 Ambient 的博客，
本文将分析 Istio Ambient 和 Sidecar 模式下的网络流量路径。</p><p>为了阐明网络流量路径并使其更容易理解，本博文探讨了以下两种场景并配有相应的图表：</p><ul><li><strong>Ambient 模式下的服务到 Sidecar 模式下服务的网络路径</strong></li><li><strong>Sidecar 模式下的服务到 Ambient 模式下服务的网络路径</strong></li></ul><h2 id=information-about-the-analysis>关于分析的信息</h2><p>分析基于 Istio 1.18.2，其中 Ambient 模式使用 iptables 进行重定向。</p><h2 id=ambient-mode-sleep-to-sidecar-mode-httpbin>Ambient 模式 <code>sleep</code> 到 Sidecar 模式 <code>httpbin</code></h2><h3 id=deployment-and-configuration-for-the-first-scenario>第一个场景的部署和配置</h3><ul><li><code>sleep</code> 部署在命名空间 foo 中<ul><li><code>sleep</code> Pod 被调度到节点 A</li></ul></li><li><code>httpbin</code> 部署在命名空间 bar 中<ul><li><code>httpbin</code> 被调度到节点 B</li></ul></li><li>foo 命名空间启用 Ambient 模式（foo 命名空间包含标签：<code>istio.io/dataplane-mode=ambient</code>）</li><li>bar 命名空间启用 Sidecar 注入（bar 命名空间包含标签：<code>istio-injection：enabled</code>）</li></ul><p>根据以上描述，部署和网络流量路径为：</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:72.63901147396294%><a data-skipendnotes=true href=/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/ambient-to-sidecar.png title="Ambient 模式 sleep 到 Sidecar 模式 httpbin"><img class=element-to-stretch src=/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/ambient-to-sidecar.png alt="Ambient 模式 sleep 到 Sidecar 模式 httpbin"></a></div><figcaption>Ambient 模式 sleep 到 Sidecar 模式 httpbin</figcaption></figure><p>如果启用 Ambient 模式，ztunnel 将作为 DaemonSet 部署在 istio-system 命名空间中，
而 istio-cni 和 ztunnel 将为 ztunnel Pod 和每个节点上的 Pod 生成 iptables 规则和路由。</p><p>启用 Ambient 模式时进出 Pod 的所有网络流量都将根据网络重定向逻辑流经 ztunnel。
然后 ztunnel 会将流量转发到正确的端点。</p><h3 id=network-traffic-path-analysis-of-ambient-mode-sleep-to-sidecar-mode-httpbin>Ambient 模式 <code>sleep</code> 到 Sidecar 模式 <code>httpbin</code> 的网络流量路径分析</h3><p>根据上图，网络流量路径的详细情况如下所示：</p><p><strong>(1) (2) (3)</strong> <code>sleep</code> 服务的请求流量从 <code>sleep</code> Pod 的 <code>veth</code> 发出，
遵循 iptables 规则和路由规则该 Pod 被标记并转发到节点中的 <code>istioout</code> 设备。
节点 A 中的 <code>istioout</code> 设备是一个 <a href=https://www.rfc-editor.org/rfc/rfc8926.html>Geneve</a> 隧道，
隧道的另一端是 <code>pistioout</code>，即位于同一节点上的 ztunnel Pod 内。</p><p><strong>(4) (5)</strong> 当流量经由 <code>pistioout</code> 设备到达时，
Pod 内的 iptables 规则会拦截并通过 Pod 中的 <code>eth0</code> 接口将其重定向到端口 <code>15001</code>。</p><p><strong>(6)</strong> 根据原始请求信息，ztunnel 可以获取目标服务的端点列表。
然后，它将处理请求并将其发送到端点，例如某个 <code>httpbin</code> Pod。
最后，请求流量将通过容器网络进入 <code>httpbin</code> Pod。</p><p><strong>(7)</strong> 到达 <code>httpbin</code> Pod 的请求流量将被 Sidecar 的 iptables
规则拦截并重定向到 Sidecar 的端口 <code>15006</code>。</p><p><strong>(8)</strong> Sidecar 处理通过端口 15006 传入的入站请求流量，
并将流量转发到同一 Pod 中的 <code>httpbin</code> 容器。</p><h2 id=sidecar-mode-sleep-to-ambient-mode-httpbin-and-helloworld>Sidecar 模式 <code>sleep</code> 到 Ambient 模式 <code>httpbin</code> 和 <code>helloworld</code></h2><h3 id=deployment-and-configuration-for-the-second-scenario>第二种场景的部署和配置</h3><ul><li><code>sleep</code> 部署在命名空间 foo 中<ul><li><code>sleep</code> Pod 被调度到节点 A</li></ul></li><li><code>httpbin</code> 部署在命名空间 bar-1 中<ul><li><code>httpbin</code> Pod 被调度到节点 B</li><li><code>httpbin</code> 的 waypoint 代理被禁用</li></ul></li><li><code>helloworld</code> 部署在命名空间 bar-2 中<ul><li><code>helloworld</code> Pod 被调度到节点 D</li><li><code>helloworld</code> 的 waypoint 代理被启用</li><li>waypoint 代理被调度到节点 C</li></ul></li><li>foo 命名空间启用 Sidecar 注入（foo 命名空间包含标签：<code>istio-injection:enabled</code>）</li><li>bar-1 命名空间启用 Ambient 模式（bar-1 命名空间包含标签：<code>istio.io/dataplane-mode=ambient</code>）</li></ul><p>根据以上描述，部署和网络流量路径为：</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:120.53639846743296%><a data-skipendnotes=true href=/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/sidecar-to-ambient.png title="sleep 到 httpbin 和 helloworld"><img class=element-to-stretch src=/v1.20/zh/blog/2023/traffic-for-ambient-and-sidecar/sidecar-to-ambient.png alt="sleep 到 httpbin 和 helloworld"></a></div><figcaption>sleep 到 httpbin 和 helloworld</figcaption></figure><h3 id=network-traffic-path-analysis-of-sidecar-mode-sleep-to-ambient-mode-httpbin>Sidecar 模式 <code>sleep</code> 到 Ambient 模式 <code>httpbin</code> 的网络流量路径分析</h3><p>上图的上半部分描述了从 <code>sleep</code> Pod（Sidecar 模式）到 <code>httpbin</code> Pod（Ambient 模式）的请求的网络流量路径。</p><p><strong>(1) (2) (3) (4)</strong> <code>sleep</code> 容器向 <code>httpbin</code> 发送一个请求。该请求被 iptables 规则拦截，
并定向到 <code>sleep</code> Pod 中 Sidecar 上的端口 <code>15001</code>。
然后，Sidecar 处理请求并根据从 istiod（控制平面）收到的配置路由流量，
将流量转发到与节点 B 上的 <code>httpbin</code> Pod 对应的 IP 地址。</p><p><strong>(5) (6)</strong> 将请求发送到设备对（<code>veth httpbin &lt;-> eth0 inside httpbin pod</code>）后，
请求根据 iptables 和路由规则被拦截和转发到节点 B 上的 <code>istioin</code> 设备，
在节点 B 上遵循 iptables 和路由规则来运行 <code>httpbin</code> Pod。节点 B 上的 <code>istioin</code> 设备和同一节点上
ztunnel Pod 内的 <code>pistion</code> 设备通过 <a href=https://www.rfc-editor.org/rfc/rfc8926.html>Geneve</a> 连接隧道。</p><p><strong>(7) (8)</strong> 请求进入 ztunnel Pod 的 <code>pistioin</code> 设备后，ztunnel Pod 中的 iptables
规则会拦截并通过 Pod 内运行的 ztunnel 代理上的端口 15008 重定向流量。</p><p><strong>(9)</strong> 进入端口 15008 的流量将被视为入站请求，
然后 ztunnel 会将请求转发到同一节点 B 中的 <code>httpbin</code> Pod。</p><h3 id=network-traffic-path-analysis-of-sidecar-mode-sleep-to-ambient-mode-httpbin-via-waypoint-proxy>通过 waypoint 代理从 Sidecar 模式 <code>sleep</code> 到 Ambient 模式 <code>httpbin</code> 的网络流量路径分析</h3><p>与图中的顶部相比，底部在 <code>sleep</code>、ztunnel 和 <code>httpbin</code> Pod 之间的路径中插入了一个 waypoint 代理。
Istio 控制平面拥有服务网格的所有服务和配置信息。当使用 waypoint 代理部署 <code>helloworld</code> Pod 时，
<code>sleep</code> Pod 的 Sidecar 接收到的 <code>helloworld</code> 服务的 EDS 配置将更改为 <code>envoy_internal_address</code> 类型。
这会导致通过 Sidecar 的请求流量通过
<a href=https://docs.google.com/document/d/1Ofqtxqzk-c_wn0EgAXjaJXDHB9KhDuLe-W3YGG67Y8g/edit>基于 HTTP 的覆盖网络（HBONE）</a>
协议被转发到节点 C 上的 waypoint 代理的 15008 端口。</p><p>waypoint 代理是 Envoy 代理的一个实例，它根据从控制平面收到的路由配置将请求转发到 <code>helloworld</code> Pod。
一旦流量到达节点 D 上的 <code>veth</code>，它就会遵循与之前场景相同的路径。</p><h2 id=wrapping-up>总结</h2><p>Sidecar 模式使 Istio 成为一个出色的服务网格。但是，Sidecar 模式也会导致问题，
因为它要求应用程序和 Sidecar 容器在同一个 Pod 中运行。
Istio Ambient 模式通过集中式代理（ztunnel 和 waypoint）实现服务之间的通信。
Ambient 模式提供了更大的灵活性和可扩展性，减少了资源消耗，因为它不需要网格中的每个 Pod 都有 Sidecar，
并且允许更精确的配置。 因此，毫无疑问，Ambient 模式是 Istio 的下一个演进。
显然，Sidecar 和 Ambient 模式的并存可能会持续很长一段时间，
虽然 Ambient 模式还处于 Alpha 阶段且 Sidecar 模式仍然是 Istio 的推荐模式，
但随着 Ambient 模式进阶至 Beta 和后续完善，它将给用户提供一种更轻量级的选择来运行并采用 Istio 服务网格。</p><h2 id=reference-resources>参考资源</h2><ul><li><a href=https://www.solo.io/blog/traffic-ambient-mesh-istio-cni-node-configuration/>Ambient 网格中的流量：Istio CNI 和节点配置</a></li><li><a href=https://www.solo.io/blog/traffic-ambient-mesh-redirection-iptables-geneve-tunnels/>Ambient 网格中的流量：使用 iptables 和 Geneve 隧道进行重定向</a></li><li><a href=https://www.solo.io/blog/traffic-ambient-mesh-ztunnel-ebpf-waypoint/>Ambient 网格中的流量：ztunnel、eBPF 配置和 waypoint 代理</a></li></ul></div><nav class=pagenav><div class=left><a title="简要回顾上海 KubeCon + CloudNativeCon + Open Source Summit China 中的 Istio 主题演讲。" href=/v1.20/zh/blog/2023/istiocon-china/ class=next-link><svg class="icon left-arrow"><use xlink:href="/v1.20/img/icons.svg#left-arrow"/></svg>IstioCon China 2023 总结</a></div><div class=right><a title="使用 Istio 演示新的 SidecarContainers 功能。" href=/v1.20/zh/blog/2023/native-sidecars/ class=next-link>在 Istio 中使用 Kubernetes 原生 Sidecar<svg class="icon right-arrow"><use xlink:href="/v1.20/img/icons.svg#right-arrow"/></svg></a></div></nav></article><footer class=footer><div class="footer-wrapper container-l"><div class="user-links footer-links"><a class=channel title='Istio 的代码在 GitHub 上开发' href=https://github.com/istio/community aria-label=GitHub><svg class="icon github"><use xlink:href="/v1.20/img/icons.svg#github"/></svg>
</a><a class=channel title='如果您想深入了解 Istio 的技术细节，请查看我们日益完善的设计文档' href=https://groups.google.com/forum/#!forum/istio-team-drive-access aria-label="team drive"><svg class="icon drive"><use xlink:href="/v1.20/img/icons.svg#drive"/></svg>
</a><a class=channel title='在 Slack 上与 Istio 社区交互讨论开发问题（仅限邀请）' href=https://slack.istio.io aria-label=slack><svg class="icon slack"><use xlink:href="/v1.20/img/icons.svg#slack"/></svg>
</a><a class=channel title='Stack Overflow 中列举了针对实际问题以及部署、配置和使用 Istio 的各项回答' href=https://stackoverflow.com/questions/tagged/istio aria-label="Stack Overflow"><svg class="icon stackoverflow"><use xlink:href="/v1.20/img/icons.svg#stackoverflow"/></svg>
</a><a class=channel title='关注我们的 Twitter 来获取最新信息' href=https://twitter.com/IstioMesh aria-label=Twitter><svg class="icon twitter"><use xlink:href="/v1.20/img/icons.svg#twitter"/></svg></a></div><hr class=footer-separator role=separator><div class="info footer-info"><a class=logo href=/v1.20/zh/ aria-label=logotype><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371A7.869 7.869.0 01114 30.56a9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></a><div class=footer-languages><a tabindex=-1 lang=en id=switch-lang-en class=footer-languages-item>English
</a><a tabindex=-1 lang=zh id=switch-lang-zh class="footer-languages-item active"><svg class="icon tick"><use xlink:href="/v1.20/img/icons.svg#tick"/></svg>
中文</a></div></div><ul class=footer-policies><li class=footer-policies-item><a class=footer-policies-link href=https://www.linuxfoundation.org/legal/terms>条款
</a>|
<a class=footer-policies-link href=https://www.linuxfoundation.org/legal/privacy-policy>隐私政策
</a>|
<a class=footer-policies-link href=https://www.linuxfoundation.org/legal/trademark-usage>商标
</a>|
<a class=footer-policies-link href=https://github.com/istio/istio.io/edit/release-1.20/content/zh/index>在 GitHub 上编辑此页</a></li></ul><div class=footer-base><span class=footer-base-copyright>&copy; 2024 the Istio Authors.</span>
<span class=footer-base-version>部分内容可能滞后于英文版本，同步工作正在进行中<br>版本
Istio 归档
1.20.3</span><ul class=footer-base-releases><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link onclick='return navigateToUrlOrRoot("https://istio.io/blog/2023/traffic-for-ambient-and-sidecar/"),!1'>当前版本</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link onclick='return navigateToUrlOrRoot("https://preliminary.istio.io/blog/2023/traffic-for-ambient-and-sidecar/"),!1'>下个版本</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link href=https://istio.io/archive>旧版本</a></li></ul></div></div></footer><div id=scroll-to-top-container aria-hidden=true><button id=scroll-to-top title=回到顶部 tabindex=-1><svg class="icon top"><use xlink:href="/v1.20/img/icons.svg#top"/></svg></button></div></body></html>