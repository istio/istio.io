<!doctype html><html lang=zh itemscope itemtype=https://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#466BB0"><meta name=title content="使用 ztunnel 实现 L4 联网和 mTLS"><meta name=description content="Istio Ambient 使用 ztunnel 代理实现 L4 联网和 mTLS 的用户指南。"><meta name=keywords content="microservices,services,mesh"><meta property="og:title" content="使用 ztunnel 实现 L4 联网和 mTLS"><meta property="og:type" content="website"><meta property="og:description" content="Istio Ambient 使用 ztunnel 代理实现 L4 联网和 mTLS 的用户指南。"><meta property="og:url" content="/v1.20/zh/docs/ops/ambient/usage/ztunnel/"><meta property="og:image" content="https://raw.githubusercontent.com/istio/istio.io/master/static/img/istio-social.png"><meta property="og:image:alt" content="The Istio sailboat logo"><meta property="og:image:width" content="4096"><meta property="og:image:height" content="2048"><meta property="og:site_name" content="Istio"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@IstioMesh"><title>Istioldie 1.20 / 使用 ztunnel 实现 L4 联网和 mTLS</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98480406-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-98480406-2")</script><link rel=alternate type=application/rss+xml title="Istio Blog" href=/v1.20/blog/feed.xml><link rel=alternate type=application/rss+xml title="Istio News" href=/v1.20/news/feed.xml><link rel=alternate type=application/rss+xml title="Istio Blog and News" href=/v1.20/feed.xml><link rel="shortcut icon" href=/v1.20/favicons/favicon.ico><link rel=apple-touch-icon href=/v1.20/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/v1.20/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/v1.20/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/v1.20/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/v1.20/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/v1.20/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/v1.20/favicons/android-96x96.png sizes=96xW96><link rel=icon type=image/png href=/v1.20/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/v1.20/favicons/android-192x192.png sizes=192x192><link rel=icon type=image/svg+xml href=/v1.20/favicons/favicon.svg><link rel=icon type=image/png href=/v1.20/favicons/favicon.png><link rel=mask-icon href=/v1.20/favicons/safari-pinned-tab.svg color=#466BB0><link rel=manifest href=/v1.20/manifest.json><meta name=apple-mobile-web-app-title content="Istio"><meta name=application-name content="Istio"><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#466BB0"><meta name=theme-color content="#466BB0"><link rel=stylesheet href=/v1.20/css/all.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap"><script src=/v1.20/js/themes_init.min.js></script></head><body class="language-unknown archive-site"><script>const branchName="release-1.20",docTitle="使用 ztunnel 实现 L4 联网和 mTLS",iconFile="/v1.20//img/icons.svg",buttonCopy="复制到剪切板",buttonPrint="打印",buttonDownload="下载"</script><script src="https://www.google.com/cse/brand?form=search-form" defer></script><script src=/v1.20/js/all.min.js data-manual defer></script><header class=main-navigation><nav class="main-navigation-wrapper container-l"><div class=main-navigation-header><a id=brand href=/v1.20/zh/ aria-label=logotype><span class=logo><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371A7.869 7.869.0 01114 30.56a9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></span>
</a><button id=hamburger class=main-navigation-toggle aria-label="Open navigation">
<svg class="icon menu-hamburger"><use xlink:href="/v1.20/img/icons.svg#menu-hamburger"/></svg>
</button>
<button id=menu-close class=main-navigation-toggle aria-label="Close navigation"><svg class="icon menu-close"><use xlink:href="/v1.20/img/icons.svg#menu-close"/></svg></button></div><div id=header-links class=main-navigation-links-wrapper><ul class=main-navigation-links><li class=main-navigation-links-item><a class="main-navigation-links-link has-dropdown"><span>关于</span><svg class="icon dropdown-arrow"><use xlink:href="/v1.20/img/icons.svg#dropdown-arrow"/></svg></a><ul class=main-navigation-links-dropdown><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/service-mesh class=main-navigation-links-link>服务网格</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/solutions class=main-navigation-links-link>解决方案</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/case-studies class=main-navigation-links-link>案例学习</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/ecosystem class=main-navigation-links-link>生态系统</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/deployment class=main-navigation-links-link>部署</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.20/zh/about/faq class=main-navigation-links-link>FAQ</a></li></ul></li><li class=main-navigation-links-item><a href=/v1.20/zh/blog/ class=main-navigation-links-link><span>博客</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/news/ class=main-navigation-links-link><span>新闻</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/get-involved/ class=main-navigation-links-link><span>加入我们</span></a></li><li class=main-navigation-links-item><a href=/v1.20/zh/docs/ class=main-navigation-links-link><span>文档</span></a></li></ul><div class=main-navigation-footer><button id=search-show class=search-show title='搜索 istio.io' aria-label=搜索><svg class="icon magnifier"><use xlink:href="/v1.20/img/icons.svg#magnifier"/></svg></button>
<a href=/v1.20/zh/docs/setup/getting-started class="btn btn--primary" id=try-istio>试用 Istio</a></div></div><form id=search-form class=search name=cse role=search><input type=hidden name=cx value=002184991200833970123:iwwf17ikgf4>
<input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=zh>
<input type=hidden id=search-page-url value=/zh/search>
<input id=search-textbox class="search-textbox form-control" name=q type=search aria-label='搜索 istio.io' placeholder=搜索>
<button id=search-close title=取消搜索 type=reset aria-label=取消搜索><svg class="icon menu-close"><use xlink:href="/v1.20/img/icons.svg#menu-close"/></svg></button></form></nav></header><div class=banner-container></div><main class="primary container has-sidebar has-toc docs"><div id=sidebar-container class=sidebar-container><nav id=sidebar aria-label="Section Navigation"><button id=sidebar-close class="main-navigation-toggle sidebar-close" aria-label="Close sidebar"><svg class="icon menu-close"><use xlink:href="/v1.20/img/icons.svg#menu-close"/></svg></button><div class=sidebar-nav><div class=search><form id=search-docs-form name=cse role=search><input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=en>
<input type=hidden id=search-docs-url value=/v1.20//search>
<input id=search-docs-textbox class=form-control name=docs-search type=search aria-label='搜索 istio.io' placeholder=搜索>
<button id=search-show2 class=search-show title='搜索 istio.io' aria-label=搜索><svg class="icon magnifier"><use xlink:href="/v1.20/img/icons.svg#magnifier"/></svg></button></form></div><div class=card><div class="body default" aria-labelledby=header0><ul role=tree aria-expanded=true aria-labelledby=header0><li role=treeitem aria-label=概念><a class=main title="一些概念，理解它们有助于您更好地了解 Istio 系统的不同部分及其使用的抽象。" href=/v1.20/zh/docs/concepts/>概念</a><ul role=group aria-expanded=true class=leaf-section><li role=none><a role=treeitem title="描述 Istio 多样的流量路由和控制特性。" href=/v1.20/zh/docs/concepts/traffic-management/>流量管理</a></li><li role=none><a role=treeitem title="描述 Istio 的授权与认证功能。" href=/v1.20/zh/docs/concepts/security/>安全</a></li><li role=none><a role=treeitem title="描述 Istio 提供的遥测和监控特性。" href=/v1.20/zh/docs/concepts/observability/>可观测性</a></li><li role=none><a role=treeitem title="讲述 Istio 的 WebAssembly 插件系统。" href=/v1.20/zh/docs/concepts/wasm/>扩展性</a></li></ul></li><li role=treeitem aria-label=安装><a class=main title="关于如何在 Kubernetes 集群中安装 Istio 控制平面和添加虚拟机到 mesh 中的说明。" href=/v1.20/zh/docs/setup/>安装</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title="快速、轻松地尝试 Istio 特性。" href=/v1.20/zh/docs/setup/getting-started/>入门</a></li><li role=treeitem aria-label=平台安装><button aria-hidden=true tabindex=-1></button><a title="在安装 Istio 之前如何准备各种 Kubernetes 平台。" href=/v1.20/zh/docs/setup/platform-setup/>平台安装</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="在各平台上安装 Istio 的前提条件。" href=/v1.20/zh/docs/setup/platform-setup/prerequisites/>平台前提条件</a></li><li role=none><a role=treeitem title="在阿里云 Kubernetes 集群进行配置以便安装运行 Istio。" href=/v1.20/zh/docs/setup/platform-setup/alicloud/>阿里云</a></li><li role=none><a role=treeitem title="有关在 AWS 云中的 Amazon EKS 上设置 Istio 的说明。" href=/v1.20/zh/docs/setup/platform-setup/amazon-eks/>Amazon EKS</a></li><li role=none><a role=treeitem title="为 Istio 设置一个 Azure 集群的操作说明。" href=/v1.20/zh/docs/setup/platform-setup/azure/>Azure</a></li><li role=none><a role=treeitem title="在 Docker Desktop 中运行 Istio 的设置说明。" href=/v1.20/zh/docs/setup/platform-setup/docker/>Docker Desktop</a></li><li role=none><a role=treeitem title="在 Google Kubernetes Engine (GKE) 上快速搭建 Istio 服务。" href=/v1.20/zh/docs/setup/platform-setup/gke/>使用 Google Kubernetes Engine 快速开始</a></li><li role=none><a role=treeitem title="为 Istio 设置一个华为云 Kubernetes 集群的操作说明。" href=/v1.20/zh/docs/setup/platform-setup/huaweicloud/>华为云</a></li><li role=none><a role=treeitem title="在 IBM 公有云或私有云上快速搭建 Istio 服务。" href=/v1.20/zh/docs/setup/platform-setup/ibm/>IBM Cloud 快速开始</a></li><li role=none><a role=treeitem title="为 Istio 设置 k3d 的说明。" href=/v1.20/zh/docs/setup/platform-setup/k3d/>k3d</a></li><li role=none><a role=treeitem title="为 Istio 设置 kind 的说明。" href=/v1.20/zh/docs/setup/platform-setup/kind/>kind</a></li><li role=none><a role=treeitem title="为 Istio 搭建 Kops 的设置说明。" href=/v1.20/zh/docs/setup/platform-setup/kops/>Kops</a></li><li role=none><a role=treeitem title="使用 Gardener 快速搭建 Istio 服务。" href=/v1.20/zh/docs/setup/platform-setup/gardener/>Kubernetes Gardener 快速开始</a></li><li role=none><a role=treeitem title="Istio 适配 KubeSphere 容器平台指南。" href=/v1.20/zh/docs/setup/platform-setup/kubesphere/>KubeSphere Container Platform</a></li><li role=none><a role=treeitem title="配置 MicroK8s 以便使用 Istio。" href=/v1.20/zh/docs/setup/platform-setup/microk8s/>MicroK8s</a></li><li role=none><a role=treeitem title="在 minikube 上配置 Istio。" href=/v1.20/zh/docs/setup/platform-setup/minikube/>minikube</a></li><li role=none><a role=treeitem title="在 OpenShift 集群上快速搭建 Istio 服务。" href=/v1.20/zh/docs/setup/platform-setup/openshift/>OpenShift</a></li><li role=none><a role=treeitem title="使用 Oracle Container 为 Istio 准备集群的说明。" href=/v1.20/zh/docs/setup/platform-setup/oci/>Oracle Cloud 基础架构</a></li><li role=none><a role=treeitem title="在腾讯云上快速创建 Istio 服务。" href=/v1.20/zh/docs/setup/platform-setup/tencent-cloud-mesh/>腾讯云</a></li></ul></li><li role=treeitem aria-label=安装><button aria-hidden=true tabindex=-1></button><a title=选择最适合您需求和平台的安装指南。 href=/v1.20/zh/docs/setup/install/>安装</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title="安装、定制 Istio 配置文件，用于深入评估及生产发布。" href=/v1.20/zh/docs/setup/install/istioctl/>使用 Istioctl 安装</a></li><li role=none><a role=treeitem title="使用 Helm 在 K8s 集群中安装和配置 Istio。" href=/v1.20/zh/docs/setup/install/helm/>使用 Helm 安装</a></li><li role=treeitem aria-label=多集群安装><button aria-hidden=true tabindex=-1></button><a title="跨多 Kubernetes 集群，安装 Istio 服务网格。" href=/v1.20/zh/docs/setup/install/multicluster/>多集群安装</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="在多个集群上安装 Istio 之前的初始步骤。" href=/v1.20/zh/docs/setup/install/multicluster/before-you-begin/>准备工作</a></li><li role=none><a role=treeitem title="跨多个主集群，安装 Istio 网格。" href=/v1.20/zh/docs/setup/install/multicluster/multi-primary/>多主架构的安装</a></li><li role=none><a role=treeitem title="跨主从集群，安装 Istio 网格。" href=/v1.20/zh/docs/setup/install/multicluster/primary-remote/>主从架构的安装</a></li><li role=none><a role=treeitem title="跨网络、多主架构的 Istio 网格安装。" href=/v1.20/zh/docs/setup/install/multicluster/multi-primary_multi-network/>跨网络多主架构的安装</a></li><li role=none><a role=treeitem title="跨网络、主从架构的 Istio 网格安装。" href=/v1.20/zh/docs/setup/install/multicluster/primary-remote_multi-network/>跨网络主从架构的安装</a></li><li role=none><a role=treeitem title="验证 Istio 已成功安装到多集群环境中。" href=/v1.20/zh/docs/setup/install/multicluster/verify/>验证安装结果</a></li></ul></li><li role=none><a role=treeitem title="使用修订和 discoverySelectors 在单集群中安装多个 Istio 控制面。" href=/v1.20/zh/docs/setup/install/multiple-controlplanes/>在单集群中安装多个 Istio 控制面</a></li><li role=none><a role=treeitem title="部署 Istio，接入虚拟机中运行的工作负载。" href=/v1.20/zh/docs/setup/install/virtual-machine/>虚拟机安装</a></li><li role=none><a role=treeitem title=安装外部控制平面和从集群。 href=/v1.20/zh/docs/setup/install/external-controlplane/>使用外部控制平面安装 Istio</a></li><li role=none><a role=treeitem title="使用 Istio Operator 在 Kubernetes 集群中安装 Istio 的说明。" href=/v1.20/zh/docs/setup/install/operator/>使用 Istio Operator 安装</a></li></ul></li><li role=treeitem aria-label=升级><button aria-hidden=true tabindex=-1></button><a title="跨多个控制平面升级、降级和管理 Istio。" href=/v1.20/zh/docs/setup/upgrade/>升级</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="通过先运行一个金丝雀部署的新控制平面升级 Istio。" href=/v1.20/zh/docs/setup/upgrade/canary/>金丝雀升级</a></li><li role=none><a role=treeitem title=原地升级和回退。 href=/v1.20/zh/docs/setup/upgrade/in-place/>原地升级</a></li><li role=none><a role=treeitem title="使用 Helm 升级 Istio 的说明。" href=/v1.20/zh/docs/setup/upgrade/helm/>使用 Helm 升级</a></li></ul></li><li role=treeitem aria-label=更多指南><button aria-hidden=true tabindex=-1></button><a title=有关其他设置任务的更多信息。 href=/v1.20/zh/docs/setup/additional-setup/>更多指南</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="轻松试用 Istio 的各项功能。" href=/v1.20/zh/docs/setup/additional-setup/getting-started/>开始使用 Istio 和 Kubernetes Gateway API</a></li><li role=none><a role=treeitem title="描述 Istio 内置的安装配置文件。" href=/v1.20/zh/docs/setup/additional-setup/config-profiles/>安装配置文件</a></li><li role=none><a role=treeitem title="安装和定制 Istio Gateway。" href=/v1.20/zh/docs/setup/additional-setup/gateway/>安装 Gateway</a></li><li role=none><a role=treeitem title="在应用程序 Pod 中使用 Sidecar Injector Webhook 自动安装或使用 Istioctl CLI 手动安装 Istio Sidecar。" href=/v1.20/zh/docs/setup/additional-setup/sidecar-injection/>安装 Sidecar</a></li><li role=none><a role=treeitem title=描述如何定制安装配置选项。 href=/v1.20/zh/docs/setup/additional-setup/customize-installation/>定制安装配置</a></li><li role=none><a role=treeitem title="描述使用 Helm 安装时如何自定义安装配置选项。" href=/v1.20/zh/docs/setup/additional-setup/customize-installation-helm/>高级 Helm chart 自定义</a></li><li role=none><a role=treeitem title="安装并使用 Istio CNI 插件，可以让运维人员用更低的权限来部署服务。" href=/v1.20/zh/docs/setup/additional-setup/cni/>安装 Istio CNI 插件</a></li><li role=none><a role=treeitem title="通过 Pod Security 准入控制器安装和使用 Istio。" href=/v1.20/zh/docs/setup/additional-setup/pod-security-admission/>通过 Pod 安全准入安装 Istio</a></li></ul></li></ul></li><li role=treeitem aria-label=任务><a class=main title="如何用 Istio 实现单个特定的目标行为。" href=/v1.20/zh/docs/tasks/>任务</a><ul role=group aria-expanded=true><li role=treeitem aria-label=流量管理><button aria-hidden=true tabindex=-1></button><a title="演示 Istio 的流量路由功能的任务。" href=/v1.20/zh/docs/tasks/traffic-management/>流量管理</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title=如何将请求动态路由到微服务的多个版本。 href=/v1.20/zh/docs/tasks/traffic-management/request-routing/>配置请求路由</a></li><li role=none><a role=treeitem title=此任务说明如何注入故障并测试应用程序的弹性。 href=/v1.20/zh/docs/tasks/traffic-management/fault-injection/>故障注入</a></li><li role=none><a role=treeitem title=展示如何将流量从旧版本迁移到新版本的服务。 href=/v1.20/zh/docs/tasks/traffic-management/traffic-shifting/>流量转移</a></li><li role=none><a role=treeitem title="展示如何将一个服务的 TCP 流量从旧版本迁移到新版本。" href=/v1.20/zh/docs/tasks/traffic-management/tcp-traffic-shifting/>TCP 流量转移</a></li><li role=none><a role=treeitem title="本任务用于示范如何使用 Istio 在 Envoy 中设置请求超时。" href=/v1.20/zh/docs/tasks/traffic-management/request-timeouts/>设置请求超时</a></li><li role=none><a role=treeitem title=本任务展示如何为连接、请求以及异常检测配置熔断。 href=/v1.20/zh/docs/tasks/traffic-management/circuit-breaking/>熔断</a></li><li role=none><a role=treeitem title="此任务演示了 Istio 的流量镜像/影子功能。" href=/v1.20/zh/docs/tasks/traffic-management/mirroring/>镜像</a></li><li role=treeitem aria-label=地域负载均衡><button aria-hidden=true tabindex=-1></button><a title="本系列任务演示如何在 Istio 中配置地域负载均衡。" href=/v1.20/zh/docs/tasks/traffic-management/locality-load-balancing/>地域负载均衡</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=配置地域负载均衡前的初始化步骤。 href=/v1.20/zh/docs/tasks/traffic-management/locality-load-balancing/before-you-begin/>开始之前</a></li><li role=none><a role=treeitem title=本任务演示如何为网格配置地域故障转移。 href=/v1.20/zh/docs/tasks/traffic-management/locality-load-balancing/failover/>地域故障转移</a></li><li role=none><a role=treeitem title=本指南演示如何配置地域权重分配。 href=/v1.20/zh/docs/tasks/traffic-management/locality-load-balancing/distribute/>地域权重分布</a></li><li role=none><a role=treeitem title=地域负载均衡的清理步骤。 href=/v1.20/zh/docs/tasks/traffic-management/locality-load-balancing/cleanup/>清理</a></li></ul></li><li role=treeitem aria-label=Ingress><button aria-hidden=true tabindex=-1></button><a title="控制 Istio 服务网格的入口流量。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/>Ingress</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="描述如何配置 Istio Gateway 对象，以将服务暴露至服务网格之外。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/ingress-control/>入口网关</a></li><li role=none><a role=treeitem title="通过 TLS 或 mTLS 将服务暴露到服务网格外。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/secure-ingress/>安全网关</a></li><li role=none><a role=treeitem title="描述了如何在不使用 Ingress Gateway 的情况下，在一个 Sidecar 上终止 TLS 流量。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/ingress-sidecar-tls-termination/>Ingress Sidecar TLS 终止</a></li><li role=none><a role=treeitem title="如何为一个 Ingress Gateway 配置 SNI 透传。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/ingress-sni-passthrough/>无 TLS 终止的 Ingress Gateway</a></li><li role=none><a role=treeitem title="展示如何配置 Kubernetes Ingress 对象，使得从服务网格外部可以访问网格内服务。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/kubernetes-ingress/>Kubernetes Ingress</a></li><li role=none><a role=treeitem title="描述在 Istio 中如何配置 Kubernetes Gateway API。" href=/v1.20/zh/docs/tasks/traffic-management/ingress/gateway-api/>Kubernetes Gateway API</a></li></ul></li><li role=treeitem aria-label=Egress><button aria-hidden=true tabindex=-1></button><a title="控制 Istio 服务网格的出口流量。" href=/v1.20/zh/docs/tasks/traffic-management/egress/>Egress</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="描述如何配置 Istio 以将流量从网格中的服务路由到外部服务。" href=/v1.20/zh/docs/tasks/traffic-management/egress/egress-control/>访问外部服务</a></li><li role=none><a role=treeitem title="描述如何配置 Istio 对来自外部服务的流量执行 TLS 发起。" href=/v1.20/zh/docs/tasks/traffic-management/egress/egress-tls-origination/>Egress TLS Origination</a></li><li role=none><a role=treeitem title="描述如何配置 Istio 通过专用网关服务将流量定向到外部服务。" href=/v1.20/zh/docs/tasks/traffic-management/egress/egress-gateway/>出口网关</a></li><li role=none><a role=treeitem title="描述如何配置一个 Egress 网关，来向外部服务发起 TLS 连接。" href=/v1.20/zh/docs/tasks/traffic-management/egress/egress-gateway-tls-origination/>Egress 网关的 TLS 发起过程</a></li><li role=none><a role=treeitem title="描述如何开启通用域中一组主机的 egress，无需单独配置每一台主机。" href=/v1.20/zh/docs/tasks/traffic-management/egress/wildcard-egress-hosts/>Wildcard 主机的 egress</a></li><li role=none><a role=treeitem title="展示如何配置 Istio Kubernetes 外部服务。" href=/v1.20/zh/docs/tasks/traffic-management/egress/egress-kubernetes-services/>Kubernetes Egress 流量服务</a></li><li role=none><a role=treeitem title="描述如何配置 Istio 以允许应用程序使用外部 HTTPS 代理。" href=/v1.20/zh/docs/tasks/traffic-management/egress/http-proxy/>使用外部 HTTPS 代理</a></li></ul></li></ul></li><li role=treeitem aria-label=安全><button aria-hidden=true tabindex=-1></button><a title=演示如何保护网格。 href=/v1.20/zh/docs/tasks/security/>安全</a><ul role=group aria-expanded=false><li role=treeitem aria-label=认证><button aria-hidden=true tabindex=-1></button><a title="管控网格服务间的双向 TLS 和终端用户的身份认证。" href=/v1.20/zh/docs/tasks/security/authentication/>认证</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="演示如何使用基于 JWT 声明路由请求的 Istio 身份验证策略。 (Alpha)" href=/v1.20/zh/docs/tasks/security/authentication/jwt-route/>基于 JWT 声明的路由 *</a></li><li role=none><a role=treeitem title="向您展示如何通过使用 Istio 认证策略来设置双向 TLS 和基本的终端用户认证。" href=/v1.20/zh/docs/tasks/security/authentication/authn-policy/>认证策略</a></li><li role=none><a role=treeitem title="展示用户如何能将 JWT 声明复制到 HTTP 头。 (Experimental)" href=/v1.20/zh/docs/tasks/security/authentication/claim-to-header/>复制 JWT 声明到 HTTP 头 *</a></li><li role=none><a role=treeitem title="阐述如何将 Istio 服务逐步迁移至双向 TLS 通信模式。" href=/v1.20/zh/docs/tasks/security/authentication/mtls-migration/>双向 TLS 迁移</a></li></ul></li><li role=treeitem aria-label=证书管理><button aria-hidden=true tabindex=-1></button><a title="管理 Istio 的证书。" href=/v1.20/zh/docs/tasks/security/cert-management/>证书管理</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="系统管理员如何通过根证书、签名证书和密钥来配置 Istio 的 CA。" href=/v1.20/zh/docs/tasks/security/cert-management/plugin-ca-cert/>插入 CA 证书</a></li><li role=none><a role=treeitem title="演示如何使用自定义证书颁发机构（与 Kubernetes CSR API 集成）来提供 Istio 工作负载证书。 (Experimental)" href=/v1.20/zh/docs/tasks/security/cert-management/custom-ca-k8s/>使用 Kubernetes CSR 自定义 CA 集成 *</a></li></ul></li><li role=treeitem aria-label=授权><button aria-hidden=true tabindex=-1></button><a title="展示如何控制到 Istio 服务的访问。" href=/v1.20/zh/docs/tasks/security/authorization/>授权</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="展示如何设置 HTTP 流量访问控制。" href=/v1.20/zh/docs/tasks/security/authorization/authz-http/>HTTP 流量</a></li><li role=none><a role=treeitem title="展示如何设置 TCP 流量的访问控制。" href=/v1.20/zh/docs/tasks/security/authorization/authz-tcp/>TCP 流量</a></li><li role=none><a role=treeitem title="演示如何为 JWT 令牌设置访问控制。" href=/v1.20/zh/docs/tasks/security/authorization/authz-jwt/>JWT 令牌</a></li><li role=none><a role=treeitem title=如何集成访问控制并将其委托给外部授权系统。 href=/v1.20/zh/docs/tasks/security/authorization/authz-custom/>外部授权</a></li><li role=none><a role=treeitem title=如何设置访问控制以明确地拒绝流量。 href=/v1.20/zh/docs/tasks/security/authorization/authz-deny/>明确拒绝</a></li><li role=none><a role=treeitem title="展示如何在 Ingress 网关上设置访问控制。" href=/v1.20/zh/docs/tasks/security/authorization/authz-ingress/>Ingress 网关</a></li><li role=none><a role=treeitem title=阐述如何在不更改授权策略的前提下从一个信任域迁移到另一个。 href=/v1.20/zh/docs/tasks/security/authorization/authz-td-migration/>信任域迁移</a></li><li role=none><a role=treeitem title="展示如何在不实际执行的情况下，观察授权策略应用后的效果。 (Alpha)" href=/v1.20/zh/docs/tasks/security/authorization/authz-dry-run/>模拟运行 *</a></li></ul></li><li role=treeitem aria-label="TLS 配置"><button aria-hidden=true tabindex=-1></button><a title="在 Istio 中配置 TLS。" href=/v1.20/zh/docs/tasks/security/tls-configuration/>TLS 配置</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="演示如何为 Istio 工作负载配置最低版本的 TLS。" href=/v1.20/zh/docs/tasks/security/tls-configuration/workload-min-tls-version/>Istio 工作负载的最低 TLS 版本配置</a></li></ul></li></ul></li><li role=treeitem aria-label=策略执行><button aria-hidden=true tabindex=-1></button><a title=演示策略执行特性。 href=/v1.20/zh/docs/tasks/policy-enforcement/>策略执行</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="此任务将展示如何配置 Istio 来动态地限制服务的流量。" href=/v1.20/zh/docs/tasks/policy-enforcement/rate-limit/>使用 Envoy 启用速率限制</a></li></ul></li><li role=treeitem aria-label=可观察性><button aria-hidden=true tabindex=-1></button><a title=演示如何从网格收集遥测信息。 href=/v1.20/zh/docs/tasks/observability/>可观察性</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title="本任务向您演示如何配置 Telemetry API。 (Alpha)" href=/v1.20/zh/docs/tasks/observability/telemetry/>Telemetry API *</a></li><li role=treeitem aria-label=指标><button aria-hidden=true tabindex=-1></button><a title="演示 Istio 中指标的收集和查询。" href=/v1.20/zh/docs/tasks/observability/metrics/>指标</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="这个任务向您展示如何使用 Telemetry API 自定义 Istio 监控指标。" href=/v1.20/zh/docs/tasks/observability/metrics/telemetry-api/>使用 Telemetry API 自定义 Istio 监控指标</a></li><li role=none><a role=treeitem title="本任务展示了如何配置 Istio 进行 TCP 服务的指标收集。" href=/v1.20/zh/docs/tasks/observability/metrics/tcp-metrics/>收集 TCP 服务指标</a></li><li role=none><a role=treeitem title="此任务向您展示如何自定义 Istio 指标。" href=/v1.20/zh/docs/tasks/observability/metrics/customize-metrics/>自定义 Istio 指标</a></li><li role=none><a role=treeitem title=此任务向您展示如何通过按类型对请求和响应进行分组来改进遥测。 href=/v1.20/zh/docs/tasks/observability/metrics/classify-metrics/>根据请求或响应对指标进行分类</a></li><li role=none><a role=treeitem title="本任务介绍如何通过 Prometheus 查询 Istio 度量指标。" href=/v1.20/zh/docs/tasks/observability/metrics/querying-metrics/>通过 Prometheus 查询度量指标</a></li><li role=none><a role=treeitem title="此任务展示了如何设置和使用 Istio Dashboard 监控网格流量。" href=/v1.20/zh/docs/tasks/observability/metrics/using-istio-dashboard/>使用 Grafana 可视化指标</a></li></ul></li><li role=treeitem aria-label=日志><button aria-hidden=true tabindex=-1></button><a title="演示 Istio 网格日志的配置、收集和处理。" href=/v1.20/zh/docs/tasks/observability/logs/>日志</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="本任务向您演示如何使用 OpenTelemetry 收集器配置 Envoy 代理来发送访问日志。" href=/v1.20/zh/docs/tasks/observability/logs/otel-provider/>OpenTelemetry</a></li><li role=none><a role=treeitem title="此任务向您展示如何配置 Envoy 代理将访问日志打印到其标准输出。" href=/v1.20/zh/docs/tasks/observability/logs/access-log/>获取 Envoy 访问日志</a></li><li role=none><a role=treeitem title="此任务向您演示如何使用 Telemetry API 配置 Envoy 代理来发送访问日志。" href=/v1.20/zh/docs/tasks/observability/logs/telemetry-api/>使用 Telemetry API 配置访问日志</a></li></ul></li><li role=treeitem aria-label=分布式追踪><button aria-hidden=true tabindex=-1></button><a title="该任务展示了如何为启用了 Istio 支持的应用进行追踪。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/>分布式追踪</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio 分布式追踪的概述。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/overview/>概述</a></li><li role=none><a role=treeitem title="如何使用 Telemetry API 配置链路追踪。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/telemetry-api/>使用 Telemetry API 配置链路追踪</a></li><li role=none><a role=treeitem title="学习如何配置代理将跟踪请求发送到 Apache SkyWalking。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/skywalking/>Apache SkyWalking</a></li><li role=none><a role=treeitem title="了解如何配置代理以向 Jaeger 发送追踪请求。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/jaeger/>Jaeger</a></li><li role=none><a role=treeitem title="学习如何配置代理将 OpenCensus 格式化的 span 发送到 OpenTelemetry Collector。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/opencensusagent/>OpenCensus Agent</a></li><li role=none><a role=treeitem title="了解如何通过配置代理以向 Zipkin 发送追踪请求。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/zipkin/>Zipkin</a></li><li role=none><a role=treeitem title="怎样配置代理才能把追踪请求发送到 Lightstep。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/lightstep/>Lightstep</a></li><li role=none><a role=treeitem title="如何使用 MeshConfig 和 Pod 注释配置跟踪选项。" href=/v1.20/zh/docs/tasks/observability/distributed-tracing/mesh-and-proxy-config/>使用 MeshConfig 和 Pod 注释配置跟踪</a></li></ul></li><li role=none><a role=treeitem title="此任务向您展示如何在 Istio 网格中可视化服务。" href=/v1.20/zh/docs/tasks/observability/kiali/>网格可视化</a></li><li role=none><a role=treeitem title="此任务向您展示如何配置从外部访问 Istio 遥测插件集。" href=/v1.20/zh/docs/tasks/observability/gateways/>远程访问遥测插件</a></li></ul></li><li role=treeitem aria-label=可扩展性><button aria-hidden=true tabindex=-1></button><a title=演示如何扩展网格行为。 href=/v1.20/zh/docs/tasks/extensibility/>可扩展性</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="描述如何在网格中使用远程 WebAssembly 模块。 (Alpha)" href=/v1.20/zh/docs/tasks/extensibility/wasm-module-distribution/>WebAssembly 模块分发 *</a></li></ul></li></ul></li><li role=treeitem aria-label=示例><a class=main title="这里包括多个可供 Istio 使用的可完整工作的示例，您可以用来亲自部署和体验这些示例。" href=/v1.20/zh/docs/examples/>示例</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title="部署一个用于演示多种 Istio 特性的应用，由四个单独的微服务构成。" href=/v1.20/zh/docs/examples/bookinfo/>Bookinfo 应用</a></li><li role=none><a role=treeitem title="使用在网格内的虚拟机上运行的 MySQL 服务运行 Bookinfo 应用程序。" href=/v1.20/zh/docs/examples/virtual-machines/>在虚拟机上部署 Bookinfo 应用程序</a></li><li role=treeitem aria-label="使用 Kubernetes 和 Istio 学习微服务"><button aria-hidden=true tabindex=-1></button><a title="该模块化教程为新用户提供了一步步将 Istio 应用于常见微服务场景的动手经验。" href=/v1.20/zh/docs/examples/microservices-istio/>使用 Kubernetes 和 Istio 学习微服务</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/prereq/>前提条件</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/setup-kubernetes-cluster/>设置 Kubernetes 集群</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/setup-local-computer/>设置本地计算机</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/single/>本地运行微服务</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/package-service/>在 Docker 中运行 ratings 服务</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/bookinfo-kubernetes/>使用 Kubernetes 运行 Bookinfo</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/production-testing/>生产测试</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/add-new-microservice-version/>添加一个新版本的 reviews</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/add-istio/>在 productpage 启用 Istio</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/enable-istio-all-microservices/>在所有微服务中启用 Istio</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/istio-ingress-gateway/>配置 Istio Ingress Gateway</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/examples/microservices-istio/logs-istio/>监控 Istio</a></li></ul></li></ul></li><li role=treeitem aria-label=运维><a class=main title="关于部署和管理 Istio 网格的概念、工具和技术。" href=/v1.20/zh/docs/ops/>运维</a><ul role=group aria-expanded=true><li role=treeitem aria-label=部署><button aria-hidden=true tabindex=-1></button><a title="设置 Istio 部署的要求、概念和注意事项。" href=/v1.20/zh/docs/ops/deployment/>部署</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="描述 Istio 的整体架构与设计目标。" href=/v1.20/zh/docs/ops/deployment/architecture/>架构</a></li><li role=none><a role=treeitem title="描述 Istio 部署中的选择和建议。" href=/v1.20/zh/docs/ops/deployment/deployment-models/>部署模型</a></li><li role=none><a role=treeitem title="阐述 Istio 针对虚拟机的高级架构。" href=/v1.20/zh/docs/ops/deployment/vm-architecture/>虚拟机架构</a></li><li role=none><a role=treeitem title="介绍 Istio 的性能和可扩展性。" href=/v1.20/zh/docs/ops/deployment/performance-and-scalability/>性能和可扩展性</a></li><li role=none><a role=treeitem title="部署在支持 Istio 的集群中的应用程序的要求。" href=/v1.20/zh/docs/ops/deployment/requirements/>应用程序要求</a></li></ul></li><li role=treeitem aria-label=配置><button aria-hidden=true tabindex=-1></button><a title="配置运行中的 Istio 网格的高级概念和功能。" href=/v1.20/zh/docs/ops/configuration/>配置</a><ul role=group aria-expanded=false><li role=treeitem aria-label=网格配置><button aria-hidden=true tabindex=-1></button><a title=帮助您管理全局网格配置。 href=/v1.20/zh/docs/ops/configuration/mesh/>网格配置</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="简要描述 Istio 对 Kubernetes webhook 的使用以及可能出现的相关问题。" href=/v1.20/zh/docs/ops/configuration/mesh/webhook/>动态准入 Webhook 概述</a></li><li role=none><a role=treeitem title=如何等待资源达到给定的就绪状态。 href=/v1.20/zh/docs/ops/configuration/mesh/config-resource-ready/>等待应用的配置资源状态就绪</a></li><li role=none><a role=treeitem title="为您展示如何对 Istio 服务做健康检查。" href=/v1.20/zh/docs/ops/configuration/mesh/app-health-check/>Istio 服务的健康检查</a></li></ul></li><li role=treeitem aria-label=流量管理><button aria-hidden=true tabindex=-1></button><a title=帮助您管理正在运行的网格的网络方面。 href=/v1.20/zh/docs/ops/configuration/traffic-management/>流量管理</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=关于如何声明协议。 href=/v1.20/zh/docs/ops/configuration/traffic-management/protocol-selection/>协议选择</a></li><li role=none><a role=treeitem title="如何使用 TLS 配置设置安全的网络流量。" href=/v1.20/zh/docs/ops/configuration/traffic-management/tls-configuration/>TLS 配置</a></li><li role=none><a role=treeitem title="Istio 如何通过网格来路由流量。" href=/v1.20/zh/docs/ops/configuration/traffic-management/traffic-routing/>Traffic Routing</a></li><li role=none><a role=treeitem title="理解 Istio 如何与 DNS 交互。" href=/v1.20/zh/docs/ops/configuration/traffic-management/dns/>DNS</a></li><li role=none><a role=treeitem title="如何配置 DNS 代理。" href=/v1.20/zh/docs/ops/configuration/traffic-management/dns-proxy/>DNS 代理</a></li><li role=none><a role=treeitem title="如何配置 Gateway 网络拓扑。 (Alpha)" href=/v1.20/zh/docs/ops/configuration/traffic-management/network-topologies/>配置 Gateway 网络拓扑 *</a></li><li role=none><a role=treeitem title=配置如何在网格中的集群之间分发流量。 href=/v1.20/zh/docs/ops/configuration/traffic-management/multicluster/>多集群流量管理</a></li></ul></li><li role=treeitem aria-label=安全><button aria-hidden=true tabindex=-1></button><a title=帮助您管理正在运行的网格的安全性方面。 href=/v1.20/zh/docs/ops/configuration/security/>安全</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="展示使用 Istio 安全策略的通用示例。" href=/v1.20/zh/docs/ops/configuration/security/security-policy-examples/>安全策略示例</a></li><li role=none><a role=treeitem title="使用加固的容器镜像来减小 Istio 的攻击面。" href=/v1.20/zh/docs/ops/configuration/security/harden-docker-images/>加固 Docker 容器镜像</a></li></ul></li><li role=treeitem aria-label=可观测性><button aria-hidden=true tabindex=-1></button><a title=帮助您管理正在运行的网格中的遥测收集和可视化。 href=/v1.20/zh/docs/ops/configuration/telemetry/>可观测性</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="精细化控制 Envoy 的统计信息。" href=/v1.20/zh/docs/ops/configuration/telemetry/envoy-stats/>Envoy 的统计信息</a></li><li role=none><a role=treeitem title="配置 Prometheus 监控 Istio 多集群。" href=/v1.20/zh/docs/ops/configuration/telemetry/monitoring-multicluster-prometheus/>使用 Prometheus 监控 Istio 多集群</a></li></ul></li><li role=treeitem aria-label=可扩展性><button aria-hidden=true tabindex=-1></button><a title=帮助您管理服务网格的扩展。 href=/v1.20/zh/docs/ops/configuration/extensibility/>可扩展性</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="描述 Istio 如何决定是拉取 Wasm 模块还是使用缓存的版本。 (Alpha)" href=/v1.20/zh/docs/ops/configuration/extensibility/wasm-pull-policy/>WebAssembly 模块的拉取策略 *</a></li></ul></li></ul></li><li role=treeitem aria-label=最佳实践><button aria-hidden=true tabindex=-1></button><a title="设置和管理 Istio 服务网格的最佳实践。" href=/v1.20/zh/docs/ops/best-practices/>最佳实践</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="设置 Istio 服务网格时的最佳实践。" href=/v1.20/zh/docs/ops/best-practices/deployment/>Deployment 最佳实践</a></li><li role=none><a role=treeitem title=避免网络或流量管理问题的配置最佳实践。 href=/v1.20/zh/docs/ops/best-practices/traffic-management/>流量管理最佳实践</a></li><li role=none><a role=treeitem title="使用 Istio 保护应用的最佳实践。" href=/v1.20/zh/docs/ops/best-practices/security/>安全最佳实践</a></li><li role=none><a role=treeitem title="描述如何使用镜像签名来验证 Istio 镜像的出处。" href=/v1.20/zh/docs/ops/best-practices/image-signing-validation/>镜像签名和验证</a></li><li role=none><a role=treeitem title="使用 Istio 观测应用时的最佳实践。" href=/v1.20/zh/docs/ops/best-practices/observability/>可观测性最佳实践</a></li></ul></li><li role=treeitem aria-label=常见问题><button aria-hidden=true tabindex=-1></button><a title="描述如何辨认和解决 Istio 中的常见问题。" href=/v1.20/zh/docs/ops/common-problems/>常见问题</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="定位常见的 Istio 流量管理和网络问题的技术。" href=/v1.20/zh/docs/ops/common-problems/network-issues/>流量管理问题</a></li><li role=none><a role=treeitem title="定位常见 Istio 认证、授权、安全相关问题的技巧。" href=/v1.20/zh/docs/ops/common-problems/security-issues/>安全问题</a></li><li role=none><a role=treeitem title="处理 Telemetry 收集问题。" href=/v1.20/zh/docs/ops/common-problems/observability-issues/>可观测性问题</a></li><li role=none><a role=treeitem title="解决 Istio 使用 Kubernetes Webhooks 进行 Sidecar 自动注入的常见问题。" href=/v1.20/zh/docs/ops/common-problems/injection/>Sidecar 自动注入问题</a></li><li role=none><a role=treeitem title=如何解决配置验证的问题。 href=/v1.20/zh/docs/ops/common-problems/validation/>配置验证的问题</a></li><li role=none><a role=treeitem title="解决 Istio 升级遇到的常见问题。" href=/v1.20/zh/docs/ops/common-problems/upgrade-issues/>升级问题</a></li></ul></li><li role=treeitem aria-label=诊断工具><button aria-hidden=true tabindex=-1></button><a title="帮助解决 Istio 网格问题的工具和技术。" href=/v1.20/zh/docs/ops/diagnostic-tools/>诊断工具</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio 自带的一个可以为服务网格部署提供调试和诊断的补充工具。" href=/v1.20/zh/docs/ops/diagnostic-tools/istioctl/>使用 Istioctl 命令行工具</a></li><li role=none><a role=treeitem title="描述诊断与流量管理相关的 Envoy 配置问题的工具和技术。" href=/v1.20/zh/docs/ops/diagnostic-tools/proxy-cmd/>调试 Envoy 和 Istiod</a></li><li role=none><a role=treeitem title="展示如何使用 istioctl describe 来验证网格中的 Pod 的配置。" href=/v1.20/zh/docs/ops/diagnostic-tools/istioctl-describe/>通过 istioctl describe 检查您的网格</a></li><li role=none><a role=treeitem title="演示如何使用 istioctl analyze 来识别配置中的潜在问题。" href=/v1.20/zh/docs/ops/diagnostic-tools/istioctl-analyze/>使用 Istioctl Analyze 诊断配置</a></li><li role=none><a role=treeitem title="了解如何使用 istioctl check-inject 来确认是否为您的 Deployment 正确启用了 Istio Sidecar 注入。" href=/v1.20/zh/docs/ops/diagnostic-tools/check-inject/>使用 istioctl check-inject 验证 Istio Sidecar 注入</a></li><li role=none><a role=treeitem title="介绍如何使用 ControlZ 深入了解正在运行的 istiod 组件。" href=/v1.20/zh/docs/ops/diagnostic-tools/controlz/>组件自检</a></li><li role=none><a role=treeitem title=如何使用组件级别日志来深入了解正在运行的组件的行为。 href=/v1.20/zh/docs/ops/diagnostic-tools/component-logging/>组件日志记录</a></li><li role=none><a role=treeitem title=介绍关于虚拟机调试的技术和工具。 href=/v1.20/zh/docs/ops/diagnostic-tools/virtual-machines/>虚拟机调试</a></li><li role=none><a role=treeitem title="描述使用 Istio 和 CNI 插件诊断问题的工具和技术。" href=/v1.20/zh/docs/ops/diagnostic-tools/cni/>Istio CNI 插件故障排除</a></li><li role=none><a role=treeitem title=介绍用来诊断多集群和多网络下安装问题的工具和技术。 href=/v1.20/zh/docs/ops/diagnostic-tools/multicluster/>多集群下的故障排除</a></li></ul></li><li role=treeitem aria-label="Ambient Mesh"><button class=show aria-hidden=true tabindex=-1></button><a title="搭建和操作 Istio Ambient Mesh 的指示信息。" href=/v1.20/zh/docs/ops/ambient/>Ambient Mesh</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title="如何部署和安装 Ambient Mesh。" href=/v1.20/zh/docs/ops/ambient/getting-started/>Ambient Mesh 入门</a></li><li role=treeitem aria-label="Ambient Mesh 用户指南"><button class=show aria-hidden=true tabindex=-1></button><a title="如何使用 Ambient Mesh。" href=/v1.20/zh/docs/ops/ambient/usage/>Ambient Mesh 用户指南</a><ul role=group aria-expanded=true class=leaf-section><li role=none><a role=treeitem title="Istio Ambient 网格安装指南。" href=/v1.20/zh/docs/ops/ambient/usage/install/>安装指南</a></li><li role=none><a role=treeitem title="使用 Waypoint 代理的 Istio Ambient L7 网络和服务的用户指南。" href=/v1.20/zh/docs/ops/ambient/usage/waypoint/>带有 Waypoint 的 L7 网络和服务</a></li><li role=none><a role=treeitem title="Istio Ambient 使用 ztunnel 代理实现 L4 联网和 mTLS 的用户指南。" href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/>使用 ztunnel 实现 L4 联网和 mTLS</a></li></ul></li><li role=treeitem aria-label=安装指南><button aria-hidden=true tabindex=-1></button><a title="Istio Ambient Mesh 安装指南。" href=/v1.20/zh/docs/ops/ambient/install/>安装指南</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="如何使用 Helm 安装 Ambient Mesh。" href=/v1.20/zh/docs/ops/ambient/install/helm-installation/>通过 Helm 安装</a></li></ul></li><li role=none><a role=treeitem title="深入了解 Ambient Mesh 架构。" href=/v1.20/zh/docs/ops/ambient/architecture/>Ambient Mesh 架构</a></li></ul></li><li role=treeitem aria-label=集成><button aria-hidden=true tabindex=-1></button><a title="能够与 Istio 集成以提供额外功能的其他软件。" href=/v1.20/zh/docs/ops/integrations/>集成</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="关于如何与 cert-manager 集成的相关说明。" href=/v1.20/zh/docs/ops/integrations/certmanager/>cert-manager</a></li><li role=none><a role=treeitem title="关于如何与 Grafana 集成构建 Istio 仪表盘的相关文档。" href=/v1.20/zh/docs/ops/integrations/grafana/>Grafana</a></li><li role=none><a role=treeitem title="如何与 Jaeger 集成。" href=/v1.20/zh/docs/ops/integrations/jaeger/>Jaeger</a></li><li role=none><a role=treeitem title="有关如何与 Kiali 集成的信息。" href=/v1.20/zh/docs/ops/integrations/kiali/>Kiali</a></li><li role=none><a role=treeitem title="如何集成 Prometheus。" href=/v1.20/zh/docs/ops/integrations/prometheus/>Prometheus</a></li><li role=none><a role=treeitem title="如何配置 Istio 以集成 SPIRE 通过 Envoy 的 SDS API 获取加密身份。" href=/v1.20/zh/docs/ops/integrations/spire/>SPIRE</a></li><li role=none><a role=treeitem title="如何与 Zipkin 进行集成。" href=/v1.20/zh/docs/ops/integrations/zipkin/>Zipkin</a></li><li role=none><a role=treeitem title="如何集成 Apache SkyWalking。" href=/v1.20/zh/docs/ops/integrations/skywalking/>Apache SkyWalking</a></li><li role=none><a role=treeitem title="Istio 如何集成第三方负载均衡器。" href=/v1.20/zh/docs/ops/integrations/loadbalancers/>第三方负载均衡器</a></li></ul></li></ul></li><li role=treeitem aria-label=发布><a class=main title="与 Istio 发布有关的信息。" href=/v1.20/zh/docs/releases/>发布</a><ul role=group aria-expanded=true><li role=none><a role=treeitem title=特性及其发布阶段的列表。 href=/v1.20/zh/docs/releases/feature-stages/>功能状态</a></li><li role=none><a role=treeitem title=如果发现错误该怎么办。 href=/v1.20/zh/docs/releases/bugs/>报告错误</a></li><li role=none><a role=treeitem title=我们如何处理安全漏洞。 href=/v1.20/zh/docs/releases/security-vulnerabilities/>安全漏洞</a></li><li role=none><a role=treeitem title="当前支持的 Istio 版本。" href=/v1.20/zh/docs/releases/supported-releases/>版本支持</a></li><li role=treeitem aria-label=贡献文档><button aria-hidden=true tabindex=-1></button><a title="详细介绍了如何创建和维护 Istio 文档。" href=/v1.20/zh/docs/releases/contribute/>贡献文档</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="向您展示如何使用 GitHub 参与贡献 Istio 文档。" href=/v1.20/zh/docs/releases/contribute/github/>使用 GitHub 参与社区活动</a></li><li role=none><a role=treeitem title="介绍如何为 Istio 贡献新文档。" href=/v1.20/zh/docs/releases/contribute/add-content/>添加新文档</a></li><li role=none><a role=treeitem title="详细说明如何将已停用的文档提交给 Istio。" href=/v1.20/zh/docs/releases/contribute/remove-content/>删除已停用的文档</a></li><li role=none><a role=treeitem title=介绍如何在本地进行本网站的构建，测试，运行和预览。 href=/v1.20/zh/docs/releases/contribute/build/>本地构建和运行本网站</a></li><li role=none><a role=treeitem title=介绍了文档中使用的文章头及其可用字段。 href=/v1.20/zh/docs/releases/contribute/front-matter/>文章头部</a></li><li role=none><a role=treeitem title="向您展示如何审阅和批准对 Istio 文档和网站的更改。" href=/v1.20/zh/docs/releases/contribute/review/>文档审阅流程</a></li><li role=none><a role=treeitem title=介绍如何在您的文档中添加代码。 href=/v1.20/zh/docs/releases/contribute/code-blocks/>添加代码块</a></li><li role=none><a role=treeitem title="介绍可用的 Shortcode 及其用法。" href=/v1.20/zh/docs/releases/contribute/shortcodes/>使用 Shortcode</a></li><li role=none><a role=treeitem title="介绍 Istio 文档的格式标准。" href=/v1.20/zh/docs/releases/contribute/formatting/>格式标准</a></li><li role=none><a role=treeitem title="介绍 Istio 文档所使用的风格规则。" href=/v1.20/zh/docs/releases/contribute/style-guide/>风格指南</a></li><li role=none><a role=treeitem title="解释 Istio 文档中使用的术语标准。" href=/v1.20/zh/docs/releases/contribute/terminology/>术语标准</a></li><li role=none><a role=treeitem title="为 Istio 文档创建图表提供素材和说明。" href=/v1.20/zh/docs/releases/contribute/diagrams/>创建图表指南</a></li></ul></li><li role=none><a role=treeitem title=该网站的最新更改列表。 href=/v1.20/zh/docs/releases/log/>网站内容更改</a></li></ul></li><li role=treeitem aria-label=参考><a class=main title="参考部分包含详细的权威参考资料，如命令行选项、配置选项和 API 调用参数。" href=/v1.20/zh/docs/reference/>参考</a><ul role=group aria-expanded=true><li role=treeitem aria-label=配置><button aria-hidden=true tabindex=-1></button><a title=关于配置选项的详细信息。 href=/v1.20/zh/docs/reference/config/>配置</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title="Telemetry configuration for workloads." href=/v1.20/zh/docs/reference/config/telemetry/>Telemetry</a></li><li role=none><a role=treeitem title="Describes the structure of messages generated by Istio analyzers." href=/v1.20/zh/docs/reference/config/istio.analysis.v1alpha1/>Analysis Messages</a></li><li role=none><a role=treeitem title="Configuration affecting the service mesh as a whole." href=/v1.20/zh/docs/reference/config/istio.mesh.v1alpha1/>Global Mesh Options</a></li><li role=none><a role=treeitem title="Configuration affecting Istio control plane installation version and shape." href=/v1.20/zh/docs/reference/config/istio.operator.v1alpha1/>IstioOperator Options</a></li><li role=none><a role=treeitem title=描述“状态”字段在配置工作流程中的作用。 href=/v1.20/zh/docs/reference/config/config-status/>状态字段配置</a></li><li role=treeitem aria-label=代理扩展><button aria-hidden=true tabindex=-1></button><a title="描述如何配置 Istio 代理扩展。" href=/v1.20/zh/docs/reference/config/proxy_extensions/>代理扩展</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Extend the functionality provided by the Istio proxy through WebAssembly filters." href=/v1.20/zh/docs/reference/config/proxy_extensions/wasm-plugin/>Wasm Plugin</a></li><li role=none><a role=treeitem title="Configuration for AccessLogPolicy Filter." href=/v1.20/zh/docs/reference/config/proxy_extensions/accesslogpolicy/>AccessLogPolicy Config</a></li><li role=none><a role=treeitem title="Configuration for Stackdriver filter." href=/v1.20/zh/docs/reference/config/proxy_extensions/stackdriver/>Stackdriver Config</a></li><li role=none><a role=treeitem title="如何使用 Wasm 进行遥测。 (Experimental)" href=/v1.20/zh/docs/reference/config/proxy_extensions/wasm_telemetry/>基于 Wasm 的遥测 *</a></li></ul></li><li role=treeitem aria-label=流量管理><button aria-hidden=true tabindex=-1></button><a title="描述如何配置 HTTP/TCP 路由功能。" href=/v1.20/zh/docs/reference/config/networking/>流量管理</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Configuration affecting load balancing, outlier detection, etc." href=/v1.20/zh/docs/reference/config/networking/destination-rule/>Destination Rule</a></li><li role=none><a role=treeitem title="Customizing Envoy configuration generated by Istio." href=/v1.20/zh/docs/reference/config/networking/envoy-filter/>Envoy Filter</a></li><li role=none><a role=treeitem title="Configuration affecting edge load balancer." href=/v1.20/zh/docs/reference/config/networking/gateway/>Gateway</a></li><li role=none><a role=treeitem title="Provides configuration for individual workloads." href=/v1.20/zh/docs/reference/config/networking/proxy-config/>ProxyConfig</a></li><li role=none><a role=treeitem title="Configuration affecting service registry." href=/v1.20/zh/docs/reference/config/networking/service-entry/>Service Entry</a></li><li role=none><a role=treeitem title="Configuration affecting network reachability of a sidecar." href=/v1.20/zh/docs/reference/config/networking/sidecar/>Sidecar</a></li><li role=none><a role=treeitem title="Configuration affecting label/content routing, sni routing, etc." href=/v1.20/zh/docs/reference/config/networking/virtual-service/>Virtual Service</a></li><li role=none><a role=treeitem title="Configuration affecting VMs onboarded into the mesh." href=/v1.20/zh/docs/reference/config/networking/workload-entry/>Workload Entry</a></li><li role=none><a role=treeitem title="Describes a collection of workload instances." href=/v1.20/zh/docs/reference/config/networking/workload-group/>Workload Group</a></li></ul></li><li role=treeitem aria-label=Security><button aria-hidden=true tabindex=-1></button><a title="如何配置 Istio 的安全功能。" href=/v1.20/zh/docs/reference/config/security/>Security</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Configuration to validate JWT." href=/v1.20/zh/docs/reference/config/security/jwt/>JWTRule</a></li><li role=none><a role=treeitem title="Peer authentication configuration for workloads." href=/v1.20/zh/docs/reference/config/security/peer_authentication/>PeerAuthentication</a></li><li role=none><a role=treeitem title="Request authentication configuration for workloads." href=/v1.20/zh/docs/reference/config/security/request_authentication/>RequestAuthentication</a></li><li role=none><a role=treeitem title="Configuration for access control on workloads." href=/v1.20/zh/docs/reference/config/security/authorization-policy/>Authorization Policy</a></li><li role=none><a role=treeitem title=授权策略中支持的条件。 href=/v1.20/zh/docs/reference/config/security/conditions/>授权策略</a></li><li role=none><a role=treeitem title=描述了授权策略中支持的规范化。 href=/v1.20/zh/docs/reference/config/security/normalization/>授权策略规范化</a></li></ul></li><li role=none><a role=treeitem title="通过 Istio 遥测导出的 Istio 标准指标。" href=/v1.20/zh/docs/reference/config/metrics/>Istio 标准指标</a></li><li role=treeitem aria-label=常见类型><button aria-hidden=true tabindex=-1></button><a title="描述 Istio API 中的常见类型。" href=/v1.20/zh/docs/reference/config/type/>常见类型</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Definition of a workload selector." href=/v1.20/zh/docs/reference/config/type/workload-selector/>Workload Selector</a></li></ul></li><li role=none><a role=treeitem title="Resource annotations used by Istio." href=/v1.20/zh/docs/reference/config/annotations/>Resource Annotations</a></li><li role=none><a role=treeitem title="Resource labels used by Istio." href=/v1.20/zh/docs/reference/config/labels/>Resource Labels</a></li><li role=treeitem aria-label=配置分析消息><button aria-hidden=true tabindex=-1></button><a title=记录配置分析期间产生的各个错误和警告消息。 href=/v1.20/zh/docs/reference/config/analysis/>配置分析消息</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0136/>AlphaAnnotation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/message-format/>Analyzer Message Format</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0109/>ConflictingMeshGatewayVirtualServiceHosts</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0110/>ConflictingSidecarWorkloadSelectors</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0159/>ConflictingTelemetryWorkloadSelectors</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0116/>DeploymentAssociatedToMultipleServices</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0137/>DeploymentConflictingPorts</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0002/>Deprecated</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0135/>DeprecatedAnnotation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0153/>EnvoyFilterUsesAddOperationIncorrectly</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0151/>EnvoyFilterUsesRelativeOperation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0155/>EnvoyFilterUsesRelativeOperationWithProxyVersion</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0154/>EnvoyFilterUsesRemoveOperationIncorrectly</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0152/>EnvoyFilterUsesReplaceOperationIncorrectly</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0164/>ExternalControlPlaneAddressIsNotAHostname</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0150/>ExternalNameServiceTypeInvalidPortName</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0162/>GatewayPortNotDefinedOnService</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0001/>InternalError</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0125/>InvalidAnnotation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0144/>InvalidApplicationUID</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0163/>InvalidExternalControlPlaneConfig</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0161/>InvalidGatewayCredential</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0122/>InvalidRegexp</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0157/>InvalidTelemetryProvider</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0119/>JwtFailureDueToInvalidServicePortPrefix</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0143/>LocalhostListener</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0107/>MisplacedAnnotation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0113/>MTLSPolicyConflict</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0111/>MultipleSidecarsWithoutWorkloadSelectors</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0160/>MultipleTelemetriesWithoutWorkloadSelectors</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0123/>NamespaceMultipleInjectionLabels</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0102/>NamespaceNotInjected</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0127/>NoMatchingWorkloadsFound</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0128/>NoServerCertificateVerificationDestinationLevel</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0129/>NoServerCertificateVerificationPortLevel</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0103/>PodMissingProxy</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0158/>PodsIstioProxyImageMismatchInNamespace</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0118/>PortNameIsNotUnderNamingConvention</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0101/>ReferencedResourceNotFound</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0106/>SchemaValidationError</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0134/>ServiceEntryAddressesRequired</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0108/>UnknownAnnotation</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0112/>VirtualServiceDestinationPortSelectorRequired</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0132/>VirtualServiceHostNotFoundInGateway</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0131/>VirtualServiceIneffectiveMatch</a></li><li role=none><a role=treeitem title href=/v1.20/zh/docs/reference/config/analysis/ist0130/>VirtualServiceUnreachableRule</a></li></ul></li></ul></li><li role=treeitem aria-label=命令><button aria-hidden=true tabindex=-1></button><a title="描述 Istio 命令和工具的用法及选项。" href=/v1.20/zh/docs/reference/commands/>命令</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Install and configure Istio CNI plugin on a node, detect and repair pod which is broken by race condition." href=/v1.20/zh/docs/reference/commands/install-cni/>install-cni</a></li><li role=none><a role=treeitem title="Istio control interface." href=/v1.20/zh/docs/reference/commands/istioctl/>istioctl</a></li><li role=none><a role=treeitem title="The Istio operator." href=/v1.20/zh/docs/reference/commands/operator/>operator</a></li><li role=none><a role=treeitem title="Istio Pilot agent." href=/v1.20/zh/docs/reference/commands/pilot-agent/>pilot-agent</a></li><li role=none><a role=treeitem title="Istio Pilot." href=/v1.20/zh/docs/reference/commands/pilot-discovery/>pilot-discovery</a></li></ul></li><li role=none><a role=treeitem title="Istio 常用术语的词汇表。" href=/v1.20/zh/docs/reference/glossary/>术语表</a></li></ul></li></ul></div></div></div></nav></div><div class=article-container><button id=sidebar-toggle class=main-navigation-toggle aria-label="Open sidebar">
<svg class="icon hamburger-sidebar"><use xlink:href="/v1.20/img/icons.svg#hamburger-sidebar"/></svg>
目录</button><article aria-labelledby=title><nav aria-label=Breadcrumb><ol><li><a href=/v1.20/zh/docs/ title="了解如何部署、使用和运维 Istio。">文档</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.20/img/icons.svg#breadcrumb-arrow"/></svg></li><li><a href=/v1.20/zh/docs/ops/ title="关于部署和管理 Istio 网格的概念、工具和技术。">运维</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.20/img/icons.svg#breadcrumb-arrow"/></svg></li><li><a href=/v1.20/zh/docs/ops/ambient/ title="搭建和操作 Istio Ambient Mesh 的指示信息。">Ambient Mesh</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.20/img/icons.svg#breadcrumb-arrow"/></svg></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ title="如何使用 Ambient Mesh。">Ambient Mesh 用户指南</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.20/img/icons.svg#breadcrumb-arrow"/></svg></li><li>使用 ztunnel 实现 L4 联网和 mTLS</li></ol></nav><div class=title-area><div style=width:100%><h1 id=title>使用 ztunnel 实现 L4 联网和 mTLS</h1><p class=byline><span class=reading-time title="2728 字"><svg class="icon clock"><use xlink:href="/v1.20/img/icons.svg#clock"/></svg><span>&nbsp;</span>阅读大约需要 13 分钟</span>
<span>&nbsp;</span>
<span><a href=https://github.com/istio/istio.io/tree/master/README.md#testing-document-content title=这个页面没有自动测试可用，点击详情或帮助创建一个。><svg class="icon cancel-grey"><use xlink:href="/v1.20/img/icons.svg#cancel-grey"/></svg><span>&nbsp;</span>
页面测试</a></span></p></div></div><nav class=toc-inlined aria-label="Table of Contents"><div><hr><ol><li role=none aria-label="简介 "><a href=#introsection>简介</a><li role=none aria-label="当前注意事项 "><a href=#caveats>当前注意事项</a><ol><li role=none aria-label="本指南使用的环境 "><a href=#environment-used-for-this-guide>本指南使用的环境</a></ol></li><li role=none aria-label="功能概述 "><a href=#functionaloverview>功能概述</a><ol><li role=none aria-label="控制平面概述 "><a href=#control-plane-overview>控制平面概述</a><li role=none aria-label="数据平面概述 "><a href=#data-plane-overview>数据平面概述</a><ol><li role=none aria-label="ztunnel 到 ztunnel 数据路径 "><a href=#ztunnel-to-ztunnel-datapath>ztunnel 到 ztunnel 数据路径</a><li role=none aria-label="通过 Waypoint 的 ztunnel 数据路径 "><a href=#ztunnel-datapath-via-waypoint>通过 Waypoint 的 ztunnel 数据路径</a><li role=none aria-label="ztunnel 数据路径 Hair-pinning "><a href=#ztunnel-datapath-hair-pinning>ztunnel 数据路径 Hair-pinning</a></ol></li><li role=none aria-label="关于 HBONE 的说明 "><a href=#hbonesection>关于 HBONE 的说明</a></ol></li><li role=none aria-label="部署应用程序 "><a href=#deployapplication>部署应用程序</a><ol><li role=none aria-label="部署不基于 Ambient 的基础应用程序 "><a href=#basic-application-deployment-without-ambient>部署不基于 Ambient 的基础应用程序</a><li role=none aria-label="为应用程序启用 Ambient "><a href=#enabling-ambient-for-an-application>为应用程序启用 Ambient</a></ol></li><li role=none aria-label="监控 ztunnel 代理和 L4 网络 "><a href=#monitoringzt>监控 ztunnel 代理和 L4 网络</a><ol><li role=none aria-label="查看 ztunnel 代理状态 "><a href=#viewing-ztunnel-proxy-state>查看 ztunnel 代理状态</a><li role=none aria-label="查看 ztunnel xDS 资源的 istiod 状态 "><a href=#viewing-istiod-state-for-ztunnel-xds-resources>查看 ztunnel xDS 资源的 istiod 状态</a><li role=none aria-label="验证 ztunnel 流量日志 "><a href=#verifying-ztunnel-traffic-logs>验证 ztunnel 流量日志</a><li role=none aria-label="通过 Prometheus、Grafana、Kiali 进行监控和遥测 "><a href=#monitoring-and-telemetry-via-prometheus-grafana-kiali>通过 Prometheus、Grafana、Kiali 进行监控和遥测</a><li role=none aria-label="验证 ztunnel 负载平衡 "><a href=#verifying-ztunnel-load-balancing>验证 ztunnel 负载平衡</a><li role=none aria-label="Ambient 模式和 Sidecar 模式的 Pod 选择逻辑 "><a href=#pod-selection-logic-for-ambient-and-sidecar-modes>Ambient 模式和 Sidecar 模式的 Pod 选择逻辑</a></ol></li><li role=none aria-label="L4 鉴权策略 "><a href=#l4auth>L4 鉴权策略</a><li role=none aria-label="Ambient 与非 Ambient 端点的互操作性 "><a href=#interop>Ambient 与非 Ambient 端点的互操作性</a><ol><li role=none aria-label="东西向非网格 Pod 到 Ambient 网格 Pod（以及 PeerAuthentication 资源的使用） "><a href=#ewnonmesh>东西向非网格 Pod 到 Ambient 网格 Pod（以及 PeerAuthentication 资源的使用）</a><li role=none aria-label="东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod "><a href=#ewside2ambient>东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod</a><li role=none aria-label="南北入口网关到 Ambient 后端 Pod "><a href=#nsingress2ambient>南北入口网关到 Ambient 后端 Pod</a></ol></li></ol><hr></div></nav><div><aside class="callout warning"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-warning"/></svg></div><div class=content><p><code>Ambient</code> 目前处于 <a href=/v1.20/zh/docs/releases/feature-stages/#feature-phase-definitions>Alpha 状态</a>。</p><p>请<strong>不要在生产环境中运行 Ambient</strong>，
并确保在使用前仔细检查<a href=/v1.20/zh/docs/releases/feature-stages/#feature-phase-definitions>功能阶段定义</a>。
特别是，<code>alpha</code> 版本中存在已知的性能、稳定性和安全问题。
还有一些功能性注意事项，其中一些已在本指南的<a href=/v1.20/zh/#caveats>注意事项部分</a>中列出。
以及计划中的重大变更，其中一些会影响升级。这些都是在升级到 <code>beta</code>
版之前将要解决的限制。当前版本的指南旨在帮助对 Ambient 的 Alpha 版本进行早期部署和测试。
随着 Ambient 状态从 Alpha 发展到 Beta 及以后，本指南将随之进行更新。</p></div></aside></div><h2 id=introsection>简介</h2><p>本指南深入介绍了 Istio Ambient 网格中 ztunnel 代理和 4 层网络能力的功能和用法。
要简单地尝试 Istio Ambient 网格，请按照
<a href=/v1.20/zh/docs/ops/ambient/getting-started/>Ambient 快速入门</a>进行操作。
本指南遵循用户旅程并通过多个示例来详细介绍 Istio Ambient 的设计和架构。
强烈建议按顺序关注下面链接中的主题。</p><ul><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#introsection>简介</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#caveats>当前注意事项</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#functionaloverview>功能概述</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#deployapplication>部署应用程序</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#monitoringzt>监控 ztunnel 代理和 L4 网络</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#l4auth>L4 鉴权策略</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#interop>Ambient 与非 Ambient 端点的互操作性</a></li></ul><p>ztunnel（Zero Trust Tunnel，零信任隧道）组件是专门为 Istio Ambient
网格构建的基于每个节点的代理。由于工作负载 Pod 不再需要在 Sidecar
中运行代理也可以参与网格，因此 Ambient 模式下的 Istio
也被非正式地称为 “无 Sidecar” 网格。</p><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-tip"/></svg></div><div class=content>使用 Sidecar 代理的 Pod/工作负载可以与在 Ambient 模式下运行的 Pod 共存于同一网格内。
使用 Sidecar 代理的网格 Pod 还可以与同一 Istio 网格中以 Ambient 模式运行的 Pod 进行互操作。
Ambient 网格的概念是指具有功能超集的 Istio 网格，因此可以支持使用任一类型代理的网格 Pod。</div></aside></div><p>ztunnel 节点代理负责安全连接和验证 Ambient 网格内的工作负载。
ztunnel 代理是用 Rust 语言编写的，旨在处理 Ambient 网格中的 L3 和 L4 功能，
例如 mTLS、身份验证、L4 鉴权和遥测。ztunnel 不会终止工作负载 HTTP
流量或解析工作负载 HTTP 标头。ztunnel 确保 L3 和 L4 流量高效、安全地传输到 <strong>Waypoint 代理</strong>，
其中实现了 Istio 的全套 L7 功能，例如 HTTP 遥测和负载均衡。
“安全覆盖网络（Secure Overlay Networking）”概念被非正式地用于统称通过
ztunnel 代理在 Ambient 网格中实现的 L4 网络功能集。
在传输层，这是通过一种称为 HBONE 的基于 HTTP CONNECT 的流量隧道协议来实现的，
HBONE 协议在本指南的<a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#hbonesection>关于 HBONE</a> 一节中进行说明。</p><p>Istio 在 Ambient 模式下的一些用例可以仅通过 L4 安全覆盖网络功能来解决，
并且不需要 L7 功能，因此不需要部署 Waypoint 代理。
其他需要高级流量管理和 L7 网络功能的用例将需要部署 Waypoint 代理。
本指南重点介绍与使用 ztunnel 代理的 L4 安全覆盖网络相关的功能。
本指南仅在需要描述某些 L4 ztunnel 功能时才引用 L7。
高级 L7 网络功能和 Waypoint 代理的详细使用将在其他指南中专门介绍。</p><table><thead><tr><th>应用程序部署用例</th><th>Istio Ambient 网格配置</th></tr></thead><tbody><tr><td>通过双向 TLS、客户端应用程序流量的加密和隧道数据传输实现零信任网络、L4 鉴权、L4 遥测</td><td>具有 ztunnel 代理网络的基线 Ambient 网格</td></tr><tr><td>应用程序需要 L4 双向 TLS 以及高级 Istio 流量管理功能（包括 VirtualService、L7 遥测、L7 鉴权）</td><td>完整的 Istio Ambient 网格配置，包括基于 ztunnel 代理和 Waypoint 代理的网络</td></tr></tbody></table><h2 id=caveats>当前注意事项</h2><p>当使用其中一种支持的安装方法安装 Istio Ambient 网格时，会自动安装 ztunnel 代理。
Istio Ambient 模式所需的最低 Istio 版本是 <code>1.18.0</code>。
一般来说，Ambient 模式下的 Istio 支持 Sidecar 代理模式下支持的现有 Istio API。
由于 Ambient 功能当前处于 Alpha 版本级别，
因此以下是 Istio Ambient 功能当前版本（自 <code>1.19.0</code> 版本起）中的功能限制或警告列表。
预计在 Ambient 进入 Beta 版本并最终正式发布时，这些限制将被解决/移除。</p><ol><li><p>**仅限 Kubernetes（K8s）：**目前仅支持 Istio Ambient 模式在 Kubernetes 集群上部署。
目前不支持在虚拟机等非 Kubernetes 端点上部署。</p></li><li><p>**不支持 Istio 多集群：**Istio Ambient 模式当前仅支持单集群部署。</p></li><li><p>**K8s CNI 限制：**Ambient 模式下的 Istio 目前不适用于所有 Kubernetes CNI 实现。
此外，对于某些插件，某些 CNI 功能（特别是 Kubernetes <code>NetworkPolicy</code> 和 Kubernetes 服务负载均衡功能）
可能会在 Istio Ambient 模式存在的情况下被透明绕过。
已被支持的 CNI 插件的明确集合以及任何 CNI 功能警告目前正在测试中，
并将在 Istio Ambient 模式接近 Beta 版本时正式提供文档。</p></li><li><p>**仅限 TCP/IPv4：**在当前版本中，基于 IPv4 的 TCP 是
Istio 安全覆盖隧道上唯一支持的传输协议（这包括在 TCP/IPv4 连接之上的应用程序层端点之间运行的 HTTP 等协议）。</p></li><li><p>**无法动态切换到 Ambient 模式：**Ambient 模式只能在使用 Ambient 配置文件或
Ambient Helm 配置部署的新 Istio 网格控制平面上启用。
例如，使用 Pre-Ambient 配置文件部署的现有 Istio 网格无法被动态切换至同时启用 Ambient 模式的状态。</p></li><li><p>**Istio <code>PeerAuthentication</code> 的限制：**截至撰写本文时，Istio Ambient 模式下的所有组件（即 Waypoint 代理）
并不支持 <code>PeerAuthentication</code> 资源。因此，建议当前仅使用 <code>STRICT</code> mTLS 模式。
与许多其他 Alpha 阶段的注意事项一样，随着该功能转向 Beta 状态，该问题应该会得到解决。</p></li><li><p>**istioctl CLI 差距：**在显示或监控 Istio Ambient 模式相关信息时，
Istio CLI 输出显示等区域可能存在一些细微的功能差距。随着功能的成熟，这些问题将得到解决。</p></li></ol><h3 id=environment-used-for-this-guide>本指南使用的环境</h3><p>本指南中的示例在基于 <code>0.20.0</code> 版 <code>kind</code> 的
Kubernetes <code>1.27.3</code> 集群内的 Istio <code>1.19.0</code> 版本中运行。</p><p>Ambient 功能所需的最低 Istio 版本是 1.18.0，所需的最低 Kubernetes 版本是 <code>1.24.0</code>。
下面的示例需要一个具有超过 1 个工作节点的集群，以便解释跨节点流量的运行方式。
请参阅<a href=/v1.20/zh/docs/ops/ambient/install/>安装用户指南</a>或<a href=/v1.20/zh/docs/ops/ambient/getting-started/>入门指南</a>，
了解关于在 Kubernetes 集群中安装 Ambient 模式 Istio 的信息。</p><h2 id=functionaloverview>功能概述</h2><p>ztunnel 代理的功能行为可以分为数据平面行为和与 Istio 控制平面的交互。
本节简要介绍这两个方面 - ztunnel 代理内部设计的详细描述超出了本指南的范围。</p><h3 id=control-plane-overview>控制平面概述</h3><p>该图展示了 ztunnel 代理和 <code>istiod</code> 控制平面以及控制平面相关组件之间的流程概述。</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:67.74193548387096%><a data-skipendnotes=true href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-architecture.png title="ztunnel 架构"><img class=element-to-stretch src=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-architecture.png alt="ztunnel 架构"></a></div><figcaption>ztunnel 架构</figcaption></figure><p>ztunnel 代理使用 xDS API 与 Istio 控制平面（<code>istiod</code>）进行通信。
这使得现代分布式系统所需的快速、动态配置更新成为可能。
ztunnel 代理还使用 xDS 为其 Kubernetes 节点上调度的所有 Pod 的服务帐户获取 mTLS 证书。
单个 ztunnel 代理可以代表共享其节点的任何 Pod 实现 L4 数据平面功能，
这需要有效获取相关配置和证书。这种多租户架构与 Sidecar 模型形成鲜明对比，
在 Sidecar 模型中，每个应用程序 Pod 都有自己的代理。</p><p>另外值得注意的是，在 Ambient 模式下，xDS API 中使用一组简化的资源来进行 ztunnel 代理配置。
这会提高性能（需要传输和处理从 istiod 发送到 ztunnel 代理的信息集更小）并改进排障过程。</p><h3 id=data-plane-overview>数据平面概述</h3><p>本节简要总结了数据平面功能的关键内容。</p><h4 id=ztunnel-to-ztunnel-datapath>ztunnel 到 ztunnel 数据路径</h4><p>第一个场景是 ztunnel 到 ztunnel L4 网络。如下图所示。</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:38.13615333773959%><a data-skipendnotes=true href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-datapath-1.png title="ztunnel 基础：仅 L4 数据路径"><img class=element-to-stretch src=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-datapath-1.png alt="ztunnel 基础：仅 L4 数据路径"></a></div><figcaption>ztunnel 基础：仅 L4 数据路径</figcaption></figure><p>该图描绘了 Kubernetes 集群的两个节点 W1 和 W2 上运行的 Ambient Pod 工作负载。
每个节点上都有一个 ztunnel 代理实例。在此场景中，应用程序客户端
Pod C1、C2 和 C3 需要访问由 Pod S1 提供的服务，并且不需要高级 L7 功能
（例如 L7 流量路由或 L7 流量管理），因此不需要 Waypoint 代理。</p><p>该图展示了在节点 W1 上运行的 Pod C1 和 C2 与在节点 W2 上运行的 Pod S1 连接，
它们的 TCP 流量通过在每个节点的 ztunnel 代理 Pod 之间创建的单个共享 HBONE 隧道实例进行隧道传输。
双向 TLS（mTLS）用于加密以及隧道流量的相互身份验证。SPIFFE 身份用于识别连接两端的工作负载。
Istio Ambient 中使用的 <code>HBONE</code>（基于 HTTP 的覆盖网络封装：HTTP Based Overlay Network Encapsulation）概念是指一种透明、
安全地隧道传输封装在 HTTPS 数据包中的 TCP 数据包的技术。
以下小节提供了有关 HBONE 的一些简短附加说明。</p><p>请注意，该图展示本地流量（从 Pod C3 到工作节点 W2 上的目标 Pod S1）
无论是否跨越节点边界也会遍历本地 ztunnel 代理实例，
以便对流量执行相同的 L4 流量管理功能（例如 L4 鉴权和 L4 遥测）。</p><h4 id=ztunnel-datapath-via-waypoint>通过 Waypoint 的 ztunnel 数据路径</h4><p>下图描述了需要高级 L7 流量路由、管理或策略处理用例的数据路径。
这里 ztunnel 使用 HBONE 隧道将流量发送到 Waypoint 代理进行 L7 处理。
处理后，Waypoint 通过第二个 HBONE 隧道将流量发送到托管所选服务目标 Pod 节点上的 ztunnel。
一般来说，Waypoint 代理可能位于也可能不位于与源或目标 Pod 相同的节点上。</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:37.84143904063957%><a data-skipendnotes=true href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-waypoint-datapath.png title="通过临时 Waypoint 的 ztunnel 数据路径"><img class=element-to-stretch src=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-waypoint-datapath.png alt="通过临时 Waypoint 的 ztunnel 数据路径"></a></div><figcaption>通过临时 Waypoint 的 ztunnel 数据路径</figcaption></figure><h4 id=ztunnel-datapath-hair-pinning>ztunnel 数据路径 Hair-pinning</h4><div><aside class="callout warning"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-warning"/></svg></div><div class=content>如前所述，随着项目进入 Beta 及更高版本，一些 Ambient 功能可能会发生变化。
此功能（Hair-pinning）是当前在 Ambient 的 Alpha 版本中可用的功能示例，
并且随着项目的发展正在审查可能的修改。</div></aside></div><p>前面已经指出，流量总是先发送到与目的地 Pod 相同节点上的 ztunnel 代理，然后再发送到目的地 Pod。
但是，如果发送方完全位于 Istio Ambient 网格之外，因此不首先向目的地 ztunnel 发起 HBONE 隧道，该怎么办？
如果发送者是恶意的并尝试绕过目标 ztunnel 代理将流量直接发送到 Ambient Pod 目标怎么办？</p><p>这里有两种情况，如下图所示。在第一种情况下，流量流 B1 被节点 W2 在任何 HBONE 隧道外接收，
并出于某种原因直接寻址到 Ambient Pod S1 的 IP 地址（可能是因为流量源不是 Ambient Pod）。
如图所示，ztunnel 流量重定向逻辑将拦截此类流量，并通过本地 ztunnel 代理进行目的地侧代理处理和可能基于
AuthorizationPolicy 的过滤，然后发送到 Pod S1。
在第二种情况下，流量流 G1 被节点 W2 的 ztunnel 代理接收（可能通过 HBONE 隧道），
但 ztunnel 代理检查目标服务是否需要 Waypoint 处理，但发送此流量的源不是 Waypoint
或者是与此目标服务无关。在这种情况下。ztunnel 代理再次将流量 Hair-pinning 到与目标服务关联的 Waypoint 之一，
然后可以将流量从那里传递到实现目标服务的任何 Pod（可能是 Pod S1 本身，如图所示）。</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:43.80883417813179%><a data-skipendnotes=true href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-hairpin.png title="ztunnel 流量 Hair-pinning"><img class=element-to-stretch src=/v1.20/zh/docs/ops/ambient/usage/ztunnel/ztunnel-hairpin.png alt="ztunnel 流量 Hair-pinning"></a></div><figcaption>ztunnel 流量 Hair-pinning</figcaption></figure><h3 id=hbonesection>关于 HBONE 的说明</h3><p>HBONE（HTTP Based Overlay Network Encapsulation，基于 HTTP 的覆盖网络封装）是 Istio 中特定的术语。
它是指通过 <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/CONNECT>HTTP CONNECT</a>
方法使用标准 HTTP 隧道来透明地传递应用程序数据包/字节流。
在 Istio 的当前实现中，它仅通过使用 HTTP CONNECT 方法透明地隧道传输 TCP 数据包，
使用 <a href=https://httpwg.org/specs/rfc7540.html>HTTP/2</a>，
并通过<a href=https://www.cloudflare.com/learning/access-management/what-is-mutual-tls/>双向 TLS</a>
提供加密和相互身份验证且 HBONE 隧道本身在 TCP 端口 15008 上运行。
来自 IP 层的整体 HBONE 数据包格式如下图所示。</p><figure style=width:100%><div class=wrapper-with-intrinsic-ratio style=padding-bottom:8.038147138964577%><a data-skipendnotes=true href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/hbone-packet.png title="HBONE L3 数据包格式"><img class=element-to-stretch src=/v1.20/zh/docs/ops/ambient/usage/ztunnel/hbone-packet.png alt="HBONE L3 数据包格式"></a></div><figcaption>HBONE L3 数据包格式</figcaption></figure><p>未来 Istio Ambient 还可能利用作为
<a href=https://ietf-wg-masque.github.io/>IETF MASQUE</a>
工作组中一部分开发的 CONNECT-UDP 和 CONNECT-IP 等新标准支持基于
<a href=https://datatracker.ietf.org/doc/html/rfc9114>HTTP/3（QUIC）</a>的传输，
并将用于传输原生 IPv4、IPv6、UDP 等所有类型的 L3 和 L4 数据包。
Istio Ambient 模式下的 HBONE 和 HTTP 隧道的此类附加用例目前还需进一步调研。</p><h2 id=deployapplication>部署应用程序</h2><p>通常，具有 Istio 管理员权限的用户将部署 Istio 网格基础设施。
一旦 Istio 在 Ambient 模式下被成功部署，它将透明地可供命名空间中所有用户部署的应用程序使用，
这些应用程序已被注解为使用 Istio Ambient，如下例所示。</p><h3 id=basic-application-deployment-without-ambient>部署不基于 Ambient 的基础应用程序</h3><p>首先，部署一个简单的 HTTP 客户端服务器应用程序，而不使其成为 Istio Ambient
网格的一部分。如 Istio 指南中所述，从本地 Istio 仓库或通过下载 istioctl
客户端创建的 Istio 文件夹中执行以下示例。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl create ns ambient-demo
$ kubectl apply -f samples/httpbin/httpbin.yaml -n ambient-demo
$ kubectl apply -f samples/sleep/sleep.yaml -n ambient-demo
$ kubectl apply -f samples/sleep/notsleep.yaml -n ambient-demo
$ kubectl scale deployment sleep --replicas=2 -n ambient-demo
</code></pre><p>这些清单部署了 <code>sleep</code> 和 <code>notsleep</code> Pod 的多个副本，
这些副本将被作为 httpbin 服务 Pod 的客户端
（为简单起见，上面的代码示例中的命令行输出已被删除）。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl wait -n ambient-demo --for=condition=ready pod --selector=app=httpbin --timeout=90s
pod/httpbin-648cd984f8-7vg8w condition met
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl get pods -n ambient-demo
NAME                       READY   STATUS    RESTARTS   AGE
httpbin-648cd984f8-7vg8w   1/1     Running   0          31m
notsleep-bb6696574-2tbzn   1/1     Running   0          31m
sleep-69cfb4968f-mhccl     1/1     Running   0          31m
sleep-69cfb4968f-rhhhp     1/1     Running   0          31m
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl get svc httpbin -n ambient-demo
NAME      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
httpbin   ClusterIP   10.110.145.219   &lt;none&gt;        8000/TCP   28m
</code></pre><p>请注意，每个应用程序 Pod 中仅运行 1 个容器（“1/1”指示符），
并且 <code>httpbin</code> 是侦听 <code>ClusterIP</code> 服务端口 8000 的 http 服务。
您现在应该能够从任一客户端 Pod <code>curl</code> 该服务并确认它返回如下所示的 <code>httpbin</code> 网页。
此时，还没有使用任何形式的 <code>TLS</code>。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n ambient-demo  -- curl httpbin:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><h3 id=enabling-ambient-for-an-application>为应用程序启用 Ambient</h3><p>现在，您只需将标签 <code>istio.io/dataplane-mode=ambient</code>
添加到应用程序的命名空间即可为上一小节中部署的应用程序启用 Ambient，如下所示。
请注意，此示例重点关注一个新的命名空间，其中包含仅通过 Ambient 模式捕获的新的、
无 Sidecar 的工作负载。后续章节将说明如何在同一网格内混用 Sidecar
模式和 Ambient 模式的混合场景中解决冲突。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl label namespace ambient-demo istio.io/dataplane-mode=ambient
$ kubectl  get pods -n ambient-demo
NAME                       READY   STATUS    RESTARTS   AGE
httpbin-648cd984f8-7vg8w   1/1     Running   0          78m
notsleep-bb6696574-2tbzn   1/1     Running   0          77m
sleep-69cfb4968f-mhccl     1/1     Running   0          78m
sleep-69cfb4968f-rhhhp     1/1     Running   0          78m
</code></pre><p>请注意，为命名空间启用 Ambient 后，每个应用程序 Pod 仍然只有 1 个容器，
并且这些 Pod 的正常运行时间表明这些 Pod 没有为了启用 Ambient 模式而被重新启动
（与 <code>sidecar</code> 模式不同，当 Sidecar 代理被注入时，它会重新启动应用程序 Pod）。
这会带来更好的用户体验和运维效率，因为就应用程序 Pod 而言，
可以完全透明地无缝启用（或禁用）Ambient 模式。</p><p>再次从客户端 Pod 之一向服务发起 <code>curl</code> 请求，以验证流量在 Ambient 模式下是否继续流动。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n ambient-demo  -- curl httpbin:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><p>这表明流量路径正在工作。下一节将介绍如何监控 ztunnel 代理的配置和数据平面，
以确认流量正确使用 ztunnel 代理。</p><h2 id=monitoringzt>监控 ztunnel 代理和 L4 网络</h2><p>本节介绍一些用于监视 ztunnel 代理配置和数据路径的选项。
此信息还可以帮助进行一些高级故障排除，以及识别在出现任何问题时可在错误报告中收集和提供的有用信息。
ztunnel 内部的其他高级监控和高级故障排除超出了本指南的范围。</p><h3 id=viewing-ztunnel-proxy-state>查看 ztunnel 代理状态</h3><p>如前所述，每个节点上的 ztunnel 代理通过 xDS API 从 istiod 组件获取配置和发现信息。
使用如下所示的 <code>istioctl proxy-config</code> 命令查看 ztunnel 代理发现的工作负载，
以及保存 ztunnel 代理从 istiod 控制平面接收到的 TLS 证书的 Secret，
以代表本地在 mTLS 信令中使用工作负载。</p><p>在第一个示例中，您会看到特定 ztunnel Pod 当前正在跟踪的所有工作负载和控制平面组件，
包括有关连接到该组件时要使用的 IP 地址和协议的信息，
以及是否存在与该工作负载关联的 Waypoint 代理。
可以对系统中的任何其他 ztunnel Pod 重复此示例，以显示其当前配置。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ export ZTUNNEL=$(kubectl get pods -n istio-system -o wide | grep ztunnel -m 1 | sed &#39;s/ .*//&#39;)
$ echo &#34;$ZTUNNEL&#34;
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ istioctl proxy-config workloads &#34;$ZTUNNEL&#34;.istio-system
NAME                                   NAMESPACE          IP         NODE               WAYPOINT PROTOCOL
coredns-6d4b75cb6d-ptbhb               kube-system        10.240.0.2 amb1-control-plane None     TCP
coredns-6d4b75cb6d-tv5nz               kube-system        10.240.0.3 amb1-control-plane None     TCP
httpbin-648cd984f8-2q9bn               ambient-demo       10.240.1.5 amb1-worker        None     HBONE
httpbin-648cd984f8-7dglb               ambient-demo       10.240.2.3 amb1-worker2       None     HBONE
istiod-5c7f79574c-pqzgc                istio-system       10.240.1.2 amb1-worker        None     TCP
local-path-provisioner-9cd9bd544-x7lq2 local-path-storage 10.240.0.4 amb1-control-plane None     TCP
notsleep-bb6696574-r4xjl               ambient-demo       10.240.2.5 amb1-worker2       None     HBONE
sleep-69cfb4968f-mwglt                 ambient-demo       10.240.1.4 amb1-worker        None     HBONE
sleep-69cfb4968f-qjmfs                 ambient-demo       10.240.2.4 amb1-worker2       None     HBONE
ztunnel-5jfj2                          istio-system       10.240.0.5 amb1-control-plane None     TCP
ztunnel-gkldc                          istio-system       10.240.1.3 amb1-worker        None     TCP
ztunnel-xxbgj                          istio-system       10.240.2.2 amb1-worker2       None     TCP
</code></pre><p>在第二个示例中，您会看到此 ztunnel 代理实例从 istiod
接收到的用于 TLS 信令的 TLS 证书列表。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ istioctl proxy-config secrets &#34;$ZTUNNEL&#34;.istio-system
NAME                                                  TYPE           STATUS        VALID CERT     SERIAL NUMBER                        NOT AFTER                NOT BEFORE
spiffe://cluster.local/ns/ambient-demo/sa/httpbin     CA             Available     true           edf7f040f4b4d0b75a1c9a97a9b13545     2023-09-20T19:02:00Z     2023-09-19T19:00:00Z
spiffe://cluster.local/ns/ambient-demo/sa/httpbin     Cert Chain     Available     true           ec30e0e1b7105e3dce4425b5255287c6     2033-09-16T18:26:19Z     2023-09-19T18:26:19Z
spiffe://cluster.local/ns/ambient-demo/sa/sleep       CA             Available     true           3b9dbea3b0b63e56786a5ea170995f48     2023-09-20T19:00:44Z     2023-09-19T18:58:44Z
spiffe://cluster.local/ns/ambient-demo/sa/sleep       Cert Chain     Available     true           ec30e0e1b7105e3dce4425b5255287c6     2033-09-16T18:26:19Z     2023-09-19T18:26:19Z
spiffe://cluster.local/ns/istio-system/sa/istiod      CA             Available     true           885ee63c08ef9f1afd258973a45c8255     2023-09-20T18:26:34Z     2023-09-19T18:24:34Z
spiffe://cluster.local/ns/istio-system/sa/istiod      Cert Chain     Available     true           ec30e0e1b7105e3dce4425b5255287c6     2033-09-16T18:26:19Z     2023-09-19T18:26:19Z
spiffe://cluster.local/ns/istio-system/sa/ztunnel     CA             Available     true           221b4cdc4487b60d08e94dc30a0451c6     2023-09-20T18:26:35Z     2023-09-19T18:24:35Z
spiffe://cluster.local/ns/istio-system/sa/ztunnel     Cert Chain     Available     true           ec30e0e1b7105e3dce4425b5255287c6     2033-09-16T18:26:19Z     2023-09-19T18:26:19Z
</code></pre><p>使用这些 CLI 命令，用户可以检查 ztunnel 代理是否已配置所有预期的工作负载和 TLS 证书，
并且缺失的信息可被用于故障排除，以解释任何潜在的观察到的网络错误。
用户还可以使用 <code>all</code> 选项通过单个 CLI 命令和 JSON
输出格式化程序来查看代理配置的所有内容，如下面例子所示，以显示完整的可用状态信息集。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ istioctl proxy-config all &#34;$ZTUNNEL&#34;.istio-system -o json | jq
</code></pre><p>请注意，与 ztunnel 代理实例一起使用时，并非所有
<code>istioctl proxy-config</code> CLI 的选项都被支持，因为某些选项仅适用于 Sidecar 代理。</p><p>高级用户还可以通过 <code>curl</code> 命令访问 ztunnel 代理 Pod 内的端点查看
ztunnel 代理的原始配置 Dump，如以下示例所示。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec ds/ztunnel -n istio-system  -- curl http://localhost:15000/config_dump | jq .
</code></pre><h3 id=viewing-istiod-state-for-ztunnel-xds-resources>查看 ztunnel xDS 资源的 istiod 状态</h3><p>有时，高级用户可能希望以专门为 ztunnel 代理定义的 xDS API 资源的格式查看 istiod
控制平面中维护的 ztunnel 代理配置资源的状态。这可以通过访问 istiod Pod
并从给定 ztunnel 代理的端口 15014 获取此信息来完成，如下面例子所示。
然后，还可以使用 JSON 漂亮的打印格式化实用程序保存和查看此输出，
以便于浏览（示例中未显示）。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec -n istio-system deploy/istiod -- curl localhost:15014/debug/config_dump?proxyID=&#34;$ZTUNNEL&#34;.istio-system | jq
</code></pre><h3 id=verifying-ztunnel-traffic-logs>验证 ztunnel 流量日志</h3><p>将一些流量从客户端 <code>sleep</code> Pod 发送到 <code>httpbin</code> 服务。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl -n ambient-demo exec deploy/sleep -- sh -c &#39;for i in $(seq 1 10); do curl -s -I http://httpbin:8000/; done&#39;
HTTP/1.1 200 OK
Server: gunicorn/19.9.0
--snip--
</code></pre><p>上述响应确认了客户端 Pod 收到来自服务的响应。
现在检查 ztunnel Pod 的日志以确认流量是通过 HBONE 隧道发送的。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl -n istio-system logs -l app=ztunnel | grep -E &#34;inbound|outbound&#34;
2023-08-14T09:15:46.542651Z  INFO outbound{id=7d344076d398339f1e51a74803d6c854}: ztunnel::proxy::outbound: proxying to 10.240.2.10:80 using node local fast path
2023-08-14T09:15:46.542882Z  INFO outbound{id=7d344076d398339f1e51a74803d6c854}: ztunnel::proxy::outbound: complete dur=269.272µs
--snip--
</code></pre><p>这些日志消息确认流量确实使用了数据路径中的 ztunnel 代理。
可以通过检查与流量源和目标 Pod 位于同一节点上的特定 ztunnel
代理实例上的日志来完成额外的细粒度监控。如果没有看到这些日志，
则可能是流量重定向无法正常工作。流量重定向逻辑的监控和故障排除的详细描述超出了本指南的范围。
请注意，如前所述，即使流量的源和目标位于同一计算节点上，Ambient 流量也始终会遍历 ztunnel Pod。</p><h3 id=monitoring-and-telemetry-via-prometheus-grafana-kiali>通过 Prometheus、Grafana、Kiali 进行监控和遥测</h3><p>除了检查 ztunnel 日志和上述其他监控选项之外，还可以使用普通的 Istio
监控和遥测功能来监控 Istio Ambient 网格内的应用程序流量。
在 Ambient 模式下使用 Istio 不会改变此行为。由于此功能在 Istio Ambient 模式下与
Istio Sidecar 模式基本没有变化，因此本指南中不再重复这些细节。
请参阅 <a href=/v1.20/zh/docs/ops/integrations/prometheus/#installation>Prometheus 服务和仪表板的安装信息</a>、
<a href=/v1.20/zh/docs/ops/integrations/kiali/#installation>Kiali 服务和仪表板的安装信息</a>、
<a href=/v1.20/zh/docs/reference/config/metrics/>标准的 Istio 指标文档</a>和
<a href=/v1.20/zh/docs/tasks/observability/metrics/querying-metrics/>Istio 遥测文档</a>。</p><p>需要注意的一点是，如果服务仅使用 ztunnel 和 L4 网络，
则报告的 Istio 指标目前仅是 L4/TCP 指标（即 <code>istio_tcp_sent_bytes_total</code>、
<code>istio_tcp_received_bytes_total</code>、<code>istio_tcp_connections_opened_total</code>、
<code>istio_tcp_connections_filled_total</code>）。
当涉及 Waypoint 代理时，将报告全套 Istio 和 Envoy 指标。</p><h3 id=verifying-ztunnel-load-balancing>验证 ztunnel 负载平衡</h3><p>如果目标是具有多个端点的服务，ztunnel 代理会自动执行客户端负载均衡。
无需额外配置。ztunnel 负载均衡算法是内部固定的 L4 循环算法，
根据 L4 连接状态分配流量，用户不可配置。</p><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-tip"/></svg></div><div class=content>如果目标是具有多个实例或 Pod 的服务，并且没有与目标服务关联的 Waypoint，
则源 ztunnel 代理直接跨越这些实例或服务后端执行 L4 负载均衡，
然后通过远程 ztunnel 代理与这些后端发送流量。如果目标服务确实具有与其关联的
Waypoint 部署（具有一个或多个 Waypoint 代理的后端实例），
则源 ztunnel 代理通过在这些 Waypoint 代理之间分配流量来执行负载均衡，
并通过远程 ztunnel 代理与关联的 Waypoint 代理实例发送流量。</div></aside></div><p>现在，使用多副本服务 Pod 重复前面的示例，
并验证客户端流量是否在服务副本之间实现负载均衡。
等待 ambient-demo 命名空间中的所有 Pod 进入 Running 状态，然后再继续下一步。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl -n ambient-demo scale deployment httpbin --replicas=2 ; kubectl wait --for condition=available  deployment/httpbin -n ambient-demo
deployment.apps/httpbin scaled
deployment.apps/httpbin condition met
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl -n ambient-demo exec deploy/sleep -- sh -c &#39;for i in $(seq 1 10); do curl -s -I http://httpbin:8000/; done&#39;
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl -n istio-system logs -l app=ztunnel | grep -E &#34;inbound|outbound&#34;
--snip--

2023-08-14T09:33:24.969996Z  INFO inbound{id=ec177a563e4899869359422b5cdd1df4 peer_ip=10.240.2.16 peer_id=spiffe://cluster.local/ns/ambient-demo/sa/sleep}: ztunnel::proxy::inbound: got CONNECT request to 10.240.1.11:80
2023-08-14T09:33:25.028601Z  INFO inbound{id=1ebc3c7384ee68942bbb7c7ed866b3d9 peer_ip=10.240.2.16 peer_id=spiffe://cluster.local/ns/ambient-demo/sa/sleep}: ztunnel::proxy::inbound: got CONNECT request to 10.240.1.11:80

--snip--

2023-08-14T09:33:25.226403Z  INFO outbound{id=9d99723a61c9496532d34acec5c77126}: ztunnel::proxy::outbound: proxy to 10.240.1.11:80 using HBONE via 10.240.1.11:15008 type Direct
2023-08-14T09:33:25.273268Z  INFO outbound{id=9d99723a61c9496532d34acec5c77126}: ztunnel::proxy::outbound: complete dur=46.9099ms
2023-08-14T09:33:25.276519Z  INFO outbound{id=cc87b4de5ec2ccced642e22422ca6207}: ztunnel::proxy::outbound: proxying to 10.240.2.10:80 using node local fast path
2023-08-14T09:33:25.276716Z  INFO outbound{id=cc87b4de5ec2ccced642e22422ca6207}: ztunnel::proxy::outbound: complete dur=231.892µs

--snip--
</code></pre><p>请注意来自 ztunnel 代理的日志，首先表明了对新目标 Pod（10.240.1.11）的
http CONNECT 请求，该请求指示在托管其他目标服务 Pod 的节点上设置到
ztunnel 的 HBONE 隧道。接下来的日志表明了客户端流量被发送到 10.240.1.11
和 10.240.2.10，这是提供服务的两个目标 Pod。另请注意，在这种情况下，
数据路径正在执行客户端负载均衡，而不是依赖于 Kubernetes 服务负载均衡。
在您的设置中，这些数字将有所不同，并将与集群中 httpbin Pod 的地址匹配。</p><p>这是一种循环负载均衡算法，并且独立于可以在 <code>VirtualService</code> 的 <code>TrafficPolicy</code>
字段中配置的任何负载均衡算法，因为如前所述，<code>VirtualService</code> API
对象的所有方面都被实例化 在 Waypoint 代理上而不是 ztunnel 代理上。</p><h3 id=pod-selection-logic-for-ambient-and-sidecar-modes>Ambient 模式和 Sidecar 模式的 Pod 选择逻辑</h3><p>具有 Sidecar 代理的 Istio 可以与同一计算集群中基于 Ambient 的节点级代理共存。
确保相同的 Pod 或命名空间不会配置为同时使用 Sidecar 代理和 Ambient 节点级代理非常重要。
但是，如果确实发生这种情况，当前此类 Pod 或命名空间将优先进行 Sidecar 注入。</p><p>请注意，理论上，可以通过将各个 Pod 与命名空间标签分开标记来将同一命名空间中的两个
Pod 设置为使用不同的模式，但不建议这样做。对于大多数常见用例，
建议对单个命名空间内的所有 Pod 使用单一模式。</p><p>确定 Pod 是否设置为使用 Ambient 模式的确切逻辑如下。</p><ol><li>在 <code>cni.values.excludeNamespaces</code> 配置中的
<code>istio-cni</code> 插件配置排除列表用于跳过排除列表中的命名空间。</li><li>Pod 已使用 <code>ambient</code> 模式，如果：</li></ol><ul><li>命名空间具有 <code>istio.io/dataplane-mode=ambient</code> 标签</li><li>Pod 上不存在 <code>sidecar.istio.io/status</code> 注解</li><li><code>ambient.istio.io/redirection</code> 不是 <code>disabled</code></li></ul><p>避免配置冲突的最简单选项是用户确保对于每个命名空间，
它要么具有 Sidecar 注入标签（<code>istio-injection=enabled</code>），
要么具有 Ambient 数据平面模式标签（<code>istio.io/dataplane- mode=ambient</code>），
但绝不能两者兼而有之。</p><h2 id=l4auth>L4 鉴权策略</h2><p>如前面所述，ztunnel 代理在仅需要 L4
流量处理以便在数据平面中实施策略并且不涉及 Waypoint 时执行鉴权策略。
实际的执行点位于连接路径中的接收端（或服务器端）ztunnel 代理。</p><p>为已部署的 <code>httpbin</code> 应用程序应用基本的 L4 鉴权策略，如下面例子所示。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -n ambient-demo -f - &lt;&lt;EOF
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
 name: allow-sleep-to-httpbin
spec:
 selector:
   matchLabels:
     app: httpbin
 action: ALLOW
 rules:
 - from:
   - source:
       principals:
       - cluster.local/ns/ambient-demo/sa/sleep
EOF
</code></pre><p><code>AuthorizationPolicy</code> API 的行为在 Istio Ambient 模式下与 Sidecar
模式下具有相同的功能行为。当没有配置 <code>AuthorizationPolicy</code> 时，默认操作是 <code>ALLOW</code>。
配置上述策略后，与策略中的 Selector（即 app:httpbin）匹配的 Pod 仅允许明确列入白名单的流量，
在本例中是主体（即身份）为 <code>cluster.local/ns/ambient-demo/sa/sleep</code> 的源。
现在如下所示，如果您尝试从 <code>sleep</code> Pod 对 <code>httpbin</code> 服务执行curl 操作，它仍然有效，
但从 <code>notsleep</code> Pod 发起时，相同的操作会被阻止。</p><p>请注意，此策略对来自主体（即身份）为 <code>cluster.local/ns/ambient-demo/sa/sleep</code>
的源的流量执行显式 <code>ALLOW</code> 操作，因此来自所有其他源的流量将被拒绝。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n ambient-demo -- curl httpbin:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/notsleep -n ambient-demo -- curl httpbin:8000 -s | grep title -m 1
command terminated with exit code 56
</code></pre><p>请注意，Waypoint 代理并未被部署，但此 <code>AuthorizationPolicy</code> 正在被强制执行，
这是因为此策略仅需要可由 ztunnel 代理执行的 L4 流量处理。
可以通过检查 ztunnel 日志并查找指示 RBAC 操作的日志来进一步确认这些策略操作，
如以下示例所示。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl logs ds/ztunnel -n istio-system  | grep -E RBAC
-- snip --
2023-10-10T23:14:00.534962Z  INFO inbound{id=cc493da5e89877489a786fd3886bd2cf peer_ip=10.240.2.2 peer_id=spiffe://cluster.local/ns/ambient-demo/sa/notsleep}: ztunnel::proxy::inbound: RBAC rejected conn=10.240.2.2(spiffe://cluster.local/ns/ambient-demo/sa/notsleep)-&gt;10.240.1.2:80
2023-10-10T23:15:33.339867Z  INFO inbound{id=4c4de8de802befa5da58a165a25ff88a peer_ip=10.240.2.2 peer_id=spiffe://cluster.local/ns/ambient-demo/sa/notsleep}: ztunnel::proxy::inbound: RBAC rejected conn=10.240.2.2(spiffe://cluster.local/ns/ambient-demo/sa/notsleep)-&gt;10.240.1.2:80
</code></pre><div><aside class="callout warning"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-warning"/></svg></div><div class=content>如果配置的 <code>AuthorizationPolicy</code> 需要 L4 之外的任何流量处理，
并且没有为流量的目标配置 Waypoint 代理，则 ztunnel 代理将简单地丢弃所有流量作为防御措施。
因此，请检查以确保所有规则仅涉及 L4 处理，否则如果非 L4 规则不可避免，
则还配置 Waypoint 代理来处理执行策略。</div></aside></div><p>例如，修改 <code>AuthorizationPolicy</code> 以包含对 HTTP GET 方法的检查，
如下所示。现在请注意，<code>sleep</code> 和 <code>notsleep</code> Pod 都会被阻止向目标 <code>httpbin</code> 服务发送流量。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -n ambient-demo -f - &lt;&lt;EOF
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
 name: allow-sleep-to-httpbin
spec:
 selector:
   matchLabels:
     app: httpbin
 action: ALLOW
 rules:
 - from:
   - source:
       principals:
       - cluster.local/ns/ambient-demo/sa/sleep
   to:
   - operation:
       methods: [&#34;GET&#34;]
EOF
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n ambient-demo -- curl httpbin:8000 -s | grep title -m 1
command terminated with exit code 56
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/notsleep -n ambient-demo -- curl httpbin:8000 -s | grep title -m 1
command terminated with exit code 56
</code></pre><p>您还可以通过查看特定 ztunnel 代理 Pod 的日志（此处示例中未显示）来进行确认，
实际执行策略的始终是托管目标 Pod 节点上的 ztunnel 代理。</p><p>在继续本指南中的其余示例之前，请先删除此 <code>AuthorizationPolicy</code>。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl delete AuthorizationPolicy allow-sleep-to-httpbin  -n ambient-demo
</code></pre><h2 id=interop>Ambient 与非 Ambient 端点的互操作性</h2><p>到目前为止的用例中，流量源和目标 Pod 都是 Ambient Pod。
本节介绍一些混合用例，其中 Ambient 端点需要与非 Ambient 端点进行通信。
与本指南前面的示例一样，本节介绍的用例不需要 Waypoint 代理。</p><ol><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#ewnonmesh>东西向非网格 Pod 到 Ambient 网格 Pod（以及使用 <code>PeerAuthentication</code> 资源）</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#ewside2ambient>东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod</a></li><li><a href=/v1.20/zh/docs/ops/ambient/usage/ztunnel/#nsingress2ambient>南北入口网关到 Ambient 后端 Pod</a></li></ol><h3 id=ewnonmesh>东西向非网格 Pod 到 Ambient 网格 Pod（以及 PeerAuthentication 资源的使用）</h3><p>在下面的示例中，通过在不属于 Istio 网格的单独命名空间中运行的客户端
<code>sleep</code> Pod 访问前面示例中已设置的相同 <code>httpbin</code> 服务。
此示例显示 Ambient 网格 Pod 和非网格 Pod 之间的东西向流量得到无缝支持。
请注意，如前面所述，此用例利用了 Ambient 的流量 Hair-pinning 功能。
由于非网格 Pod 直接向后端 Pod 发起流量，而不经过 HBONE 或 ztunnel，
因此在目标节点，流量将通过目标节点的 ztunnel 代理进行重定向，
以确保应用 Ambient 鉴权策略（这可以通过以下方式验证，查看目标节点上相应
ztunnel 代理 Pod 的日志；为简单起见，下面的示例代码片段中未显示日志）。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl create namespace client-a
$ kubectl apply -f samples/sleep/sleep.yaml -n client-a
$ kubectl wait --for condition=available  deployment/sleep -n client-a
</code></pre><p>等待 Pod 在 client-a 命名空间中进入 Running 状态，然后再继续。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n client-a  -- curl httpbin.ambient-demo.svc.cluster.local:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><p>如下面的示例所示，现在在 Ambient 命名空间中添加 mTLS 模式并设置为
<code>STRICT</code> 的 <code>PeerAuthentication</code> 资源，确认同一客户端的流量现在被拒绝，
并出现一条指示请求被拒绝的错误。这是因为客户端使用简单的 HTTP 连接到服务器，
而不是使用 mTLS 的 HBONE 隧道。这是一种可用于防止非
Istio 源向 Istio Ambient Pod 发送流量的可能方法。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -n ambient-demo -f - &lt;&lt;EOF
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: peerauth
spec:
  mtls:
    mode: STRICT
EOF
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n client-a  -- curl httpbin.ambient-demo.svc.cluster.local:8000 -s | grep title -m 1
command terminated with exit code 56
</code></pre><p>将 mTLS 模式更改为 <code>PERMISSIVE</code>，并确认 Ambient Pod
可以再次接受非 mTLS 连接，包括本例中来自非网格 Pod 的连接。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -n ambient-demo -f - &lt;&lt;EOF
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: peerauth
spec:
  mtls:
    mode: PERMISSIVE
EOF
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n client-a  -- curl httpbin.ambient-demo.svc.cluster.local:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><h3 id=ewside2ambient>东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod</h3><p>此用例是使用 Sidecar 代理的 Istio Pod 与同一网格内的
Ambient Pod 之间的无缝东西向流量互操作性。</p><p>使用与上一个示例相同的 httpbin 服务，但现在添加一个客户端以从另一个标记为
Sidecar 注入的命名空间访问此服务。这也会自动且透明地工作，如下面例子所示。
在这种情况下，与客户端一起运行的 Sidecar 代理会自动知道使用 HBONE 控制平面，
因为已发现目的地是 HBONE 目标。用户无需进行任何特殊配置即可启用此功能。</p><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-tip"/></svg></div><div class=content>为了使 Sidecar 代理在与 Ambient 目标通信时使用 HBONE/mTLS 信号选项，
需要在代理元数据中进行配置，将 <code>ISTIO_META_ENABLE_HBONE</code> 设置为 true。
使用 <code>ambient</code> 配置文件时，会在 <code>MeshConfig</code> 中自动为用户设置默认值，
因此用户在使用此配置文件时无需执行任何其他操作。</div></aside></div><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl create ns client-b
$ kubectl label namespace client-b istio-injection=enabled
$ kubectl apply -f samples/sleep/sleep.yaml -n client-b
$ kubectl wait --for condition=available  deployment/sleep -n client-b
</code></pre><p>等待 Pod 在 client-b 命名空间中进入 Running 状态，然后再继续。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl exec deploy/sleep -n client-b  -- curl httpbin.ambient-demo.svc.cluster.local:8000 -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><p>同样，通过查看目标节点上 ztunnel Pod（示例中未显示）的日志，
可以进一步验证流量实际上确实使用从基于 Sidecar 代理的源客户端 Pod
到基于 HBONE 和 CONNECT 的 Ambient 路径的目标服务。
另外未显示，但也可以验证与前一小节不同，在这种情况下，即使您将 <code>PeerAuthentication</code>
资源应用于标记为 Ambient 模式的命名空间，客户端和服务 Pod 之间的通信也会继续，
因为两者都使用依赖 mTLS 的 HBONE 控制面和数据面。</p><h3 id=nsingress2ambient>南北入口网关到 Ambient 后端 Pod</h3><p>本节介绍了南北流量的用例，其中 Istio 网关通过 Kubernetes Gateway API
公开 httpbin 服务。网关本身在非 Ambient 命名空间中运行，
并且可能是一个现有网关，并公开非 Ambient Pod 提供的其他服务。
因此，此示例表明 Ambient 工作负载还可以与 Istio 网关进行互操作，
而 Istio 网关本身不需要在标记为 Ambient 操作模式的命名空间中运行。</p><p>对于此示例，您可以使用 <code>metallb</code> 在可以从集群外部访问的 IP 地址上提供负载均衡器服务。
同一示例还适用于其他形式的南北负载均衡选项。
下面的示例假设您已经在此集群中安装了 <code>metallb</code> 来提供负载均衡器服务，
其中包括 <code>metallb</code> 的 IP 地址池，以用于向外部公开服务。
请参阅 <a href=https://kind.sigs.k8s.io/docs/user/loadbalancer/><code>metallb</code> kind 指南</a>，
了解有关在 kind 集群上设置 <code>metallb</code> 的说明，或参阅适用于您环境的
<a href=https://metallb.universe.tf/installation/><code>metallb</code> 文档</a>。</p><p>此示例使用 Kubernetes Gateway API 来配置南北网关。
由于 Kubernetes 和 kind 发行版中当前未默认提供此 API，
因此您必须首先安装 API CRD，如示例中所示。</p><p>然后，将部署使用 Kubernetes Gateway API CRD 的 <code>Gateway</code> 实例，
以利用此 <code>metallb</code> 负载均衡器服务。在此示例中，
Gateway 的实例在 istio-system 命名空间中运行，表示在非 Ambient
命名空间中运行的现有网关。最后，将为 <code>HTTPRoute</code> 配置一个后端引用，
该引用指向在 ambient-demo 命名空间中的 Ambient Pod 上运行的现有 httpbin 服务。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl get crd gateways.gateway.networking.k8s.io &amp;&gt; /dev/null || \
      { kubectl kustomize &#34;github.com/kubernetes-sigs/gateway-api/config/crd/experimental?ref=v0.6.1&#34; | kubectl apply -f -; }
</code></pre><div><aside class="callout tip"><div class=type><svg class="large-icon"><use xlink:href="/v1.20/img/icons.svg#callout-tip"/></svg></div><div class=content>Istio 包括了对 Kubernetes <a href=https://gateway-api.sigs.k8s.io/>Gateway API</a> 的 Beta 支持，
打算<a href=/v1.20/zh/blog/2022/gateway-api-beta/>未来</a>使其成为流量管理的默认 API。
以下说明指导您在网格中配置流量管理时如何选择使用 Gateway API 或 Istio 配置 API。
请按照您的首选项遵循 <code>Gateway API</code> 或 <code>Istio APIs</code> 页签中的指示说明。</div></aside></div><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -f - &lt;&lt; EOF
apiVersion: gateway.networking.k8s.io/v1beta1
kind: Gateway
metadata:
  name: httpbin-gateway
  namespace: istio-system
spec:
  gatewayClassName: istio
  listeners:
  - name: http
    port: 80
    protocol: HTTP
    allowedRoutes:
      namespaces:
        from: All
EOF
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl apply -n ambient-demo -f - &lt;&lt; EOF
apiVersion: gateway.networking.k8s.io/v1beta1
kind: HTTPRoute
metadata:
  name: httpbin
spec:
  parentRefs:
  - name: httpbin-gateway
    namespace: istio-system
  rules:
  - backendRefs:
    - name: httpbin
      port: 8000
EOF
</code></pre><p>接下来找到网关正在侦听的外部服务 IP 地址，
然后从集群外部访问该 IP 地址（下面例子中的 172.18.255.200）上的 httpbin 服务，如下所示。</p><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ kubectl get service httpbin-gateway-istio -n istio-system
NAME                    TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)                        AGE
httpbin-gateway-istio   LoadBalancer   10.110.30.25   172.18.255.200   15021:32272/TCP,80:30159/TCP   121m
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ export INGRESS_HOST=$(kubectl -n istio-system get service httpbin-gateway-istio  -o jsonpath=&#39;{.status.loadBalancer.ingress[0].ip}&#39;)
$ echo &#34;$INGRESS_HOST&#34;
172.18.255.200
</code></pre><pre><code class=language-bash data-expandlinks=true data-repo=istio>$ curl  &#34;$INGRESS_HOST&#34; -s | grep title -m 1
    &lt;title&gt;httpbin.org&lt;/title&gt;
</code></pre><p>这些示例说明了 Ambient Pod 和非 Ambient 端点
（可以是 Kubernetes 应用 Pod 或具有 Istio 原生网关和 Kubernetes Gateway API 实例的 Istio 网关 Pod）
之间的互操作性的多种选项。Istio Ambient Pod 和 Istio Egress 网关之间也支持互操作性，
以及 Ambient Pod 运行应用程序的客户端且服务端运行在使用 Sidecar 代理模式的网格 Pod 之外的场景。
因此，用户有多种选择可以在同一 Istio 网格中无缝集成 Ambient 和非 Ambient 工作负载，
从而允许以最适合 Istio 网格部署和操作的需求分阶段引入 Ambient 功能。</p></article><nav class=pagenav><div class=left><a title="使用 Waypoint 代理的 Istio Ambient L7 网络和服务的用户指南。" href=/v1.20/zh/docs/ops/ambient/usage/waypoint/ class=next-link><svg class="icon left-arrow"><use xlink:href="/v1.20/img/icons.svg#left-arrow"/></svg>带有 Waypoint 的 L7 网络和服务</a></div><div class=right></div></nav><div id=feedback><div id=feedback-initial>这些信息有用吗？<br><button class="btn feedback" onclick='sendFeedback("zh",1)'>是的</button>
<button class="btn feedback" onclick='sendFeedback("zh",0)'>没有</button></div><div id=feedback-comment>您是否有更多建议和改进意见？<br><br><input id=feedback-textbox type=text placeholder=帮助我们进行改进... data-lang=zh></div><div id=feedback-thankyou>感谢您的反馈！</div></div><div id=endnotes-container aria-hidden=true><h2>链接</h2><ol id=endnotes></ol></div></div><div class=toc-container><nav class=toc aria-label="Table of Contents"><div id=toc><ol><li role=none aria-label="简介 "><a href=#introsection>简介</a><li role=none aria-label="当前注意事项 "><a href=#caveats>当前注意事项</a><ol><li role=none aria-label="本指南使用的环境 "><a href=#environment-used-for-this-guide>本指南使用的环境</a></ol></li><li role=none aria-label="功能概述 "><a href=#functionaloverview>功能概述</a><ol><li role=none aria-label="控制平面概述 "><a href=#control-plane-overview>控制平面概述</a><li role=none aria-label="数据平面概述 "><a href=#data-plane-overview>数据平面概述</a><ol><li role=none aria-label="ztunnel 到 ztunnel 数据路径 "><a href=#ztunnel-to-ztunnel-datapath>ztunnel 到 ztunnel 数据路径</a><li role=none aria-label="通过 Waypoint 的 ztunnel 数据路径 "><a href=#ztunnel-datapath-via-waypoint>通过 Waypoint 的 ztunnel 数据路径</a><li role=none aria-label="ztunnel 数据路径 Hair-pinning "><a href=#ztunnel-datapath-hair-pinning>ztunnel 数据路径 Hair-pinning</a></ol></li><li role=none aria-label="关于 HBONE 的说明 "><a href=#hbonesection>关于 HBONE 的说明</a></ol></li><li role=none aria-label="部署应用程序 "><a href=#deployapplication>部署应用程序</a><ol><li role=none aria-label="部署不基于 Ambient 的基础应用程序 "><a href=#basic-application-deployment-without-ambient>部署不基于 Ambient 的基础应用程序</a><li role=none aria-label="为应用程序启用 Ambient "><a href=#enabling-ambient-for-an-application>为应用程序启用 Ambient</a></ol></li><li role=none aria-label="监控 ztunnel 代理和 L4 网络 "><a href=#monitoringzt>监控 ztunnel 代理和 L4 网络</a><ol><li role=none aria-label="查看 ztunnel 代理状态 "><a href=#viewing-ztunnel-proxy-state>查看 ztunnel 代理状态</a><li role=none aria-label="查看 ztunnel xDS 资源的 istiod 状态 "><a href=#viewing-istiod-state-for-ztunnel-xds-resources>查看 ztunnel xDS 资源的 istiod 状态</a><li role=none aria-label="验证 ztunnel 流量日志 "><a href=#verifying-ztunnel-traffic-logs>验证 ztunnel 流量日志</a><li role=none aria-label="通过 Prometheus、Grafana、Kiali 进行监控和遥测 "><a href=#monitoring-and-telemetry-via-prometheus-grafana-kiali>通过 Prometheus、Grafana、Kiali 进行监控和遥测</a><li role=none aria-label="验证 ztunnel 负载平衡 "><a href=#verifying-ztunnel-load-balancing>验证 ztunnel 负载平衡</a><li role=none aria-label="Ambient 模式和 Sidecar 模式的 Pod 选择逻辑 "><a href=#pod-selection-logic-for-ambient-and-sidecar-modes>Ambient 模式和 Sidecar 模式的 Pod 选择逻辑</a></ol></li><li role=none aria-label="L4 鉴权策略 "><a href=#l4auth>L4 鉴权策略</a><li role=none aria-label="Ambient 与非 Ambient 端点的互操作性 "><a href=#interop>Ambient 与非 Ambient 端点的互操作性</a><ol><li role=none aria-label="东西向非网格 Pod 到 Ambient 网格 Pod（以及 PeerAuthentication 资源的使用） "><a href=#ewnonmesh>东西向非网格 Pod 到 Ambient 网格 Pod（以及 PeerAuthentication 资源的使用）</a><li role=none aria-label="东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod "><a href=#ewside2ambient>东西向 Istio Sidecar 代理 Pod 到 Ambient 网格 Pod</a><li role=none aria-label="南北入口网关到 Ambient 后端 Pod "><a href=#nsingress2ambient>南北入口网关到 Ambient 后端 Pod</a></ol></li></ol></div></nav></div></main><footer class=footer><div class="footer-wrapper container-l"><div class="user-links footer-links"><a class=channel title='Istio 的代码在 GitHub 上开发' href=https://github.com/istio/community aria-label=GitHub><svg class="icon github"><use xlink:href="/v1.20/img/icons.svg#github"/></svg>
</a><a class=channel title='如果您想深入了解 Istio 的技术细节，请查看我们日益完善的设计文档' href=https://groups.google.com/forum/#!forum/istio-team-drive-access aria-label="team drive"><svg class="icon drive"><use xlink:href="/v1.20/img/icons.svg#drive"/></svg>
</a><a class=channel title='在 Slack 上与 Istio 社区交互讨论开发问题（仅限邀请）' href=https://slack.istio.io aria-label=slack><svg class="icon slack"><use xlink:href="/v1.20/img/icons.svg#slack"/></svg>
</a><a class=channel title='Stack Overflow 中列举了针对实际问题以及部署、配置和使用 Istio 的各项回答' href=https://stackoverflow.com/questions/tagged/istio aria-label="Stack Overflow"><svg class="icon stackoverflow"><use xlink:href="/v1.20/img/icons.svg#stackoverflow"/></svg>
</a><a class=channel title='关注我们的 Twitter 来获取最新信息' href=https://twitter.com/IstioMesh aria-label=Twitter><svg class="icon twitter"><use xlink:href="/v1.20/img/icons.svg#twitter"/></svg></a></div><hr class=footer-separator role=separator><div class="info footer-info"><a class=logo href=/v1.20/zh/ aria-label=logotype><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371A7.869 7.869.0 01114 30.56a9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></a><div class=footer-languages><a tabindex=-1 lang=en id=switch-lang-en class=footer-languages-item>English
</a><a tabindex=-1 lang=zh id=switch-lang-zh class="footer-languages-item active"><svg class="icon tick"><use xlink:href="/v1.20/img/icons.svg#tick"/></svg>
中文</a></div></div><ul class=footer-policies><li class=footer-policies-item><a class=footer-policies-link href=https://www.linuxfoundation.org/legal/terms>条款
</a>|
<a class=footer-policies-link href=https://www.linuxfoundation.org/legal/privacy-policy>隐私政策
</a>|
<a class=footer-policies-link href=https://www.linuxfoundation.org/legal/trademark-usage>商标
</a>|
<a class=footer-policies-link href=https://github.com/istio/istio.io/edit/release-1.20/content/zh/index>在 GitHub 上编辑此页</a></li></ul><div class=footer-base><span class=footer-base-copyright>&copy; 2024 the Istio Authors.</span>
<span class=footer-base-version>部分内容可能滞后于英文版本，同步工作正在进行中<br>版本
Istio 归档
1.20.3</span><ul class=footer-base-releases><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link onclick='return navigateToUrlOrRoot("https://istio.io/docs/ops/ambient/usage/ztunnel/"),!1'>当前版本</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link onclick='return navigateToUrlOrRoot("https://preliminary.istio.io/docs/ops/ambient/usage/ztunnel/"),!1'>下个版本</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link href=https://istio.io/archive>旧版本</a></li></ul></div></div></footer><div id=scroll-to-top-container aria-hidden=true><button id=scroll-to-top title=回到顶部 tabindex=-1><svg class="icon top"><use xlink:href="/v1.20/img/icons.svg#top"/></svg></button></div></body></html>