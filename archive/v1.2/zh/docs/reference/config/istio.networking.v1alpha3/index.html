<!doctype html><html lang=zh itemscope itemtype=https://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content=#466BB0><meta name=title content=é€šä¿¡è·¯ç”±><meta name=description content=æµé‡è·¯ç”±é…ç½®ã€‚><meta name=keywords content=microservices,services,mesh><meta property=og:title content=é€šä¿¡è·¯ç”±><meta property=og:type content=website><meta property=og:description content=æµé‡è·¯ç”±é…ç½®ã€‚><meta property=og:url content=/v1.2/zh/docs/reference/config/istio.networking.v1alpha3/><meta property=og:image content=/v1.2/img/istio-whitelogo-bluebackground-framed.svg><meta property=og:image:alt content="Istio Logo"><meta property=og:image:width content=112><meta property=og:image:height content=150><meta property=og:site_name content=Istio><meta name=twitter:card content=summary><meta name=twitter:site content=@IstioMesh><title>Istioldie 1.2 / é€šä¿¡è·¯ç”±</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98480406-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-98480406-2');</script><link rel=alternate type=application/rss+xml title="Istio Blog" href=/v1.2/feed.xml><link rel="shortcut icon" href=/v1.2/favicons/favicon.ico><link rel=apple-touch-icon href=/v1.2/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/v1.2/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/v1.2/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/v1.2/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/v1.2/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/v1.2/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/v1.2/favicons/android-96x96.png sizes=96xW96><link rel=icon type=image/png href=/v1.2/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/v1.2/favicons/android-192x192.png sizes=192x192><link rel=manifest href=/v1.2/manifest.json><meta name=apple-mobile-web-app-title content=Istio><meta name=application-name content=Istio><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Work+Sans:400|Chivo:400|Work+Sans:500,300,600,300italic,400italic,500italic,600italic|Chivo:500,300,600,300italic,400italic,500italic,600italic"><link rel=stylesheet href=/v1.2/css/all.css><script src=/v1.2/js/themes_init.min.js></script></head><body class="language-unknown archive-site"><script>const branchName="release-1.2";const docTitle="é€šä¿¡è·¯ç”±";const iconFile="\/v1.2/img/icons.svg";const buttonCopy='å¤åˆ¶åˆ°å‰ªåˆ‡æ¿';const buttonPrint='æ‰“å°';const buttonDownload='ä¸‹è½½';</script><script src="https://www.google.com/cse/brand?form=search-form" defer></script><script src=/v1.2/js/all.min.js data-manual defer></script><header><nav><a id=brand href=/v1.2/zh/><span class=logo><svg viewBox="0 0 300 300"><circle cx="150" cy="150" r="146" stroke-width="2" /><path d="M65 240H225L125 270z"/><path d="M65 230l60-10V110z"/><path d="M135 220l90 10L135 30z"/></svg></span><span class=name>Istioldie 1.2</span></a><div id=hamburger><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#hamburger"/></svg></div><div id=header-links><span title="äº†è§£å¦‚ä½•éƒ¨ç½²ã€ä½¿ç”¨å’Œè¿ç»´ Istioã€‚">æ–‡æ¡£</span>
<a title="å…³äºä½¿ç”¨ Istio çš„åšå®¢æ–‡ç« ã€‚" href=/v1.2/zh/blog/2019/announcing-1.1.3/>åšå®¢</a>
<a title=å…³äºIstioçš„å¸¸è§é—®é¢˜ã€‚ href=/v1.2/zh/faq/>FAQ</a>
<a title=å…³äºIstioçš„è¯´æ˜ã€‚ href=/v1.2/zh/about/>å…³äº</a><div class=menu><button id=gearDropdownButton class=menu-trigger title=é€‰é¡¹å’Œè®¾ç½® aria-label="Options and Settings" aria-controls=gearDropdownContent><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#gear"/></svg></button><div id=gearDropdownContent class=menu-content aria-labelledby=gearDropdownButton role=menu><a tabindex=-1 role=menuitem lang=en id=switch-lang-en>English</a>
<a tabindex=-1 role=menuitem lang=zh id=switch-lang-zh class=active>ä¸­æ–‡</a><div role=separator></div><a tabindex=-1 role=menuitem class=active id=light-theme-item>äº®ä¸»é¢˜</a>
<a tabindex=-1 role=menuitem id=dark-theme-item>æš—ä¸»é¢˜</a><div role=separator></div><a tabindex=-1 role=menuitem id=syntax-coloring-item>ä»£ç é«˜äº®</a><div role=separator></div><h6>æœ¬ç«™çš„å…¶å®ƒç‰ˆæœ¬</h6><a tabindex=-1 role=menuitem onclick="navigateToUrlOrRoot('https://istio.io/docs\/reference\/config\/istio.networking.v1alpha3\/');return false;">å½“å‰ç‰ˆæœ¬</a>
<a tabindex=-1 role=menuitem onclick="navigateToUrlOrRoot('https://preliminary.istio.io/docs\/reference\/config\/istio.networking.v1alpha3\/');return false;">ä¸‹ä¸ªç‰ˆæœ¬</a>
<a tabindex=-1 role=menuitem href=https://archive.istio.io>æ—§ç‰ˆæœ¬</a></div></div><button id=search-show title=æœç´¢istio.io aria-label=Search><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#magnifier"/></svg></button></div><form id=search-form name=cse role=search><input type=hidden name=cx value=013699703217164175118:iwwf17ikgf4>
<input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=en>
<input type=hidden id=search-page-url value=/v1.2/search.html>
<input id=search-textbox class=form-control name=q type=search aria-label=æœç´¢istio.io>
<button id=search-close title="Cancel search" type=reset aria-label="Cancel search"><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#cancel-x"/></svg></button></form></nav></header><main class=primary><div id=sidebar-container class="sidebar-container sidebar-offcanvas"><nav id=sidebar aria-label="Section Navigation"><div class=directory><div class=card><button class="header dynamic" id=card15 title="å…³äºè¿è¡Œ Istio ç½‘æ ¼çš„æç¤ºã€æŠ€å·§å’Œçªé—¨ã€‚" aria-controls=card15-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#guide"/></svg>è¿ç»´æŒ‡å—</button><div class=body aria-labelledby=card15 role=region id=card15-body><ul role=tree aria-expanded=true aria-labelledby=card15><li role=none><a role=treeitem title=æè¿°å¦‚ä½•ä½¿ç”¨ç»„ä»¶æ—¥å¿—æ¥æ·±å…¥äº†è§£è¿è¡Œç»„ä»¶çš„è¡Œä¸ºã€‚ href=/v1.2/zh/docs/ops/component-logging/>ç»„ä»¶æ—¥å¿—</a></li><li role=none><a role=treeitem title="æè¿°å¦‚ä½•ä½¿ç”¨ ControlZ æ£€æµ‹æŸ¥çœ‹å•ä¸ªç»„ä»¶çš„è¿è¡ŒçŠ¶æ€ã€‚" href=/v1.2/zh/docs/ops/controlz/>ç»„ä»¶å†…æ£€</a></li><li role=none><a role=treeitem title="å¦‚ä½•ä»åº•å±‚è°ƒè¯• Istio ç»„ä»¶ã€‚" href=/v1.2/zh/docs/ops/component-debugging/>ç»„ä»¶è°ƒè¯•</a></li><li role=treeitem aria-label=æµé‡ç®¡ç†><button aria-hidden=true></button><a title=å¸®åŠ©ç®¡ç†æœåŠ¡ç½‘æ ¼ä¸­çš„ç½‘ç»œã€‚ href=/v1.2/zh/docs/ops/traffic-management/>æµé‡ç®¡ç†</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="æè¿°å¦‚ä½•è°ƒè¯• Pilot å’Œ Envoyã€‚" href=/v1.2/zh/docs/ops/traffic-management/proxy-cmd/>è°ƒè¯• Envoy å’Œ Pilot</a></li><li role=none><a role=treeitem title="ä»‹ç» Istio ç½‘ç»œæ“ä½œæ–¹é¢çŸ¥è¯†ã€‚" href=/v1.2/zh/docs/ops/traffic-management/introduction/>ç½‘ç»œè¿ç»´ä»‹ç»</a></li><li role=none><a role=treeitem title=æä¾›ç‰¹å®šçš„éƒ¨ç½²å’Œé…ç½®æŒ‡å—ã€‚ href=/v1.2/zh/docs/ops/traffic-management/deploy-guidelines/>éƒ¨ç½²å’Œé…ç½®æŒ‡å—</a></li><li role=none><a role=treeitem title=å¸¸è§ç½‘ç»œç›¸å…³é—®é¢˜çš„è¯†åˆ«å’Œå¤„ç†ã€‚ href=/v1.2/zh/docs/ops/traffic-management/troubleshooting/>ç½‘ç»œé—®é¢˜æ’æŸ¥</a></li><li role=none><a role=treeitem title=æœ‰å…³å¦‚ä½•å¯ç”¨å’Œç†è§£æœ¬åœ°è´Ÿè½½å‡è¡¡çš„ä¿¡æ¯ã€‚ href=/v1.2/zh/docs/ops/traffic-management/locality-load-balancing/>æœ¬åœ°è´Ÿè½½å‡è¡¡</a></li><li role=none><a role=treeitem title=ä»‹ç»ä¸€äº›å·¥å…·å’ŒæŠ€æœ¯ï¼Œç”¨æ¥é’ˆå¯¹æµé‡ç®¡ç†æ–¹é¢çš„é…ç½®é—®é¢˜è¿›è¡Œè¯Šæ–­ã€‚ href=/v1.2/zh/docs/ops/traffic-management/observing/>é…ç½®é—®é¢˜è¯Šæ–­</a></li></ul></li><li role=treeitem aria-label=å®‰å…¨><button aria-hidden=true></button><a title=å¸®åŠ©ä½ ç®¡ç†è¿è¡Œä¸­çš„ç½‘æ ¼çš„å®‰å…¨æ€§æ–¹é¢é—®é¢˜ã€‚ href=/v1.2/zh/docs/ops/security/>å®‰å…¨</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=å±•ç¤ºæˆæƒåŠŸèƒ½çš„è°ƒè¯•è¿‡ç¨‹ã€‚ href=/v1.2/zh/docs/ops/security/debugging-authorization/>è°ƒè¯•æˆæƒ</a></li><li role=none><a role=treeitem title="å¦‚æœ Citadel è¡¨ç°ä¸æ­£å¸¸è¯¥æ€ä¹ˆåŠã€‚" href=/v1.2/zh/docs/ops/security/repairing-citadel/>ä¿®å¤ Citadel</a></li><li role=none><a role=treeitem title="å¦‚æœæ‚¨æ€€ç–‘ Istio å¯†é’¥å’Œè¯ä¹¦æœ‰é—®é¢˜è¯¥æ€ä¹ˆåŠã€‚" href=/v1.2/zh/docs/ops/security/keys-and-certs/>å¯†é’¥å’Œè¯ä¹¦</a></li><li role=none><a role=treeitem title="å¦‚ä½•å¤„ç† TLS è®¤è¯çš„å¤±æ•ˆé—®é¢˜ã€‚" href=/v1.2/zh/docs/ops/security/mutual-tls/>åŒå‘ TLS</a></li><li role=none><a role=treeitem title="å¦‚ä½•åœ¨å¯ç”¨åŒå‘ TLS çš„æƒ…å†µä¸‹è¿è¡Œå¥åº·æ£€æŸ¥ã€‚" href=/v1.2/zh/docs/ops/security/health-checks-and-mtls/>å¥åº·æ£€æŸ¥å’ŒåŒå‘ TLS</a></li><li role=none><a role=treeitem title=å·²ç»å¯ç”¨äº†æˆæƒï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•è¯·æ±‚è¿˜æ˜¯ä¼šé€šè¿‡ã€‚ href=/v1.2/zh/docs/ops/security/authorization-permissive/>æˆæƒå¤ªè¿‡å®½æ¾</a></li><li role=none><a role=treeitem title=å¯ç”¨äº†æˆæƒç„¶åä»»ä½•è¯·æ±‚éƒ½æ— æ³•åˆ°è¾¾æœåŠ¡ã€‚ href=/v1.2/zh/docs/ops/security/authorization-restrictive/>æˆæƒè¿‡äºä¸¥æ ¼</a></li><li role=none><a role=treeitem title=å¦‚æœç»ˆç«¯ç”¨æˆ·èº«ä»½éªŒè¯ä¸èµ·ä½œç”¨ï¼Œè¯¥æ€ä¹ˆåŠã€‚ href=/v1.2/zh/docs/ops/security/end-user-auth/>ç»ˆç«¯ç”¨æˆ·èº«ä»½éªŒè¯</a></li></ul></li><li role=treeitem aria-label=é¥æµ‹><button aria-hidden=true></button><a title=å¸®åŠ©æ‚¨åœ¨ä¸€ä¸ªè¿è¡Œçš„æœåŠ¡ç½‘æ ¼ä¸­ç®¡ç†é¥æµ‹æ•°æ®çš„é‡‡é›†å’Œå¯è§†åŒ–ã€‚ href=/v1.2/zh/docs/ops/telemetry/>é¥æµ‹</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem href=/v1.2/zh/docs/ops/telemetry/missing-metrics/>æŸ¥çœ‹ä¸åˆ°æŒ‡æ ‡</a></li><li role=none><a role=treeitem title="å¤„ç† Grafana ç›¸å…³é—®é¢˜ã€‚" href=/v1.2/zh/docs/ops/telemetry/grafana/>Grafana</a></li><li role=none><a role=treeitem title="Envoy ç»Ÿè®¡æ•°æ®çš„ç»†ç²’åº¦æ§åˆ¶ã€‚" href=/v1.2/zh/docs/ops/telemetry/envoy-stats/>Envoy ç»Ÿè®¡æ•°æ®</a></li></ul></li><li role=treeitem aria-label=å®‰è£…å’Œè®¾ç½®><button aria-hidden=true></button><a title="å¸®åŠ©è¯Šæ–­å’Œä¿®å¤ Isto å®‰è£…é—®é¢˜ã€‚" href=/v1.2/zh/docs/ops/setup/>å®‰è£…å’Œè®¾ç½®</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="æ¦‚è¿°äº† Istio ä½¿ç”¨ Kubernetes Webhook åŠå¯èƒ½å‡ºç°çš„ç›¸å…³é—®é¢˜ã€‚" href=/v1.2/zh/docs/ops/setup/webhook/>åŠ¨æ€å‡†å…¥ Webhook æ¦‚è¿°</a></li><li role=none><a role=treeitem title="æè¿° Istio ä½¿ç”¨ Kubernetes webhook è¿›è¡ŒæœåŠ¡å™¨ç«¯é…ç½®éªŒè¯ã€‚" href=/v1.2/zh/docs/ops/setup/validation/>é…ç½®éªŒè¯ Webhook</a></li><li role=none><a role=treeitem title="æè¿°äº† Istio å¦‚ä½•ä½¿ç”¨ Kubernetes webhooks è¿›è¡Œè‡ªåŠ¨ sidecar æ³¨å…¥ã€‚" href=/v1.2/zh/docs/ops/setup/injection/>Sidecar æ³¨å…¥ Webhook</a></li><li role=none><a role=treeitem title="å¦‚ä½•æ£€æŸ¥ Pod ä¸­è¢«è®¸å¯çš„åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/ops/setup/required-pod-capabilities/>Pod çš„å¿…è¦åŠŸèƒ½</a></li><li role=none><a role=treeitem title="å±•ç¤ºå¦‚ä½•å¯¹ Istio service è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚" href=/v1.2/zh/docs/ops/setup/app-health-check/>Istio Service å¥åº·æ£€æŸ¥</a></li></ul></li><li role=none><a role=treeitem title="å…³äºè§£å†³ Istio å¸¸è§é—®é¢˜çš„å»ºè®®ã€‚" href=/v1.2/zh/docs/ops/misc/>æ‚é¡¹</a></li></ul></div></div><div class=card><button class="header dynamic" id=card38 title="ä¸€äº›æ¦‚å¿µï¼Œç†è§£å®ƒä»¬æœ‰åŠ©äºæ‚¨æ›´å¥½åœ°äº†è§£ Istio ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†åŠå…¶ä½¿ç”¨çš„æŠ½è±¡ã€‚" aria-controls=card38-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#concepts"/></svg>æ¦‚å¿µ</button><div class=body aria-labelledby=card38 role=region id=card38-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card38><li role=none><a role=treeitem title="ä»‹ç» Istio åŠå…¶è¦è§£å†³çš„é—®é¢˜ã€é¡¶å±‚æ¶æ„å’Œè®¾è®¡ç›®æ ‡ã€‚" href=/v1.2/zh/docs/concepts/what-is-istio/>Istio æ˜¯ä»€ä¹ˆ?</a></li><li role=none><a role=treeitem title="ä»‹ç» Istio ä¸­å…³äºæµé‡è·¯ç”±ä¸æ§åˆ¶çš„å„é¡¹åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/concepts/traffic-management/>æµé‡ç®¡ç†</a></li><li role=none><a role=treeitem title="æè¿° Istio çš„æˆæƒä¸é‰´æƒåŠŸèƒ½ã€‚" href=/v1.2/zh/docs/concepts/security/>å®‰å…¨</a></li><li role=none><a role=treeitem title=æè¿°ç­–ç•¥å®æ–½å’Œé¥æµ‹æœºåˆ¶ã€‚ href=/v1.2/zh/docs/concepts/policies-and-telemetry/>ç­–ç•¥ä¸é¥æµ‹</a></li><li role=none><a role=treeitem title="ä»‹ç» Istio ç»„ä»¶çš„æ€§èƒ½ä¸å¯ä¼¸ç¼©æ€§æ–¹æ³•è®ºã€ç»“æœå’Œæœ€ä½³å®è·µã€‚" href=/v1.2/zh/docs/concepts/performance-and-scalability/>æ€§èƒ½ä¸å¯ä¼¸ç¼©æ€§</a></li><li role=none><a role=treeitem title=æè¿°å¦‚ä½•é…ç½®æœåŠ¡ç½‘æ ¼ä»¥åŒ…å«æ¥è‡ªå¤šä¸ªé›†ç¾¤çš„æœåŠ¡ã€‚ href=/v1.2/zh/docs/concepts/multicluster-deployments/>å¤šé›†ç¾¤éƒ¨ç½²</a></li></ul></div></div><div class=card><button class="header dynamic" id=card53 title="åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼ˆä¾‹å¦‚ Kubernetesã€Consul ç­‰ï¼‰å¦‚ä½•éƒ¨ç½²å’Œå‡çº§ Istioã€‚" aria-controls=card53-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#setup"/></svg>å®‰è£…å’Œå‡çº§</button><div class=body aria-labelledby=card53 role=region id=card53-body><ul role=tree aria-expanded=true aria-labelledby=card53><li role=treeitem aria-label=Kubernetes><button aria-hidden=true></button><a title="å…³äºå¦‚ä½•åœ¨ Kubernetes é›†ç¾¤ä¸­å®‰è£… Istio æ§åˆ¶å¹³é¢å’Œæ·»åŠ è™šæ‹Ÿæœºåˆ° mesh ä¸­çš„è¯´æ˜ã€‚" href=/v1.2/zh/docs/setup/kubernetes/>Kubernetes</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title="å…³äº Istio å‘å¸ƒåŒ…ä¸‹è½½è¿‡ç¨‹çš„è¯´æ˜ã€‚" href=/v1.2/zh/docs/setup/kubernetes/download/>ä¸‹è½½ Istio å‘å¸ƒåŒ…</a></li><li role=treeitem aria-label=å®‰è£…æ–¹æ¡ˆ><button aria-hidden=true></button><a title=é€‰æ‹©æœ€é€‚åˆæ‚¨éœ€æ±‚å’Œå¹³å°çš„æ–¹æ¡ˆã€‚ href=/v1.2/zh/docs/setup/kubernetes/install/>å®‰è£…æ–¹æ¡ˆ</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title="åœ¨ Kubernetes é›†ç¾¤ä¸­å¿«é€Ÿå®‰è£… Istio æœåŠ¡ç½‘æ ¼çš„è¯´æ˜ã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/kubernetes/>åœ¨ Kubernetes ä¸­å¿«é€Ÿå¼€å§‹</a></li><li role=none><a role=treeitem title="ä½¿ç”¨å†…å«çš„ Helm chart å®‰è£… Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/helm/>ä½¿ç”¨ Helm è¿›è¡Œå®‰è£…</a></li><li role=treeitem aria-label=å¤šé›†ç¾¤å®‰è£…><button aria-hidden=true></button><a title="é…ç½®è·¨è¶Šå¤šä¸ª Kubernetes é›†ç¾¤çš„ Istio æœåŠ¡ç½‘æ ¼ã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/multicluster/>å¤šé›†ç¾¤å®‰è£…</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="ä½¿ç”¨ Istio Gateway è·¨è¶Šå¤šä¸ª Kubernetes é›†ç¾¤å®‰è£… Istio ç½‘æ ¼ä»¥è®¿é—®è¿œç¨‹ podã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/multicluster/gateways/>Gateway è¿æ¥</a></li><li role=none><a role=treeitem title="é€šè¿‡ç›´è¿è¿œç¨‹ pods å®ç°å¤š Kubernetes é›†ç¾¤å®‰è£… Istio ç½‘æ ¼ã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/multicluster/vpn/>VPN è¿æ¥</a></li></ul></li><li role=treeitem aria-label=ç‰¹å®šå¹³å°å®‰è£…è¯´æ˜><button aria-hidden=true></button><a title="æ”¯æŒçš„ Kubernetes å¹³å°çš„é¢å¤–å®‰è£…æµç¨‹ã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/platform/>ç‰¹å®šå¹³å°å®‰è£…è¯´æ˜</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="å¦‚ä½•ä½¿ç”¨é˜¿é‡Œäº‘ Kubernetes å®¹å™¨æœåŠ¡å¿«é€Ÿå®‰è£… Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/platform/alicloud/>é˜¿é‡Œäº‘</a></li><li role=none><a role=treeitem title="åœ¨ Google Kubernetes Engine (GKE) ä¸Šå¿«é€Ÿæ­å»º Istio æœåŠ¡ã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/platform/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="å¦‚ä½•ä½¿ç”¨ IBM å…¬æœ‰äº‘æˆ– IBM ç§æœ‰äº‘å¿«é€Ÿå®‰è£… Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/install/platform/ibm/>IBM Cloud</a></li></ul></li></ul></li><li role=treeitem aria-label=å‡†å¤‡><button aria-hidden=true></button><a title="ä¸º Istio åšå‡†å¤‡ã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/>å‡†å¤‡</a><ul role=group aria-expanded=false><li role=treeitem aria-label=å¹³å°æ­å»º><button aria-hidden=true></button><a title="åœ¨å®‰è£… Istio å‰ï¼Œå¦‚ä½•å‡†å¤‡å„ç§ Kubernetes å¹³å°ã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/>å¹³å°æ­å»º</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="ä¸º Istio è®¾ç½®é˜¿é‡Œäº‘ Kubernetes é›†ç¾¤çš„è¯´æ˜ã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/alicloud/>é˜¿é‡Œäº‘</a></li><li role=none><a role=treeitem title="å¯¹ Azure é›†ç¾¤è¿›è¡Œé…ç½®ä»¥ä¾¿å®‰è£…è¿è¡Œ Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/azure/>Azure</a></li><li role=none><a role=treeitem title="ä½¿ç”¨æ¡Œé¢ç‰ˆ Docker å®‰è£… Istio çš„è¯´æ˜ã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/docker/>æ¡Œé¢ç‰ˆ Docker</a></li><li role=none><a role=treeitem title="å¯¹ Google Kubernetes Engineï¼ˆGKEï¼‰é›†ç¾¤è¿›è¡Œé…ç½®ä»¥ä¾¿å®‰è£…è¿è¡Œ Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="å¯¹ IBM Cloud Kubernetes Serviceï¼ˆIKSï¼‰é›†ç¾¤è¿›è¡Œé…ç½®ä»¥ä¾¿å®‰è£…è¿è¡Œ Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/ibm/>IBM Cloud Kubernetes Service</a></li><li role=none><a role=treeitem title="å¯¹ Minikube é›†ç¾¤è¿›è¡Œé…ç½®ä»¥ä¾¿å®‰è£…è¿è¡Œ Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/minikube/>Minikube</a></li><li role=none><a role=treeitem title="å¯¹ OpenShift é›†ç¾¤è¿›è¡Œé…ç½®ä»¥ä¾¿å®‰è£…è¿è¡Œ Istioã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/openshift/>OpenShift</a></li><li role=none><a role=treeitem title="ä¸º Istio å¯¹ OKE é›†ç¾¤ç¯å¢ƒè¿›è¡Œé…ç½®ã€‚" href=/v1.2/zh/docs/setup/kubernetes/prepare/platform-setup/oci/>Oracle Cloud Infrastructure</a></li></ul></li></ul></li><li role=treeitem aria-label=å‡çº§><button aria-hidden=true></button><a title="å‡çº§ Istio çš„ç›¸å…³ä¿¡æ¯ã€‚" href=/v1.2/zh/docs/setup/kubernetes/upgrade/>å‡çº§</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="åœ¨å‡çº§åˆ° Istio 1.1 ä¹‹å‰ï¼Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£çš„é‡è¦æ›´æ”¹ã€‚" href=/v1.2/zh/docs/setup/kubernetes/upgrade/notice/>1.1 å‡çº§é€šçŸ¥</a></li><li role=none><a role=treeitem title="æ¼”ç¤ºå¦‚ä½•ç‹¬ç«‹å‡çº§ Istio æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ã€‚" href=/v1.2/zh/docs/setup/kubernetes/upgrade/setps/>å‡çº§æ­¥éª¤</a></li></ul></li><li role=treeitem aria-label=å…¶ä»–è®¾ç½®æŒ‡å—><button aria-hidden=true></button><a title=æœ‰å…³å…¶ä»–è®¾ç½®ä»»åŠ¡çš„æ›´å¤šä¿¡æ¯ã€‚ href=/v1.2/zh/docs/setup/kubernetes/additional-setup/>å…¶ä»–è®¾ç½®æŒ‡å—</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio å†…ç½®çš„å®‰è£…é…ç½®æ–‡ä»¶ä»‹ç»ã€‚" href=/v1.2/zh/docs/setup/kubernetes/additional-setup/config-profiles/>å®‰è£…é…ç½®</a></li><li role=none><a role=treeitem title="ä»‹ç»ä¸¤ç§å°† Istio sidecar æ³¨å…¥åº”ç”¨ Pod çš„æ–¹æ³•ï¼šä½¿ç”¨ Sidecar æ³¨å…¥ Webhook è‡ªåŠ¨å®Œæˆï¼Œæˆ–ä½¿ç”¨ istioctl å®¢æˆ·ç«¯å·¥å…·æ‰‹å·¥å®Œæˆã€‚" href=/v1.2/zh/docs/setup/kubernetes/additional-setup/sidecar-injection/>æ³¨å…¥ Istio sidecar</a></li><li role=none><a role=treeitem title="è¿™é‡Œè®²è¿°äº† Istio å¯¹ Kubernetes ä¸­ Pod å’ŒæœåŠ¡çš„è¦æ±‚ã€‚" href=/v1.2/zh/docs/setup/kubernetes/additional-setup/requirements/>Istio å¯¹ Pod å’ŒæœåŠ¡çš„è¦æ±‚</a></li><li role=none><a role=treeitem title="Istio CNI æ’ä»¶çš„å®‰è£…å’Œä½¿ç”¨ï¼Œè¯¥æ’ä»¶è®©è¿ç»´äººå‘˜å¯ä»¥ç”¨è¾ƒä½çš„æƒé™æ¥å®Œæˆç½‘æ ¼æœåŠ¡çš„éƒ¨ç½²å·¥ä½œã€‚" href=/v1.2/zh/docs/setup/kubernetes/additional-setup/cni/>å®‰è£… Istio CNI</a></li><li role=none><a role=treeitem title="éƒ¨ç½²åœ¨ Kubernetes ä¹‹ä¸­çš„ Istio æœåŠ¡ç½‘æ ¼ï¼Œå°†è™šæ‹Ÿæœºå’Œç‰©ç†æœºé›†æˆè¿›å…¥åˆ°æœåŠ¡ç½‘æ ¼çš„æ–¹æ³•ã€‚" href=/v1.2/zh/docs/setup/kubernetes/additional-setup/mesh-expansion/>ç½‘æ ¼æ‰©å±•</a></li></ul></li></ul></li><li role=treeitem aria-label="Nomad &amp; Consul"><button aria-hidden=true></button><a title="åŸºäº Consul å’Œ Nomad å®‰è£… Istio æ§åˆ¶å¹³é¢ã€‚" href=/v1.2/zh/docs/setup/consul/>Nomad &amp; Consul</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="é€šè¿‡ Docker Compose å¿«é€Ÿå®‰è£… Istio service meshã€‚" href=/v1.2/zh/docs/setup/consul/quick-start/>é€šè¿‡ Docker å¿«é€Ÿå®‰è£…</a></li><li role=none><a role=treeitem title="åŸºäº Consul å’Œ Nomad å®‰è£… Istio æ§åˆ¶å¹³é¢ã€‚" href=/v1.2/zh/docs/setup/consul/install/>å®‰è£…</a></li></ul></li></ul></div></div><div class=card><button class="header dynamic" id=card61 title="å¦‚ä½•ç”¨ Istio ç³»ç»Ÿå®ç°ç‰¹å®šç›®æ ‡çš„è¡Œä¸ºã€‚" aria-controls=card61-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#tasks"/></svg>ä»»åŠ¡</button><div class=body aria-labelledby=card61 role=region id=card61-body><ul role=tree aria-expanded=true aria-labelledby=card61><li role=treeitem aria-label=æµé‡ç®¡ç†><button aria-hidden=true></button><a title=æ¼”ç¤ºIstioæµé‡è·¯ç”±åŠŸèƒ½çš„ä»»åŠ¡ã€‚ href=/v1.2/zh/docs/tasks/traffic-management/>æµé‡ç®¡ç†</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title=æ­¤ä»»åŠ¡å°†è¯´æ˜å¦‚ä½•å°†è¯·æ±‚åŠ¨æ€è·¯ç”±åˆ°å¤šä¸ªç‰ˆæœ¬çš„å¾®æœåŠ¡ã€‚ href=/v1.2/zh/docs/tasks/traffic-management/request-routing/>é…ç½®è¯·æ±‚è·¯ç”±</a></li><li role=none><a role=treeitem title=æ­¤ä»»åŠ¡è¯´æ˜å¦‚ä½•æ³¨å…¥å»¶è¿Ÿå¹¶æµ‹è¯•åº”ç”¨ç¨‹åºçš„å¼¹æ€§ã€‚ href=/v1.2/zh/docs/tasks/traffic-management/fault-injection/>æ•…éšœæ³¨å…¥</a></li><li role=none><a role=treeitem title=å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æµé‡ä»æ—§ç‰ˆæœ¬è¿ç§»åˆ°æ–°ç‰ˆæœ¬çš„æœåŠ¡ã€‚ href=/v1.2/zh/docs/tasks/traffic-management/traffic-shifting/>æµé‡è½¬ç§»</a></li><li role=none><a role=treeitem title="å±•ç¤ºå¦‚ä½•å°†ä¸€ä¸ª TCP æœåŠ¡çš„æµé‡ä»è€ç‰ˆæœ¬è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/tcp-traffic-shifting/>TCP æµé‡è½¬ç§»</a></li><li role=none><a role=treeitem title="æœ¬ä»»åŠ¡ç”¨äºç¤ºèŒƒå¦‚ä½•ä½¿ç”¨ Istio åœ¨ Envoy ä¸­è®¾ç½®è¯·æ±‚è¶…æ—¶ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/request-timeouts/>è®¾ç½®è¯·æ±‚è¶…æ—¶</a></li><li role=none><a role=treeitem title="ä»‹ç»åœ¨æœåŠ¡ç½‘æ ¼ Istio ä¸­å¦‚ä½•é…ç½®å¤–éƒ¨å…¬å¼€æœåŠ¡ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/ingress/>æ§åˆ¶ Ingress æµé‡</a></li><li role=treeitem aria-label="åŠ å¯† Ingress Gateway"><button aria-hidden=true></button><a title="ä½¿ç”¨å¤šç§æ–¹æ³•ä¸º Gateway æ§åˆ¶å™¨æä¾›åŠ å¯†æ”¯æŒã€‚" href=/v1.2/zh/docs/tasks/traffic-management/secure-ingress/>åŠ å¯† Ingress Gateway</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="å¦‚ä½•é…ç½® Istioï¼Œå€ŸåŠ© SDSï¼ˆSecret å‘ç°æœåŠ¡ï¼‰ï¼Œä½¿ç”¨ TLS æˆ–åŒå‘ TLS å°†æœåŠ¡å¼€æ”¾åˆ°ç½‘æ ¼ä¹‹å¤–ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/secure-ingress/sds/>ä½¿ç”¨ SDS ä¸º Gateway æä¾› HTTPS åŠ å¯†æ”¯æŒ</a></li></ul></li><li role=none><a role=treeitem title="åœ¨ Istio ä¸­é…ç½®ä»ç½‘æ ¼å†…è®¿é—®å¤–éƒ¨æœåŠ¡çš„æµé‡è·¯ç”±ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/egress/>æ§åˆ¶ Egress æµé‡</a></li><li role=none><a role=treeitem title=ç”¨è¿æ¥ã€è¯·æ±‚ä»¥åŠå¤–éƒ¨æ£€æµ‹æ¥è¿›è¡Œç†”æ–­é…ç½®çš„è¿‡ç¨‹ã€‚ href=/v1.2/zh/docs/tasks/traffic-management/circuit-breaking/>ç†”æ–­</a></li><li role=none><a role=treeitem title="æ­¤ä»»åŠ¡æ¼”ç¤ºäº† Istio çš„æµé‡é•œåƒåŠŸèƒ½ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/mirroring/>é•œåƒ</a></li><li role=treeitem aria-label=è¾¹ç¼˜æµé‡æ§åˆ¶><button aria-hidden=true></button><a title="ç”¨äºç®¡ç† Istio æœåŠ¡ç½‘æ ¼çš„è¾¹ç¼˜æµé‡ï¼ˆå³ Ingress å’Œ Egress æµé‡ï¼‰çš„å„ç§é«˜çº§ç¤ºä¾‹ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/>è¾¹ç¼˜æµé‡æ§åˆ¶</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="ä»‹ç»å¦‚ä½•ä¸ºå…¥å£ç½‘å…³é…ç½® SNI ç›´é€šã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/ingress-sni-passthrough/>æ²¡æœ‰ TLS çš„ Ingress gateway</a></li><li role=none><a role=treeitem title="æè¿°äº†é…ç½® Egress ç½‘å…³æ¥å‘èµ·å¯¹å¤–éƒ¨æœåŠ¡è¿›è¡Œ TLS é€šä¿¡çš„è¿‡ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/egress-gateway-tls-origination/>Egress ç½‘å…³çš„ TLS å‘èµ·è¿‡ç¨‹</a></li><li role=none><a role=treeitem title="æ­¤ä»»åŠ¡æè¿° Istio å¦‚ä½•é…ç½®å‡ºå£æµé‡çš„ TLSã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/egress-tls-origination/>å‡ºå£æµé‡çš„ TLS</a></li><li role=none><a role=treeitem title="æè¿°å¦‚ä½•é€šè¿‡ä¸“ç”¨ç½‘å…³æœåŠ¡å°†æµé‡å®šå‘åˆ°å¤–éƒ¨æœåŠ¡æ¥é…ç½® Istioã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/egress-gateway/>é…ç½® Egress gateway</a></li><li role=none><a role=treeitem title="ä»‹ç»å¦‚ä½•ä¸ºå…¬å…±åŸŸä¸­çš„ä¸€ç»„ä¸»æœºå¯ç”¨ Egress æµé‡ï¼Œè€Œä¸æ˜¯å•ç‹¬é…ç½®æ¯ä¸ªä¸»æœºã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/wildcard-egress-hosts/>ä½¿ç”¨é€šé…ç¬¦ä¸»æœºé…ç½® Egress æµé‡</a></li><li role=none><a role=treeitem title="å¦‚ä½•ä¸º Egress TLS æµé‡é…ç½® SNI ç›‘æ§å¹¶åº”ç”¨ç­–ç•¥ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/egress_sni_monitoring_and_policies/>Egress TLS æµé‡ä¸­çš„ SNI ç›‘æ§åŠç­–ç•¥</a></li><li role=none><a role=treeitem title="æè¿°å¦‚ä½•é…ç½® Istio ä»¥å…è®¸åº”ç”¨ç¨‹åºä½¿ç”¨å¤–éƒ¨ HTTPS ä»£ç†ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/http-proxy/>è¿æ¥åˆ°å¤–éƒ¨ HTTPS ä»£ç†</a></li><li role=none><a role=treeitem title="å±•ç¤ºä½¿ç”¨ cert-Manager ä¸º Kubernetes Ingress è·å– Let's Encrypt TLS è¯ä¹¦çš„è¿‡ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/traffic-management/edge-traffic/ingress-certmgr/>ä½¿ç”¨ cert-manager åŠ å¯† Kubernetes Ingress</a></li></ul></li></ul></li><li role=treeitem aria-label=å®‰å…¨><button aria-hidden=true></button><a title=æ¼”ç¤ºå¯¹æœåŠ¡ç½‘æ ¼è¿›è¡Œå®‰å…¨åŠ å›ºçš„æ–¹æ³•ã€‚ href=/v1.2/zh/docs/tasks/security/>å®‰å…¨</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="å±•ç¤ºä¸º HTTP æœåŠ¡è®¾ç½®åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æ–¹æ³•ã€‚" href=/v1.2/zh/docs/tasks/security/authz-http/>HTTP æœåŠ¡çš„è®¿é—®æ§åˆ¶</a></li><li role=none><a role=treeitem title="æœ‰å…³å¦‚ä½•æ•´åˆ Vault CA åˆ° Istio ä¸­é¢å‘è¯ä¹¦çš„æ•™ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/security/vault-ca/>Istio Vault CA é›†æˆ</a></li><li role=none><a role=treeitem title="æœ‰å…³å¦‚ä½•åœ¨ Istio ä¸­é…ç½®åŸºäºç»„çš„æˆæƒå’Œé…ç½®åˆ—è¡¨ç±»å‹å£°æ˜çš„æˆæƒçš„æ•™ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/security/rbac-groups/>åŸºäºç»„å’Œåˆ—è¡¨ç±»å‹å£°æ˜çš„æˆæƒ</a></li><li role=none><a role=treeitem title="ä»‹ç»å¦‚ä½•ä½¿ç”¨ Istio è®¤è¯ç­–ç•¥è®¾ç½®åŒå‘ TLS å’ŒåŸºæœ¬çš„ç»ˆç«¯ç”¨æˆ·è®¤è¯ã€‚" href=/v1.2/zh/docs/tasks/security/authn-policy/>åŸºç¡€è®¤è¯ç­–ç•¥</a></li><li role=none><a role=treeitem title="å¯¹ Istio çš„è‡ªåŠ¨åŒå‘ TLS è®¤è¯åŠŸèƒ½è¿›è¡Œä½“éªŒå’Œæµ‹è¯•ã€‚" href=/v1.2/zh/docs/tasks/security/mutual-tls/>æ·±å…¥äº†è§£åŒå‘ TLS</a></li><li role=none><a role=treeitem title=å±•ç¤ºå®½å®¹æ¨¡å¼çš„çš„é‰´æƒè¿‡ç¨‹ã€‚ href=/v1.2/zh/docs/tasks/security/authz-permissive/>é‰´æƒè¿‡ç¨‹ä¸­çš„å®½å®¹æ¨¡å¼</a></li><li role=none><a role=treeitem title="å±•ç¤ºå¦‚ä½•ä¸º TCP æœåŠ¡è®¾ç½®åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚" href=/v1.2/zh/docs/tasks/security/authz-tcp/>TCP æœåŠ¡çš„è®¿é—®æ§åˆ¶</a></li><li role=none><a role=treeitem title=å±•ç¤ºå¦‚ä½•åœ¨æœåŠ¡ç½‘æ ¼ä¸­è¿›è¡ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚ href=/v1.2/zh/docs/tasks/security/role-based-access-control/>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</a></li><li role=none><a role=treeitem title="è¿ç»´äººå‘˜å¦‚ä½•ä½¿ç”¨ç°æœ‰æ ¹è¯ä¹¦é…ç½® Citadel è¿›è¡Œè¯ä¹¦ä»¥åŠå¯†é’¥çš„ç­¾å‘ã€‚" href=/v1.2/zh/docs/tasks/security/plugin-ca-cert/>æ’å…¥å¤–éƒ¨ CA å¯†é’¥å’Œè¯ä¹¦</a></li><li role=none><a role=treeitem title="å¦‚ä½•åœ¨ Kubernetes ä¸­å¯ç”¨ Citadel çš„å¥åº·æ£€æŸ¥ã€‚" href=/v1.2/zh/docs/tasks/security/health-check/>Citadel çš„å¥åº·æ£€æŸ¥</a></li><li role=none><a role=treeitem title="å±•ç¤ºå¯ç”¨ SDS æ¥ä¸º Istio æä¾›èº«ä»½æœåŠ¡çš„è¿‡ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/security/auth-sds/>é€šè¿‡ SDS æä¾›èº«ä»½æœåŠ¡</a></li><li role=none><a role=treeitem title="å¦‚ä½•æ¸è¿›å¼çš„ä¸ºç°æœ‰ Istio æœåŠ¡æ·»åŠ åŒå‘ TLS æ”¯æŒã€‚" href=/v1.2/zh/docs/tasks/security/mtls-migration/>åŒå‘ TLS çš„è¿ç§»</a></li><li role=none><a role=treeitem title="å±•ç¤ºå¦‚ä½•åœ¨ HTTPS æœåŠ¡ä¸Šå¯ç”¨åŒå‘ TLSã€‚" href=/v1.2/zh/docs/tasks/security/https-overlay/>é€šè¿‡ HTTPS è¿›è¡ŒåŒå‘ TLS</a></li></ul></li><li role=treeitem aria-label=ç­–ç•¥><button aria-hidden=true></button><a title=æ¼”ç¤ºç­–ç•¥å®æ–½åŠŸèƒ½ã€‚ href=/v1.2/zh/docs/tasks/policy-enforcement/>ç­–ç•¥</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="æœ¬ä»»åŠ¡è®²è§£å¦‚ä½•å¯ç”¨ Istio ç­–ç•¥æ£€æŸ¥åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/tasks/policy-enforcement/enabling-policy/>å¯ç”¨ç­–ç•¥æ£€æŸ¥</a></li><li role=none><a role=treeitem title="è¿™ä¸€ä»»åŠ¡å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Istio åŠ¨æ€çš„å¯¹æœåŠ¡é€šä¿¡è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚" href=/v1.2/zh/docs/tasks/policy-enforcement/rate-limiting/>å¯ç”¨é€Ÿç‡é™åˆ¶</a></li><li role=none><a role=treeitem title="å±•ç¤ºä½¿ç”¨ç®€å•çš„ Denier é€‚é…å™¨æˆ–é»‘ç™½åå•å¯¹æœåŠ¡è¿›è¡Œè®¿é—®æ§åˆ¶çš„æ–¹æ³•ã€‚" href=/v1.2/zh/docs/tasks/policy-enforcement/denial-and-list/>Denier é€‚é…å™¨ä»¥åŠé»‘ç™½åå•</a></li></ul></li><li role=treeitem aria-label=é¥æµ‹><button aria-hidden=true></button><a title=æ¼”ç¤ºä»æœåŠ¡ç½‘æ ¼æ”¶é›†é¥æµ‹ä¿¡æ¯çš„æ–¹æ³•ã€‚ href=/v1.2/zh/docs/tasks/telemetry/>é¥æµ‹</a><ul role=group aria-expanded=false><li role=treeitem aria-label=æŒ‡æ ‡åº¦é‡><button aria-hidden=true></button><a title="æ¼”ç¤º Istio ç½‘æ ¼æŒ‡æ ‡åº¦é‡çš„é…ç½®ã€æ”¶é›†å’Œå¤„ç†ã€‚" href=/v1.2/zh/docs/tasks/telemetry/metrics/>æŒ‡æ ‡åº¦é‡</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="è¿™ä¸€ä»»åŠ¡è®²è¿°å¦‚ä½•é…ç½® Istioï¼Œè¿›è¡ŒæŒ‡æ ‡å’Œæ—¥å¿—çš„æ”¶é›†å·¥ä½œã€‚" href=/v1.2/zh/docs/tasks/telemetry/metrics/collecting-metrics/>æ”¶é›†æŒ‡æ ‡å’Œæ—¥å¿—</a></li><li role=none><a role=treeitem title="æœ¬ä»»åŠ¡å±•ç¤ºäº†å¦‚ä½•é…ç½® Istio è¿›è¡Œ TCP æœåŠ¡çš„æŒ‡æ ‡æ”¶é›†ã€‚" href=/v1.2/zh/docs/tasks/telemetry/metrics/tcp-metrics/>è·å– TCP æœåŠ¡æŒ‡æ ‡</a></li><li role=none><a role=treeitem title="æ­¤ä»»åŠ¡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Prometheus æŸ¥è¯¢ Istio æŒ‡æ ‡ã€‚" href=/v1.2/zh/docs/tasks/telemetry/metrics/querying-metrics/>æŸ¥è¯¢ Prometheus çš„æŒ‡æ ‡</a></li><li role=none><a role=treeitem title="è¿™ä¸ªä»»åŠ¡å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•è®¾ç½®å’Œä½¿ç”¨ Istio ä»ªè¡¨ç›˜æ¥ç›‘è§†ç½‘æ ¼æµé‡ã€‚" href=/v1.2/zh/docs/tasks/telemetry/metrics/using-istio-dashboard/>ä½¿ç”¨ Grafana å¯è§†åŒ–æŒ‡æ ‡åº¦é‡</a></li></ul></li><li role=treeitem aria-label=åˆ†å¸ƒå¼è¿½è¸ª><button aria-hidden=true></button><a title="è¯¥ä»»åŠ¡å±•ç¤ºäº†å¦‚ä½•ä¸ºå¯ç”¨äº† Istio æ”¯æŒçš„åº”ç”¨è¿›è¡Œè¿½è¸ªã€‚" href=/v1.2/zh/docs/tasks/telemetry/distributed-tracing/>åˆ†å¸ƒå¼è¿½è¸ª</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Istio åˆ†å¸ƒå¼è¿½è¸ªæ¦‚è¿°ã€‚" href=/v1.2/zh/docs/tasks/telemetry/distributed-tracing/overview/>æ¦‚è¿°</a></li><li role=none><a role=treeitem title="äº†è§£å¦‚ä½•é…ç½®ä»£ç†ä»¥å‘ Jaeger å‘é€è¿½è¸ªè¯·æ±‚ã€‚" href=/v1.2/zh/docs/tasks/telemetry/distributed-tracing/jaeger/>Jaeger</a></li><li role=none><a role=treeitem title="äº†è§£å¦‚ä½•é…ç½®ä»£ç†ä»¥å‘ Zipkin å‘é€è¿½è¸ªè¯·æ±‚ã€‚" href=/v1.2/zh/docs/tasks/telemetry/distributed-tracing/zipkin/>Zipkin</a></li><li role=none><a role=treeitem title="å¦‚ä½•é…ç½®ä»£ç†ä»¥å‘é€è¯·æ±‚è‡³ LightStep [ğ‘¥]PM." href=/v1.2/zh/docs/tasks/telemetry/distributed-tracing/lightstep/>ä½¿ç”¨ LightStep [ğ‘¥]PM è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ª</a></li></ul></li><li role=treeitem aria-label=æ—¥å¿—><button aria-hidden=true></button><a title="æ¼”ç¤º Istio ç½‘æ ¼æ—¥å¿—çš„é…ç½®ã€æ”¶é›†å’Œå¤„ç†ã€‚" href=/v1.2/zh/docs/tasks/telemetry/logs/>æ—¥å¿—</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="æ­¤ä»»åŠ¡å‘æ‚¨å±•ç¤ºå¦‚ä½•é…ç½® Envoy ä»£ç†å°†è®¿é—®æ—¥å¿—æ‰“å°åˆ°å…¶æ ‡å‡†è¾“å‡ºã€‚" href=/v1.2/zh/docs/tasks/telemetry/logs/access-log/>è·å– Envoy è®¿é—®æ—¥å¿—</a></li><li role=none><a role=treeitem title="è¿™ä¸€ä»»åŠ¡è®²è¿°å¦‚ä½•é…ç½® Istioï¼Œè¿›è¡Œæ—¥å¿—çš„æ”¶é›†å·¥ä½œã€‚" href=/v1.2/zh/docs/tasks/telemetry/logs/collecting-logs/>æ”¶é›†æ—¥å¿—</a></li><li role=none><a role=treeitem title="æ­¤ä»»åŠ¡è¯´æ˜å¦‚ä½•é…ç½® Istio ä»¥å°†æ—¥å¿—è¾“å‡ºåˆ° Fluentd å®ˆæŠ¤ç¨‹åºã€‚" href=/v1.2/zh/docs/tasks/telemetry/logs/fluentd/>ä½¿ç”¨ Fluentd è®°å½•æ—¥å¿—</a></li></ul></li><li role=none><a role=treeitem title="æœ¬ä»»åŠ¡å±•ç¤ºäº†åœ¨ Istio ç½‘æ ¼ä¸­å¯¹æœåŠ¡è¿›è¡Œå¯è§†åŒ–çš„è¿‡ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/telemetry/kiali/>ç½‘æ ¼å¯è§†åŒ–</a></li><li role=none><a role=treeitem title="æœ¬ä»»åŠ¡å±•ç¤ºäº†ä¸º Istio é¥æµ‹æ’ä»¶é…ç½®å¤–éƒ¨è®¿é—®çš„è¿‡ç¨‹ã€‚" href=/v1.2/zh/docs/tasks/telemetry/gateways/>é¥æµ‹æ’ä»¶çš„è¿œç¨‹è®¿é—®</a></li></ul></li><li role=treeitem aria-label=å•ä¸€ä¸‰å±‚ç½‘ç»œçš„å¤šé›†ç¾¤ç½‘æ ¼><button aria-hidden=true></button><a title="æ‚¨å¯ä»¥å°è¯•å„ç§åŸºäº VPN çš„ Istio å¤šé›†ç¾¤ç¤ºä¾‹ã€‚" href=/v1.2/zh/docs/tasks/multicluster/>å•ä¸€ä¸‰å±‚ç½‘ç»œçš„å¤šé›†ç¾¤ç½‘æ ¼</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=åœ¨ä¸€ä¸ªä½¿ç”¨ç½‘å…³è¿›è¡Œè¿æ¥çš„å¤šé›†ç¾¤ç½‘æ ¼ä¸­é…ç½®è¿œç¨‹æœåŠ¡ã€‚ href=/v1.2/zh/docs/tasks/multicluster/gateways/>é€šè¿‡ç½‘å…³è¿›è¡Œè¿æ¥çš„å¤šé›†ç¾¤</a></li><li role=none><a role=treeitem title="åŸºäº GKE çš„ Istio å¤šé›†ç¾¤å®‰è£…ã€‚" href=/v1.2/zh/docs/tasks/multicluster/gke/>Google Kubernetes Engine</a></li><li role=none><a role=treeitem title="å¤š IBM Cloud Private é›†ç¾¤å®‰è£… Istio ç¤ºä¾‹ã€‚" href=/v1.2/zh/docs/tasks/multicluster/icp/>IBM Cloud Private</a></li><li role=none><a role=treeitem title="åˆ©ç”¨ Istio çš„æ°´å¹³åˆ†å‰² EDS æ¥åˆ›å»ºå¤šé›†ç¾¤ç½‘æ ¼ã€‚" href=/v1.2/zh/docs/tasks/multicluster/split-horizon-eds/>é›†ç¾¤æ„ŸçŸ¥çš„æœåŠ¡è·¯ç”±</a></li></ul></li></ul></div></div><div class=card><button class="header dynamic" id=card99 title="è¿™é‡ŒåŒ…æ‹¬å¤šä¸ªå¯ä¾› Istio ä½¿ç”¨çš„å¯å®Œæ•´å·¥ä½œçš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥ç”¨æ¥äº²è‡ªéƒ¨ç½²å’Œä½“éªŒè¿™äº›ç¤ºä¾‹ã€‚" aria-controls=card99-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#examples"/></svg>ç¤ºä¾‹</button><div class=body aria-labelledby=card99 role=region id=card99-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card99><li role=none><a role=treeitem title="éƒ¨ç½²ä¸€ä¸ªç”¨äºæ¼”ç¤ºå¤šç§ Istio ç‰¹æ€§çš„åº”ç”¨ï¼Œç”±å››ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ„æˆã€‚" href=/v1.2/zh/docs/examples/bookinfo/>Bookinfo åº”ç”¨</a></li><li role=none><a role=treeitem title="å¦‚ä½•åœ¨ Istio æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨å¤šç§æµé‡ç®¡ç†åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/examples/intelligent-routing/>æ™ºèƒ½è·¯ç”±</a></li><li role=none><a role=treeitem title="æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Istio Mixer å’Œ Istio sidecar è·å–æŒ‡æ ‡å’Œæ—¥å¿—ï¼Œå¹¶åœ¨ä¸åŒçš„æœåŠ¡é—´è¿›è¡Œè¿½è¸ªã€‚" href=/v1.2/zh/docs/examples/telemetry/>æ·±å…¥é¥æµ‹</a></li><li role=none><a role=treeitem title="è¯´æ˜å¦‚ä½•åœ¨è°·æ­Œäº‘ Endpoints æœåŠ¡ä¸­æ‰‹åŠ¨æ•´åˆ Istioã€‚" href=/v1.2/zh/docs/examples/endpoints/>åœ¨è°·æ­Œäº‘ Endpoints æœåŠ¡ä¸­å®‰è£… Istio</a></li><li role=none><a role=treeitem title="åœ¨å•ä¸€æœåŠ¡ç½‘æ ¼ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨ Istio å¯¹ Kubernetes é›†ç¾¤ä»¥åŠè™šæ‹Ÿæœºè¿›è¡Œæ§åˆ¶ã€‚" href=/v1.2/zh/docs/examples/integrating-vms/>è™šæ‹Ÿæœºé›†æˆ</a></li></ul></div></div><div class=card><button class="header dynamic" id=card137 title="å‚è€ƒéƒ¨åˆ†åŒ…å«è¯¦ç»†çš„æƒå¨å‚è€ƒèµ„æ–™ï¼Œå¦‚å‘½ä»¤è¡Œé€‰é¡¹ã€é…ç½®é€‰é¡¹å’Œ API è°ƒç”¨å‚æ•°ã€‚" aria-controls=card137-body><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#reference"/></svg>å‚è€ƒ</button><div class="body default" aria-labelledby=card137 role=region id=card137-body><ul role=tree aria-expanded=true aria-labelledby=card137><li role=treeitem aria-label=é…ç½®><button class=show aria-hidden=true></button><a title=å…³äºé…ç½®é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ã€‚ href=/v1.2/zh/docs/reference/config/>é…ç½®</a><ul role=group aria-expanded=true><li role=treeitem aria-label=æµé‡ç®¡ç†><button aria-hidden=true></button><a title="æè¿°å¦‚ä½•é…ç½® HTTP/TCP è·¯ç”±åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/reference/config/networking/>æµé‡ç®¡ç†</a><ul role=group aria-expanded=false class=leaf-section></ul></li><li role=none><a role=treeitem title="æè¿°äº†ä½¿ç”¨ Helm chart å®‰è£… Istio æ—¶å¯ä»¥ä½¿ç”¨çš„é€‰é¡¹ã€‚" href=/v1.2/zh/docs/reference/config/installation-options/>å®‰è£…é€‰é¡¹</a></li><li role=treeitem aria-label=æˆæƒ><button aria-hidden=true></button><a title=å…³äºå¦‚ä½•é…ç½®Istioæˆæƒç‰¹æ€§çš„æè¿°ã€‚ href=/v1.2/zh/docs/reference/config/authorization/>æˆæƒ</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title=æè¿°æ‰€æ”¯æŒçš„çº¦æŸå’Œå±æ€§ã€‚ href=/v1.2/zh/docs/reference/config/authorization/constraints-and-properties/>çº¦æŸå’Œå±æ€§</a></li><li role=none><a role=treeitem title=é…ç½®åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚ href=/v1.2/zh/docs/reference/config/authorization/istio.rbac.v1alpha1/>RBAC</a></li></ul></li><li role=treeitem aria-label=ç­–ç•¥å’Œé¥æµ‹><button aria-hidden=true></button><a title="æè¿°å¦‚ä½•é…ç½® Istio çš„ç­–ç•¥å’Œé¥æµ‹åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/>ç­–ç•¥å’Œé¥æµ‹</a><ul role=group aria-expanded=false><li role=none><a role=treeitem title=ä»‹ç»ç­–ç•¥å’Œæ§åˆ¶ä¸­ä¼šç”¨åˆ°çš„ä¸€äº›åŸºç¡€å±æ€§è¯æ±‡ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/attribute-vocabulary/>å±æ€§è¯æ±‡</a></li><li role=none><a role=treeitem title="Mixer çš„é…ç½®è¡¨è¾¾å¼è¯­è¨€å‚è€ƒã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/expression-language/>è¡¨è¾¾å¼è¯­è¨€</a></li><li role=treeitem aria-label=é€‚é…å™¨><button aria-hidden=true></button><a title="Mixer é€‚é…å™¨èƒ½å¤Ÿè®© Istio è¿æ¥å„ç§åŸºç¡€è®¾æ–½åç«¯ä»¥å®Œæˆç±»ä¼¼æŒ‡æ ‡å’Œæ—¥å¿—è¿™æ ·çš„åŠŸèƒ½ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/>é€‚é…å™¨</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Apigee çš„åˆ†å¸ƒå¼ç­–ç•¥æ£€æŸ¥ä»¥åŠåˆ†æé€‚é…å™¨ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/apigee/>Apigee</a></li><li role=none><a role=treeitem title="é€‚ç”¨äº circonus.com çš„ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/circonus/>Circonus</a></li><li role=none><a role=treeitem title="CloudMonitor é€‚é…å™¨ä½¿ Istio å¯ä»¥å‘ AliCloud CloudMonitor æä¾›æŒ‡æ ‡ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/cloudmonitor/>CloudMonitor</a></li><li role=none><a role=treeitem title=å§‹ç»ˆè¿”å›æŒ‰å‰ææ¡ä»¶æ‹’ç»çš„é€‚é…å™¨ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/denier/>Denier</a></li><li role=none><a role=treeitem title="ç”¨äºå°†æ—¥å¿—å‘é€ç»™ Fluentd å®ˆæŠ¤è¿›ç¨‹çš„é€‚é…å™¨ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/fluentd/>Fluentd</a></li><li role=none><a role=treeitem title="å°†æŒ‡æ ‡å‘é€åˆ° SignalFx çš„é€‚é…å™¨ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/signalfx/>SignalFx</a></li><li role=none><a role=treeitem title="ä» Kubernetes ç¯å¢ƒä¸­è·å–é›†ç¾¤ä¿¡æ¯ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/kubernetesenv/>Kubernetes Env</a></li><li role=none><a role=treeitem title=ç”¨äºæ‰§è¡Œé»‘åå•æˆ–ç™½åå•æ£€æµ‹çš„é€‚é…å™¨ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/list/>List</a></li><li role=none><a role=treeitem title=ç®€å•å†…å­˜é…é¢ç®¡ç†ç³»ç»Ÿé€‚é…å™¨ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/memquota/>Memory quota</a></li><li role=none><a role=treeitem title="åŸºäº Redis çš„é…é¢ç®¡ç†ç³»ç»Ÿã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/redisquota/>Redis Quota</a></li><li role=none><a role=treeitem title="ç”¨äºå‘ Google Service Control å‘é€æ—¥å¿—å’ŒæŒ‡æ ‡çš„é€‚é…å™¨ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/servicecontrol/>Service Control</a></li><li role=none><a role=treeitem title="è¯¥é€‚é…å™¨ç”¨äºå‘ statsd åç«¯å‘é€æŒ‡æ ‡æ•°æ®ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/statsd/>statsd</a></li><li role=none><a role=treeitem title=è¯¥é€‚é…å™¨å¯ä»¥åœ¨æœ¬åœ°è¾“å‡ºæ—¥å¿—å’ŒæŒ‡æ ‡ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/adapters/stdio/>Stdio</a></li></ul></li><li role=treeitem aria-label=æ¨¡æ¿><button aria-hidden=true></button><a title="Mixer æ¨¡æ¿ç”¨äºå°†æ•°æ®å‘é€åˆ°å„ä¸ªé€‚é…å™¨ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/>æ¨¡æ¿</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="è¯¥æ¨¡æ¿ç”¨äºè¡¨è¾¾ä¸€ä¸ª API Keyã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/apikey/>API Key</a></li><li role=none><a role=treeitem title="Analytics æ¨¡æ¿ç”¨äºå‘ Apigee å‘é€è¿è¡Œæ—¶é¥æµ‹æ•°æ®ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/analytics/>Analytics</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡ç‰ˆç”¨äºè®¿é—®æ§åˆ¶æŸ¥è¯¢ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/authorization/>Authorization</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œç”¨äºæµ‹è¯•ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/checknothing/>Check Nothing</a></li><li role=none><a role=treeitem title="ç”¨äºç”Ÿæˆ Kubernetes çš„ç‰¹å®šå±æ€§ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/kubernetes/>Kubernetes</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ç”¨äºæ‰§è¡Œåˆ—è¡¨æ£€æŸ¥æ“ä½œã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/listentry/>List Entry</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ç”¨äºè¡¨è¾¾ä¸€æ¡è¿è¡Œæ—¶æ—¥å¿—é¡¹ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/logentry/>Log Entry</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ç”¨äºè¡¨è¾¾ä¸€ä¸ªè¿è¡Œæ—¶äº§ç”Ÿçš„ç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/metric/>Metric</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ç”¨äºè¡¨è¾¾å ç”¨é…é¢çš„è¯·æ±‚ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/quota/>Quota</a></li><li role=none><a role=treeitem title=è¯¥æ¨¡æ¿ä¸åŒ…å«æ•°æ®ï¼Œç”¨äºæµ‹è¯•ã€‚ href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/reportnothing/>Report Nothing</a></li><li role=none><a role=treeitem title="ç”¨äº Google Service Control é€‚é…å™¨çš„æ¨¡æ¿ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/servicecontrolreport/>Service Control Report</a></li><li role=none><a role=treeitem title="è¯¥æ¨¡æ¿ç”¨äºè¡¨è¾¾åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ä¸­çš„ä¸€ä¸ª Spanã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/templates/tracespan/>Trace Span</a></li></ul></li><li role=none><a role=treeitem title="é€šè¿‡ Mixer ä» Istio å¯¼å‡ºçš„é»˜è®¤ç›‘æ§æŒ‡æ ‡ã€‚" href=/v1.2/zh/docs/reference/config/policy-and-telemetry/metrics/>é»˜è®¤ç›‘æ§æŒ‡æ ‡</a></li></ul></li><li role=none><span role=treeitem class=current title=æµé‡è·¯ç”±é…ç½®ã€‚>é€šä¿¡è·¯ç”±</span></li></ul></li><li role=treeitem aria-label=å‘½ä»¤><button aria-hidden=true></button><a title="æè¿° Istio å‘½ä»¤å’Œå·¥å…·çš„ç”¨æ³•åŠé€‰é¡¹ã€‚" href=/v1.2/zh/docs/reference/commands/>å‘½ä»¤</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Galley ä¸º Istio æä¾›é…ç½®ç®¡ç†æœåŠ¡ã€‚" href=/v1.2/zh/docs/reference/commands/galley/>galley</a></li><li role=none><a role=treeitem title="è‡ªåŠ¨æ³¨å…¥ Istio sidecar çš„ Kubernetes webhookã€‚" href=/v1.2/zh/docs/reference/commands/sidecar-injector/>sidecar-injector</a></li><li role=none><a role=treeitem title="Istio æ§åˆ¶ç•Œé¢ã€‚" href=/v1.2/zh/docs/reference/commands/istioctl/>istioctl</a></li><li role=none><a role=treeitem title="Istio è¯ä¹¦é¢å‘ï¼ˆCAï¼‰ã€‚" href=/v1.2/zh/docs/reference/commands/istio_ca/>istio_ca</a></li><li role=none><a role=treeitem title="ç”¨äºè§¦å‘ç›´æ¥è°ƒç”¨ Mixer API çš„å®ç”¨ç¨‹åºã€‚" href=/v1.2/zh/docs/reference/commands/mixc/>mixc</a></li><li role=none><a role=treeitem title="Mixer æ˜¯ Istio åœ¨åç«¯åŸºç¡€è®¾æ–½ä¹‹ä¸Šçš„æŠ½è±¡ã€‚" href=/v1.2/zh/docs/reference/commands/mixs/>mixs</a></li><li role=none><a role=treeitem title="èŠ‚ç‚¹ä¸€çº§çš„ Istio å®‰å…¨ä»£ç†ã€‚" href=/v1.2/zh/docs/reference/commands/node_agent/>node_agent</a></li><li role=none><a role=treeitem title="Istio Pilotã€‚" href=/v1.2/zh/docs/reference/commands/pilot-discovery/>pilot-discovery</a></li></ul></li><li role=none><a role=treeitem title="Istio å¸¸è§çš„æœ¯è¯­è¡¨ã€‚" href=/v1.2/zh/docs/reference/glossary/>æœ¯è¯­è¡¨</a></li></ul></div></div></div></nav></div><div class=article-container><button tabindex=-1 id=sidebar-toggler title=æŠ˜å å¯¼èˆªæ ><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#pull"/></svg></button><nav aria-label=Breadcrumb><ol><li><a href=/v1.2/zh/>Istio</a></li><li><a href=/v1.2/zh/docs/ title="äº†è§£å¦‚ä½•éƒ¨ç½²ã€ä½¿ç”¨å’Œè¿ç»´ Istioã€‚">æ–‡æ¡£</a></li><li><a href=/v1.2/zh/docs/reference/ title="å‚è€ƒéƒ¨åˆ†åŒ…å«è¯¦ç»†çš„æƒå¨å‚è€ƒèµ„æ–™ï¼Œå¦‚å‘½ä»¤è¡Œé€‰é¡¹ã€é…ç½®é€‰é¡¹å’Œ API è°ƒç”¨å‚æ•°ã€‚">å‚è€ƒ</a></li><li><a href=/v1.2/zh/docs/reference/config/ title=å…³äºé…ç½®é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ã€‚>é…ç½®</a></li><li>é€šä¿¡è·¯ç”±</li></ol></nav><article aria-labelledby=title><div class=title-area><div><h1 id=title>é€šä¿¡è·¯ç”±</h1><p class=byline><span title="3418 å­—"><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#clock"/></svg><span>&nbsp;</span>é˜…è¯»å¤§çº¦éœ€è¦ 17 åˆ†é’Ÿ</span></p></div></div><nav class=toc-inlined aria-label="Table of Contents"><div><hr><ol><li role=none aria-label=ConnectionPoolSettings><a href=#connectionpoolsettings><code>ConnectionPoolSettings</code></a><li role=none aria-label=ConnectionPoolSettings.HTTPSettings><a href=#connectionpoolsettings-httpsettings><code>ConnectionPoolSettings.HTTPSettings</code></a><li role=none aria-label=ConnectionPoolSettings.TCPSettings><a href=#connectionpoolsettings-tcpsettings><code>ConnectionPoolSettings.TCPSettings</code></a><li role=none aria-label=CorsPolicy><a href=#corspolicy><code>CorsPolicy</code></a><li role=none aria-label=Destination><a href=#destination><code>Destination</code></a><li role=none aria-label=DestinationRule><a href=#destinationrule><code>DestinationRule</code></a><li role=none aria-label=DestinationWeight><a href=#destinationweight><code>DestinationWeight</code></a><li role=none aria-label=EnvoyFilter><a href=#envoyfilter><code>EnvoyFilter</code></a><li role=none aria-label=EnvoyFilter.Filter><a href=#envoyfilter-filter><code>EnvoyFilter.Filter</code></a><li role=none aria-label=EnvoyFilter.Filter.FilterType><a href=#envoyfilter-filter-filtertype><code>EnvoyFilter.Filter.FilterType</code></a><li role=none aria-label=EnvoyFilter.InsertPosition><a href=#envoyfilter-insertposition><code>EnvoyFilter.InsertPosition</code></a><li role=none aria-label=EnvoyFilter.InsertPosition.Index><a href=#envoyfilter-insertposition-index><code>EnvoyFilter.InsertPosition.Index</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch><a href=#envoyfilter-listenermatch><code>EnvoyFilter.ListenerMatch</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch.ListenerProtocol><a href=#envoyfilter-listenermatch-listenerprotocol><code>EnvoyFilter.ListenerMatch.ListenerProtocol</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch.ListenerType><a href=#envoyfilter-listenermatch-listenertype><code>EnvoyFilter.ListenerMatch.ListenerType</code></a><li role=none aria-label=Gateway><a href=#gateway><code>Gateway</code></a><li role=none aria-label=HTTPFaultInjection><a href=#httpfaultinjection><code>HTTPFaultInjection</code></a><li role=none aria-label=HTTPFaultInjection.Abort><a href=#httpfaultinjection-abort><code>HTTPFaultInjection.Abort</code></a><li role=none aria-label=HTTPFaultInjection.Delay><a href=#httpfaultinjection-delay><code>HTTPFaultInjection.Delay</code></a><li role=none aria-label=HTTPMatchRequest><a href=#httpmatchrequest><code>HTTPMatchRequest</code></a><li role=none aria-label=HTTPRedirect><a href=#httpredirect><code>HTTPRedirect</code></a><li role=none aria-label=HTTPRetry><a href=#httpretry><code>HTTPRetry</code></a><li role=none aria-label=HTTPRewrite><a href=#httprewrite><code>HTTPRewrite</code></a><li role=none aria-label=HTTPRoute><a href=#httproute><code>HTTPRoute</code></a><li role=none aria-label=L4MatchAttributes><a href=#l4matchattributes><code>L4MatchAttributes</code></a><li role=none aria-label=LoadBalancerSettings><a href=#loadbalancersettings><code>LoadBalancerSettings</code></a><li role=none aria-label=LoadBalancerSettings.ConsistentHashLB><a href=#loadbalancersettings-consistenthashlb><code>LoadBalancerSettings.ConsistentHashLB</code></a><li role=none aria-label=LoadBalancerSettings.ConsistentHashLB.HTTPCookie><a href=#loadbalancersettings-consistenthashlb-httpcookie><code>LoadBalancerSettings.ConsistentHashLB.HTTPCookie</code></a><li role=none aria-label=LoadBalancerSettings.SimpleLB><a href=#loadbalancersettings-simplelb><code>LoadBalancerSettings.SimpleLB</code></a><li role=none aria-label=OutlierDetection><a href=#outlierdetection><code>OutlierDetection</code></a><li role=none aria-label=Port><a href=#port><code>Port</code></a><li role=none aria-label=PortSelector><a href=#portselector><code>PortSelector</code></a><li role=none aria-label=Server><a href=#server><code>Server</code></a><li role=none aria-label=Server.TLSOptions><a href=#server-tlsoptions><code>Server.TLSOptions</code></a><li role=none aria-label=Server.TLSOptions.TLSmode><a href=#server-tlsoptions-tlsmode><code>Server.TLSOptions.TLSmode</code></a><li role=none aria-label=ServiceEntry><a href=#serviceentry><code>ServiceEntry</code></a><ol><li role=none aria-label=ç¤ºä¾‹ï¼šåŠ å…¥å¤–éƒ¨æœåŠ¡><a href=#%e7%a4%ba%e4%be%8b-%e5%8a%a0%e5%85%a5%e5%a4%96%e9%83%a8%e6%9c%8d%e5%8a%a1>ç¤ºä¾‹ï¼šåŠ å…¥å¤–éƒ¨æœåŠ¡</a><li role=none aria-label="ç¤ºä¾‹ï¼šTLS é€ä¼ "><a href=#%e7%a4%ba%e4%be%8b-tls-%e9%80%8f%e4%bc%a0>ç¤ºä¾‹ï¼šTLS é€ä¼ </a><li role=none aria-label=è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡><a href=#%e8%bd%ac%e5%8f%91%e6%89%80%e6%9c%89%e5%a4%96%e9%83%a8%e6%b5%81%e9%87%8f>è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡</a><li role=none aria-label=ç¤ºä¾‹ï¼šé€šé…ç¬¦åŸŸå><a href=#%e7%a4%ba%e4%be%8b-%e9%80%9a%e9%85%8d%e7%ac%a6%e5%9f%9f%e5%90%8d>ç¤ºä¾‹ï¼šé€šé…ç¬¦åŸŸå</a><li role=none aria-label="Unix Socket è¿æ¥"><a href=#unix-socket-%e8%bf%9e%e6%8e%a5>Unix Socket è¿æ¥</a><li role=none aria-label=ä»£ç†æœåŠ¡å™¨><a href=#%e4%bb%a3%e7%90%86%e6%9c%8d%e5%8a%a1%e5%99%a8>ä»£ç†æœåŠ¡å™¨</a></ol></li><li role=none aria-label=ServiceEntry.Endpoint><a href=#serviceentry-endpoint><code>ServiceEntry.Endpoint</code></a><li role=none aria-label=ServiceEntry.Location><a href=#serviceentry-location><code>ServiceEntry.Location</code></a><li role=none aria-label=ServiceEntry.Resolution><a href=#serviceentry-resolution><code>ServiceEntry.Resolution</code></a><li role=none aria-label=StringMatch><a href=#stringmatch><code>StringMatch</code></a><li role=none aria-label=Subset><a href=#subset><code>Subset</code></a><li role=none aria-label=TCPRoute><a href=#tcproute><code>TCPRoute</code></a><li role=none aria-label=TLSMatchAttributes><a href=#tlsmatchattributes><code>TLSMatchAttributes</code></a><li role=none aria-label=TLSRoute><a href=#tlsroute><code>TLSRoute</code></a><li role=none aria-label=TLSSettings><a href=#tlssettings><code>TLSSettings</code></a><li role=none aria-label=TLSSettings.TLSmode><a href=#tlssettings-tlsmode><code>TLSSettings.TLSmode</code></a><li role=none aria-label=TrafficPolicy><a href=#trafficpolicy><code>TrafficPolicy</code></a><li role=none aria-label=TrafficPolicy.PortTrafficPolicy><a href=#trafficpolicy-porttrafficpolicy><code>TrafficPolicy.PortTrafficPolicy</code></a><li role=none aria-label=VirtualService><a href=#virtualservice><code>VirtualService</code></a></ol><hr></div></nav><p>è·¯ç”±æ–¹é¢çš„é…ç½®ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯ä¸è¯¥é…ç½®ä¸Šä¸‹æ–‡æœ‰å…³çš„è¯æ±‡ã€‚</p><p><code>Serviceï¼ˆæœåŠ¡ï¼‰</code>ï¼šæœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¸€ä¸ªå•ä½ï¼Œå…·å¤‡å”¯ä¸€åç§°ï¼Œä»£è¡¨äº†ä¸€ä¸ªåº”ç”¨ã€‚ä¸€ä¸ªæœåŠ¡æ˜¯ç”±å¤šä¸ªç½‘ç»œç«¯ç‚¹æ„æˆçš„ï¼Œè¿™äº›ç«¯ç‚¹æ˜¯ç”±è¿è¡Œåœ¨ Podã€å®¹å™¨æˆ–è€…è™šæ‹Ÿæœºä¸Šçš„å·¥ä½œè´Ÿè½½å®ä¾‹å®ç°çš„ã€‚</p><p><code>Service versionsï¼ˆä¹Ÿå«åš subset/å­é›†ï¼‰</code>ï¼šåœ¨æŒç»­éƒ¨ç½²çš„åœºæ™¯ä¸­ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½ä¼šæœ‰å¤šä¸ªå­é›†åœ¨åŒæ—¶è¿è¡Œã€‚å­é›†ä¹‹é—´çš„é€šå¸¸ä¼šæœ‰ API ç‰ˆæœ¬æ–¹é¢çš„åŒºåˆ«ã€‚ä¸åŒçš„å­é›†å¯èƒ½æ˜¯åŒä¸€æœåŠ¡çš„ä¸åŒè¿­ä»£é˜¶æ®µï¼Œæˆ–è€…ä¸åŒç¯å¢ƒçš„éƒ¨ç½²ï¼ˆç”Ÿäº§ã€é¢„å‘å¸ƒä»¥åŠå¼€å‘ç­‰ï¼‰ã€‚å­é›†çš„å­˜åœ¨ï¼Œå¯¹äº A/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒç­‰åœºæ™¯éƒ½æ˜¯å¿…è¦çš„ã€‚å¯ä»¥ä½¿ç”¨å¤šç§æ¡ä»¶ï¼ˆHeaderã€URL ç­‰ï¼‰æ¥ä¸ºæµé‡é€‰æ‹©å¯¹åº”çš„å­é›†ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªç¼ºçœçš„ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«äº†è¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ã€‚</p><p><code>Sourceï¼ˆæºï¼‰</code>ï¼šè°ƒç”¨æŸæœåŠ¡çš„ä¸‹æ¸¸å®¢æˆ·ç«¯ã€‚</p><p><code>Hostï¼ˆä¸»æœºï¼‰</code>ï¼šå®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡æ—¶æ‰€ä½¿ç”¨çš„åœ°å€ã€‚</p><p><code>Access modelï¼ˆè®¿é—®æ¨¡å‹ï¼‰</code>ï¼šåº”ç”¨ä»…å…³æ³¨ç›®æ ‡æœåŠ¡ï¼ˆä¸»æœºï¼‰ï¼Œè€Œå¯¹äºæœåŠ¡çš„ç‰ˆæœ¬æˆ–è€…å­é›†ä¸€æ— æ‰€çŸ¥ã€‚ç‰ˆæœ¬é€‰æ‹©çš„å†³ç­–è¿‡ç¨‹ç”±ä»£ç†ï¼ˆSidecarï¼‰å®Œæˆï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œåº”ç”¨ä»£ç å°±å¯ä»¥è„±ç¦»å¯¹æœåŠ¡å…·ä½“ç‰ˆæœ¬çš„ä¾èµ–äº†ã€‚</p><h2 id=connectionpoolsettings><code>ConnectionPoolSettings</code></h2><p>ä¸Šæ¸¸ä¸»æœºçš„è¿æ¥æ± è®¾ç½®ã€‚è¿™ä¸€è®¾ç½®ä¼šåº”ç”¨åˆ°ä¸Šæ¸¸æœåŠ¡ä¸­çš„æ¯ä¸ªä¸»æœºä¸Šã€‚å¯ä»¥å‚è€ƒ Envoy çš„<a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/circuit_breaking>æ–­è·¯å™¨æ–‡æ¡£</a>è·å–æ›´å¤šä¿¡æ¯ã€‚è¿™ä¸€è®¾ç½®åœ¨ TCP å’Œ HTTP çº§åˆ«éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™ä¸º Redis æœåŠ¡è®¾ç½®äº†ä¸€ä¸ªåä¸º <code>myredissrv</code> çš„è§„åˆ™ï¼Œé™åˆ¶è¿æ¥æ•°ä¸Šé™ä¸º 100ï¼Œè¿æ¥è¶…æ—¶é™åˆ¶ä¸º 30 æ¯«ç§’ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-redis
spec:
  host: myredissrv.prod.svc.cluster.local
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
        connectTimeout: 30ms
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>tcp</code></td><td><a href=#connectionpoolsettings-tcpsettings><code>ConnectionPoolSettings.TCPSettings</code></a></td><td>è¿æ¥æ•°é™åˆ¶ï¼Œå¯¹ HTTP å’Œ TCP éƒ½æœ‰æ•ˆã€‚</td></tr><tr><td><code>http</code></td><td><a href=#connectionpoolsettings-httpsettings><code>ConnectionPoolSettings.HTTPSettings</code></a></td><td>HTTP è¿æ¥æ± è®¾ç½®ã€‚</td></tr></tbody></table><h2 id=connectionpoolsettings-httpsettings><code>ConnectionPoolSettings.HTTPSettings</code></h2><p>é’ˆå¯¹ HTTP1.1/HTTP2/GRPC è¿æ¥çš„è®¾ç½®é¡¹ç›®ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>http1MaxPendingRequests</code></td><td><code>int32</code></td><td>é’ˆå¯¹ä¸€ä¸ªç›®æ ‡çš„ HTTP è¯·æ±‚çš„æœ€å¤§æ’é˜Ÿæ•°é‡ï¼Œç¼ºçœå€¼ä¸º 1024ã€‚</td></tr><tr><td><code>http2MaxRequests</code></td><td><code>int32</code></td><td>å¯¹ä¸€ä¸ªåç«¯çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œç¼ºçœå€¼ä¸º 1024ã€‚</td></tr><tr><td><code>maxRequestsPerConnection</code></td><td><code>int32</code></td><td>å¯¹æŸä¸€åç«¯çš„è¯·æ±‚ä¸­ï¼Œä¸€ä¸ªè¿æ¥å†…èƒ½å¤Ÿå‘å‡ºçš„æœ€å¤§è¯·æ±‚æ•°é‡ã€‚å¦‚æœå°†è¿™ä¸€å‚æ•°è®¾ç½®ä¸º 1 åˆ™ä¼šç¦æ­¢ <code>keep alive</code> ç‰¹æ€§ã€‚</td></tr><tr><td><code>maxRetries</code></td><td><code>int32</code></td><td>åœ¨ç»™å®šæ—¶é—´å†…ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºå¯ä»¥æ‰§è¡Œçš„æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</td></tr></tbody></table><h2 id=connectionpoolsettings-tcpsettings><code>ConnectionPoolSettings.TCPSettings</code></h2><p>å¯¹ TCP å’Œ HTTP éƒ½æœ‰æ•ˆçš„çš„é€šç”¨è¿æ¥è®¾ç½®ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>maxConnections</code></td><td><code>int32</code></td><td>åˆ°ç›®æ ‡ä¸»æœºçš„ HTTP1/TCP æœ€å¤§è¿æ¥æ•°ã€‚</td></tr><tr><td><code>connectTimeout</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>TCP è¿æ¥è¶…æ—¶</td></tr></tbody></table><h2 id=corspolicy><code>CorsPolicy</code></h2><p>ä¸ºæœåŠ¡å®šä¹‰è·¨æ¥æºèµ„æºå…±äº«ï¼ˆ<a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS>Cross-Origin Resource Sharing</a>ï¼Œç¼©å†™ä¸º CORSï¼‰ç­–ç•¥ã€‚ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™å¯¹æ¥è‡ª <code>example.com</code> åŸŸçš„è·¨æ¥æºè¯·æ±‚è¿›è¡Œäº†é™åˆ¶ï¼š</p><ul><li>ä»…å…è®¸ <code>POST</code> å’Œ <code>GET</code> æ“ä½œã€‚</li><li>è®¾ç½® <code>Access-Control-Allow-Credentials</code> Header çš„å€¼ä¸º Falseã€‚</li><li>åªå¼€æ”¾ <code>X-Foo-bar</code> Headerã€‚</li><li>è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 1 å¤©ã€‚</li></ul><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - route:
    - destination:
        host: ratings.prod.svc.cluster.local
        subset: v1
    corsPolicy:
      allowOrigin:
      - example.com
      allowMethods:
      - POST
      - GET
      allowCredentials: false
      allowHeaders:
      - X-Foo-Bar
      maxAge: &#34;1d&#34;
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>allowOrigin</code></td><td><code>string[]</code></td><td>å…è®¸å‘èµ· CORS è¯·æ±‚çš„æ¥æºåˆ—è¡¨ã€‚è¿™ä¸€å­—æ®µçš„å†…å®¹ä¼šè¢«åºåˆ—åŒ–ä¹‹åä¿å­˜åˆ° <code>Access-Control-Allow-Origin header</code> Header ä¹‹ä¸­ã€‚ä½¿ç”¨é€šé…ç¬¦ <code>*</code> ä¼šå…è®¸æ‰€æœ‰æ¥æºã€‚</td></tr><tr><td><code>allowMethods</code></td><td><code>string[]</code></td><td>å…è®¸è®¿é—®èµ„æºçš„ HTTP æ–¹æ³•ï¼Œå­—æ®µå†…å®¹ä¼šè¿›è¡Œåºåˆ—åŒ–ä¹‹åä¿å­˜åˆ° <code>Access-Control-Allow-Methods</code> Header ä¹‹ä¸­ã€‚</td></tr><tr><td><code>allowHeaders</code></td><td><code>string[]</code></td><td>åœ¨è¯·æ±‚èµ„æºæ—¶å¯ä»¥ä½¿ç”¨çš„ HTTP Header åˆ—è¡¨ï¼Œä¼šè¢«åºåˆ—åŒ–åä¿å­˜åˆ° <code>Access-Control-Allow-Methods</code> Header ä¹‹ä¸­ã€‚</td></tr><tr><td><code>exposeHeaders</code></td><td><code>string[]</code></td><td>ä¸€ä¸ªå…è®¸æµè§ˆå™¨è®¿é—®çš„ HTTP Header ç™½åå•ï¼Œä¼šè¢«åºåˆ—åŒ–åä¿å­˜åˆ° <code>Access-Control-Expose-Headers</code> Header ä¹‹ä¸­ã€‚</td></tr><tr><td><code>maxAge</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>å¯ä»¥ç¼“å­˜é¢„æ£€è¯·æ±‚ç»“æœçš„æœ‰æ•ˆæœŸã€‚ä¿å­˜åˆ° <code>Access-Control-Max-Age</code> Header ä¹‹ä¸­ã€‚</td></tr><tr><td><code>allowCredentials</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.BoolValue</code></a></td><td>æ˜¯å¦å…è®¸è°ƒç”¨è€…æºå¸¦è®¤è¯ä¿¡æ¯å¯¹èµ„æºå‘èµ·å®é™…è¯·æ±‚ï¼ˆéé¢„æ£€ï¼‰ã€‚ä¼šä¿å­˜åˆ° <code>Access-Control-Allow-Credentials</code> Header ä¹‹ä¸­ã€‚</td></tr></tbody></table><h2 id=destination><code>Destination</code></h2><p><code>Destination</code> ç”¨äºå®šä¹‰åœ¨ç½‘ç»œä¸­å¯å¯»å€çš„æœåŠ¡ï¼Œè¯·æ±‚æˆ–è¿æ¥åœ¨ç»è¿‡è·¯ç”±è§„åˆ™çš„å¤„ç†ä¹‹åï¼Œå°±ä¼šè¢«å‘é€ç»™ <code>Destination</code>ã€‚<code>destination.host</code> åº”è¯¥æ˜ç¡®æŒ‡å‘æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¸€ä¸ªæœåŠ¡ã€‚Istio çš„æœåŠ¡æ³¨å†Œè¡¨é™¤åŒ…å«å¹³å°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼ˆä¾‹å¦‚ Kubernetes æœåŠ¡ã€Consul æœåŠ¡ï¼‰ä¹‹å¤–ï¼Œè¿˜åŒ…å«äº† <a href=#serviceentry><code>ServiceEntry</code></a> èµ„æºæ‰€å®šä¹‰çš„æœåŠ¡ã€‚</p><p><em>Kubernetes ç”¨æˆ·æ³¨æ„</em> ï¼šå½“ä½¿ç”¨æœåŠ¡çš„çŸ­åç§°æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>reviews</code>ï¼Œè€Œä¸æ˜¯ <code>reviews.default.svc.cluster.local</code>ï¼‰ï¼ŒIstio ä¼šæ ¹æ®è§„åˆ™æ‰€åœ¨çš„å‘½åç©ºé—´æ¥å¤„ç†è¿™ä¸€åç§°ï¼Œè€ŒéæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚å‡è®¾ â€œdefaultâ€ å‘½åç©ºé—´çš„ä¸€æ¡è§„åˆ™ä¸­åŒ…å«äº†ä¸€ä¸ª <code>reviews</code> çš„ <code>host</code> å¼•ç”¨ï¼Œå°±ä¼šè¢«è§†ä¸º <code>reviews.default.svc.cluster.local</code>ï¼Œè€Œä¸ä¼šè€ƒè™‘ <code>reviews</code> æœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚<strong>ä¸ºäº†é¿å…å¯èƒ½çš„é”™è¯¯é…ç½®ï¼Œå»ºè®®ä½¿ç”¨ FQDN æ¥è¿›è¡ŒæœåŠ¡å¼•ç”¨ã€‚</strong></p><p>ä¸‹é¢çš„ Kubernetes å®ä¾‹ï¼Œç¼ºçœæŠŠæ‰€æœ‰çš„æµé‡è·¯ç”±åˆ° <code>reviews</code> æœåŠ¡ä¸­å…·æœ‰æ ‡ç­¾ <code>version: v1</code>ï¼ˆä¹Ÿå°±æ˜¯ <code>v1</code> å­é›†ï¼‰çš„ Pod ä¸­ï¼Œå¦å¤–è¿˜æœ‰ä¸€éƒ¨åˆ†ä¼šè·¯ç”±åˆ° <code>v2</code> å­é›†ä¹‹ä¸­ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews-route
  namespace: foo
spec:
  hosts:
  - reviews # ç­‰ä»·äº reviews.foo.svc.cluster.local
  http:
  - match:
    - uri:
        prefix: &#34;/wpcatalog&#34;
    - uri:
        prefix: &#34;/consumercatalog&#34;
    rewrite:
      uri: &#34;/newcatalog&#34;
    route:
    - destination:
        host: reviews # å’Œ reviews.foo.svc.cluster.local ç­‰ä»·
        subset: v2
  - route:
    - destination:
        host: reviews # å’Œ reviews.foo.svc.cluster.local ç­‰ä»·
        subset: v1
</code></pre><p>ä¸‹é¢æ˜¯ç›¸å…³çš„ <code>DestinationRule</code>ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: reviews-destination
  namespace: foo
spec:
  host: reviews # ç­‰ä»·äº reviews.foo.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
</code></pre><p>æ¥ä¸‹æ¥çš„ <code>VirtualService</code> åœ¨ Kubernetes ä¸­ä¸ºæ‰€æœ‰å¯¹ <code>productpage.prod.svc.cluster.local</code> æœåŠ¡çš„è°ƒç”¨éƒ½è®¾ç½®äº†ä¸€ä¸ª 5 ç§’é’Ÿçš„è¶…æ—¶ã€‚æ³¨æ„è¿™é‡Œçš„è§„åˆ™ä¸­æ²¡æœ‰å­é›†çš„å®šä¹‰ã€‚Istio ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠ“å– <code>productpage.prod.svc.cluster.local</code> æœåŠ¡æ‰€æœ‰å®ä¾‹ï¼Œæ®æ­¤ç”Ÿæˆ Envoy çš„è´Ÿè½½å‡è¡¡æ± ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯åœ¨ <code>istio-system</code> å‘½åç©ºé—´ä¸­è®¾ç½®çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯ <code>productpage</code> æœåŠ¡çš„ FQDNï¼š<code>productpage.prod.svc.cluster.local</code>ã€‚è¿™æ ·è§„åˆ™æ‰€å¤„çš„å‘½åç©ºé—´å°±ä¸ä¼šå¯¹ <code>prodcutpage</code> æœåŠ¡çš„è§£æè¿‡ç¨‹é€ æˆå½±å“äº†ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: my-productpage-rule
  namespace: istio-system
spec:
  hosts:
  - productpage.prod.svc.cluster.local # æ— è§†è§„åˆ™æ‰€åœ¨çš„å‘½åç©ºé—´
  http:
  - timeout: 5s
    route:
    - destination:
        host: productpage.prod.svc.cluster.local
</code></pre><p>è¦æ§åˆ¶å‘ç½‘æ ¼ä¹‹å¤–å‘å‡ºçš„æµé‡ï¼Œå¤–éƒ¨æœåŠ¡é¦–å…ˆè¦ä»¥ <code>ServiceEntry</code> èµ„æºçš„å½¢å¼åœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­è¿›è¡Œå®šä¹‰ã€‚å®šä¹‰å®Œæˆä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>ServiceEntry</code> èµ„æºæ¥æ§åˆ¶åˆ°è¿™äº›å¤–éƒ¨æœåŠ¡çš„æµé‡äº†ã€‚ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™ä¸º <code>wikipedia.org</code> å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡ï¼Œå¹¶ä¸º http è¯·æ±‚è®¾ç½®äº†ä¸€ä¸ª 5 ç§’é’Ÿçš„è¶…æ—¶ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-wikipedia
spec:
  hosts:
  - wikipedia.org
  location: MESH_EXTERNAL
  ports:
  - number: 80
    name: example-http
    protocol: HTTP
  resolution: DNS

apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: my-wiki-rule
spec:
  hosts:
  - wikipedia.org
  http:
  - timeout: 5s
    route:
    - destination:
        host: wikipedia.org
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>host</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚ç›®æ ‡æœåŠ¡çš„åç§°ã€‚æµé‡ç›®æ ‡å¯¹åº”çš„æœåŠ¡ï¼Œä¼šåœ¨å¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ï¼ˆä¾‹å¦‚ Kubernetes æœåŠ¡å’Œ Consul æœåŠ¡ï¼‰ä»¥åŠ <a href=#serviceentry><code>ServiceEntry</code></a> èµ„æºä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¸¢å¼ƒæµé‡ã€‚<strong>Kubernetes ç”¨æˆ·æ³¨æ„ï¼šå½“ä½¿ç”¨æœåŠ¡çš„çŸ­åç§°æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>reviews</code>ï¼Œè€Œä¸æ˜¯ <code>reviews.default.svc.cluster.local</code>ï¼‰ï¼ŒIstio ä¼šæ ¹æ®è§„åˆ™æ‰€åœ¨çš„å‘½åç©ºé—´æ¥å¤„ç†è¿™ä¸€åç§°ï¼Œè€ŒéæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚å‡è®¾ â€œdefaultâ€ å‘½åç©ºé—´çš„ä¸€æ¡è§„åˆ™ä¸­åŒ…å«äº†ä¸€ä¸ª <code>reviews</code> çš„ <code>host</code> å¼•ç”¨ï¼Œå°±ä¼šè¢«è§†ä¸º <code>reviews.default.svc.cluster.local</code>ï¼Œè€Œä¸ä¼šè€ƒè™‘ <code>reviews</code> æœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚ä¸ºäº†é¿å…å¯èƒ½çš„é”™è¯¯é…ç½®ï¼Œå»ºè®®ä½¿ç”¨ FQDN æ¥è¿›è¡ŒæœåŠ¡å¼•ç”¨ã€‚</strong></td></tr><tr><td><code>subset</code></td><td><code>string</code></td><td>æœåŠ¡å­é›†çš„åç§°ã€‚ä»…å¯¹ç½‘æ ¼ä¸­çš„æœåŠ¡æœ‰æ•ˆã€‚å¿…é¡»åœ¨ <code>DestinationRule</code> ä¸­å®šä¹‰å­é›†ã€‚</td></tr><tr><td><code>port</code></td><td><a href=#portselector><code>PortSelector</code></a></td><td>æŒ‡å®šç›®æ ‡ä¸»æœºçš„ç«¯å£ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡åªæš´éœ²äº†ä¸€ä¸ªç«¯å£ï¼Œé‚£ä¹ˆå°±æ— éœ€æ˜¾å¼çš„è¿›è¡Œç«¯å£é€‰æ‹©ã€‚</td></tr></tbody></table><h2 id=destinationrule><code>DestinationRule</code></h2><p><code>DestinationRule</code> æ‰€å®šä¹‰çš„ç­–ç•¥ï¼Œå†³å®šäº†ç»è¿‡è·¯ç”±å¤„ç†ä¹‹åçš„æµé‡çš„è®¿é—®ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥ä¸­å¯ä»¥å®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®ã€è¿æ¥æ± å°ºå¯¸ä»¥åŠå¤–éƒ¨æ£€æµ‹ï¼ˆç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ± ä¸­å¯¹ä¸å¥åº·ä¸»æœºè¿›è¡Œè¯†åˆ«å’Œé©±é€ï¼‰é…ç½®ã€‚ä¾‹å¦‚ç»™ <code>ratings</code> æœåŠ¡å®šä¹‰ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-ratings
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN
</code></pre><p>å¯ä»¥å°†ç­–ç•¥æŒ‡æ´¾ç»™æœåŠ¡çš„ç‰¹å®šç‰ˆæœ¬ï¼Œè¦å®Œæˆè¿™ä¸€æ“ä½œéœ€è¦å®šä¹‰ä¸€ä¸ª <code>subset</code>ï¼Œå¹¶ä¸”åœ¨ <code>subset</code> ä¸­å¯¹æœåŠ¡çº§å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¦†ç›–ã€‚ä¸‹æ–‡è§„åˆ™çš„å®šä¹‰ä¸­ï¼Œç¼ºçœçš„è´Ÿè½½å‡è¡¡æ–¹å¼æ˜¯ <code>LEAST_CONN</code>ï¼›è€Œåœ¨ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªåç§°ä¸º <code>testversion</code> çš„ <code>subset</code>ï¼Œè¿™ä¸ªå­é›†çš„ Pod ç‰¹å¾æ˜¯ <code>version</code> æ ‡ç­¾å–å€¼ä¸º <code>v3</code>ï¼Œè¯¥å­é›†çš„è´Ÿè½½å‡è¡¡æ¨¡å¼ä¸º <code>ROUND_ROBIN</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-ratings
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN
  subsets:
  - name: testversion
    labels:
      version: v3
    trafficPolicy:
      loadBalancer:
        simple: ROUND_ROBIN
</code></pre><p><strong>æ³¨æ„</strong>ï¼šåªæœ‰åœ¨æµé‡è¢«æ˜¾å¼çš„å‘é€ç»™æŸä¸€å­é›†çš„æ—¶å€™ï¼ŒæŒ‡æ´¾ç»™è¯¥å­é›†çš„ç­–ç•¥æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>æµé‡ç­–ç•¥è¿˜å¯ä»¥æ ¹æ®ç«¯å£æ¥è¿›è¡Œå®šä¹‰ã€‚æ¥ä¸‹æ¥çš„è§„åˆ™ï¼Œè¦æ±‚æ‰€æœ‰ä½¿ç”¨ <code>80</code> ç«¯å£çš„æµé‡ä½¿ç”¨ <code>LEAST_CONN</code> æ–¹å¼çš„è´Ÿè½½å‡è¡¡ï¼›è€Œä½¿ç”¨ <code>9080</code> ç«¯å£çš„æµé‡åˆ™ä½¿ç”¨ <code>ROUND_ROBIN</code> æ–¹å¼ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-ratings-port
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy: # å¯¹æ‰€æœ‰ç«¯å£ç”Ÿæ•ˆ
    portLevelSettings:
    - port:
        number: 80
      loadBalancer:
        simple: LEAST_CONN
    - port:
        number: 9080
      loadBalancer:
        simple: ROUND_ROBIN
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>host</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚ç›®æ ‡æœåŠ¡çš„åç§°ã€‚æµé‡ç›®æ ‡å¯¹åº”çš„æœåŠ¡ï¼Œä¼šåœ¨åœ¨å¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ï¼ˆä¾‹å¦‚ Kubernetes æœåŠ¡å’Œ Consul æœåŠ¡ï¼‰ä»¥åŠ <a href=#serviceentry><code>ServiceEntry</code></a> æ³¨å†Œä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¸¢å¼ƒæµé‡ã€‚<strong>Kubernetes ç”¨æˆ·æ³¨æ„ï¼šå½“ä½¿ç”¨æœåŠ¡çš„çŸ­åç§°æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>reviews</code>ï¼Œè€Œä¸æ˜¯ <code>reviews.default.svc.cluster.local</code>ï¼‰ï¼ŒIstio ä¼šæ ¹æ®è§„åˆ™æ‰€åœ¨çš„å‘½åç©ºé—´æ¥å¤„ç†è¿™ä¸€åç§°ï¼Œè€ŒéæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚å‡è®¾ <code>default</code> å‘½åç©ºé—´çš„ä¸€æ¡è§„åˆ™ä¸­åŒ…å«äº†ä¸€ä¸ª <code>reivews</code> çš„ <code>host</code> å¼•ç”¨ï¼Œå°±ä¼šè¢«è§†ä¸º <code>reviews.default.svc.cluster.local</code>ï¼Œè€Œä¸ä¼šè€ƒè™‘ <code>reviews</code> æœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚ä¸ºäº†é¿å…å¯èƒ½çš„é”™è¯¯é…ç½®ï¼Œå»ºè®®ä½¿ç”¨ FQDN æ¥è¿›è¡ŒæœåŠ¡å¼•ç”¨ã€‚</strong></td></tr><tr><td><code>trafficPolicy</code></td><td><a href=#trafficpolicy><code>TrafficPolicy</code></a></td><td>æµé‡ç­–ç•¥ï¼ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ã€é—´æ¥æ± å°ºå¯¸å’Œå¤–éƒ¨æ£€æµ‹ï¼‰ã€‚</td></tr><tr><td><code>subsets</code></td><td><a href=#subset><code>Subset</code></a></td><td>ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ç‰ˆæœ¬ã€‚åœ¨å­é›†çš„çº§åˆ«å¯ä»¥è¦†ç›–æœåŠ¡ä¸€çº§çš„æµé‡ç­–ç•¥å®šä¹‰ã€‚</td></tr></tbody></table><h2 id=destinationweight><code>DestinationWeight</code></h2><p>æ¯ä¸€æ¡è·¯ç”±è§„åˆ™éƒ½ä¼šå¯¹åº”åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ç‰ˆæœ¬ä¸Šï¼ˆå¯ä»¥å‚è€ƒæœ¬æ–‡é¡¶ç«¯çš„åè¯è§£é‡Šï¼‰ã€‚æ¯ä¸ªç‰ˆæœ¬çš„æƒé‡å†³å®šäº†è¿™ä¸€ç‰ˆæœ¬ä¼šæ”¶åˆ°çš„æµé‡çš„å¤šå°‘ã€‚ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™ä¼šå°† <code>reviews</code> æœåŠ¡çš„æµé‡è¿›è¡Œæ‹†åˆ†ï¼Œå…¶ä¸­ 25% è¿›å…¥ <code>v2</code> ç‰ˆæœ¬ï¼Œå…¶ä½™éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯ 75%ï¼‰è¿›å…¥ <code>v1</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  http:
  - route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v2
      weight: 25
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v1
      weight: 75
</code></pre><p>å¯¹åº”çš„ <code>DestinationRule</code>ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: reviews-destination
spec:
  host: reviews.prod.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
</code></pre><p>é™¤äº†æœåŠ¡å†…çš„æŒ‰ç‰ˆæœ¬æ‹†åˆ†ï¼Œæµé‡å’Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡é—´è¿›è¡Œæ‹†åˆ†ã€‚ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™æŠŠ 25% çš„æµé‡åˆ†é…ç»™äº† <code>dev.reviews.com</code>ï¼Œå‰©ä½™çš„ 75% åˆ™æµå‘ <code>reviews.com</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews-route-two-domains
spec:
  hosts:
  - reviews.com
  http:
  - route:
    - destination:
        host: dev.reviews.com
      weight: 25
    - destination:
        host: reviews.com
      weight: 75
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>destination</code></td><td><a href=#destination><code>Destination</code></a></td><td>å¿…è¦å­—æ®µã€‚æµé‡å°†ä¼šè¢«å¯¼å…¥è¿™ä¸€å­—æ®µæ‰€æŒ‡ä»£çš„æœåŠ¡ã€‚</td></tr><tr><td><code>weight</code></td><td><code>int32</code></td><td>å¿…è¦å­—æ®µã€‚è½¬å‘ç»™ä¸€ä¸ªæœåŠ¡ç‰ˆæœ¬çš„æµé‡å æ€»æµé‡çš„ç™¾åˆ†æ¯”ã€‚å‡ ä¸ªç›®æ ‡çš„<strong>ç™¾åˆ†æ¯”ä¹‹å’Œå¿…é¡»ç­‰äº 100</strong>ã€‚å¦‚æœä¸€æ¡è§„åˆ™ä¸­åªæœ‰ä¸€ä¸ªç›®æ ‡ï¼Œä¼šå‡è®¾å…¶æƒé‡ä¸º 100ã€‚</td></tr></tbody></table><h2 id=envoyfilter><code>EnvoyFilter</code></h2><p><code>EnvoyFilter</code> å¯¹è±¡æè¿°äº†é’ˆå¯¹ä»£ç†æœåŠ¡çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®šåˆ¶ç”± Istio Pilot ç”Ÿæˆçš„ä»£ç†é…ç½®ã€‚è¿™ä¸€åŠŸèƒ½ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å†…å®¹ä¸€æ—¦å®Œæˆä¼ æ’­ï¼Œå¯èƒ½ä¼šä»¤æ•´ä¸ªæœåŠ¡ç½‘æ ¼è¿›å…¥ç˜«ç—ªçŠ¶æ€ã€‚</p><p>æ³¨ 1ï¼šè¿™ä¸€é…ç½®ååˆ†è„†å¼±ï¼Œå› æ­¤ä¸ä¼šæœ‰ä»»ä½•çš„å‘åå…¼å®¹èƒ½åŠ›ã€‚è¿™ä¸€é…ç½®æ˜¯ç”¨äºå¯¹ Istio ç½‘ç»œç³»ç»Ÿçš„å†…éƒ¨å®ç°è¿›è¡Œå˜æ›´çš„ã€‚</p><p>æ³¨ 2ï¼šå¦‚æœæœ‰å¤šä¸ª <code>EnvoyFilter</code> ç»‘å®šåœ¨åŒä¸€ä¸ªå·¥ä½œè´Ÿè½½ä¸Šï¼Œæ‰€æœ‰çš„é…ç½®ä¼šæŒ‰ç…§åˆ›å»ºæ—¶é—´çš„é¡ºåºè¿›è¡Œå¤„ç†ã€‚å¦‚æœå¤šä¸ªé…ç½®ä¹‹é—´å­˜åœ¨å†²çªï¼Œä¼šäº§ç”Ÿä¸å¯é¢„çŸ¥çš„åæœã€‚</p><p>ä¸‹é¢çš„ Kubernetes ä¾‹å­ï¼Œæ˜¯é’ˆå¯¹ <code>reviews</code> æœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯å¸¦æœ‰æ ‡ç­¾ <code>app:reviews</code> çš„ Podï¼‰çš„ 8080 ç«¯å£ä¸Šçš„æ‰€æœ‰å…¥ç«™è°ƒç”¨å·¥ä½œçš„ï¼Œè¿™ä¸€æ®µé…ç½®å¯ç”¨äº† Envoy çš„ <code>Lua</code> è¿‡æ»¤å™¨ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  name: reviews-lua
spec:
  workloadLabels:
    app: reviews
  filters:
  - listenerMatch:
      portNumber: 8080
      listenerType: SIDECAR_INBOUND # åŒ¹é…åˆ° reviews:8080 çš„å…¥ç«™ç›‘å¬å™¨
    filterName: envoy.lua
    filterType: HTTP
    filterConfig:
      inlineCode: |
        ... lua code .
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>workloadLabels</code></td><td><code>map&lt;string, string&gt;</code></td><td>ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†ä¸€ç»„ Pod/è™šæ‹Ÿæœºã€‚è¿™ä¸€ç»„å·¥ä½œè´Ÿè½½å®ä¾‹ä¸­çš„ä»£ç†ä¼šè¢«é…ç½®ä½¿ç”¨é™„åŠ çš„è¿‡æ»¤å™¨é…ç½®ã€‚æ ‡ç­¾çš„æœç´¢èŒƒå›´æ˜¯å¹³å°ç›¸å…³çš„ã€‚ä¾‹å¦‚åœ¨ Kubernetes ä¸­ï¼Œç”Ÿæ•ˆèŒƒå›´ä¼šåŒ…æ‹¬æ‰€æœ‰å¯è¾¾çš„å‘½åç©ºé—´ã€‚å¦‚æœçœç•¥è¿™ä¸€å­—æ®µï¼Œé…ç½®å°†ä¼šåº”ç”¨åˆ°ç½‘æ ¼ä¸­çš„æ‰€æœ‰ Envoy ä»£ç†å®ä¾‹ä¸­ã€‚æ³¨æ„ï¼šä¸€ä¸ªå·¥ä½œè´Ÿè½½åªåº”è¯¥ä½¿ç”¨ä¸€ä¸ª <code>EnvoyFilter</code>ã€‚å¦‚æœå¤šä¸ª <code>EnvoyFilter</code> è¢«ç»‘å®šåˆ°åŒä¸€ä¸ªå·¥ä½œè´Ÿè½½ä¸Šï¼Œä¼šäº§ç”Ÿä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚</td></tr><tr><td><code>filters</code></td><td><a href=#envoyfilter-filter><code>EnvoyFilter.Filter[]</code></a></td><td>å¿…è¦å­—æ®µã€‚è¦åŠ å…¥æŒ‡å®šç›‘å¬å™¨ä¹‹ä¸­çš„ Envoy ç½‘ç»œè¿‡æ»¤å™¨/HTTP è¿‡æ»¤å™¨é…ç½®ä¿¡æ¯ã€‚å½“ç»™ http è¿æ¥åŠ å…¥ç½‘ç»œè¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œåº”è¯¥æ³¨æ„ç¡®ä¿è¯¥è¿‡æ»¤å™¨åº”æ—©äº <code>envoy.httpconnectionmanager</code>ã€‚</td></tr></tbody></table><h2 id=envoyfilter-filter><code>EnvoyFilter.Filter</code></h2><p>è¦åŠ å…¥è¿‡æ»¤å™¨é“¾æ¡çš„ Envoy è¿‡æ»¤å™¨ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>listenerMatch</code></td><td><a href=#envoyfilter-listenermatch><code>EnvoyFilter.ListenerMatch</code></a></td><td>åªæœ‰åœ¨ç¬¦åˆåŒ¹é…æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿‡æ»¤å™¨æ‰ä¼šåŠ å…¥è¿™ä¸€ç›‘å¬å™¨ä¹‹ä¸­ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å­—æ®µï¼Œä¼šåœ¨æ‰€æœ‰ç›‘å¬å™¨ä¸­åŠ å…¥è¿™ä¸€è¿‡æ»¤å™¨ã€‚</td></tr><tr><td><code>insertPosition</code></td><td><a href=#envoyfilter-insertposition><code>EnvoyFilter.InsertPosition</code></a></td><td>åœ¨è¿‡æ»¤å™¨é“¾æ¡ä¸­çš„æ’å…¥ä½ç½®ï¼Œç¼ºçœä¸º <code>FIRST</code>ã€‚</td></tr><tr><td><code>filterType</code></td><td><a href=#envoyfilter-filter-filtertype><code>EnvoyFilter.Filter.FilterType</code></a></td><td>å¿…è¦å­—æ®µã€‚è¦å®ä¾‹åŒ–çš„è¿‡æ»¤å™¨çš„ç±»å‹ã€‚</td></tr><tr><td><code>filterName</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚è¦åˆå§‹åŒ–çš„è¿‡æ»¤å™¨çš„åç§°ã€‚åå­—å¿…é¡»èƒ½å¤ŸåŒ¹é…åˆ°æ”¯æŒçš„ç¼–è¯‘è¿› Envoy çš„è¿‡æ»¤å™¨ã€‚</td></tr><tr><td><code>filterConfig</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Struct</code></a></td><td>å¿…è¦å­—æ®µã€‚ä¸ºå®ä¾‹åŒ–çš„è¿‡æ»¤å™¨æŒ‡å®šé…ç½®å†…å®¹ã€‚</td></tr></tbody></table><h2 id=envoyfilter-filter-filtertype><code>EnvoyFilter.Filter.FilterType</code></h2><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>INVALID</code></td><td>å ä½ç¬¦ã€‚</td></tr><tr><td><code>HTTP</code></td><td>Http è¿‡æ»¤å™¨ã€‚</td></tr><tr><td><code>NETWORK</code></td><td>ç½‘ç»œè¿‡æ»¤å™¨ã€‚</td></tr></tbody></table><h2 id=envoyfilter-insertposition><code>EnvoyFilter.InsertPosition</code></h2><p>åœ¨è¿‡æ»¤å™¨é“¾æ¡ä¸­æŒ‡å®šä½ç½®ï¼Œç”¨äºæ’å…¥æ–°çš„ Envoy è¿‡æ»¤å™¨é…ç½®ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>index</code></td><td><a href=#envoyfilter-insertposition-index><code>EnvoyFilter.InsertPosition.Index</code></a></td><td>è¿‡æ»¤å™¨åœ¨é“¾æ¡ä¸­çš„ä½ç½®ã€‚</td></tr><tr><td><code>relativeTo</code></td><td><code>string</code></td><td>å¦‚æœæŒ‡å®šäº† <code>BEFORE</code> æˆ–è€… <code>AFTER</code>ï¼Œè¿™é‡Œå°±è¦è¾“å…¥ç›¸å¯¹ä½ç½®æ‰€å‚è€ƒçš„è¿‡æ»¤å™¨åç§°ã€‚</td></tr></tbody></table><h2 id=envoyfilter-insertposition-index><code>EnvoyFilter.InsertPosition.Index</code></h2><p>è¿‡æ»¤å™¨é“¾æ¡ä¸­çš„ç´¢å¼•æˆ–ä½ç½®ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIRST</code></td><td>æ’å…¥é¦–ä½ã€‚</td></tr><tr><td><code>LAST</code></td><td>æ’å…¥æœ«å°¾ã€‚</td></tr><tr><td><code>BEFORE</code></td><td>æŒ‡å®šè¿‡æ»¤å™¨ä¹‹å‰ã€‚</td></tr><tr><td><code>AFTER</code></td><td>æŒ‡å®šè¿‡æ»¤å™¨ä¹‹åã€‚</td></tr></tbody></table><h2 id=envoyfilter-listenermatch><code>EnvoyFilter.ListenerMatch</code></h2><p>é€‰æ‹©ä¸€ä¸ªç›‘å¬å™¨ï¼Œåœ¨ç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹åŠ å…¥è¿‡æ»¤å™¨é…ç½®ã€‚<code>ListenerMatch</code> ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ¡ä»¶å…¨éƒ¨ç¬¦åˆï¼ˆé€»è¾‘ä¸ï¼‰çš„æƒ…å†µä¸‹æ‰èƒ½è¿›è¡Œæ’å…¥ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>portNumber</code></td><td><code>uint32</code></td><td>è¿›è¡Œé€šä¿¡çš„æœåŠ¡æˆ–ç½‘å…³ç«¯å£ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿™ä¸€å­—æ®µï¼Œåˆ™åŒ¹é…æ‰€æœ‰çš„ç›‘å¬å™¨ã€‚å³ä½¿æ˜¯ä¸ºå®ä¾‹æˆ–è€… Pod ç”Ÿæˆçš„å…¥ç«™è¿æ¥ç›‘å¬å™¨ï¼Œä¹Ÿåªåº”è¯¥ä½¿ç”¨æœåŠ¡ç«¯å£è¿›è¡ŒåŒ¹é…ã€‚</td></tr><tr><td><code>portNamePrefix</code></td><td><code>string</code></td><td>é™¤äº†ç”¨å…·ä½“ç«¯å£ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨ç«¯å£åç§°çš„å‰ç¼€è¿›è¡Œå¤§å°å†™æ— å…³çš„åŒ¹é…ã€‚ä¾‹å¦‚ <code>mongo</code> å‰ç¼€å¯ä»¥åŒ¹é… <code>mongo-port</code>ã€<code>mongo</code>ã€<code>mongoDB</code> ä»¥åŠ <code>MONGO</code> ç­‰ã€‚</td></tr><tr><td><code>listenerType</code></td><td><a href=#envoyfilter-listenermatch-listenertype><code>EnvoyFilter.ListenerMatch.ListenerType</code></a></td><td>å…¥ç«™å’Œå‡ºç«™ä¸¤ç§ç±»å‹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™åŒ¹é…æ‰€æœ‰ç›‘å¬å™¨ã€‚</td></tr><tr><td><code>listenerProtocol</code></td><td><a href=#envoyfilter-listenermatch-listenerprotocol><code>EnvoyFilter.ListenerMatch.ListenerProtocol</code></a></td><td>ä¸ºåŒä¸€åè®®æŒ‡å®šç›‘å¬å™¨ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œä¼šæŠŠç›‘å¬å™¨åº”ç”¨åˆ°æ‰€æœ‰åè®®ä¸Šã€‚åè®®é€‰æ‹©å¯ä»¥æ˜¯æ‰€æœ‰ HTTP ç›‘å¬å™¨ï¼ˆåŒ…æ‹¬ HTTP2/gRPC/HTTPSï¼ˆEnvoy ä½œä¸º TLS ç»ˆç»“å™¨ï¼‰ ï¼‰æˆ–è€…æ‰€æœ‰ TCP ç›‘å¬å™¨ï¼ˆåŒ…æ‹¬åˆ©ç”¨ SNI è¿›è¡Œçš„ HTTPS é€ä¼ ï¼‰ã€‚</td></tr><tr><td><code>address</code></td><td><code>string[]</code></td><td>ç›‘å¬å™¨ç»‘å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ª IP åœ°å€ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåº”è¯¥è‡³å°‘åŒ¹é…å…¶ä¸­ä¸€ä¸ªåœ°å€ã€‚</td></tr></tbody></table><h2 id=envoyfilter-listenermatch-listenerprotocol><code>EnvoyFilter.ListenerMatch.ListenerProtocol</code></h2><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ALL</code></td><td>æ‰€æœ‰åè®®ã€‚</td></tr><tr><td><code>HTTP</code></td><td>HTTP æˆ–è€… HTTPSï¼ˆç”± Envoy å®Œæˆç»ˆç»“ï¼‰/HTTP2/gRPCã€‚</td></tr><tr><td><code>TCP</code></td><td>ä»»æ„é HTTP ç›‘å¬å™¨ã€‚</td></tr></tbody></table><h2 id=envoyfilter-listenermatch-listenertype><code>EnvoyFilter.ListenerMatch.ListenerType</code></h2><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ANY</code></td><td>æ‰€æœ‰ç›‘å¬å™¨ã€‚</td></tr><tr><td><code>SIDECAR_INBOUND</code></td><td>Sidecar ä¸­çš„å…¥ç«™ç›‘å¬å™¨ã€‚</td></tr><tr><td><code>SIDECAR_OUTBOUND</code></td><td>Sidecar ä¸­çš„å‡ºç«™ç›‘å¬å™¨ã€‚</td></tr><tr><td><code>GATEWAY</code></td><td>ç½‘å…³ç›‘å¬å™¨ã€‚</td></tr></tbody></table><h2 id=gateway><code>Gateway</code></h2><p><code>Gateway</code> æè¿°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ‰¿è½½ç½‘æ ¼è¾¹ç¼˜çš„è¿›å…¥å’Œå‘å‡ºè¿æ¥ã€‚è¿™ä¸€è§„èŒƒä¸­æè¿°äº†ä¸€ç³»åˆ—å¼€æ”¾ç«¯å£ï¼Œä»¥åŠè¿™äº›ç«¯å£æ‰€ä½¿ç”¨çš„åè®®ã€è´Ÿè½½å‡è¡¡çš„ SNI é…ç½®ç­‰å†…å®¹ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„ <code>Gateway</code> é…ç½®è®¾ç½®äº†ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œç”¨æ¥å¼€æ”¾ 80 å’Œ 9080 ä¸¤ä¸ª http ç«¯å£ï¼Œ443 çš„ https ç«¯å£ä»¥åŠ 2379 çš„ TCP ç«¯å£ï¼Œè¿™äº›ç«¯å£éƒ½ç”¨äºå…¥ç«™è¿æ¥ã€‚æ ‡ç­¾ä¸º <code>app: my-gateway-controller</code> çš„ Pod å……å½“äº†ä»£ç†æœåŠ¡å™¨çš„è§’è‰²ï¼Œç¤ºä¾‹å®šä¹‰ä¼šå‘é€ç»™è¿™äº› Podã€‚Istio é€šè¿‡è¿™æ ·çš„é…ç½®ï¼Œè¦æ±‚ä»£ç†æœåŠ¡å™¨ç›‘å¬è¿™äº›ç«¯å£ï¼Œå¦å¤–ç”¨æˆ·åº”è¯¥ç¡®ä¿å¤–éƒ¨æµé‡èƒ½å¤Ÿé¡ºåˆ©åˆ°è¾¾ç½‘æ ¼è¾¹ç¼˜çš„è¿™äº›å¼€æ”¾ç«¯å£ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-gateway
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      httpsRedirect: true # ç”¨ 301 é‡å®šå‘æŒ‡ä»¤å“åº” http åè®®çš„è¯·æ±‚ã€‚
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - uk.bookinfo.com
    - eu.bookinfo.com
    tls:
      mode: SIMPLE # åœ¨è¿™ä¸€ç«¯å£å¼€æ”¾ https æœåŠ¡ã€‚
      serverCertificate: /etc/certs/servercert.pem
      privateKey: /etc/certs/privatekey.pem
  - port:
      number: 9080
      name: http-wildcard
      protocol: HTTP
    hosts:
    - &#34;*&#34;
  - port:
      number: 2379 # ç”¨å¤–éƒ¨ç«¯å£ 2379 æ¥å¼€æ”¾å†…éƒ¨æœåŠ¡ã€‚
      name: mongo
      protocol: MONGO
    hosts:
    - &#34;*&#34;
</code></pre><p>ä¸Šé¢çš„ <code>Gateway</code> å®šä¹‰äº†å››å±‚åˆ°å…­å±‚çš„è´Ÿè½½å‡è¡¡å±æ€§ã€‚è€Œ <code>VirtualService</code> ä¼šç»‘å®šåˆ°ä¸€ä¸ª <code>Gateway</code>ï¼Œæ¥æ§åˆ¶åˆ°è¾¾æŒ‡å®šä¸»æœºæˆ–è€…ç½‘å…³ç«¯å£çš„æµé‡è½¬å‘è¡Œä¸ºã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„ <code>VirtualService</code> çš„å®šä¹‰ï¼Œæµé‡åˆ†åˆ«æ¥è‡ªå››ä¸ªæ¥æºï¼ˆ<code>https://uk.bookinfo.com/reviews</code>ã€ <code>https://eu.bookinfo.com/reviews</code>ã€<code>http://uk.bookinfo.com:9080/reviews</code> ä»¥åŠ <code>http://eu.bookinfo.com:9080/reviews</code>ï¼‰ï¼›è€Œå†…éƒ¨æœåŠ¡ <code>reviews</code> å¼€æ”¾äº† 9080 ç«¯å£ï¼Œåˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ <code>prod</code> å’Œ <code>qa</code>ï¼Œ<code>VirtualService</code> å¯¹è±¡åœ¨æ¥æºå’Œå†…éƒ¨æœåŠ¡çš„ç‰ˆæœ¬ä¹‹é—´å»ºç«‹äº†è·¯ç”±è§„åˆ™ã€‚</p><p>å¦å¤–åŒ…å« cookie <code>user: dev-123</code> çš„è¯·æ±‚ä¼šå‘é€ç»™ <code>qa</code> ç‰ˆæœ¬ä¸­çš„ç‰¹æ®Šç«¯å£ 7777ã€‚åŒæ ·çš„è§„åˆ™åœ¨ç½‘æ ¼å†…éƒ¨å¯¹ <code>reviews.prod.svc.cluster.local</code> çš„è°ƒç”¨ä¸­ä¹Ÿæ˜¯æˆç«‹çš„ã€‚è¯¥è§„åˆ™é€‚ç”¨äº 443 å’Œ 9080 ä¸¤ä¸ªç«¯å£ï¼Œè€Œå¯¹ 80 ç«¯å£çš„è®¿é—®ä¼šè¢«é‡å®šå‘åˆ° 443 ç«¯å£â€”â€”ä¹Ÿå°±æ˜¯è¯´ <code>http://uk.bookinfo.com</code> ä¼šè½¬å‘ <code>https://uk.bookinfo.com</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-rule
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  - uk.bookinfo.com
  - eu.bookinfo.com
  gateways:
  - my-gateway
  - mesh # ä»£è¡¨ç½‘æ ¼ä¸­çš„æ‰€æœ‰ Sidecar
  http:
  - match:
    - headers:
        cookie:
          user: dev-123
    route:
    - destination:
        port:
          number: 7777
        host: reviews.qa.svc.cluster.local
  - match:
      uri:
        prefix: /reviews/
    route:
    - destination:
        port:
          number: 9080 # å¦‚æœ reviews æœåŠ¡ä¸­åªæœ‰è¿™ä¸€ä¸ªç«¯å£ï¼Œå¯ä»¥çœç•¥è¿™ä¸€å­—æ®µã€‚
        host: reviews.prod.svc.cluster.local
      weight: 80
    - destination:
        host: reviews.qa.svc.cluster.local
      weight: 20
</code></pre><p>ä¸‹é¢çš„ <code>VirtualService</code> å®šä¹‰å°†å¤–éƒ¨å¯¹ 27017 ç«¯å£çš„è®¿é—®é‡å®šå‘åˆ°å†…éƒ¨çš„ <code>Mongo</code> æœåŠ¡çš„ 5555 ç«¯å£ã€‚è¿™ä¸€è§„åˆ™å¯¹ç½‘æ ¼å†…çš„è°ƒç”¨æ˜¯æ— æ•ˆçš„ï¼Œè¿™æ˜¯å› ä¸º <code>Gateway</code> åˆ—è¡¨ä¸­æ²¡æœ‰åŒ…å« <code>mesh</code> ç½‘å…³ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-Mongo
spec:
  hosts:
  - mongosvr.prod.svc.cluster.local # å†…éƒ¨çš„ Mongo æœåŠ¡
  gateways:
  - my-gateway
  tcp:
  - match:
    - port: 27017
    route:
    - destination:
        host: mongo.prod.svc.cluster.local
        port:
          number: 5555
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>servers</code></td><td><a href=#server><code>Server</code></a></td><td>å¿…è¦å­—æ®µã€‚<code>Server</code> å®šä¹‰åˆ—è¡¨ã€‚</td></tr><tr><td><code>selector</code></td><td><code>map&lt;string, string&gt;</code></td><td>å¿…è¦å­—æ®µã€‚ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾æ¥é€‰æ‹©ä¸€ç»„ Pod æˆ–è™šæ‹Ÿæœºï¼Œç”¨äºåº”ç”¨ <code>Gateway</code> é…ç½®ã€‚æ ‡ç­¾é€‰æ‹©çš„èŒƒå›´æ˜¯å¹³å°ç›¸å…³çš„ã€‚ä¾‹å¦‚åœ¨ Kubernetes ä¸Šï¼Œé€‰æ‹©èŒƒå›´åŒ…å«æ‰€æœ‰å¯è¾¾çš„å‘½åç©ºé—´ã€‚</td></tr></tbody></table><h2 id=httpfaultinjection><code>HTTPFaultInjection</code></h2><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>delay</code></td><td><a href=#httpfaultinjection-delay><code>HTTPFaultInjection.Delay</code></a></td><td>è½¬å‘ä¹‹å‰åŠ å…¥å»¶è¿Ÿï¼Œç”¨äºæ¨¡æ‹Ÿç½‘ç»œæ•…éšœã€ä¸Šæ¸¸æœåŠ¡è¿‡è½½ç­‰æ•…éšœã€‚</td></tr><tr><td><code>abort</code></td><td><a href=#httpfaultinjection-abort><code>HTTPFaultInjection.Abort</code></a></td><td>ç»ˆæ­¢è¯·æ±‚å¹¶å‘ä¸‹æ¸¸æœåŠ¡è¿”å›é”™è¯¯ä»£ç ï¼Œæ¨¡æ‹Ÿä¸Šæ¸¸æœåŠ¡å‡ºé”™çš„çŠ¶å†µã€‚</td></tr></tbody></table><h2 id=httpfaultinjection-abort><code>HTTPFaultInjection.Abort</code></h2><p>è¿™ä¸ªé…ç½®ä¼šæå‰ç»ˆæ­¢è¯·æ±‚ï¼Œå¹¶è¿”å›é¢„å®šä¹‰çš„é”™è¯¯ç ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ<code>ratings:v1</code> æœåŠ¡çš„è¯·æ±‚ä¸­ï¼Œæœ‰ 10% ä¼šè¢«ä¸­æ–­å¹¶å¾—åˆ°ä¸€ä¸ª 400 çš„é”™è¯¯ç ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - route:
    - destination:
        host: ratings.prod.svc.cluster.local
        subset: v1
    fault:
      abort:
        percent: 10
        httpStatus: 400
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>percent</code></td><td><code>int32</code></td><td>å–å€¼èŒƒå›´åœ¨ 0 å’Œ 100 ä¹‹é—´ï¼Œç”¨æ¥æŒ‡å®šä¸­æ–­è¯·æ±‚çš„æ¯”ä¾‹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>percent</code>ï¼Œåˆ™ä¸­æ–­æ‰€æœ‰è¯·æ±‚ã€‚</td></tr><tr><td><code>httpStatus</code></td><td><code>int32</code></td><td>å¿…è¦å­—æ®µã€‚ç”¨æ¥å®šä¹‰è¿”å›ç»™å®¢æˆ·ç«¯æœåŠ¡çš„<strong>æœ‰æ•ˆçš„ HTTP é”™è¯¯ä»£ç </strong>ã€‚</td></tr></tbody></table><h2 id=httpfaultinjection-delay><code>HTTPFaultInjection.Delay</code></h2><p><code>Delay</code> é…ç½®ç”¨æ¥åœ¨è¯·æ±‚çš„è½¬å‘è·¯å¾„ä¸Šæ³¨å…¥å»¶è¿Ÿã€‚ä¸‹é¢çš„ä¾‹å­ä¸­çš„æµé‡ï¼Œæ¥æºäºæ ‡ç­¾ <code>env: prod</code> çš„ Podï¼Œç›®æ ‡æœåŠ¡ä¸º <code>reviews</code> çš„ <code>v1</code> ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¼šåœ¨å…¶ä¸­çš„ 10% æ³¨å…¥ 5 ç§’é’Ÿçš„å»¶è¿Ÿã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  http:
  - match:
    - sourceLabels:
        env: prod
    route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v1
    fault:
      delay:
        percent: 10
        fixedDelay: 5s
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>percent</code></td><td><code>int32</code></td><td>å–å€¼èŒƒå›´åœ¨ 0 å’Œ 100 ä¹‹é—´ï¼Œç”¨æ¥æŒ‡å®šæ³¨å…¥å»¶è¿Ÿçš„æ¯”ä¾‹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>percent</code>ï¼Œä¸ºæ‰€æœ‰è¯·æ±‚è¿›è¡Œå»¶è¿Ÿæ³¨å…¥ã€‚</td></tr><tr><td><code>fixedDelay</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>å¿…è¦å­—æ®µã€‚åœ¨è¯·æ±‚è½¬å‘ä¹‹å‰åŠ å…¥çš„å›ºå®šå»¶è¿Ÿã€‚å¯é€‰å•ä½åŒ…æ‹¬å°æ—¶ï¼ˆ<code>h</code>ï¼‰ã€åˆ†é’Ÿï¼ˆ<code>m</code>ï¼‰ã€ç§’é’Ÿï¼ˆ<code>s</code>ï¼‰ä»¥åŠæ¯«ç§’ï¼ˆ<code>ms</code>ï¼‰ï¼Œå…è®¸çš„æœ€å°å€¼æ˜¯ <code>1ms</code>ã€‚</td></tr></tbody></table><h2 id=httpmatchrequest><code>HTTPMatchRequest</code></h2><p><code>HttpMatchRequest</code> åŒ…å«ä¸€ç³»åˆ—çš„ç­›é€‰æ¡ä»¶ï¼Œç»™è§„åˆ™æä¾›å¯¹ HTTP è¯·æ±‚çš„é€‰æ‹©èƒ½åŠ›ã€‚ä¾‹å¦‚ä¸‹é¢æ–‡æ¡£ä¸­çš„åŒ¹é…æ¡ä»¶ï¼Œè¦æ±‚è¯·æ±‚ URL å‰ç¼€ä¸º <code>/ratings/v2/</code>ï¼Œå¹¶ä¸” <code>end-user</code> Header çš„å€¼ä¸º <code>jason</code>ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - match:
    - headers:
        end-user:
          exact: jason
      uri:
        prefix: &#34;/ratings/v2/&#34;
    route:
    - destination:
        host: ratings.prod.svc.cluster.local
</code></pre><p>åœ¨ <code>VirtualService</code> å®šä¹‰ä¸­ï¼Œ<code>HTTPMatchRequest</code> ä¸å¯ä¸ºç©ºã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>uri</code></td><td><a href=#stringmatch><code>StringMatch</code></a></td><td>URI çš„åŒ¹é…è¦æ±‚ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</td></tr><tr><td><code>scheme</code></td><td>[<code>StringMatch</code>]</td><td>URI æ¨¡å¼çš„åŒ¹é…è¦æ±‚ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</td></tr><tr><td><code>method</code></td><td>[<code>StringMatch</code>]</td><td>HTTP æ–¹æ³•çš„åŒ¹é…æ¡ä»¶ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</td></tr><tr><td><code>authority</code></td><td>[<code>StringMatch</code>]</td><td>HTTP è®¤è¯å€¼çš„åŒ¹é…è¦æ±‚ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</td></tr><tr><td><code>headers</code></td><td><code>map&lt;string,</code> [<code>StringMatch</code>]<code>&gt;</code></td><td>Header çš„é”®å¿…é¡»æ˜¯å°å†™çš„ï¼Œä½¿ç”¨è¿å­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ <code>x-request-id</code>ã€‚Headers çš„åŒ¹é…åŒæ ·æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚<strong>æ³¨æ„åœ¨ Header ä¸­çš„ <code>uri</code>ã€<code>shceme</code>ã€<code>method</code> ä»¥åŠ <code>authority</code> ä¼šè¢«å¿½ç•¥ã€‚</strong></td></tr><tr><td><code>port</code></td><td><code>uint32</code></td><td>æŒ‡å®šä¸»æœºä¸Šçš„ç«¯å£ã€‚æœ‰çš„æœåŠ¡åªå¼€æ”¾ä¸€ä¸ªç«¯å£ï¼Œæœ‰çš„æœåŠ¡ä¼šç”¨åè®®ä½œä¸ºå‰ç¼€ç»™ç«¯å£å‘½åï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦æ˜¾å¼çš„æŒ‡æ˜ç«¯å£å·ã€‚</td></tr><tr><td><code>sourceLabels</code></td><td><code>map&lt;string, string&gt;</code></td><td>ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾é€‰æ‹©å·¥ä½œè´Ÿè½½ï¼Œåº”ç”¨åˆ°è§„åˆ™ä¹‹ä¸­ã€‚å¦‚æœ <code>VirtualService</code> ä¸­æŒ‡å®šäº† <code>gateways</code> å­—æ®µï¼Œéœ€è¦å°†ä¿ç•™çš„ <code>mesh</code> ä¹ŸåŠ å…¥åˆ—è¡¨ï¼Œæ‰èƒ½è®©è¿™ä¸€å­—æ®µç”Ÿæ•ˆã€‚</td></tr><tr><td><code>gateways</code></td><td><code>string[]</code></td><td>è§„åˆ™æ‰€æ¶‰åŠçš„ <code>Gateway</code> çš„åç§°åˆ—è¡¨ã€‚è¿™ä¸€å­—æ®µä¼šè¦†ç›– <code>VirtualService</code> è‡ªèº«çš„ <code>gateways</code> è®¾ç½®ã€‚<code>gateways</code> åŒ¹é…æ˜¯ç‹¬ç«‹äº <code>sourceLabels</code> çš„ã€‚</td></tr></tbody></table><h2 id=httpredirect><code>HTTPRedirect</code></h2><p><code>HTTPReidrect</code> ç”¨æ¥å‘ä¸‹æ¸¸æœåŠ¡å‘é€ 301 è½¬å‘å“åº”ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”¨ç‰¹å®šå€¼æ¥æ›¿æ¢å“åº”ä¸­çš„è®¤è¯/ä¸»æœºä»¥åŠ URI éƒ¨åˆ†ã€‚ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™ä¼šæŠŠå‘ <code>ratings</code> æœåŠ¡çš„ <code>/v1/getProductRatings</code> è·¯å¾„å‘é€çš„è¯·æ±‚é‡å®šå‘åˆ° <code>bookratings</code> æœåŠ¡çš„ <code>/v1/bookRatings</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - match:
    - uri:
        exact: /v1/getProductRatings
  redirect:
    uri: /v1/bookRatings
    authority: newratings.default.svc.cluster.local
  ..
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>uri</code></td><td><code>string</code></td><td>åœ¨è½¬å‘æ—¶ç”¨è¿™ä¸ªå­—æ®µçš„å€¼æ¥æ›¿æ¢ URL çš„è·¯å¾„éƒ¨åˆ†ã€‚æ³¨æ„ä¸ç®¡æ¡ä»¶æ˜¯å‰ç¼€åŒ¹é…è¿˜æ˜¯å®Œå…¨åŒ¹é…ï¼Œæ•´ä¸ªè·¯å¾„éƒ½ä¼šè¢«å®Œå…¨æ›¿æ¢ã€‚</td></tr><tr><td><code>authority</code></td><td><code>string</code></td><td>åœ¨è½¬å‘æ—¶æŠŠè®¤è¯å’Œä¸»æœºéƒ¨åˆ†ç”¨è¿™ä¸€å­—æ®µçš„å€¼è¿›è¡Œæ›¿æ¢ã€‚</td></tr></tbody></table><h2 id=httpretry><code>HTTPRetry</code></h2><p>ç”¨äºå®šä¹‰ HTTP è¯·æ±‚å¤±è´¥æ—¶çš„é‡è¯•ç­–ç•¥ã€‚ä¾‹å¦‚ä¸‹é¢çš„é…ç½®ï¼Œå¯¹ <code>ratings:v1</code> çš„æµé‡è¿›è¡Œäº†é‡è¯•è®¾ç½®ï¼Œæœ€å¤§é‡è¯•æµ‹è¯•ä¸º 3ï¼Œæ¯æ¬¡é‡è¯•çš„è¶…æ—¶æ—¶é—´ä¸º 2 ç§’é’Ÿã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - route:
    - destination:
        host: ratings.prod.svc.cluster.local
        subset: v1
    retries:
      attempts: 3
      perTryTimeout: 2s
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>attempts</code></td><td><code>uint32</code></td><td>å¿…è¦å­—æ®µã€‚ä¸ºç‰¹å®šè¯·æ±‚è®¾ç½®é‡è¯•æ¬¡æ•°ã€‚é‡è¯•ä¹‹é—´çš„é—´éš”æ˜¯è‡ªåŠ¨å†³å®šçš„ï¼ˆæœ€å°‘ 25 æ¯«ç§’ï¼‰ã€‚å®é™…é‡è¯•æ¬¡æ•°è¿˜å—[è·¯ç”±è§„åˆ™]ä¸­ <code>timeout</code> è®¾ç½®çš„é™åˆ¶ã€‚</td></tr><tr><td><code>perTryTimeout</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>æ¯æ¬¡é‡è¯•çš„è¶…æ—¶æ—¶é—´ã€‚å¯é€‰å•ä½åŒ…æ‹¬å°æ—¶ï¼ˆ<code>h</code>ï¼‰ã€åˆ†é’Ÿï¼ˆ<code>m</code>ï¼‰ã€ç§’é’Ÿï¼ˆ<code>s</code>ï¼‰ä»¥åŠæ¯«ç§’ï¼ˆ<code>ms</code>ï¼‰ï¼Œå…è®¸çš„æœ€å°å€¼æ˜¯ <code>1ms</code>ã€‚</td></tr></tbody></table><h2 id=httprewrite><code>HTTPRewrite</code></h2><p><code>HTTPRewrite</code> ç”¨æ¥åœ¨ HTTP è¯·æ±‚è¢«è½¬å‘åˆ°ç›®æ ‡ä¹‹å‰ï¼Œå¯¹è¯·æ±‚å†…å®¹è¿›è¡Œéƒ¨åˆ†æ”¹å†™ã€‚<code>Rewrite</code> åŸè¯­åªèƒ½ç”¨åœ¨ <code>DestinationWrights</code> ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åœ¨è¿›è¡Œå¯¹ <code>ratings</code> æœåŠ¡çš„ API è°ƒç”¨ä¹‹å‰ï¼Œå¯¹ URL å‰ç¼€ï¼ˆ<code>/ratings</code>ï¼‰è¿›è¡Œæ”¹å†™ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-route
spec:
  hosts:
  - ratings.prod.svc.cluster.local
  http:
  - match:
    - uri:
        prefix: /ratings
    rewrite:
      uri: /v1/bookRatings
    route:
    - destination:
        host: ratings.prod.svc.cluster.local
        subset: v1
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>uri</code></td><td><code>string</code></td><td>é‡å†™ URI çš„è·¯å¾„ï¼ˆæˆ–å‰ç¼€ï¼‰éƒ¨åˆ†ã€‚å¦‚æœåŸå§‹ URI æ˜¯åŸºäºå‰ç¼€çš„ï¼Œè¿™é‡Œçš„å€¼å°±ä¼šå¯¹åŒ¹é…çš„å‰ç¼€è¿›è¡Œæ›¿æ¢ã€‚</td></tr><tr><td><code>authority</code></td><td><code>string</code></td><td>ç”¨è¿™ä¸ªå€¼é‡å†™è®¤è¯/ä¸»æœºéƒ¨åˆ†ã€‚</td></tr></tbody></table><h2 id=httproute><code>HTTPRoute</code></h2><p>ä¸º HTTP/1.1ã€HTTP2 ä»¥åŠ gRPC æµé‡æè¿°åŒ¹é…æ¡ä»¶å’Œå¯¹åº”åŠ¨ä½œã€‚å¯ä»¥å‚è€ƒ <a href=#virtualservice><code>VirtualService</code></a> æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>match</code></td><td><a href=#httpmatchrequest><code>HTTPMatchRequest[]</code></a></td><td>æ¿€æ´»è§„åˆ™æ‰€éœ€çš„åŒ¹é…æ¡ä»¶ã€‚ä¸€ä¸ª <code>match</code> å—å†…æ¡ä»¶ä¹‹é—´éƒ½æ˜¯é€»è¾‘ä¸å…³ç³»ï¼›<code>match</code> å—ä¹‹é—´æ˜¯é€»è¾‘æˆ–å…³ç³»ã€‚ä»»ä½•ä¸€ä¸ª <code>match</code> å—åŒ¹é…æˆåŠŸï¼Œéƒ½ä¼šæ¿€æ´»è§„åˆ™ã€‚</td></tr><tr><td><code>route</code></td><td><a href=#destinationweight><code>DestinationWeight[]</code></a></td><td>HTTP è§„åˆ™å¯¹æµé‡å¯èƒ½è¿›è¡Œé‡å®šå‘æˆ–è€…è½¬å‘ï¼ˆç¼ºçœï¼‰ã€‚è½¬å‘ç›®æ ‡å¯ä»¥æ˜¯æœåŠ¡çš„å¤šä¸ªç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªã€‚æœåŠ¡ç‰ˆæœ¬æ‰€å…³è”çš„ <a href=#destinationweight><code>DestinationWeight</code></a> åˆ™å†³å®šäº†ä¸åŒç›®æ ‡ä¹‹é—´çš„æµé‡åˆ†é…æ¯”é‡ã€‚</td></tr><tr><td><code>redirect</code></td><td><a href=#httpredirect><code>HTTPRedirect</code></a></td><td>HTTP è§„åˆ™å¯¹æµé‡å¯èƒ½è¿›è¡Œé‡å®šå‘æˆ–è€…è½¬å‘ï¼ˆç¼ºçœï¼‰ã€‚å¦‚æœå¯ç”¨äº†æµé‡é€ä¼ é€‰é¡¹ï¼Œä¼šæ— è§† <code>route</code> ä»¥åŠ <code>redirect</code> è®¾ç½®ã€‚é‡å®šå‘åŸè¯­ä¼šå‘é€ HTTP 301 æŒ‡ä»¤æŒ‡å‘ä¸åŒçš„ URI æˆ–è®¤è¯éƒ¨åˆ†ã€‚</td></tr><tr><td><code>rewrite</code></td><td><a href=#httprewrite><code>HTTPRewrite</code></a></td><td><code>Rewrite</code> HTTP URI å’Œè®¤è¯éƒ¨åˆ†ã€‚<code>rewrite</code> ä¸èƒ½å’Œ <code>redirect</code> å…±ç”¨ï¼Œå¹¶ä¸”ä¼šåœ¨è½¬å‘ä¹‹å‰ç”Ÿæ•ˆã€‚</td></tr><tr><td><code>timeout</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>HTTP è¯·æ±‚çš„è¶…æ—¶è®¾ç½®ã€‚</td></tr><tr><td><code>retries</code></td><td><a href=#httpretry><code>HTTPRetry</code></a></td><td>HTTP è¯·æ±‚çš„é‡è¯•è®¾ç½®ã€‚</td></tr><tr><td><code>fault</code></td><td><a href=#httpfaultinjection><code>HTTPFaultInjection</code></a></td><td>åº”ç”¨åˆ° HTTP è¯·æ±‚å®¢æˆ·ç«¯çš„æ•…éšœæ³¨å…¥ç­–ç•¥ã€‚<strong>æ³¨æ„ï¼šå®¢æˆ·ç«¯å¯ç”¨äº†æ•…éšœæ³¨å…¥ä¹‹åï¼Œè¶…æ—¶å’Œé‡è¯•ä¼šè¢«å¿½ç•¥ã€‚</strong></td></tr><tr><td><code>mirror</code></td><td><a href=#destination><code>mirror</code></a></td><td>åœ¨æŠŠ HTTP è¯·æ±‚è½¬å‘ç»™é¢„æœŸç›®æ ‡çš„åŒæ—¶ï¼Œå¯¹æµé‡è¿›è¡Œé•œåƒå¹¶å‘é€ç»™å…¶ä»–ç›®æ ‡ã€‚å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼ŒSidecar/Gateway åœ¨è¿”å›é¢„æœŸç›®æ ‡çš„å“åº”ä¹‹å‰ä¸ä¼šç­‰å¾…é•œåƒç›®æ ‡çš„å“åº”ã€‚è¢«é•œåƒçš„ç›®æ ‡åŒæ ·ä¹Ÿä¼šç”Ÿæˆç»Ÿè®¡ä¿¡æ¯ã€‚</td></tr><tr><td><code>corsPolicy</code></td><td><a href=#corspolicy><code>CorsPolicy</code></a></td><td>è·¨æ¥æºèµ„æºå…±äº«ï¼ˆ<a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS>CORS</a>ï¼‰ã€‚</td></tr><tr><td><code>appendHeaders</code></td><td><code>map&lt;string, string&gt;</code></td><td>åœ¨å‘ç›®æ ‡æœåŠ¡è½¬å‘è¯·æ±‚ä¹‹å‰ï¼ŒåŠ å…¥é¢å¤–çš„ HTTP Headerã€‚</td></tr></tbody></table><h2 id=l4matchattributes><code>L4MatchAttributes</code></h2><p>å››å±‚è¿æ¥åŒ¹é…çš„å±æ€§ã€‚æ³¨æ„ï¼šå››å±‚è¿æ¥çš„åŒ¹é…å±æ€§æ”¯æŒå°šæœªå®Œæˆã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>destinationSubnets</code></td><td><code>string[]</code></td><td>ç›®æ ‡çš„ <code>IPv4</code> æˆ–è€… <code>IPv6</code> åœ°å€ï¼Œå¯èƒ½å¸¦æœ‰å­ç½‘æ ‡è¯†ï¼Œ<code>a.b.c.d/xx</code> æˆ–è€… <code>a.b.c.d</code> éƒ½æœ‰å¯èƒ½ã€‚</td></tr><tr><td><code>port</code></td><td><code>uint32</code></td><td>æŒ‡å®šä¸»æœºä¸Šçš„ç«¯å£ã€‚æœ‰çš„æœåŠ¡åªå¼€æ”¾ä¸€ä¸ªç«¯å£ï¼Œæœ‰çš„æœåŠ¡ä¼šç”¨åè®®ä½œä¸ºå‰ç¼€ç»™ç«¯å£å‘½åï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦æ˜¾å¼çš„æŒ‡æ˜ç«¯å£å·ã€‚</td></tr><tr><td><code>sourceLabels</code></td><td><code>map&lt;string, string&gt;</code></td><td>ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾é€‰æ‹©å·¥ä½œè´Ÿè½½ï¼Œåº”ç”¨åˆ°è§„åˆ™ä¹‹ä¸­ã€‚å¦‚æœ <code>VirtualService</code> ä¸­æŒ‡å®šäº† <code>gateways</code> å­—æ®µï¼Œéœ€è¦å°†ä¿ç•™çš„ <code>mesh</code> ä¹ŸåŠ å…¥åˆ—è¡¨ï¼Œæ‰èƒ½è®©è¿™ä¸€å­—æ®µç”Ÿæ•ˆã€‚</td></tr><tr><td><code>gateways</code></td><td><code>string[]</code></td><td>è§„åˆ™æ‰€æ¶‰åŠçš„ <code>Gateway</code> çš„åç§°åˆ—è¡¨ã€‚è¿™ä¸€å­—æ®µä¼šè¦†ç›– <code>VirtualService</code> è‡ªèº«çš„ <code>gateways</code> è®¾ç½®ã€‚<code>gateways</code> åŒ¹é…æ˜¯ç‹¬ç«‹äº <code>sourceLabels</code> çš„ã€‚</td></tr></tbody></table><h2 id=loadbalancersettings><code>LoadBalancerSettings</code></h2><p>ç‰¹å®šç›®æ ‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚é˜…è¯» <a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancing>Envoy è´Ÿè½½å‡è¡¡æ–‡æ¡£</a>èƒ½å¤Ÿè·å¾—æ›´å¤šè¿™æ–¹é¢çš„ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸ºæ‰€æœ‰æŒ‡å‘ <code>ratings</code> æœåŠ¡çš„æµé‡æŒ‡å®šäº†è½®è¯¢è°ƒåº¦ç®—æ³•è´Ÿè½½å‡è¡¡ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-ratings
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: ROUND_ROBIN
</code></pre><p>è€Œæ¥ä¸‹æ¥ä¾‹å­ï¼Œåˆ™ä¸º <code>ratings</code> è®¾ç½®äº†ä¼šè¯ç²˜è¿ï¼ˆSoft session affinityï¼‰æ¨¡å¼çš„è´Ÿè½½å‡è¡¡ï¼Œç²˜è¿æ¨¡å¼æ‰€ä½¿ç”¨çš„å“ˆå¸Œæ ¹æ® Cookie ä¸­çš„ <code>user</code> æ•°æ®å¾—æ¥ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
   name: bookinfo-ratings
spec:
   host: ratings.prod.svc.cluster.local
   trafficPolicy:
      loadBalancer:
       consistentHash:
         httpCookie:
           name: user
           ttl: 0s
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>simple</code></td><td><a href=#loadbalancersettings-simplelb><code>LoadBalancerSettings.SimpleLB</code></a></td><td></td></tr><tr><td><code>consistentHash</code></td><td><a href=#loadbalancersettings-consistenthashlb><code>LoadBalancerSettings.ConsistentHashLB</code></a></td><td></td></tr></tbody></table><h2 id=loadbalancersettings-consistenthashlb><code>LoadBalancerSettings.ConsistentHashLB</code></h2><p>åŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„è´Ÿè½½å‡è¡¡å¯ä»¥æ ¹æ® HTTP Headerã€Cookie ä»¥åŠå…¶ä»–å±æ€§æ¥æä¾›ä¼šè¯ç²˜è¿ï¼ˆSoft session affinityï¼‰åŠŸèƒ½ã€‚è¿™ç§è´Ÿè½½å‡è¡¡ç­–ç•¥åªå¯¹ HTTP è¿æ¥æœ‰æ•ˆã€‚æŸä¸€ç›®æ ‡çš„ç²˜è¿å…³ç³»ï¼Œä¼šå› ä¸ºè´Ÿè½½å‡è¡¡æ± ä¸­çš„èŠ‚ç‚¹æ•°é‡çš„å˜åŒ–è€Œè¢«é‡ç½®ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>httpHeaderName</code></td><td><code>string</code></td><td>æ ¹æ® HTTP Header è·å¾—å“ˆå¸Œã€‚</td></tr><tr><td><code>httpCookie</code></td><td><a href=#loadbalancersettings-consistenthashlb-httpcookie><code>LoadBalancerSettings.ConsistentHashLB.HTTPCookie</code></a></td><td>æ ¹æ® HTTP Cookie è·å¾—å“ˆå¸Œã€‚</td></tr><tr><td><code>useSourceIp</code></td><td><code>bool</code></td><td>æ ¹æ®æº IP è·å¾—å“ˆå¸Œã€‚</td></tr><tr><td><code>minimumRingSize</code></td><td><code>uint64</code></td><td>å“ˆå¸Œç¯æ‰€éœ€çš„æœ€å°è™šæ‹ŸèŠ‚ç‚¹æ•°é‡ã€‚ç¼ºçœå€¼ä¸º 1024ã€‚è¾ƒå¤§çš„å€¼ä¼šè·å¾—è¾ƒç²—ç³™çš„è´Ÿè½½åˆ†å¸ƒã€‚å¦‚æœè´Ÿè½½å‡è¡¡æ± ä¸­çš„ä¸»æœºæ•°é‡å¤§äºè™šæ‹ŸèŠ‚ç‚¹æ•°é‡ï¼Œæ¯ä¸ªä¸»æœºéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚</td></tr></tbody></table><h2 id=loadbalancersettings-consistenthashlb-httpcookie><code>LoadBalancerSettings.ConsistentHashLB.HTTPCookie</code></h2><p>æè¿°ç”¨äºåœ¨ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡å™¨ä¸­ç”¨äºç”Ÿæˆå“ˆå¸Œå€¼çš„ HTTP Cookieã€‚å¦‚æœæŒ‡å®šçš„ Cookie ä¸å­˜åœ¨åˆ™ä¼šè¢«ç”Ÿæˆã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚Cookie çš„åç§°ã€‚</td></tr><tr><td><code>path</code></td><td><code>string</code></td><td>è®¾ç½® Cookie çš„è·¯å¾„ã€‚</td></tr><tr><td><code>ttl</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>å¿…è¦å­—æ®µã€‚Cookie çš„ç”Ÿå‘½æœŸã€‚</td></tr></tbody></table><h2 id=loadbalancersettings-simplelb><code>LoadBalancerSettings.SimpleLB</code></h2><p>æ ‡å‡†è´Ÿè½½å‡è¡¡ç®—æ³•çš„è°ƒæ•´é€‰é¡¹ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ROUND_ROBIN</code></td><td>è½®è¯¢è°ƒåº¦ç­–ç•¥ã€‚ç¼ºçœã€‚</td></tr><tr><td><code>LEAST_CONN</code></td><td>ä½¿ç”¨ä¸€ä¸ª O(1) å¤æ‚åº¦çš„ç®—æ³•ï¼šéšæœºé€‰æ‹©ä¸¤ä¸ªå¥åº·ä¸»æœºï¼Œä»ä¸­é€‰æ‹©ä¸€ä¸ªè¾ƒå°‘è¯·æ±‚çš„ä¸»æœºæä¾›æœåŠ¡ã€‚</td></tr><tr><td><code>RANDOM</code></td><td>éšæœºçš„è´Ÿè½½å‡è¡¡ç®—æ³•ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¥åº·ä¸»æœºã€‚åœ¨æ²¡æœ‰å¥åº·æ£€æŸ¥ç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œéšæœºç­–ç•¥é€šå¸¸ä¼šæ¯”è½®è¯¢è°ƒåº¦ç­–ç•¥æ›´åŠ é«˜æ•ˆã€‚</td></tr><tr><td><code>PASSTHROUGH</code></td><td>è¿™ä¸ªç­–ç•¥ä¼šç›´æ¥æŠŠè¯·æ±‚å‘ç»™å®¢æˆ·ç«¯è¦æ±‚çš„åœ°å€ä¸Šã€‚è¿™ä¸ªé€‰é¡¹éœ€è¦æ…é‡ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ç§é«˜çº§ç”¨ä¾‹ã€‚å‚è€ƒ <a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancing>Envoy çš„ Original destination è´Ÿè½½å‡è¡¡</a> ä¸€æ–‡è¿›ä¸€æ­¥äº†è§£å…¶åº”ç”¨æ–¹å¼ã€‚</td></tr></tbody></table><h2 id=outlierdetection><code>OutlierDetection</code></h2><p>ç†”æ–­å™¨çš„å®ç°éœ€è¦å¯¹æ¯ä¸ªä¸Šæ¸¸æœåŠ¡ä¸»æœºè¿›è¡Œè¿½è¸ªã€‚å¯¹ HTTP å’Œ TCP æœåŠ¡éƒ½å¯ä»¥ç”Ÿæ•ˆã€‚å¯¹ HTTP æœåŠ¡æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸»æœºæŒç»­è¿”å› <code>5xx</code> ç»™ API è°ƒç”¨ï¼Œä¼šè¢«è¸¢å‡ºæœåŠ¡æ± ï¼Œå¹¶æŒç»­ä¸€ä¸ªé¢„å®šä¹‰çš„æ—¶é—´é•¿åº¦ï¼›è€Œå¯¹äº TCP æœåŠ¡ï¼Œåˆ°æŒ‡å®šä¸»æœºçš„è¿æ¥è¶…æ—¶å’Œè¿æ¥å¤±è´¥éƒ½ä¼šè¢«è®°ä¸ºé”™è¯¯æ¬¡æ•°ï¼Œä½œä¸ºæŒç»­å¤±è´¥çš„æŒ‡æ ‡è¿›è¡Œç»Ÿè®¡ã€‚å‚è€ƒ Envoy çš„ <a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier>outlier detection</a> å¯ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p><p>ä¸‹é¢çš„è§„åˆ™ä¸º <code>reviews</code> æœåŠ¡è®¾ç½®äº†ä¸€ä¸ª 100 ä¸ª TCP è¿æ¥ï¼Œä»¥åŠ 1000 ä¸ª HTTP2 å¹¶å‘è¯·æ±‚åŒæ—¶æ¯ä¸ªè¿æ¥ä¸èƒ½è¶…è¿‡ 10 è¯·æ±‚çš„è¿æ¥æ± ã€‚å¦å¤–å…¶ä¸­è¿˜é…ç½®äº†æ¯äº”åˆ†é’Ÿæ‰«æä¸€æ¬¡ä¸Šæ¸¸æœåŠ¡ä¸»æœºï¼Œè¿ç»­å¤±è´¥ 7 æ¬¡è¿”å› <code>5xx</code> é”™è¯¯ç çš„ä¸»æœºä¼šè¢«ç§»å‡ºè¿æ¥æ±  15 åˆ†é’Ÿã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: reviews-cb-policy
spec:
  host: reviews.prod.svc.cluster.local
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http2MaxRequests: 1000
        maxRequestsPerConnection: 10
    outlierDetection:
      consecutiveErrors: 7
      interval: 5m
      baseEjectionTime: 15m
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>consecutiveErrors</code></td><td><code>int32</code></td><td>è¶…è¿‡è¿™ä¸€é”™è¯¯æ•°é‡ä¹‹åï¼Œä¸»æœºå°†ä¼šè¢«ç§»å‡ºè¿æ¥æ± ã€‚ç¼ºçœå€¼ä¸º 5ã€‚å½“ä¸Šæ¸¸æœåŠ¡æ˜¯ HTTP æœåŠ¡æ—¶ï¼Œ<code>5xx</code> çš„è¿”å›ç ä¼šè¢«è®°ä¸ºé”™è¯¯ï¼›å½“ä¸Šæ¸¸ä¸»æœºæä¾›çš„æ˜¯ TCP æœåŠ¡æ—¶ï¼ŒTCP è¿æ¥è¶…æ—¶å’Œè¿æ¥é”™è¯¯/æ•…éšœäº‹ä»¶ä¼šè¢«è®°ä¸ºé”™è¯¯ã€‚</td></tr><tr><td><code>interval</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>åœ¨ç§»é™¤æ£€æµ‹ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚ç¼ºçœå€¼ä¸º <code>10s</code>ï¼Œå¿…é¡»å¤§äºæˆ–ç­‰äº <code>1ms</code>ã€‚</td></tr><tr><td><code>baseEjectionTime</code></td><td><a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf><code>google.protobuf.Duration</code></a></td><td>æœ€å°çš„ç§»é™¤æ—¶é—´é•¿åº¦ã€‚ä¸»æœºæ¯æ¬¡è¢«ç§»é™¤åçš„éš”ç¦»æ—¶é—´ç­‰äºè¢«ç§»é™¤çš„æ¬¡æ•°å’Œæœ€å°ç§»é™¤æ—¶é—´çš„ä¹˜ç§¯ã€‚è¿™æ ·çš„å®ç°ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨å¢åŠ ä¸å¥åº·ä¸Šæ¸¸æœåŠ¡å®ä¾‹çš„éš”ç¦»æ—¶é—´ã€‚ç¼ºçœä¸ºå€¼ä¸º <code>30s</code>ã€‚</td></tr><tr><td><code>maxEjectionPercent</code></td><td><code>int32</code></td><td>ä¸Šæ¸¸æœåŠ¡çš„è´Ÿè½½å‡è¡¡æ± ä¸­å…è®¸è¢«ç§»é™¤çš„ä¸»æœºçš„æœ€å¤§ç™¾åˆ†æ¯”ã€‚ç¼ºçœå€¼ä¸º <code>10%</code></td></tr></tbody></table><h2 id=port><code>Port</code></h2><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>number</code></td><td><code>uint32</code></td><td>å¿…è¦å­—æ®µã€‚ä¸€ä¸ªæœ‰æ•ˆçš„æ­£æ•´æ•°ä»£è¡¨çš„ç«¯å£å·ã€‚</td></tr><tr><td><code>protocol</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚è¯¥ç«¯å£å¼€æ”¾çš„æœåŠ¡åè®®ï¼Œå¿…é¡»æ˜¯ <code>HTTP</code>ã€<code>HTTPS</code>ã€<code>GRPC</code>ã€<code>HTTP2</code>ã€<code>MONGO</code>ã€<code>TCP</code> ä»¥åŠ <code>TLS</code> ä¸­çš„ä¸€ä¸ªã€‚TLS ç”¨æ¥æŒ‡ç¤ºä¸é HTTP æœåŠ¡çš„å®‰å…¨è¿æ¥ã€‚</td></tr><tr><td><code>name</code></td><td><code>string</code></td><td>åˆ†é…ç»™è¿™ä¸€ç«¯å£çš„æ ‡ç­¾ã€‚</td></tr></tbody></table><h2 id=portselector><code>PortSelector</code></h2><p><code>PortSelector</code> æŒ‡å®šä¸€ä¸ªç«¯å£å·ï¼Œç”¨äºåŒ¹é…æˆ–é€‰æ‹©æœ€ç»ˆè·¯ç”±ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>number</code></td><td><code>uint32</code></td><td>æœ‰æ•ˆçš„ç«¯å£å·ã€‚</td></tr></tbody></table><h2 id=server><code>Server</code></h2><p><code>Server</code> æè¿°äº†æŒ‡å®šè´Ÿè½½å‡è¡¡ç«¯å£ä¸Šçš„ä»£ç†æœåŠ¡å™¨å±æ€§ï¼Œä¾‹å¦‚ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-ingress
spec:
  selector:
    app: my-ingress-gateway
  servers:
  - port:
      number: 80
      name: http2
      protocol: HTTP2
    hosts:
    - &#34;*&#34;
</code></pre><p>å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-tcp-ingress
spec:
  selector:
    app: my-tcp-ingress-gateway
  servers:
  - port:
      number: 27018
      name: mongo
      protocol: MONGO
    hosts:
    - &#34;*&#34;
</code></pre><p>æ¥ä¸‹æ¥çš„ä¾‹å­æ˜¯ä¸€ä¸ª 443 ç«¯å£ä¸Šçš„ TLS é…ç½®ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-tls-ingress
spec:
  selector:
    app: my-tls-ingress-gateway
  servers:
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - &#34;*&#34;
    tls:
      mode: SIMPLE
      serverCertificate: /etc/certs/server.pem
      privateKey: /etc/certs/privatekey.pem
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>port</code></td><td><a href=#port><code>Port</code></a></td><td>å¿…è¦å­—æ®µã€‚ä»£ç†æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ï¼Œç”¨äºæ¥æ”¶è¿æ¥ã€‚</td></tr><tr><td><code>hosts</code></td><td><code>string[]</code></td><td>å¿…è¦å­—æ®µã€‚<code>Gateway</code> å…¬å¼€çš„ä¸»æœºååˆ—è¡¨ã€‚æœ€å°‘è¦æœ‰ä¸€æ¡è®°å½•ã€‚åœ¨é€šå¸¸çš„ HTTP æœåŠ¡ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¸¦æœ‰ SNI çš„ TLS æœåŠ¡ã€‚å¯ä»¥ä½¿ç”¨åŒ…å«é€šé…ç¬¦å‰ç¼€çš„åŸŸåï¼Œä¾‹å¦‚ <code>*.foo.com</code> åŒ¹é… <code>bar.foo.com</code>ï¼Œ<code>*.com</code> åŒ¹é… <code>bar.foo.com</code> ä»¥åŠ <code>example.com</code>ã€‚<strong>æ³¨æ„</strong>ï¼šç»‘å®šåœ¨ <code>Gateway</code> ä¸Šçš„ <code>VirtualService</code> å¿…é¡»æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèƒ½å¤Ÿå’Œ <code>Server</code> ä¸­çš„ <code>hosts</code> å­—æ®µç›¸åŒ¹é…çš„ä¸»æœºåã€‚åŒ¹é…å¯ä»¥æ˜¯å®Œå…¨åŒ¹é…æˆ–æ˜¯åç¼€åŒ¹é…ã€‚ä¾‹å¦‚ <code>server</code> çš„ <code>hosts</code> å­—æ®µä¸º <code>*.example.com</code>ï¼Œå¦‚æœ <code>VirtualService</code> çš„ <code>hosts</code> å­—æ®µå®šä¹‰ä¸º <code>dev.example.com</code> å’Œ <code>prod.example.com</code>ï¼Œå°±æ˜¯å¯ä»¥åŒ¹é…çš„ï¼›è€Œå¦‚æœ<code>VirtualService</code> çš„ <code>hosts</code> å­—æ®µæ˜¯ <code>example.com</code> æˆ–è€… <code>newexample.com</code> åˆ™æ— æ³•åŒ¹é…ã€‚</td></tr><tr><td><code>tls</code></td><td><a href=#server-tlsoptions><code>Server.TLSOptions</code></a></td><td>ä¸€ç»„ TLS ç›¸å…³çš„é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹å¯ä»¥æŠŠ http è¯·æ±‚é‡å®šå‘ä¸º httpsï¼Œå¹¶ä¸”è®¾ç½® TLS çš„æ¨¡å¼ã€‚</td></tr></tbody></table><h2 id=server-tlsoptions><code>Server.TLSOptions</code></h2><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>httpsRedirect</code></td><td><code>bool</code></td><td>å¦‚æœè®¾ç½®ä¸ºçœŸï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šç»™æ‰€æœ‰ http è¿æ¥å‘é€ 301 è½¬å‘æŒ‡ä»¤ï¼Œè¦æ±‚å®¢æˆ·ç«¯ä½¿ç”¨ HTTPSã€‚</td></tr><tr><td><code>mode</code></td><td><a href=#server-tlsoptions-tlsmode><code>Server.TLSOptions.TLSmode</code></a></td><td>å¯é€‰å­—æ®µï¼šè¿™ä¸€å­—æ®µçš„å€¼å†³å®šäº†å¦‚ä½•ä½¿ç”¨ TLSã€‚</td></tr><tr><td><code>serverCertificate</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚å¦‚æœ <code>mode</code> è®¾ç½®ä¸º <code>SIMPLE</code> æˆ–è€… <code>MUTUAL</code>ï¼Œè¿™ä¸€å­—æ®µæŒ‡å®šäº†æœåŠ¡ç«¯çš„ TLS è¯ä¹¦ã€‚</td></tr><tr><td><code>privateKey</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚å¦‚æœ <code>mode</code> è®¾ç½®ä¸º <code>SIMPLE</code> æˆ–è€… <code>MUTUAL</code>ï¼Œè¿™ä¸€å­—æ®µæŒ‡å®šäº†æœåŠ¡ç«¯çš„ TLS å¯†é’¥ã€‚</td></tr><tr><td><code>caCertificates</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚å¦‚æœ <code>mode</code> è®¾ç½®ä¸º <code>MUTUAL</code>ï¼Œè¿™ä¸€å­—æ®µåŒ…å«äº†ç”¨äºéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ ca è¯ä¹¦ã€‚</td></tr><tr><td><code>subjectAltNames</code></td><td><code>string[]</code></td><td>ç”¨äºéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ä¸€ç»„è®¤è¯ä¸»ä½“åç§°ã€‚</td></tr></tbody></table><h2 id=server-tlsoptions-tlsmode><code>Server.TLSOptions.TLSmode</code></h2><p>ä»£ç†æœåŠ¡å™¨ä½¿ç”¨çš„ TLS æ¨¡å¼ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>PASSTHROUGH</code></td><td>åŸºäºå®¢æˆ·ç«¯æä¾›çš„SNIå­—ç¬¦ä¸²é€‰æ‹©ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œè½¬å‘ã€‚</td></tr><tr><td><code>SIMPLE</code></td><td>ç”¨æ ‡å‡† TLS åŠ å¯†è¿æ¥ã€‚</td></tr><tr><td><code>MUTUAL</code></td><td>é€šè¿‡æä¾›å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶ä½¿ç”¨åŒå‘ TLS åŠ å¯†ä¸ä¸Šæ¸¸çš„è¿æ¥ã€‚</td></tr></tbody></table><h2 id=serviceentry><code>ServiceEntry</code></h2><p><code>ServiceEntry</code> èƒ½å¤Ÿåœ¨ Istio å†…éƒ¨çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­åŠ å…¥é¢å¤–çš„æ¡ç›®ï¼Œä»è€Œè®©ç½‘æ ¼ä¸­è‡ªåŠ¨å‘ç°çš„æœåŠ¡èƒ½å¤Ÿè®¿é—®å’Œè·¯ç”±åˆ°è¿™äº›æ‰‹å·¥åŠ å…¥çš„æœåŠ¡ã€‚<code>ServiceEntry</code> æè¿°äº†æœåŠ¡çš„å±æ€§ï¼ˆDNS åç§°ã€VIPã€ç«¯å£ã€åè®®ä»¥åŠç«¯ç‚¹ï¼‰ã€‚è¿™ç±»æœåŠ¡å¯èƒ½æ˜¯ç½‘æ ¼å¤–çš„ APIï¼Œæˆ–è€…æ˜¯å¤„äºç½‘æ ¼å†…éƒ¨ä½†å´ä¸å­˜åœ¨äºå¹³å°çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ¡ç›®ï¼ˆä¾‹å¦‚éœ€è¦å’Œ Kubernetes æœåŠ¡æ²Ÿé€šçš„ä¸€ç»„è™šæ‹ŸæœºæœåŠ¡ï¼‰ã€‚</p><h3 id=ç¤ºä¾‹-åŠ å…¥å¤–éƒ¨æœåŠ¡>ç¤ºä¾‹ï¼šåŠ å…¥å¤–éƒ¨æœåŠ¡</h3><p>ä¸‹é¢çš„é…ç½®æŠŠä¸€ç»„è¿è¡Œåœ¨éæ‰˜ç®¡è™šæ‹Ÿæœºä¸Šçš„ MongoDB åŠ å…¥åˆ° Istio çš„æœåŠ¡æ³¨å†Œè¡¨ä¹‹ä¸­ï¼Œè¿™æ ·è¿™äº›æœåŠ¡å°±å¯ä»¥å’Œå…¶ä»–ç½‘æ ¼å†…çš„æœåŠ¡ä¸€æ ·è¿›è¡Œä½¿ç”¨ã€‚å¯¹åº”çš„ <code>DestinationRule</code> ç”¨æ¥åˆå§‹åŒ–åˆ°æ•°æ®åº“å®ä¾‹çš„åŒå‘ TLS è¿æ¥ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-mongocluster
spec:
  hosts:
  - mymongodb.somedomain # æ— ç”¨
  addresses:
  - 192.192.192.192/24 # VIPs
  ports:
  - number: 27018
    name: mongodb
    protocol: MONGO
  location: MESH_INTERNAL
  resolution: STATIC
  endpoints:
  - address: 2.2.2.2
  - address: 3.3.3.3
</code></pre><p>ç›¸å…³çš„ <code>DestinationRule</code>ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: mtls-mongocluster
spec:
  host: mymongodb.somedomain
  trafficPolicy:
    tls:
      mode: MUTUAL
      clientCertificate: /etc/certs/myclientcert.pem
      privateKey: /etc/certs/client_private_key.pem
      caCertificates: /etc/certs/rootcacerts.pem
</code></pre><h3 id=ç¤ºä¾‹-tls-é€ä¼ >ç¤ºä¾‹ï¼šTLS é€ä¼ </h3><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¼šç”¨åˆ°ä¸€ä¸ª <code>ServiceEntry</code> ä»¥åŠ <code>VirtualService</code> çš„ç»„åˆæ¥è¿›è¡Œæ¼”ç¤ºï¼ŒæŠŠæ¥è‡ªåº”ç”¨çš„æœªç»ˆç»“ TLS æµé‡ç»è¿‡ Sidecar è½¬å‘ç»™å¤–éƒ¨æœåŠ¡ã€‚Sidecar è§‚å¯Ÿ <code>ClientHello</code> æ¶ˆæ¯ä¸­çš„ SNI å€¼ï¼Œç„¶åæŠŠæµé‡è½¬å‘ç»™åˆé€‚çš„å¤–éƒ¨æœåŠ¡ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-https
spec:
  hosts:
  - api.dropboxapi.com
  - www.googleapis.com
  - api.facebook.com
  location: MESH_EXTERNAL
  ports:
  - number: 443
    name: https
    protocol: HTTPS
  resolution: DNS
</code></pre><p>ç›¸å…³çš„ <code>VirtualService</code>ï¼Œæ ¹æ® SNI è¿›è¡Œè·¯ç”±ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: tls-routing
spec:
  hosts:
  - api.dropboxapi.com
  - www.googleapis.com
  - api.facebook.com
  tls:
  - match:
    - port: 443
      sniHosts:
      - api.dropboxapi.com
    route:
    - destination:
        host: api.dropboxapi.com
  - match:
    - port: 443
      sniHosts:
      - www.googleapis.com
    route:
    - destination:
        host: www.googleapis.com
  - match:
    - port: 443
      sniHosts:
      - api.facebook.com
    route:
    - destination:
        host: api.facebook.com
</code></pre><h3 id=è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡>è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡</h3><p>å†æ¥ä¸€ä¸ªä¾‹å­ï¼Œæ¼”ç¤ºä¸€ä¸ªç‹¬ç«‹çš„å¤–å‘æµé‡ç½‘å…³ï¼Œç”¨äºæ‰€æœ‰å¤–éƒ¨æœåŠ¡æµé‡çš„è½¬å‘ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-httpbin
spec:
  hosts:
  - httpbin.com
  location: MESH_EXTERNAL
  ports:
  - number: 80
    name: http
    protocol: HTTP
  resolution: DNS
</code></pre><p>å®šä¹‰ä¸€ä¸ª <code>Gateway</code> å¯¹è±¡æ¥å¤„ç†æ‰€æœ‰çš„å¤–å‘æµé‡ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
 name: istio-egressgateway
spec:
 selector:
   istio: egressgateway
 servers:
 - port:
     number: 80
     name: http
     protocol: HTTP
   hosts:
   - &#34;*&#34;
</code></pre><p>ç›¸å…³çš„ <code>VirtualService</code> ä¼šè¿›è¡Œä» Sidecar åˆ°ç½‘å…³æœåŠ¡çš„è·¯ç”±ï¼ˆ<code>istio-egressgateway.istio-system.svc.cluster.local</code>ï¼‰ä»¥åŠä»ç½‘å…³åˆ°å¤–éƒ¨æœåŠ¡çš„è·¯ç”±ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: gateway-routing
spec:
  hosts:
  - httpbin.com
  gateways:
  - mesh
  - istio-egressgateway
  http:
  - match:
    - port: 80
      gateways:
      - mesh
    route:
    - destination:
        host: istio-egressgateway.istio-system.svc.cluster.local
  - match:
    - port: 80
      gateway:
      - istio-egressgateway
    route:
    - destination:
        host: httpbin.com
</code></pre><h3 id=ç¤ºä¾‹-é€šé…ç¬¦åŸŸå>ç¤ºä¾‹ï¼šé€šé…ç¬¦åŸŸå</h3><p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†åœ¨å¤–éƒ¨æœåŠ¡å®šä¹‰ä¸­å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦å®šä¹‰ <code>hosts</code>ã€‚å¦‚æœè¿æ¥å¿…é¡»è¢«è·¯ç”±åˆ°åº”ç”¨è¯·æ±‚çš„ IPï¼ˆä¾‹å¦‚åº”ç”¨è§£æ DNS ä¹‹åå°è¯•è¿æ¥åˆ°ç‰¹å®š IP çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆ <code>resolution</code> éœ€è¦è®¾ç½®ä¸º <code>NONE</code>ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-wildcard-example
spec:
  hosts:
  - &#34;*.bar.com&#34;
  location: MESH_EXTERNAL
  ports:
  - number: 80
    name: http
    protocol: HTTP
  resolution: NONE
</code></pre><h3 id=unix-socket-è¿æ¥>Unix Socket è¿æ¥</h3><p>è¿™ä¸ªä¾‹å­ä¸­æ¼”ç¤ºçš„æœåŠ¡ï¼Œå¯ä»¥ç”¨å®¢æˆ·ç«¯æ‰€åœ¨ä¸»æœºçš„ Unix Socket è¿›è¡Œè¿æ¥ã€‚è¿™é‡Œçš„ <code>resolution</code> å¿…é¡»è®¾ç½®ä¸º <code>STATIC</code>ï¼Œæ³¨æ„ä¸‹é¢çš„ <code>endpoints</code> å®šä¹‰ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: unix-domain-socket-example
spec:
  hosts:
  - &#34;example.unix.local&#34;
  location: MESH_EXTERNAL
  ports:
  - number: 80
    name: http
    protocol: HTTP
  resolution: STATIC
  endpoints:
  - address: unix:///var/run/example/socket
</code></pre><h3 id=ä»£ç†æœåŠ¡å™¨>ä»£ç†æœåŠ¡å™¨</h3><p>å¯¹åŸºäº HTTP çš„æœåŠ¡æ¥è¯´ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰å¤šä¸ª DNS åœ°å€ä½œä¸ºåç«¯çš„ <code>VirtualService</code>ã€‚åœ¨è¿™ç§åœºæ™¯é‡Œï¼Œåº”ç”¨å¯ä»¥ä½¿ç”¨ <code>HTTP_PROXY</code> ç¯å¢ƒå˜é‡æ¥æŠŠ API è°ƒç”¨è·¯ç”±åˆ°æŒ‡å®šåç«¯ã€‚ä¾‹å¦‚ä¸‹é¢çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ªä¸å­˜åœ¨çš„å¤–éƒ¨æœåŠ¡ï¼Œå‘½åä¸º <code>foo.bar.com</code>ï¼Œä¸‰ä¸ªåç«¯è¿›è¡Œæ”¯æ’‘ï¼š<code>us.foo.bar.com:8080</code>ã€<code>uk.foo.bar.com:9080</code> ä»¥åŠ <code>in.foo.bar.com:7080</code>ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-dns
spec:
  hosts:
  - foo.bar.com
  location: MESH_EXTERNAL
  ports:
  - number: 80
    name: https
    protocol: HTTP
  resolution: DNS
  endpoints:
  - address: us.foo.bar.com
    ports:
      https: 8080
  - address: uk.foo.bar.com
    ports:
      https: 9080
  - address: in.foo.bar.com
    ports:
      https: 7080
</code></pre><p>å¦‚æ­¤å®šä¹‰ä¹‹åï¼Œå¦‚æœè®¾ç½®äº† <code>HTTP_PROXY=http://localhost/</code>ï¼Œä»åº”ç”¨åˆ° <code>http://foo.bar.com</code> çš„è®¿é—®ä¼šåˆ°è¾¾ä¸Šé¢çš„ä¸‰ä¸ªç«¯ç‚¹ç»„æˆçš„è´Ÿè½½å‡è¡¡ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹ <code>http://foo.bar.com/baz</code> ä¼šè¢«ç¿»è¯‘ä¸º <code>http://uk.foo.bar.com/baz</code>ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>hosts</code></td><td><code>string[]</code></td><td>å¿…è¦å­—æ®µã€‚ç»‘å®šåˆ° <code>ServiceEntry</code> ä¸Šçš„ä¸»æœºåã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå¸¦æœ‰é€šé…ç¬¦å‰ç¼€çš„ DNS åç§°ã€‚å¦‚æœæœåŠ¡ä¸æ˜¯ HTTP åè®®çš„ï¼Œä¾‹å¦‚ <code>mongo</code>ã€TCP ä»¥åŠ HTTPS ä¸­ï¼Œ<code>hosts</code> ä¸­çš„ DNS åç§°ä¼šè¢«å¿½ç•¥ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨ <code>endpoints</code> ä¸­çš„ <code>address</code> ä»¥åŠ <code>port</code> æ¥ç”„åˆ«è°ƒç”¨ç›®æ ‡ã€‚</td></tr><tr><td><code>addresss</code></td><td><code>string[]</code></td><td>æœåŠ¡ç›¸å…³çš„è™šæ‹Ÿ IPã€‚å¯ä»¥æ˜¯ CIDR å‰ç¼€ã€‚å¯¹ HTTP æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸€å­—æ®µä¼šè¢«å¿½ç•¥ï¼Œè€Œä¼šä½¿ç”¨ HTTP çš„ <code>HOST/Authority</code> Headerã€‚è€Œå¯¹äºé HTTP æœåŠ¡ï¼Œä¾‹å¦‚ <code>mongo</code>ã€TCP ä»¥åŠ HTTPS ä¸­ï¼Œè¿™äº›ä¸»æœºä¼šè¢«å¿½ç•¥ã€‚å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªæˆ–è€…å¤šä¸ª IP åœ°å€ï¼Œå¯¹äºåœ¨åˆ—è¡¨èŒƒå›´å†…çš„ IP çš„è®¿é—®ä¼šè¢«åˆ¤å®šä¸ºå±äºè¿™ä¸€æœåŠ¡ã€‚å¦‚æœåœ°å€å­—æ®µä¸ºç©ºï¼ŒæœåŠ¡çš„é‰´åˆ«å°±åªèƒ½é ç›®æ ‡ç«¯å£äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¢«è®¿é—®æœåŠ¡çš„ç«¯å£ä¸€å®šä¸èƒ½å’Œå…¶ä»–ç½‘æ ¼å†…çš„æœåŠ¡è¿›è¡Œå…±äº«ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œçš„ Sidecar ä¼šç®€å•çš„åšä¸º TCP ä»£ç†ï¼Œå°†ç‰¹å®šç«¯å£çš„è®¿é—®è½¬å‘åˆ°æŒ‡å®šç›®æ ‡ç«¯ç‚¹çš„ IPã€ä¸»æœºä¸Šå»ã€‚å°±æ— æ³•æ”¯æŒ Unix socket äº†ã€‚</td></tr><tr><td><code>ports</code></td><td><a href=#port><code>Port[]</code></a></td><td>å¿…è¦å­—æ®µã€‚å’Œå¤–éƒ¨æœåŠ¡å…³è”çš„ç«¯å£ã€‚å¦‚æœ <code>endpoints</code> æ˜¯ Unix socket åœ°å€ï¼Œè¿™é‡Œå¿…é¡»åªæœ‰ä¸€ä¸ªç«¯å£ã€‚</td></tr><tr><td><code>location</code></td><td><a href=#serviceentry-location><code>ServiceEntry.Location</code></a></td><td>ç”¨äºæŒ‡å®šè¯¥æœåŠ¡çš„ä½ç½®ï¼Œå±äºç½‘æ ¼å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚</td></tr><tr><td><code>resolution</code></td><td><a href=#serviceentry-resolution><code>ServiceEntry.Resolution</code></a></td><td>å¿…è¦å­—æ®µã€‚ä¸»æœºçš„æœåŠ¡å‘ç°æ¨¡å¼ã€‚åœ¨æ²¡æœ‰é™„å¸¦ IP åœ°å€çš„æƒ…å†µä¸‹ï¼Œä¸º TCP ç«¯å£è®¾ç½®è§£ææ¨¡å¼ä¸º NONE æ—¶å¿…é¡»å°å¿ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹ä»»ä½• IP çš„æŒ‡å®šç«¯å£çš„æµé‡éƒ½æ˜¯å…è®¸çš„ï¼ˆä¾‹å¦‚ <code>0.0.0.0:</code>ï¼‰ã€‚</td></tr><tr><td><code>endpoints</code></td><td><a href=#serviceentry-endpoint><code>ServiceEntry.Endpoint[]</code></a></td><td>ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…³è”åˆ°è¿™ä¸€æœåŠ¡çš„ <code>endpoint</code>ã€‚</td></tr></tbody></table><h2 id=serviceentry-endpoint><code>ServiceEntry.Endpoint</code></h2><p><code>Endpoint</code> ä¸ºç½‘æ ¼å†…çš„æœåŠ¡å®šä¹‰äº†ä¸€ä¸ªç½‘ç»œåœ°å€ï¼ˆIP æˆ–è€…ä¸»æœºåï¼‰ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>address</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚å’Œç½‘ç»œç«¯ç‚¹å…³è”çš„åœ°å€ï¼Œä¸åŒ…æ‹¬ç«¯å£éƒ¨åˆ†ã€‚åªæœ‰åœ¨ <code>resolution</code> è®¾ç½®ä¸º DNS çš„æ—¶å€™ï¼Œæ‰èƒ½ä½¿ç”¨åŸŸåï¼Œå¹¶ä¸”å…¶ä¸­ä¸å¯ä»¥åŒ…å«é€šé…ç¬¦ã€‚è¿˜å¯ä»¥ç”¨ <code>unix:///absolute/path/to/socket</code> çš„å½¢å¼ä½¿ç”¨ Unix socketã€‚</td></tr><tr><td><code>ports</code></td><td><code>map&lt;string, uint32&gt;</code></td><td>å…³è”åˆ°æœ¬ç«¯ç‚¹çš„ä¸€ç³»åˆ—ç«¯å£ã€‚ç«¯å£å¿…é¡»å’ŒæœåŠ¡ä¸­å£°æ˜çš„ç«¯å£ç›¸å…³è”ã€‚ä¸èƒ½ä½¿ç”¨ <code>unix://</code> åœ°å€ã€‚</td></tr><tr><td><code>labels</code></td><td><code>map&lt;string, string&gt;</code></td><td>å’Œç«¯ç‚¹ç›¸å…³è”çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ã€‚</td></tr></tbody></table><h2 id=serviceentry-location><code>ServiceEntry.Location</code></h2><p><code>Location</code> ç”¨äºæ ‡è¯†è¿™ä¸€æœåŠ¡æ˜¯å¦å¤„äºç½‘æ ¼å†…éƒ¨ã€‚<code>Location</code> å†³å®šäº†å¾ˆå¤šæ–¹é¢çš„ç‰¹æ€§ï¼Œä¾‹å¦‚æœåŠ¡é—´çš„åŒå‘ TLS è®¤è¯ï¼Œç­–ç•¥å®æ–½ç­‰ã€‚å½“å’Œå¤–éƒ¨æœåŠ¡é€šä¿¡æ—¶ï¼ŒIstio ä¼šåœç”¨åŒå‘ TLS è®¤è¯ï¼Œç­–ç•¥å®æ–½è¿‡ç¨‹ä¹Ÿä¼šä»æœåŠ¡ç«¯æ”¹ä¸ºå®¢æˆ·ç«¯æ‰§è¡Œã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>MESH_EXTERNAL</code></td><td>æœåŠ¡å¤„äºç½‘æ ¼ä¹‹å¤–ã€‚ä¸€èˆ¬ç”¨äºæä¾› API çš„å¤–éƒ¨æœåŠ¡ã€‚</td></tr><tr><td><code>MESH_INTERNAL</code></td><td>æœåŠ¡å¤„äºç½‘æ ¼ä¹‹å†…ã€‚å…¸å‹çš„æƒ…å†µæ˜¯ç”¨äºæŠŠéæ‰˜ç®¡ç¯å¢ƒï¼ˆåŠ å…¥åŸºäº Kubernetes çš„æœåŠ¡ç½‘æ ¼çš„è™šæ‹Ÿæœºï¼‰ä¸­çš„æœåŠ¡åŠ å…¥ç½‘æ ¼ã€‚</td></tr></tbody></table><h2 id=serviceentry-resolution><code>ServiceEntry.Resolution</code></h2><p><code>Resolution</code> ç¡®å®šä»£ç†å¦‚ä½•è§£ææœåŠ¡ç«¯ç‚¹æ‰€ä»£è¡¨çš„ IP åœ°å€ï¼Œä»è€Œå®Œæˆè·¯ç”±è¿‡ç¨‹ã€‚åº”ç”¨ç¨‹åºçš„ IP åœ°å€è§£ææ˜¯ä¸å—è¿™ä¸€å­—æ®µå½±å“çš„ã€‚åº”ç”¨æœ¬èº«è¿˜æ˜¯ä¼šä½¿ç”¨ DNS å®ŒæˆæœåŠ¡åˆ° IP çš„è§£æï¼Œè¿™æ ·å¤–å‘æµé‡æ‰èƒ½å¤Ÿè¢«ä»£ç†æ•è·ã€‚å¦å¤–å¯¹äº HTTP æœåŠ¡æ¥è¯´ï¼Œåº”ç”¨å¯ä»¥ç›´æ¥å’Œä»£ç†æœåŠ¡å™¨é€šä¿¡ï¼Œä»è€Œé—´æ¥çš„å®Œæˆå’ŒæœåŠ¡çš„é€šä¿¡ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>NONE</code></td><td>å‡è®¾è¿›å…¥è¿æ¥å·²ç»è¢«è§£æä¸ºä¸€ä¸ªç‰¹å®šçš„ç›®æ ‡ IP åœ°å€ã€‚è¿™ç§è¿æ¥é€šå¸¸æ˜¯ç”±ä»£ç†ä½¿ç”¨ IP table REDIRECT æˆ–è€… eBPF ä¹‹ç±»çš„æœºåˆ¶è½¬å‘è€Œæ¥çš„ã€‚å®Œæˆè·¯ç”±ç›¸å…³çš„è½¬æ¢ä¹‹åï¼Œä»£ç†æœåŠ¡å™¨ä¼šå°†è¿æ¥è½¬å‘åˆ°è¯¥ IP åœ°å€ã€‚</td></tr><tr><td><code>STATIC</code></td><td>ä½¿ç”¨ <code>endpoints</code> ä¸­æŒ‡å®šçš„é™æ€ IP åœ°å€ä½œä¸ºæœåŠ¡åç«¯ã€‚ï¼ˆå‚è§ä¸‹ä¸€æ¡ï¼‰</td></tr><tr><td><code>DNS</code></td><td>å¤„ç†è¯·æ±‚æ—¶å°è¯•å‘ DNS æŸ¥è¯¢ IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>endpoints</code>ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨é€šé…ç¬¦ã€‚ä»£ç†æœåŠ¡å™¨ä¼šä½¿ç”¨ DNS è§£æ <code>hosts</code> å­—æ®µä¸­çš„åœ°å€ã€‚å¦‚æœæŒ‡å®šäº† <code>endpoints</code>ï¼Œé‚£ä¹ˆæŒ‡å®šçš„åœ°å€å°±ä¼šä½œä¸ºç›®æ ‡ IP åœ°å€ã€‚DNS è§£æä¸èƒ½ç”¨åœ¨ Unix domain ç«¯ç‚¹ä¸Šã€‚</td></tr></tbody></table><h2 id=stringmatch><code>StringMatch</code></h2><p>æè¿°å¦‚ä½•è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ï¼ŒåŒ¹é…è¿‡ç¨‹æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>extract</code></td><td><code>string</code></td><td>å®Œå…¨åŒ¹é…ã€‚</td></tr><tr><td><code>prefix</code></td><td><code>string</code></td><td>å‰ç¼€åŒ¹é…ã€‚</td></tr><tr><td><code>regex</code></td><td><code>string</code></td><td><code>ECMAscript</code> é£æ ¼çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</td></tr></tbody></table><h2 id=subset><code>Subset</code></h2><p><code>Subset</code> æ˜¯æœåŠ¡ç«¯ç‚¹çš„ä¸€ä¸ªæˆå‘˜ï¼Œå¯ä»¥ç”¨äº A/B æµ‹è¯•æˆ–è€…åˆ†ç‰ˆæœ¬è·¯ç”±ç­‰åœºæ™¯ã€‚å‚è€ƒ <a href=#virtualservice><code>VirtualService</code></a> æ–‡æ¡£ï¼Œå…¶ä¸­ä¼šæœ‰æ›´å¤šè¿™æ–¹é¢åº”ç”¨çš„ä¾‹å­ã€‚å¦å¤–æœåŠ¡çº§çš„æµé‡ç­–ç•¥å¯ä»¥åœ¨ <code>subset</code> çº§ä¸­è¿›è¡Œè¦†ç›–ã€‚ä¸‹é¢çš„è§„åˆ™é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªåä¸º <code>testversion</code> çš„å­é›†ï¼Œè¿™ä¸ªå­é›†æ˜¯æ ¹æ®æ ‡ç­¾ï¼ˆ<code>version: v3</code>ï¼‰é€‰å‡ºçš„ï¼Œä¸ºè¿™ä¸ªå­é›†ä½¿ç”¨äº†è½®è¯¢è°ƒåº¦çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: bookinfo-ratings
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN
  subsets:
  - name: testversion
    labels:
      version: v3
    trafficPolicy:
      loadBalancer:
        simple: ROUND_ROBIN

</code></pre><p><strong>æ³¨æ„</strong>ï¼šåœ¨è·¯ç”±è§„åˆ™æ˜¾å¼å¼•ç”¨ä¸€ä¸ª <code>Subset</code> çš„æ—¶å€™ï¼Œè¯¥ <code>Subset</code> å®šä¹‰çš„ç­–ç•¥æ‰ä¼šç”Ÿæ•ˆã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>å¿…è¦å­—æ®µã€‚æœåŠ¡åå’Œ <code>subset</code> åç§°å¯ä»¥ç”¨äºè·¯ç”±è§„åˆ™ä¸­çš„æµé‡æ‹†åˆ†ã€‚</td></tr><tr><td><code>labels</code></td><td><code>map&lt;string, string&gt;</code></td><td>å¿…è¦å­—æ®µã€‚ä½¿ç”¨æ ‡ç­¾å¯¹æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ç«¯ç‚¹è¿›è¡Œç­›é€‰ã€‚</td></tr><tr><td><code>trafficPolicy</code></td><td><a href=#trafficpolicy><code>TrafficPolicy</code></a></td><td>åº”ç”¨åˆ°è¿™ä¸€å­é›†çš„æµé‡ç­–ç•¥ã€‚ç¼ºçœæƒ…å†µä¸‹å­é›†ä¼šç»§æ‰¿ <code>DestinationRule</code> çº§åˆ«çš„ç­–ç•¥ï¼Œè¿™ä¸€å­—æ®µçš„å®šä¹‰åˆ™ä¼šè¦†ç›–ç¼ºçœçš„ç»§æ‰¿ç­–ç•¥ã€‚</td></tr></tbody></table><h2 id=tcproute><code>TCPRoute</code></h2><p>æè¿° TCP æµé‡çš„ç‰¹å¾åŒ¹é…å’Œç›¸å…³åŠ¨ä½œã€‚ä¸‹é¢çš„è·¯ç”±è§„åˆ™ä¼šæŠŠåˆ°è¾¾ 27017 ç«¯å£çš„æµé‡è½¬å‘ç»™ <code>mongo.prod.svc.cluster.local</code> è¿™ä¸€æœåŠ¡çš„ 5555 ç«¯å£ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-Mongo
spec:
  hosts:
  - mongo.prod.svc.cluster.local
  tcp:
  - match:
    - port: 27017
    route:
    - destination:
        host: mongo.backup.svc.cluster.local
        port:
          number: 5555
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>match</code></td><td><a href=#l4matchattributes><code>L4MatchAttributes[]</code></a></td><td>æ¿€æ´»è§„åˆ™æ‰€éœ€çš„åŒ¹é…æ¡ä»¶ã€‚ä¸€ä¸ª <code>match</code> å—å†…æ¡ä»¶ä¹‹é—´éƒ½æ˜¯é€»è¾‘ä¸å…³ç³»ï¼›<code>match</code> å—ä¹‹é—´æ˜¯é€»è¾‘æˆ–å…³ç³»ã€‚ä»»ä½•ä¸€ä¸ª <code>match</code> å—åŒ¹é…æˆåŠŸï¼Œéƒ½ä¼šæ¿€æ´»è§„åˆ™ã€‚</td></tr><tr><td><code>route</code></td><td><a href=#destinationweight><code>DestinationWeight[]</code></a></td><td>æµé‡çš„è½¬å‘ç›®æ ‡ã€‚ç›®å‰ TCP æœåŠ¡åªå…è®¸ä¸€ä¸ªè½¬å‘ç›®æ ‡ã€‚å½“ Envoy æ”¯æŒ TCP æƒé‡è·¯ç”±ä¹‹åï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨å¤šä¸ªç›®æ ‡äº†ã€‚</td></tr></tbody></table><h2 id=tlsmatchattributes><code>TLSMatchAttributes</code></h2><p>TLS è¿æ¥å±æ€§åŒ¹é…ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>sniHosts</code></td><td><code>string[]</code></td><td>å¿…è¦å­—æ®µã€‚è¦åŒ¹é…çš„ SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºï¼‰ã€‚å¯ä»¥åœ¨ SNI åŒ¹é…å€¼ä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚æ¯”å¦‚ <code>*.com</code> å¯ä»¥åŒæ—¶åŒ¹é… <code>foo.example.com</code> å’Œ <code>example.com</code>ã€‚</td></tr><tr><td><code>destinationSubnets</code></td><td><code>string[]</code></td><td><code>IPv4</code> æˆ–è€… <code>IPv6</code> çš„ç›®æ ‡åœ°å€ï¼Œå¯èƒ½å¸¦æœ‰å­ç½‘ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>a.b.c.d</code> å½¢å¼æˆ–è€… <code>a.b.c.d</code>ã€‚</td></tr><tr><td><code>port</code></td><td><code>uint32</code></td><td>æŒ‡å®šä¸»æœºæœåŠ¡çš„ç›‘å¬ç«¯å£ã€‚å¾ˆå¤šæœåŠ¡åªæš´éœ²ä¸€ä¸ªç«¯å£ï¼Œæˆ–è€…ç”¨åè®®å‰ç¼€ç»™ç«¯å£å‘½åï¼Œè¿™ç§æƒ…å†µä¸‹å°±éƒ½ä¸éœ€è¦æ˜¾å¼çš„æŒ‡å®šç«¯å£å·ã€‚</td></tr><tr><td><code>sourceLabels</code></td><td><code>map&lt;string, string&gt;</code></td><td>ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ç”¨äºæŒ‡ç¤ºè§„åˆ™åœ¨å·¥ä½œè´Ÿè½½ä¸­çš„çš„é€‚ç”¨èŒƒå›´ã€‚å¦‚æœ <code>VirtualService</code> ä¸­æŒ‡å®šäº† <code>gateway</code>ï¼Œè¦ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤ï¼Œè¿˜è¦åŠ å…¥ <code>mesh</code> è¿™ä¸€ç¼ºçœç½‘å…³æ‰èƒ½ç”Ÿæ•ˆã€‚</td></tr><tr><td><code>gateways</code></td><td><code>string[]</code></td><td>è§„åˆ™æ‰€æ¶‰åŠçš„ <code>Gateway</code> çš„åç§°åˆ—è¡¨ã€‚è¿™ä¸€å­—æ®µä¼šè¦†ç›– <code>VirtualService</code> è‡ªèº«çš„ <code>gateways</code> è®¾ç½®ã€‚<code>gateways</code> åŒ¹é…æ˜¯ç‹¬ç«‹äº <code>sourceLabels</code> çš„ã€‚</td></tr></tbody></table><h2 id=tlsroute><code>TLSRoute</code></h2><p>æè¿°é€ä¼  TLS æµé‡çš„ç‰¹å¾åŒ¹é…å’Œç›¸å…³åŠ¨ä½œã€‚ä¸‹é¢çš„ä¾‹å­å°†åˆ°è¾¾ <code>mygateway</code> ç½‘å…³ 443 ç«¯å£çš„é€ä¼  TLS æµé‡æ ¹æ® SNI å€¼è½¬å‘ç»™ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo-sni
spec:
  hosts:
  - &#34;*.bookinfo.com&#34;
  gateways:
  - mygateway
  tls:
  - match:
    - port: 443
      sniHosts:
      - login.bookinfo.com
    route:
    - destination:
        host: login.prod.svc.cluster.local
  - match:
    - port: 443
      sniHosts:
      - reviews.bookinfo.com
    route:
    - destination:
        host: reviews.prod.svc.cluster.local
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>match</code></td><td><a href=#tlsmatchattributes><code>TLSMatchAttributes[]</code></a></td><td>å¿…è¦å­—æ®µã€‚æ¿€æ´»è§„åˆ™æ‰€éœ€çš„åŒ¹é…æ¡ä»¶ã€‚ä¸€ä¸ª <code>match</code> å—å†…æ¡ä»¶ä¹‹é—´éƒ½æ˜¯é€»è¾‘ä¸å…³ç³»ï¼›<code>match</code> å—ä¹‹é—´æ˜¯é€»è¾‘æˆ–å…³ç³»ã€‚ä»»ä½•ä¸€ä¸ª <code>match</code> å—åŒ¹é…æˆåŠŸï¼Œéƒ½ä¼šæ¿€æ´»è§„åˆ™ã€‚</td></tr><tr><td><code>route</code></td><td><a href=#destinationweight><code>DestinationWeight[]</code></a></td><td>æµé‡çš„è½¬å‘ç›®æ ‡ã€‚ç›®å‰ TLS æœåŠ¡åªå…è®¸ä¸€ä¸ªè½¬å‘ç›®æ ‡ã€‚å½“ Envoy æ”¯æŒ TCP æƒé‡è·¯ç”±ä¹‹åï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨å¤šä¸ªç›®æ ‡äº†ã€‚</td></tr></tbody></table><h2 id=tlssettings><code>TLSSettings</code></h2><p>SSL/TLS ç›¸å…³çš„ä¸Šæ¸¸æœåŠ¡è®¾ç½®ã€‚å‚è€ƒ Envoy çš„ <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/auth/cert.proto.html>TLS ä¸Šä¸‹æ–‡</a>æ¥è·å–æ›´å¤šç»†èŠ‚ã€‚è¿™äº›è®¾ç½®å¯¹ HTTP å’Œ TCP ä¸Šæ¸¸æœåŠ¡éƒ½æœ‰æ•ˆã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„è§„åˆ™é…ç½®ï¼Œè¦æ±‚å®¢æˆ·ç«¯ä½¿ç”¨åŒå‘ TLS è¿æ¥ä¸Šæ¸¸çš„æ•°æ®åº“é›†ç¾¤ã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: db-mtls
spec:
  host: mydbserver.prod.svc.cluster.local
  trafficPolicy:
    tls:
      mode: MUTUAL
      clientCertificate: /etc/certs/myclientcert.pem
      privateKey: /etc/certs/client_private_key.pem
      caCertificates: /etc/certs/rootcacerts.pem
</code></pre><p>æ¥ä¸‹æ¥çš„è§„åˆ™é…ç½®ï¼Œå¦‚æœè¿æ¥å¤–éƒ¨æœåŠ¡çš„åŸŸåèƒ½å¤ŸåŒ¹é…åˆ° <code>*.foo.com</code>ï¼Œå°±éœ€è¦ä½¿ç”¨ TLSã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: tls-foo
spec:
  host: &#34;*.foo.com&#34;
  trafficPolicy:
    tls:
      mode: SIMPLE
</code></pre><p>ä¸‹é¢çš„è§„åˆ™é…ç½®å®¢æˆ·ç«¯ï¼Œåœ¨è®¿é—® <code>ratings</code> æœåŠ¡çš„æ—¶å€™ä½¿ç”¨åŒå‘ TLSã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: ratings-istio-mtls
spec:
  host: ratings.prod.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>mode</code></td><td><a href=#tlssettings-tlsmode><code>TLSSettings.TLSmode</code></a></td><td>å¿…è¦å­—æ®µã€‚è¿æ¥è¯¥ç«¯å£æ˜¯å¦éœ€è¦ä½¿ç”¨ TLSã€‚è¿™ä¸ªå­—æ®µçš„å€¼å†³å®šäº†ç«¯å£çš„åŠ å¯†è¦æ±‚ã€‚</td></tr><tr><td><code>clientCertificate</code></td><td><code>string</code></td><td><code>mode</code> å­—æ®µä¸º <code>MUTUAL</code> çš„æƒ…å†µä¸‹ï¼Œè¯¥å­—æ®µä¸ºå¿…è¦å­—æ®µã€‚å­—æ®µå€¼ä»£è¡¨ç”¨äºå®¢æˆ·ç«¯ TLS è®¤è¯çš„è¯ä¹¦ã€‚å¦‚æœ <code>mode</code> å–å€¼ä¸º <code>ISTIO_MUTUAL</code>ï¼Œè¯¥å­—æ®µåº”è¯¥ä¸ºç©ºã€‚</td></tr><tr><td><code>privateKey</code></td><td><code>string</code></td><td><code>mode</code> å­—æ®µä¸º <code>MUTUAL</code> çš„æƒ…å†µä¸‹ï¼Œè¯¥å­—æ®µä¸ºå¿…è¦å­—æ®µã€‚è¯¥å­—æ®µçš„å€¼ä»£è¡¨å®¢æˆ·ç«¯ç§é’¥æ–‡ä»¶ã€‚å¦‚æœ <code>mode</code> å–å€¼ä¸º <code>ISTIO_MUTUAL</code>ï¼Œè¯¥å­—æ®µåº”è¯¥ä¸ºç©ºã€‚</td></tr><tr><td><code>caCertificates</code></td><td><code>string</code></td><td>å¯é€‰å­—æ®µã€‚è¿™ä¸€å­—æ®µåŒ…å«äº†ç”¨äºéªŒè¯æœåŠ¡ç«¯è¯ä¹¦çš„ ca è¯ä¹¦ã€‚å¦‚æœçœç•¥è¯¥å­—æ®µï¼Œåˆ™ä¸ä¼šå¯¹æœåŠ¡ç«¯è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚å¦‚æœ <code>mode</code> å–å€¼ä¸º <code>ISTIO_MUTUAL</code>ï¼Œè¯¥å­—æ®µåº”è¯¥ä¸ºç©ºã€‚</td></tr><tr><td><code>subjectAltNames</code></td><td><code>string[]</code></td><td>ä¸€ä¸ªå¯é€‰åç§°åˆ—è¡¨ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦ä¸­çš„ä¸»ä½“æ ‡è¯†ã€‚å¦‚æœè¯¥å­—æ®µæœ‰èµ‹å€¼ï¼Œä»£ç†æœåŠ¡å™¨ä¼šæ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦ä¸­çš„è®°å½•æ˜¯å¦åœ¨è¯¥å­—æ®µçš„èŒƒå›´ä¹‹å†…ã€‚å¦‚æœ <code>mode</code> å–å€¼ä¸º <code>ISTIO_MUTUAL</code>ï¼Œè¯¥å­—æ®µåº”è¯¥ä¸ºç©ºã€‚</td></tr><tr><td><code>sni</code></td><td><code>string</code></td><td>TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ SNI å­—ç¬¦ä¸²ã€‚å¦‚æœ <code>mode</code> å–å€¼ä¸º <code>ISTIO_MUTUAL</code>ï¼Œè¯¥å­—æ®µåº”è¯¥ä¸ºç©ºã€‚</td></tr></tbody></table><h2 id=tlssettings-tlsmode><code>TLSSettings.TLSmode</code></h2><p>TLS è¿æ¥æ¨¡å¼ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>DISABLE</code></td><td>ä¸è¦ä¸ºä¸Šæ¸¸ç«¯ç‚¹ä½¿ç”¨ TLSã€‚</td></tr><tr><td><code>SIMPLE</code></td><td>å‘ä¸Šæ¸¸ç«¯ç‚¹å‘èµ· TLS è¿æ¥ã€‚</td></tr><tr><td><code>MUTUAL</code></td><td>å‘é€å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œç”¨åŒå‘ TLS è¿æ¥ä¸Šæ¸¸ç«¯ç‚¹ã€‚</td></tr><tr><td><code>ISTIO_MUTUAL</code></td><td>å‘é€å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œç”¨åŒå‘ TLS è¿æ¥ä¸Šæ¸¸ç«¯ç‚¹ã€‚å’Œ <code>MUTUAL</code> ç›¸æ¯”ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨çš„åŒå‘ TLS è¯ä¹¦ç³»ç»Ÿæ˜¯ç”± Istio ç”Ÿæˆçš„ã€‚å¦‚æœä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œ<code>TLSSettings</code> ä¸­çš„å…¶ä»–å­—æ®µåº”è¯¥ç•™ç©ºã€‚</td></tr></tbody></table><h2 id=trafficpolicy><code>TrafficPolicy</code></h2><p>ç‰¹å®šç›®æ ‡çš„æµé‡ç­–ç•¥ï¼Œå¯¹æ‰€æœ‰ç›®æ ‡ç«¯å£ç”Ÿæ•ˆã€‚å‚è€ƒ <code>DestinationRule</code>ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>loadBalancer</code></td><td><a href=#loadbalancersettings><code>LoadBalancerSettings</code></a></td><td>è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</td></tr><tr><td><code>connectionPool</code></td><td><a href=#connectionpoolsettings><code>ConnectionPoolSettings</code></a></td><td>è®¾ç½®ä¸Šæ¸¸æœåŠ¡çš„è¿æ¥æ± ã€‚</td></tr><tr><td><code>outlierDetection</code></td><td><a href=#outlierdetection><code>OutlierDetection</code></a></td><td>ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤ä¸å¥åº·ä¸»æœºçš„è®¾ç½®ã€‚</td></tr><tr><td><code>tls</code></td><td><a href=#tlssettings><code>TLSSettings</code></a></td><td>å’Œä¸Šæ¸¸æœåŠ¡è¿›è¡Œ TLS è¿æ¥çš„ç›¸å…³è®¾ç½®ã€‚</td></tr><tr><td><code>portLevelSettings</code></td><td><a href=#trafficpolicy-porttrafficpolicy><code>TrafficPolicy.PortTrafficPolicy[]</code></a></td><td>é’ˆå¯¹å•ç‹¬ç«¯å£è®¾ç½®çš„æµé‡ç­–ç•¥ã€‚ç«¯å£çº§åˆ«çš„ç­–ç•¥è®¾ç½®ä¼šè¦†ç›–ç›®æ ‡çº§åˆ«çš„ç­–ç•¥ï¼Œå¦å¤–åœ¨ç«¯å£çº§åˆ«ç­–ç•¥ä¸­çœç•¥çš„å­—æ®µä¼šä»¥ç¼ºçœå€¼è¿›è¡Œå·¥ä½œï¼Œè€Œä¸ä¼šç»§æ‰¿ç›®æ ‡çº§ç­–ç•¥ä¸­çš„è®¾ç½®ã€‚</td></tr></tbody></table><h2 id=trafficpolicy-porttrafficpolicy><code>TrafficPolicy.PortTrafficPolicy</code></h2><p>åº”ç”¨åˆ°æœåŠ¡ç«¯å£çš„æµé‡ç­–ç•¥ã€‚</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>port</code></td><td><a href=#portselector><code>PortSelector</code></a></td><td></td></tr><tr><td><code>loadBalancer</code></td><td><a href=#loadbalancersettings><code>LoadBalancerSettings</code></a></td><td>è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</td></tr><tr><td><code>connectionPool</code></td><td><a href=#connectionpoolsettings><code>ConnectionPoolSettings</code></a></td><td>è®¾ç½®ä¸Šæ¸¸æœåŠ¡çš„è¿æ¥æ± ã€‚</td></tr><tr><td><code>outlierDetection</code></td><td><a href=#outlierdetection><code>OutlierDetection</code></a></td><td>ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤ä¸å¥åº·ä¸»æœºçš„è®¾ç½®ã€‚</td></tr><tr><td><code>tls</code></td><td><a href=#tlssettings><code>TLSSettings</code></a></td><td>å’Œä¸Šæ¸¸æœåŠ¡è¿›è¡Œ TLS è¿æ¥çš„ç›¸å…³è®¾ç½®ã€‚</td></tr></tbody></table><h2 id=virtualservice><code>VirtualService</code></h2><p><code>VirtualService</code> å®šä¹‰äº†ä¸€ç³»åˆ—é’ˆå¯¹æŒ‡å®šæœåŠ¡çš„æµé‡è·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½é’ˆå¯¹ç‰¹å®šåè®®çš„åŒ¹é…è§„åˆ™ã€‚å¦‚æœæµé‡ç¬¦åˆè¿™äº›ç‰¹å¾ï¼Œå°±ä¼šæ ¹æ®è§„åˆ™å‘é€åˆ°æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ç›®æ ‡æœåŠ¡ï¼ˆæˆ–è€…ç›®æ ‡æœåŠ¡çš„å­é›†æˆ–ç‰ˆæœ¬ï¼‰ã€‚</p><p>åŒ¹é…è§„åˆ™ä¸­è¿˜åŒ…å«äº†å¯¹æµé‡å‘èµ·æ–¹çš„å®šä¹‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè§„åˆ™è¿˜å¯ä»¥é’ˆå¯¹ç‰¹å®šå®¢æˆ·ä¸Šä¸‹æ–‡è¿›è¡Œå®šåˆ¶ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª Kubernetes ä¸Šçš„ä¾‹å­ï¼Œç¼ºçœæŠŠæ‰€æœ‰çš„ HTTP æµé‡å‘é€ç»™ <code>reviews</code> æœåŠ¡ä¸­æ ‡ç­¾ä¸º <code>version: v1</code> çš„ Podã€‚å¦å¤–åŒ…å« <code>/wpcatalog/</code> æˆ– <code>/consumercatalog/</code> URL å‰ç¼€çš„è¯·æ±‚ä¼šè¢«é‡å†™ä¸º <code>/newcatalog</code> å¹¶å‘é€ç»™æ ‡ç­¾ä¸º <code>version: v2</code> çš„ Podã€‚</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  http:
  - match:
    - uri:
        prefix: &#34;/wpcatalog&#34;
    - uri:
        prefix: &#34;/consumercatalog&#34;
    rewrite:
      uri: &#34;/newcatalog&#34;
    route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v2
  - route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v1
</code></pre><p>ç›®æ ‡çš„çš„å­é›†æˆ–è€…è¯´ç‰ˆæœ¬æ˜¯é€šè¿‡ <code>DestinationRule</code> ä¸­çš„å®šä¹‰å¾—æ¥çš„ï¼š</p><pre><code class=language-yaml data-expandlinks=true>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: reviews-destination
spec:
  host: reviews.prod.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
</code></pre><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>hosts</code></td><td><code>string[]</code></td><td>å¿…è¦å­—æ®µï¼šæµé‡çš„ç›®æ ‡ä¸»æœºã€‚å¯ä»¥æ˜¯å¸¦æœ‰é€šé…ç¬¦å‰ç¼€çš„ DNS åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¯ IP åœ°å€ã€‚æ ¹æ®æ‰€åœ¨å¹³å°æƒ…å†µï¼Œè¿˜å¯èƒ½ä½¿ç”¨çŸ­åç§°æ¥ä»£æ›¿ FQDNã€‚è¿™ç§åœºæ™¯ä¸‹ï¼ŒçŸ­åç§°åˆ° FQDN çš„å…·ä½“è½¬æ¢è¿‡ç¨‹æ˜¯è¦é ä¸‹å±‚å¹³å°å®Œæˆçš„ã€‚<strong>ä¸€ä¸ªä¸»æœºååªèƒ½åœ¨ä¸€ä¸ª <code>VirtualService</code> ä¸­å®šä¹‰ã€‚</strong>åŒä¸€ä¸ª <code>VirtualService</code> ä¸­å¯ä»¥ç”¨äºæ§åˆ¶å¤šä¸ª HTTP å’Œ TCP ç«¯å£çš„æµé‡å±æ€§ã€‚ Kubernetes ç”¨æˆ·æ³¨æ„ï¼šå½“ä½¿ç”¨æœåŠ¡çš„çŸ­åç§°æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>reviews</code>ï¼Œè€Œä¸æ˜¯ <code>reviews.default.svc.cluster.local</code>ï¼‰ï¼ŒIstio ä¼šæ ¹æ®è§„åˆ™æ‰€åœ¨çš„å‘½åç©ºé—´æ¥å¤„ç†è¿™ä¸€åç§°ï¼Œè€ŒéæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚å‡è®¾ â€œdefaultâ€ å‘½åç©ºé—´çš„ä¸€æ¡è§„åˆ™ä¸­åŒ…å«äº†ä¸€ä¸ª <code>reviews</code> çš„ <code>host</code> å¼•ç”¨ï¼Œå°±ä¼šè¢«è§†ä¸º <code>reviews.default.svc.cluster.local</code>ï¼Œè€Œä¸ä¼šè€ƒè™‘ <code>reviews</code> æœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚<strong>ä¸ºäº†é¿å…å¯èƒ½çš„é”™è¯¯é…ç½®ï¼Œå»ºè®®ä½¿ç”¨ FQDN æ¥è¿›è¡ŒæœåŠ¡å¼•ç”¨ã€‚</strong> <code>hosts</code> å­—æ®µå¯¹ HTTP å’Œ TCP æœåŠ¡éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ç½‘æ ¼ä¸­çš„æœåŠ¡ä¹Ÿå°±æ˜¯åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„æœåŠ¡ï¼Œå¿…é¡»ä½¿ç”¨ä»–ä»¬çš„æ³¨å†Œåè¿›è¡Œå¼•ç”¨ï¼›åªæœ‰ <code>Gateway</code> å®šä¹‰çš„æœåŠ¡æ‰å¯ä»¥ä½¿ç”¨ IP åœ°å€ã€‚</td></tr><tr><td><code>gateways</code></td><td><code>string[]</code></td><td><code>Gateway</code> åç§°åˆ—è¡¨ï¼ŒSidecar ä¼šæ®æ­¤ä½¿ç”¨è·¯ç”±ã€‚<code>VirtualService</code> å¯¹è±¡å¯ä»¥ç”¨äºç½‘æ ¼ä¸­çš„ Sidecarï¼Œä¹Ÿå¯ä»¥ç”¨äºä¸€ä¸ªæˆ–å¤šä¸ª <code>Gateway</code>ã€‚è¿™é‡Œå…¬å¼€çš„é€‰æ‹©æ¡ä»¶å¯ä»¥åœ¨åè®®ç›¸å…³çš„è·¯ç”±è¿‡æ»¤æ¡ä»¶ä¸­è¿›è¡Œè¦†ç›–ã€‚ä¿ç•™å­— <code>mesh</code> ç”¨æ¥æŒ‡ä»£ç½‘æ ¼ä¸­çš„æ‰€æœ‰ Sidecarã€‚å½“è¿™ä¸€å­—æ®µè¢«çœç•¥æ—¶ï¼Œå°±ä¼šä½¿ç”¨ç¼ºçœå€¼ï¼ˆ<code>mesh</code>ï¼‰ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹ç½‘æ ¼ä¸­çš„æ‰€æœ‰ Sidecar ç”Ÿæ•ˆã€‚å¦‚æœæä¾›äº† <code>gateways</code> å­—æ®µï¼Œè¿™ä¸€è§„åˆ™å°±åªä¼šåº”ç”¨åˆ°å£°æ˜çš„ <code>Gateway</code> ä¹‹ä¸­ã€‚è¦è®©è§„åˆ™åŒæ—¶å¯¹ <code>Gateway</code> å’Œç½‘æ ¼å†…æœåŠ¡ç”Ÿæ•ˆï¼Œéœ€è¦æ˜¾å¼çš„å°† <code>mesh</code> åŠ å…¥ <code>gateways</code> åˆ—è¡¨ã€‚</td></tr><tr><td><code>http</code></td><td><a href=#httproute><code>HTTPRoute[]</code></a></td><td>HTTP æµé‡è§„åˆ™çš„æœ‰åºåˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨å¯¹åç§°å‰ç¼€ä¸º <code>http-</code>ã€<code>http2-</code>ã€<code>grpc-</code> çš„æœåŠ¡ç«¯å£ï¼Œæˆ–è€…åè®®ä¸º <code>HTTP</code>ã€<code>HTTP2</code>ã€<code>GRPC</code> ä»¥åŠç»ˆç»“çš„ TLSï¼Œå¦å¤–è¿˜æœ‰ä½¿ç”¨ <code>HTTP</code>ã€<code>HTTP2</code> ä»¥åŠ <code>GRPC</code> åè®®çš„ <code>ServiceEntry</code> éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚è¿›å…¥æµé‡ä¼šä½¿ç”¨åŒ¹é…åˆ°çš„ç¬¬ä¸€æ¡è§„åˆ™ã€‚</td></tr><tr><td><code>tls</code></td><td><a href=#tlsroute><code>TLSRoute[]</code></a></td><td>ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œå¯¹åº”çš„æ˜¯é€ä¼  TLS å’Œ HTTPS æµé‡ã€‚è·¯ç”±è¿‡ç¨‹é€šå¸¸åˆ©ç”¨ <code>ClientHello</code> æ¶ˆæ¯ä¸­çš„ SNI æ¥å®Œæˆã€‚TLS è·¯ç”±é€šå¸¸åº”ç”¨åœ¨ <code>https-</code>ã€<code>tls-</code> å‰ç¼€çš„å¹³å°æœåŠ¡ç«¯å£ï¼Œæˆ–è€…ç» <code>Gateway</code> é€ä¼ çš„ HTTPSã€TLS åè®®ç«¯å£ï¼Œä»¥åŠä½¿ç”¨ HTTPS æˆ–è€… TLS åè®®çš„ <code>ServiceEntry</code> ç«¯å£ä¸Šã€‚<strong>æ³¨æ„ï¼šæ²¡æœ‰å…³è” <code>VirtualService</code> çš„ <code>https-</code> æˆ–è€… <code>tls-</code> ç«¯å£æµé‡ä¼šè¢«è§†ä¸ºé€ä¼  TCP æµé‡ã€‚</strong></td></tr><tr><td><code>tcp</code></td><td><a href=#tcproute><code>TCPRoute[]</code></a></td><td>ä¸€ä¸ªé’ˆå¯¹é€ä¼  TCP æµé‡çš„æœ‰åºè·¯ç”±åˆ—è¡¨ã€‚TCP è·¯ç”±å¯¹æ‰€æœ‰ HTTP å’Œ TLS ä¹‹å¤–çš„ç«¯å£ç”Ÿæ•ˆã€‚è¿›å…¥æµé‡ä¼šä½¿ç”¨åŒ¹é…åˆ°çš„ç¬¬ä¸€æ¡è§„åˆ™ã€‚</td></tr></tbody></table></article><nav class=pagenav><div class=left><a title="æè¿°äº†ä½¿ç”¨ Helm chart å®‰è£… Istio æ—¶å¯ä»¥ä½¿ç”¨çš„é€‰é¡¹ã€‚" href=/v1.2/zh/docs/reference/config/installation-options/><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#left-arrow"/></svg>å®‰è£…é€‰é¡¹</a></div><div class=right></div></nav><div id=endnotes-container aria-hidden=true><h2>é“¾æ¥</h2><ol id=endnotes></ol></div></div><div class=toc-container><nav class=toc aria-label="Table of Contents"><div id=toc><ol><li role=none aria-label=ConnectionPoolSettings><a href=#connectionpoolsettings><code>ConnectionPoolSettings</code></a><li role=none aria-label=ConnectionPoolSettings.HTTPSettings><a href=#connectionpoolsettings-httpsettings><code>ConnectionPoolSettings.HTTPSettings</code></a><li role=none aria-label=ConnectionPoolSettings.TCPSettings><a href=#connectionpoolsettings-tcpsettings><code>ConnectionPoolSettings.TCPSettings</code></a><li role=none aria-label=CorsPolicy><a href=#corspolicy><code>CorsPolicy</code></a><li role=none aria-label=Destination><a href=#destination><code>Destination</code></a><li role=none aria-label=DestinationRule><a href=#destinationrule><code>DestinationRule</code></a><li role=none aria-label=DestinationWeight><a href=#destinationweight><code>DestinationWeight</code></a><li role=none aria-label=EnvoyFilter><a href=#envoyfilter><code>EnvoyFilter</code></a><li role=none aria-label=EnvoyFilter.Filter><a href=#envoyfilter-filter><code>EnvoyFilter.Filter</code></a><li role=none aria-label=EnvoyFilter.Filter.FilterType><a href=#envoyfilter-filter-filtertype><code>EnvoyFilter.Filter.FilterType</code></a><li role=none aria-label=EnvoyFilter.InsertPosition><a href=#envoyfilter-insertposition><code>EnvoyFilter.InsertPosition</code></a><li role=none aria-label=EnvoyFilter.InsertPosition.Index><a href=#envoyfilter-insertposition-index><code>EnvoyFilter.InsertPosition.Index</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch><a href=#envoyfilter-listenermatch><code>EnvoyFilter.ListenerMatch</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch.ListenerProtocol><a href=#envoyfilter-listenermatch-listenerprotocol><code>EnvoyFilter.ListenerMatch.ListenerProtocol</code></a><li role=none aria-label=EnvoyFilter.ListenerMatch.ListenerType><a href=#envoyfilter-listenermatch-listenertype><code>EnvoyFilter.ListenerMatch.ListenerType</code></a><li role=none aria-label=Gateway><a href=#gateway><code>Gateway</code></a><li role=none aria-label=HTTPFaultInjection><a href=#httpfaultinjection><code>HTTPFaultInjection</code></a><li role=none aria-label=HTTPFaultInjection.Abort><a href=#httpfaultinjection-abort><code>HTTPFaultInjection.Abort</code></a><li role=none aria-label=HTTPFaultInjection.Delay><a href=#httpfaultinjection-delay><code>HTTPFaultInjection.Delay</code></a><li role=none aria-label=HTTPMatchRequest><a href=#httpmatchrequest><code>HTTPMatchRequest</code></a><li role=none aria-label=HTTPRedirect><a href=#httpredirect><code>HTTPRedirect</code></a><li role=none aria-label=HTTPRetry><a href=#httpretry><code>HTTPRetry</code></a><li role=none aria-label=HTTPRewrite><a href=#httprewrite><code>HTTPRewrite</code></a><li role=none aria-label=HTTPRoute><a href=#httproute><code>HTTPRoute</code></a><li role=none aria-label=L4MatchAttributes><a href=#l4matchattributes><code>L4MatchAttributes</code></a><li role=none aria-label=LoadBalancerSettings><a href=#loadbalancersettings><code>LoadBalancerSettings</code></a><li role=none aria-label=LoadBalancerSettings.ConsistentHashLB><a href=#loadbalancersettings-consistenthashlb><code>LoadBalancerSettings.ConsistentHashLB</code></a><li role=none aria-label=LoadBalancerSettings.ConsistentHashLB.HTTPCookie><a href=#loadbalancersettings-consistenthashlb-httpcookie><code>LoadBalancerSettings.ConsistentHashLB.HTTPCookie</code></a><li role=none aria-label=LoadBalancerSettings.SimpleLB><a href=#loadbalancersettings-simplelb><code>LoadBalancerSettings.SimpleLB</code></a><li role=none aria-label=OutlierDetection><a href=#outlierdetection><code>OutlierDetection</code></a><li role=none aria-label=Port><a href=#port><code>Port</code></a><li role=none aria-label=PortSelector><a href=#portselector><code>PortSelector</code></a><li role=none aria-label=Server><a href=#server><code>Server</code></a><li role=none aria-label=Server.TLSOptions><a href=#server-tlsoptions><code>Server.TLSOptions</code></a><li role=none aria-label=Server.TLSOptions.TLSmode><a href=#server-tlsoptions-tlsmode><code>Server.TLSOptions.TLSmode</code></a><li role=none aria-label=ServiceEntry><a href=#serviceentry><code>ServiceEntry</code></a><ol><li role=none aria-label=ç¤ºä¾‹ï¼šåŠ å…¥å¤–éƒ¨æœåŠ¡><a href=#%e7%a4%ba%e4%be%8b-%e5%8a%a0%e5%85%a5%e5%a4%96%e9%83%a8%e6%9c%8d%e5%8a%a1>ç¤ºä¾‹ï¼šåŠ å…¥å¤–éƒ¨æœåŠ¡</a><li role=none aria-label="ç¤ºä¾‹ï¼šTLS é€ä¼ "><a href=#%e7%a4%ba%e4%be%8b-tls-%e9%80%8f%e4%bc%a0>ç¤ºä¾‹ï¼šTLS é€ä¼ </a><li role=none aria-label=è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡><a href=#%e8%bd%ac%e5%8f%91%e6%89%80%e6%9c%89%e5%a4%96%e9%83%a8%e6%b5%81%e9%87%8f>è½¬å‘æ‰€æœ‰å¤–éƒ¨æµé‡</a><li role=none aria-label=ç¤ºä¾‹ï¼šé€šé…ç¬¦åŸŸå><a href=#%e7%a4%ba%e4%be%8b-%e9%80%9a%e9%85%8d%e7%ac%a6%e5%9f%9f%e5%90%8d>ç¤ºä¾‹ï¼šé€šé…ç¬¦åŸŸå</a><li role=none aria-label="Unix Socket è¿æ¥"><a href=#unix-socket-%e8%bf%9e%e6%8e%a5>Unix Socket è¿æ¥</a><li role=none aria-label=ä»£ç†æœåŠ¡å™¨><a href=#%e4%bb%a3%e7%90%86%e6%9c%8d%e5%8a%a1%e5%99%a8>ä»£ç†æœåŠ¡å™¨</a></ol></li><li role=none aria-label=ServiceEntry.Endpoint><a href=#serviceentry-endpoint><code>ServiceEntry.Endpoint</code></a><li role=none aria-label=ServiceEntry.Location><a href=#serviceentry-location><code>ServiceEntry.Location</code></a><li role=none aria-label=ServiceEntry.Resolution><a href=#serviceentry-resolution><code>ServiceEntry.Resolution</code></a><li role=none aria-label=StringMatch><a href=#stringmatch><code>StringMatch</code></a><li role=none aria-label=Subset><a href=#subset><code>Subset</code></a><li role=none aria-label=TCPRoute><a href=#tcproute><code>TCPRoute</code></a><li role=none aria-label=TLSMatchAttributes><a href=#tlsmatchattributes><code>TLSMatchAttributes</code></a><li role=none aria-label=TLSRoute><a href=#tlsroute><code>TLSRoute</code></a><li role=none aria-label=TLSSettings><a href=#tlssettings><code>TLSSettings</code></a><li role=none aria-label=TLSSettings.TLSmode><a href=#tlssettings-tlsmode><code>TLSSettings.TLSmode</code></a><li role=none aria-label=TrafficPolicy><a href=#trafficpolicy><code>TrafficPolicy</code></a><li role=none aria-label=TrafficPolicy.PortTrafficPolicy><a href=#trafficpolicy-porttrafficpolicy><code>TrafficPolicy.PortTrafficPolicy</code></a><li role=none aria-label=VirtualService><a href=#virtualservice><code>VirtualService</code></a></ol></div></nav></div></main><footer><div class=user-links><a class=channel title="Go download Istio 1.2.5 now" href=https://github.com/istio/istio/releases/tag/1.2.5 aria-label="Download Istio"><span>download</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#download"/></svg>
</a><a class=channel title="åŠ å…¥ Istio discussion board å‚ä¸è®¨è®ºè·å–å¸®åŠ©" href=https://discuss.istio.io aria-label="Istio discussion board"><span>discuss</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#discourse"/></svg></a>
<a class=channel title="Stack Overflow ä¸­åˆ—ä¸¾äº†é’ˆå¯¹å®é™…é—®é¢˜ä»¥åŠéƒ¨ç½²ã€é…ç½®å’Œä½¿ç”¨ Istio çš„å„é¡¹å›ç­”" href=https://stackoverflow.com/questions/tagged/istio aria-label="Stack Overflow"><span>stack overflow</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#stackoverflow"/></svg></a>
<a class=channel title="åœ¨ Slack ä¸Šä¸ Istio ç¤¾åŒºäº¤äº’è®¨è®ºå¼€å‘é—®é¢˜ï¼ˆä»…é™é‚€è¯·ï¼‰" href=https://istio.slack.com aria-label=slack><span>slack</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#slack"/></svg></a>
<a class=channel title="å…³æ³¨æˆ‘ä»¬çš„ Twitter æ¥è·å–æœ€æ–°ä¿¡æ¯" href=https://twitter.com/IstioMesh aria-label=Twitter><span>twitter</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#twitter"/></svg></a><div class=tag>å¯¹äºç”¨æˆ·</div></div><div class=info><p class=copyright>ä¸­æ–‡å†…å®¹ç”± ServiceMesher ç¤¾åŒºç»´æŠ¤ï¼Œéƒ¨åˆ†æ–‡æ¡£å¯èƒ½ç¨å¾®æ»åäºè‹±æ–‡ç‰ˆæœ¬ï¼ŒåŒæ­¥å·¥ä½œæŒç»­è¿›è¡Œä¸­<br>Istio å½’æ¡£
1.2.5<br>&copy; 2019 Istio Authors, <a href=https://policies.google.com/privacy>éšç§æ”¿ç­–</a><br>å½’æ¡£äº 2019å¹´9æœˆ12æ—¥</p></div><div class=dev-links><a class=channel title="Istio çš„ä»£ç åœ¨ GitHub ä¸Šå¼€å‘" href=https://github.com/istio/community aria-label=GitHub><span>github</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#github"/></svg></a>
<a class=channel title="å¦‚æœæ‚¨æƒ³æ·±å…¥äº†è§£ Istio çš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬æ—¥ç›Šå®Œå–„çš„è®¾è®¡æ–‡æ¡£" href=https://groups.google.com/forum/#!forum/istio-team-drive-access aria-label="team drive"><span>drive</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#drive"/></svg></a>
<a class=channel title="å¦‚æœæ‚¨æƒ³ä¸º Istio é¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œè¯·è€ƒè™‘åŠ å…¥æˆ‘ä»¬çš„å·¥ä½œç»„" href=https://github.com/istio/community/blob/master/WORKING-GROUPS.md aria-label="working groups"><span>working groups</span><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#working-groups"/></svg></a><div class=tag>å¯¹äºå¼€å‘è€…</div></div></footer><div id=scroll-to-top-container aria-hidden=true><button id=scroll-to-top title=å›åˆ°é¡¶éƒ¨><svg class="icon"><use xlink:href="/v1.2/img/icons.svg#top"/></svg></button></div></body></html>