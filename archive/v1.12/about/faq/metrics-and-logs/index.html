<!doctype html><html lang=en itemscope itemtype=https://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#466BB0"><meta name=title content="Metrics and Logs FAQ"><meta name=description content="Metrics and Logs Q & A."><meta name=keywords content="microservices,services,mesh"><meta property="og:title" content="Metrics and Logs FAQ"><meta property="og:type" content="website"><meta property="og:description" content="Metrics and Logs Q & A."><meta property="og:url" content="/v1.12/about/faq/metrics-and-logs/"><meta property="og:image" content="https://raw.githubusercontent.com/istio/istio.io/master/static/img/istio-whitelogo-bluebackground-framed.svg"><meta property="og:image:alt" content="Istio Logo"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="1024"><meta property="og:site_name" content="Istio"><meta name=twitter:card content="summary"><meta name=twitter:site content="@IstioMesh"><title>Istioldie 1.12 / Metrics and Logs FAQ</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98480406-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-98480406-2');</script><link rel=alternate type=application/rss+xml title="Istio Blog" href=/v1.12/blog/feed.xml><link rel=alternate type=application/rss+xml title="Istio News" href=/v1.12/news/feed.xml><link rel=alternate type=application/rss+xml title="Istio Blog and News" href=/v1.12/feed.xml><link rel="shortcut icon" href=/v1.12/favicons/favicon.ico><link rel=apple-touch-icon href=/v1.12/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/v1.12/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/v1.12/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/v1.12/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/v1.12/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/v1.12/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/v1.12/favicons/android-96x96.png sizes=96xW96><link rel=icon type=image/png href=/v1.12/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/v1.12/favicons/android-192x192.png sizes=192x192><link rel=mask-icon href=/v1.12/favicons/safari-pinned-tab.svg color=#466bb0><link rel=manifest href=/v1.12/manifest.json><meta name=apple-mobile-web-app-title content="Istio"><meta name=application-name content="Istio"><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#466BB0"><meta name=theme-color content="#466BB0"><link rel=stylesheet href=/v1.12/css/all.css><link rel=preconnect href=https://fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap"><script src=/v1.12/js/themes_init.min.js></script></head><body class="language-unknown archive-site"><script>const branchName="release-1.12";const docTitle="Metrics and Logs FAQ";const iconFile="\/v1.12/img/icons.svg";const buttonCopy='Copy to clipboard';const buttonPrint='Print';const buttonDownload='Download';</script><script src="https://www.google.com/cse/brand?form=search-form" defer></script><script src=/v1.12/js/all.min.js data-manual defer></script><header class=main-navigation><nav class="main-navigation-wrapper container-l"><div class=main-navigation-header><a id=brand href=/v1.12/><span class=logo><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371 7.869 7.869.0 013.066-4.178 9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></span></a><button id=hamburger class=main-navigation-toggle aria-label="Open navigation"><svg class="icon menu-hamburger"><use xlink:href="/v1.12/img/icons.svg#menu-hamburger"/></svg></button>
<button id=menu-close class=main-navigation-toggle aria-label="Close navigation"><svg class="icon menu-close"><use xlink:href="/v1.12/img/icons.svg#menu-close"/></svg></button></div><div id=header-links class=main-navigation-links-wrapper><ul class=main-navigation-links><li class=main-navigation-links-item><a class="main-navigation-links-link has-dropdown"><span>About</span><svg class="icon dropdown-arrow"><use xlink:href="/v1.12/img/icons.svg#dropdown-arrow"/></svg></a><ul class=main-navigation-links-dropdown><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/service-mesh class=main-navigation-links-link>Service mesh</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/solutions class=main-navigation-links-link>Solutions</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/case-studies class=main-navigation-links-link>Case studies</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/ecosystem class=main-navigation-links-link>Ecosystem</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/deployment class=main-navigation-links-link>Deployment</a></li><li class=main-navigation-links-dropdown-item><a href=/v1.12/about/faq class=main-navigation-links-link>FAQ</a></li></ul></li><li class=main-navigation-links-item><a href=/v1.12/blog/ class=main-navigation-links-link><span>Blog</span></a></li><li class=main-navigation-links-item><a href=/v1.12/news/ class=main-navigation-links-link><span>News</span></a></li><li class=main-navigation-links-item><a href=/v1.12/get-involved/ class=main-navigation-links-link><span>Get involved</span></a></li><li class=main-navigation-links-item><a href=/v1.12/docs/ class=main-navigation-links-link><span>Documentation</span></a></li></ul><div class=main-navigation-footer><button id=search-show class=search-show title="Search this site" aria-label=Search><svg class="icon magnifier"><use xlink:href="/v1.12/img/icons.svg#magnifier"/></svg></button>
<a href=/v1.12/docs/setup/getting-started class="btn btn--primary" id=try-istio>Try Istio</a></div></div><form id=search-form class=search name=cse role=search><input type=hidden name=cx value=002184991200833970123:iwwf17ikgf4>
<input type=hidden name=ie value=utf-8>
<input type=hidden name=hl value=en>
<input type=hidden id=search-page-url value=/search>
<input id=search-textbox class="search-textbox form-control" name=q type=search aria-label="Search this site" placeholder=Search>
<button id=search-close title="Cancel search" type=reset aria-label="Cancel search"><svg class="icon menu-close"><use xlink:href="/v1.12/img/icons.svg#menu-close"/></svg></button></form></nav></header><div class=banner-container><a href=/v1.12/news/releases/1.12.x/announcing-1.12.3/ class=banner data-title="Latest Release-2022-02-11 00:00:00 +0000 UTC" data-period-start=1644537600000 data-period-end=1645142400000 data-max-impressions=3 data-timeout><div class=content><p>Istio 1.12.3 is now available! Click here to learn more</p></div><div class=frame></div></a></div><nav aria-label=Breadcrumb class=container-l><ol><li><a href title="Get a bit more in-depth info about the Istio project.">About</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.12/img/icons.svg#breadcrumb-arrow"/></svg></li><li><a href=/v1.12/about/faq/ title="Frequently Asked Questions about Istio.">FAQ</a><svg class="icon breadcrumb-arrow"><use xlink:href="/v1.12/img/icons.svg#breadcrumb-arrow"/></svg></li><li>Metrics and Logs</li></ol></nav><main class="primary container about"><div class=article-container><article aria-labelledby=title><div class=title-area><div style=width:100%><h1 id=title>Metrics and Logs FAQ</h1></div></div><nav class="toc-inlined toc-forced"><hr><div class=directory role=directory><nav id=InlineTableOfContents><ol><li role=none aria-label="Can Istio metrics be accessed through REST?"><a href=#accessing-telemetry-via-rest>Can Istio metrics be accessed through REST?</a></li><li role=none aria-label="What are the differences in telemetry reported by in-proxy telemetry (aka v2) and Mixer-based telemetry (aka v1)?"><a href=#telemetry-v1-vs-v2>What are the differences in telemetry reported by in-proxy telemetry (aka v2) and Mixer-based telemetry (aka v1)?</a></li><li role=none aria-label="How can I manage short-lived metrics?"><a href=#metric-expiry>How can I manage short-lived metrics?</a></li><li role=none aria-label="How do I migrate existing Mixer functionality?"><a href=#mixer-migration>How do I migrate existing Mixer functionality?</a></li><li role=none aria-label="Can the Prometheus adapter be used in non-Kubernetes environments?"><a href=#prometheus-for-non-k8s>Can the Prometheus adapter be used in non-Kubernetes environments?</a></li><li role=none aria-label="How to figure out what happened to a request in Istio?"><a href=#life-of-a-request>How to figure out what happened to a request in Istio?</a></li><li role=none aria-label="Can I use Prometheus to scrape application metrics with Istio?"><a href=#prometheus-application-metrics>Can I use Prometheus to scrape application metrics with Istio?</a></li></ol></nav></div><hr></nav><div class=faq><h5 id=accessing-telemetry-via-rest class=question>Can Istio metrics be accessed through REST?</h5><div class=answer><p>You can collect telemetry data about Istio using <a href=/v1.12/docs/tasks/observability/metrics/querying-metrics/>Prometheus</a>. And then use
<a href=https://prometheus.io/docs/prometheus/latest/querying/api/>Prometheus’s HTTP API</a> to query that data.</p></div><h5 id=telemetry-v1-vs-v2 class=question>What are the differences in telemetry reported by in-proxy telemetry (aka v2) and Mixer-based telemetry (aka v1)?</h5><div class=answer><p>In-proxy telemetry (aka v2) reduces resource cost and improves proxy
performance as compared to the Mixer-based telemetry (aka v1) approach,
and is the preferred mechanism for surfacing telemetry in Istio.
However, there are few differences in reported telemetry between v1 and
v2 which are listed below:</p><ul><li><p><strong>Missing labels for out-of-mesh traffic</strong>
In-proxy telemetry relies on metadata exchange between Envoy proxies to gather
information like peer workload name, namespace and labels. In Mixer-based telemetry
this functionality was performed by Mixer as part of combining request attributes
with the platform data. This metadata exchange is performed by the Envoy proxies
by adding a specific HTTP header for HTTP protocol or augmenting
ALPN protocol for TCP protocol as described
<a href=/v1.12/docs/tasks/observability/metrics/tcp-metrics/#understanding-tcp-telemetry-collection>here</a>.
This requires Envoy proxies to be injected at both the client & server workloads,
implying that the telemetry reported when one peer is not in the mesh will be
missing peer attributes like workload name, namespace and labels.
However, if both peers have proxies injected all the labels mentioned
<a href=/v1.12/docs/reference/config/metrics/>here</a> are available in the generated metrics.
When the server workload is out of the mesh, server workload metadata is still
distributed to client sidecar, causing client side metrics to have server workload
metadata labels filled.</p></li><li><p><strong>TCP metadata exchange requires mTLS</strong>
TCP metadata exchange relies on the <a href=/v1.12/docs/tasks/observability/metrics/tcp-metrics/#understanding-tcp-telemetry-collection>Istio ALPN protocol</a>
which requires mutual TLS (mTLS) to be enabled for the Envoy proxies
to exchange metadata successfully. This implies that if mTLS is not
enabled in your cluster, telemetry for TCP protocol will not include
peer information like workload name, namespace and labels.</p></li><li><p><strong>No mechanism for configuring custom buckets for histogram metrics</strong>
Mixer-based telemetry supported customizing buckets for histogram type metrics
like request duration and TCP byte sizes. In-proxy telemetry has no such
available mechanism. Additionally, the buckets available for latency metrics
in in-proxy telemetry are in milliseconds as compared to seconds
in Mixer-based telemetry. However, more buckets are available by default
in in-proxy telemetry for latency metrics at the lower latency levels.</p></li><li><p><strong>No metric expiration for short-lived metrics</strong>
Mixer-based telemetry supported metric expiration whereby metrics which were
not generated for a configurable amount of time were de-registered for
collection by Prometheus. This is useful in scenarios, such as one-off jobs, that generate short-lived metrics. De-registering
the metrics prevents reporting of metrics which would no longer change in the
future, thereby reducing network traffic and storage in Prometheus.
This expiration mechanism is not available in in-proxy telemetry.
The workaround for this can be found <a href=/v1.12/about/faq/#metric-expiry>here</a>.</p></li></ul></div><h5 id=metric-expiry class=question>How can I manage short-lived metrics?</h5><div class=answer><p>Short-lived metrics can hamper the performance of Prometheus, as they often are a large source of label cardinality. Cardinality is a measure of the number of unique values for a label. To manage the impact of your short-lived metrics on Prometheus, you must first identify the high cardinality metrics and labels. Prometheus provides cardinality information at its <code>/status</code> page. Additional information can be retrieved <a href=https://www.robustperception.io/which-are-my-biggest-metrics>via PromQL</a>.
There are several ways to reduce the cardinality of Istio metrics:</p><ul><li>Disable host header fallback.
The <code>destination_service</code> label is one potential source of high-cardinality.
The values for <code>destination_service</code> default to the host header if the Istio proxy is not able to determine the destination service from other request metadata.
If clients are using a variety of host headers, this could result in a large number of values for the <code>destination_service</code>.
In this case, follow the <a href=/v1.12/docs/tasks/observability/metrics/customize-metrics/>metric customization</a> guide to disable host header fallback mesh wide.
To disable host header fallback for a particular workload or namespace, you need to copy the stats <code>EnvoyFilter</code> configuration, update it to have host header fallback disabled, and apply it with a more specific selector.
<a href=https://github.com/istio/istio/issues/25963#issuecomment-666037411>This issue</a> has more detail on how to achieve this.</li><li>Drop unnecessary labels from collection. If the label with high cardinality is not needed, you can drop it from metric collection via <a href=/v1.12/docs/tasks/observability/metrics/customize-metrics/>metric customization</a> using <code>tags_to_remove</code>.</li><li>Normalize label values, either through federation or classification.
If the information provided by the label is desired, you can use <a href=/v1.12/docs/ops/best-practices/observability/#using-prometheus-for-production-scale-monitoring>Prometheus federation</a> or <a href=/v1.12/docs/tasks/observability/metrics/classify-metrics/>request classification</a> to normalize the label.</li></ul></div><h5 id=mixer-migration class=question>How do I migrate existing Mixer functionality?</h5><div class=answer><p>Mixer was <a href=/v1.12/news/releases/1.8.x/announcing-1.8/#deprecations>removed in the 1.8 Istio release</a>.
Migration is needed if you still rely on Mixer&rsquo;s built-in adapters or any out-of-process adapters for mesh extension.</p><p>For built-in adapters, several alternatives are provided:</p><ul><li><code>Prometheus</code> and <code>Stackdriver</code> integrations are implemented as <a href=/v1.12/docs/reference/config/proxy_extensions/>proxy extensions</a>.
Customization of telemetry generated by these two extensions can be achieved via <a href=/v1.12/docs/tasks/observability/metrics/classify-metrics/>request classification</a> and <a href=/v1.12/docs/tasks/observability/metrics/customize-metrics/>Prometheus metrics customization</a>.</li><li>Global and Local Rate-Limiting (<code>memquota</code> and <code>redisquota</code> adapters) functionality is provided through the <a href=/v1.12/docs/tasks/policy-enforcement/rate-limit/>Envoy-based rate-limiting solution</a>.</li><li><code>OPA</code> adapter is replaced by the <a href=/v1.12/docs/tasks/security/authorization/authz-custom/>Envoy ext-authz based solution</a>, which supports <a href=https://www.openpolicyagent.org/docs/latest/envoy-introduction/>integration with OPA policy agent</a>.</li></ul><p>For custom out-of-process adapters, migration to Wasm-based extensions is strongly encouraged. Please refer to the guides on <a href=https://github.com/istio-ecosystem/wasm-extensions/blob/master/doc/write-a-wasm-extension-with-cpp.md>Wasm module development</a> and <a href=/v1.12/docs/ops/configuration/extensibility/wasm-module-distribution/>extension distribution</a>. As a temporary solution, you can <a href=https://github.com/istio/istio/wiki/Enabling-Envoy-Authorization-Service-and-gRPC-Access-Log-Service-With-Mixer>enable Envoy ext-authz and gRPC access log API support in Mixer</a>, which allows you to upgrade Istio to post 1.7 versions while still using 1.7 Mixer with out-of-process adapters. This will give you more time to migrate to Wasm-based extensions. Note this temporary solution is not battle-tested and will unlikely get patch fixes, since it is only available on the Istio 1.7 branch which is out of support window after Feb 2021.</p></div><h5 id=prometheus-for-non-k8s class=question>Can the Prometheus adapter be used in non-Kubernetes environments?</h5><div class=answer><p>You can use docker-compose to install Prometheus.</p></div><h5 id=life-of-a-request class=question>How to figure out what happened to a request in Istio?</h5><div class=answer><p>You can enable <a href=/v1.12/docs/tasks/observability/distributed-tracing/>tracing</a> to determine the flow of a request in Istio.</p><p>Additionally, you can use the following commands to know more about the state of the mesh:</p><ul><li><p><a href=/v1.12/docs/reference/commands/istioctl/#istioctl-proxy-config><code>istioctl proxy-config</code></a>: Retrieve information about proxy configuration when running in Kubernetes:</p><pre><code class=language-plain data-expandlinks=true data-repo=istio># Retrieve information about bootstrap configuration for the Envoy instance in the specified pod.
$ istioctl proxy-config bootstrap productpage-v1-bb8d5cbc7-k7qbm

# Retrieve information about cluster configuration for the Envoy instance in the specified pod.
$ istioctl proxy-config cluster productpage-v1-bb8d5cbc7-k7qbm

# Retrieve information about listener configuration for the Envoy instance in the specified pod.
$ istioctl proxy-config listener productpage-v1-bb8d5cbc7-k7qbm

# Retrieve information about route configuration for the Envoy instance in the specified pod.
$ istioctl proxy-config route productpage-v1-bb8d5cbc7-k7qbm

# Retrieve information about endpoint configuration for the Envoy instance in the specified pod.
$ istioctl proxy-config endpoints productpage-v1-bb8d5cbc7-k7qbm

# Try the following to discover more proxy-config commands
$ istioctl proxy-config --help
</code></pre></li><li><p><code>kubectl get</code>: Gets information about different resources in the mesh along with routing configuration:</p><pre><code class=language-plain data-expandlinks=true data-repo=istio># List all virtual services
$ kubectl get virtualservices
</code></pre></li></ul></div><h5 id=prometheus-application-metrics class=question>Can I use Prometheus to scrape application metrics with Istio?</h5><div class=answer><p>Yes. Istio ships with <a href=https://raw.githubusercontent.com/istio/istio/release-1.12/manifests/charts/istio-telemetry/prometheus/templates/configmap.yaml>configuration for Prometheus</a>
that enables collection of application metrics when mutual TLS is enabled or disabled.</p><p>The <code>kubernetes-pods</code> job collects application metrics from pods in environments without mutual TLS. The <code>kubernetes-pods-istio-secure</code> job collects metrics
from application pods when mutual TLS is enabled for Istio.</p><p>Both jobs require that the following annotations are added to any deployments from which application metric collection is desired:</p><ul><li><code>prometheus.io/scrape: "true"</code></li><li><code>prometheus.io/path: "&lt;metrics path>"</code></li><li><code>prometheus.io/port: "&lt;metrics port>"</code></li></ul><p>A few notes:</p><ul><li>If the Prometheus pod started before the Istio Citadel pod could generate the required certificates and distribute them to Prometheus, the Prometheus pod will need to
be restarted in order to collect from mutual TLS-protected targets.</li><li>If your application exposes Prometheus metrics on a dedicated port, that port should be added to the service and deployment specifications.</li></ul></div></div></article><nav class=pagenav><div class=left><a title="Security Q & A." href=/v1.12/about/faq/security/ class=next-link><svg class="icon left-arrow"><use xlink:href="/v1.12/img/icons.svg#left-arrow"/></svg>Security</a></div><div class=right><a title="Distributed Tracing Q & A." href=/v1.12/about/faq/distributed-tracing/ class=next-link>Distributed Tracing<svg class="icon right-arrow"><use xlink:href="/v1.12/img/icons.svg#right-arrow"/></svg></a></div></nav><div id=endnotes-container aria-hidden=true><h2>Links</h2><ol id=endnotes></ol></div></div></main><footer class=footer><div class="footer-wrapper container-l"><div class="user-links footer-links"><a class=channel title="GitHub is where development takes place on Istio code" href=https://github.com/istio/community aria-label=GitHub><svg class="icon github"><use xlink:href="/v1.12/img/icons.svg#github"/></svg></a><a class=channel title="Access our team drive if you'd like to take a look at the Istio technical design documents" href=https://groups.google.com/forum/#!forum/istio-team-drive-access aria-label="team drive"><svg class="icon drive"><use xlink:href="/v1.12/img/icons.svg#drive"/></svg></a><a class=channel title="Interactively discuss issues with the Istio community on Slack" href=https://slack.istio.io aria-label=slack><svg class="icon slack"><use xlink:href="/v1.12/img/icons.svg#slack"/></svg></a><a class=channel title="Stack Overflow is where you can ask questions and find curated answers on deploying, configuring, and using Istio" href=https://stackoverflow.com/questions/tagged/istio aria-label="Stack Overflow"><svg class="icon stackoverflow"><use xlink:href="/v1.12/img/icons.svg#stackoverflow"/></svg></a><a class=channel title="Follow us on Twitter to get the latest news" href=https://twitter.com/IstioMesh aria-label=Twitter><svg class="icon twitter"><use xlink:href="/v1.12/img/icons.svg#twitter"/></svg></a></div><hr class=footer-separator role=separator><div class="info footer-info"><a class=logo href=/v1.12/><svg xmlns="http://www.w3.org/2000/svg" width="128" height="60" viewBox="0 0 128 60"><path d="M58.434 48.823A.441.441.0 0158.3 48.497V22.583a.444.444.0 01.134-.326.446.446.0 01.327-.134h3.527a.447.447.0 01.325.134.447.447.0 01.134.326v25.914a.443.443.0 01-.134.326.444.444.0 01-.325.134h-3.527a.444.444.0 01-.327-.134z"/><path d="m70.969 48.477a6.556 6.556.0 01-2.818-1.955 4.338 4.338.0 01-1-2.78v-.345a.443.443.0 01.134-.326.444.444.0 01.326-.135h3.374a.444.444.0 01.326.135.445.445.0 01.134.326v.077a2.014 2.014.0 001.054 1.667 4.672 4.672.0 002.664.709 4.446 4.446.0 002.492-.633 1.862 1.862.0 00.958-1.591 1.426 1.426.0 00-.786-1.322 12.7 12.7.0 00-2.549-.939l-1.457-.46a21.526 21.526.0 01-3.3-1.227 6.57 6.57.0 01-2.262-1.783 4.435 4.435.0 01-.92-2.894 5.081 5.081.0 012.109-4.275 8.993 8.993.0 015.558-1.591 10.445 10.445.0 014.1.748 6.3 6.3.0 012.722 2.07 5 5 0 01.958 3.009.441.441.0 01-.134.326.441.441.0 01-.325.134h-3.258a.441.441.0 01-.326-.134.443.443.0 01-.134-.326 1.974 1.974.0 00-.978-1.667 4.647 4.647.0 00-2.665-.671 4.741 4.741.0 00-2.435.556 1.724 1.724.0 00-.938 1.553 1.512 1.512.0 00.9 1.4 15.875 15.875.0 003.01 1.055l.843.229a27.368 27.368.0 013.412 1.246 6.67 6.67.0 012.338 1.763 4.387 4.387.0 01.958 2.933 4.988 4.988.0 01-2.146 4.275 9.543 9.543.0 01-5.712 1.552 11.626 11.626.0 01-4.227-.709z"/><path d="m97.039 32.837a.443.443.0 01-.326.135h-3.911a.169.169.0 00-.191.192v9.239a2.951 2.951.0 00.632 2.108 2.7 2.7.0 002.013.652h1.15a.444.444.0 01.325.134.441.441.0 01.134.326v2.875a.471.471.0 01-.459.5l-1.994.039a8 8 0 01-4.524-1.035q-1.495-1.035-1.533-3.91V33.166A.17.17.0 0088.164 32.974H85.978A.441.441.0 0185.652 32.839.441.441.0 0185.518 32.513V29.83a.441.441.0 01.134-.326.444.444.0 01.326-.135h2.186a.169.169.0 00.191-.192v-4.485a.438.438.0 01.134-.326.44.44.0 01.325-.134h3.336a.443.443.0 01.325.134.442.442.0 01.135.326v4.485a.169.169.0 00.191.192h3.911a.446.446.0 01.326.135.446.446.0 01.134.326v2.683a.446.446.0 01-.133.324z"/><path d="m101.694 25.917a2.645 2.645.0 01-.767-1.955 2.65 2.65.0 01.767-1.955 2.65 2.65.0 011.955-.767 2.65 2.65.0 011.955.767 2.652 2.652.0 01.767 1.955 2.647 2.647.0 01-.767 1.955 2.646 2.646.0 01-1.955.767 2.645 2.645.0 01-1.955-.767zm-.211 22.906a.441.441.0 01-.134-.326V29.79a.444.444.0 01.134-.326.446.446.0 01.326-.134h3.527a.446.446.0 01.326.134.445.445.0 01.134.326v18.707a.443.443.0 01-.134.326.443.443.0 01-.326.134h-3.527a.443.443.0 01-.326-.134z"/><path d="m114.019 47.734a8.1 8.1.0 01-3.047-4.255 14.439 14.439.0 01-.652-4.37 14.3 14.3.0 01.614-4.371 7.869 7.869.0 013.066-4.178 9.072 9.072.0 015.252-1.5 8.543 8.543.0 015.041 1.5 7.985 7.985.0 013.009 4.14 12.439 12.439.0 01.69 4.37 13.793 13.793.0 01-.651 4.37 8.255 8.255.0 01-3.028 4.275 8.475 8.475.0 01-5.1 1.553 8.754 8.754.0 01-5.194-1.534zm7.629-3.1a4.536 4.536.0 001.476-2.262 11.335 11.335.0 00.383-3.221 10.618 10.618.0 00-.383-3.22 4.169 4.169.0 00-1.457-2.243 4.066 4.066.0 00-2.531-.785 3.942 3.942.0 00-2.453.785 4.376 4.376.0 00-1.5 2.243 11.839 11.839.0 00-.383 3.22 11.84 11.84.0 00.383 3.221 4.222 4.222.0 001.476 2.262 4.075 4.075.0 002.549.8 3.8 3.8.0 002.44-.809z"/><path d="m15.105 32.057v15.565a.059.059.0 01-.049.059L.069 50.25A.06.06.0 01.005 50.167l14.987-33.47a.06.06.0 01.114.025z"/><path d="m17.631 23.087v24.6a.06.06.0 00.053.059l22.449 2.507a.06.06.0 00.061-.084L17.745.032a.06.06.0 00-.114.024z"/><path d="m39.961 52.548-24.833 7.45a.062.062.0 01-.043.0L.079 52.548a.059.059.0 01.026-.113h39.839a.06.06.0 01.017.113z"/></svg></a><div class=footer-languages><a tabindex=-1 role=menuitem lang=en id=switch-lang-en class="footer-languages-item active"><svg class="icon tick"><use xlink:href="/v1.12/img/icons.svg#tick"/></svg>English</a>
<a tabindex=-1 role=menuitem lang=zh id=switch-lang-zh class=footer-languages-item>中文</a></div></div><ul class=footer-policies><li class=footer-policies-item><a class=footer-policies-link href=https://policies.google.com/privacy>Privacy policy</a> |
<a class=footer-policies-link href=https://github.com/istio/istio.io/edit/release-1.12/content/en/about/faq/metrics-and-logs/index.md>Edit this Page on GitHub</a></li></ul><div class=footer-base><span class=footer-base-copyright>&copy; 2021 Istio Authors.</span>
<span class=footer-base-version>Version
Archive
1.12.3</span><ul class=footer-base-releases><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link role=menuitem onclick="navigateToUrlOrRoot('https://istio.io/about\/faq\/metrics-and-logs\/');return false;">current release</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link role=menuitem onclick="navigateToUrlOrRoot('https://preliminary.istio.io/about\/faq\/metrics-and-logs\/');return false;">next release</a></li><li class=footer-base-releases-item><a tabindex=-1 class=footer-base-releases-link role=menuitem href=https://istio.io/archive>older releases</a></li></ul></div></div></footer><div id=scroll-to-top-container aria-hidden=true><button id=scroll-to-top title="Back to top"><svg class="icon top"><use xlink:href="/v1.12/img/icons.svg#top"/></svg></button></div></body></html>